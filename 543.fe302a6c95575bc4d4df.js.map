{"version":3,"file":"543.fe302a6c95575bc4d4df.js","mappings":"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","sources":["webpack://@tstibbs/geo-bagging-ui/./src/js/bundles/ lazy ^\\.\\/.*\\.js$ strict namespace object","webpack://@tstibbs/geo-bagging-ui/../shared/conversion.js","webpack://@tstibbs/geo-bagging-ui/./src/js/bundles/abstract_bundle_builder.js","webpack://@tstibbs/geo-bagging-ui/./src/js/bundles/abstract_geojson_builder.js","webpack://@tstibbs/geo-bagging-ui/./src/js/bundles/abstract_points_builder.js","webpack://@tstibbs/geo-bagging-ui/./src/js/bundles/external-geojson/config.js","webpack://@tstibbs/geo-bagging-ui/./src/js/bundles/external-gpx/config.js","webpack://@tstibbs/geo-bagging-ui/./src/js/config.js","webpack://@tstibbs/geo-bagging-ui/./src/js/constants.js","webpack://@tstibbs/geo-bagging-ui/./src/js/fullscreen_link.js","webpack://@tstibbs/geo-bagging-ui/./src/js/global.js","webpack://@tstibbs/geo-bagging-ui/./src/js/leaflet-plugins/zoom-detector.js","webpack://@tstibbs/geo-bagging-ui/./src/js/mobile.js","webpack://@tstibbs/geo-bagging-ui/./src/js/vendor-wrappers/bing-layer.js","webpack://@tstibbs/geo-bagging-ui/./src/js/layers.js","webpack://@tstibbs/geo-bagging-ui/./src/js/map_view.js","webpack://@tstibbs/geo-bagging-ui/./src/js/vendor-wrappers/leaflet-subgroup.js","webpack://@tstibbs/geo-bagging-ui/./src/js/marker_view.js","webpack://@tstibbs/geo-bagging-ui/./src/js/points_view.js","webpack://@tstibbs/geo-bagging-ui/./src/js/geojson_view.js","webpack://@tstibbs/geo-bagging-ui/./src/js/utils/url_handler.js","webpack://@tstibbs/geo-bagging-ui/./src/js/model_views.js","webpack://@tstibbs/geo-bagging-ui/./src/js/source_loader.js","webpack://@tstibbs/geo-bagging-ui/./src/js/vendor-wrappers/leaflet-matrix-layers-control.js","webpack://@tstibbs/geo-bagging-ui/./src/js/vendor-wrappers/leaflet-control-hider.js","webpack://@tstibbs/geo-bagging-ui/./src/js/selection.js","webpack://@tstibbs/geo-bagging-ui/./src/js/locate.js","webpack://@tstibbs/geo-bagging-ui/./src/js/vendor-wrappers/leaflet-geosearch.js","webpack://@tstibbs/geo-bagging-ui/./src/js/vendor-wrappers/leaflet-mouse-position.js","webpack://@tstibbs/geo-bagging-ui/./src/js/mouseposition_osgb.js","webpack://@tstibbs/geo-bagging-ui/./src/js/vendor-wrappers/leaflet-map-center-coord.js","webpack://@tstibbs/geo-bagging-ui/./src/js/screenposition_osgb.js","webpack://@tstibbs/geo-bagging-ui/./src/js/vendor-wrappers/sidebar.js","webpack://@tstibbs/geo-bagging-ui/./src/js/menu/attribution.js","webpack://@tstibbs/geo-bagging-ui/./src/js/menu/user.js","webpack://@tstibbs/geo-bagging-ui/./src/js/menu/settings/view.js","webpack://@tstibbs/geo-bagging-ui/./src/js/utils/external-source-loader.js","webpack://@tstibbs/geo-bagging-ui/./src/js/menu/external-files/files_view.js","webpack://@tstibbs/geo-bagging-ui/./src/js/menu/external-files/file_load_view.js","webpack://@tstibbs/geo-bagging-ui/./src/js/menu/external-files/file_features_load_view.js","webpack://@tstibbs/geo-bagging-ui/./src/js/menu/constraints/file-constraint-load-view.js","webpack://@tstibbs/geo-bagging-ui/./src/js/menu/constraints/track_load_view.js","webpack://@tstibbs/geo-bagging-ui/./src/js/menu/constraints/current_location_view.js","webpack://@tstibbs/geo-bagging-ui/./src/js/menu/constraints/current_area_view.js","webpack://@tstibbs/geo-bagging-ui/./src/js/menu/constraints/geo-json-load-view.js","webpack://@tstibbs/geo-bagging-ui/./src/js/utils/polygon-merger.js","webpack://@tstibbs/geo-bagging-ui/./src/js/menu/constraints/view.js","webpack://@tstibbs/geo-bagging-ui/./src/js/constraints/visits-excel-parser.js","webpack://@tstibbs/geo-bagging-ui/./src/js/menu/visits/visits_load_view.js","webpack://@tstibbs/geo-bagging-ui/./src/js/menu/visits/view.js","webpack://@tstibbs/geo-bagging-ui/./src/js/menu/external-files/files_load_panel.js","webpack://@tstibbs/geo-bagging-ui/./src/js/menu/view.js","webpack://@tstibbs/geo-bagging-ui/./src/js/controls.js","webpack://@tstibbs/geo-bagging-ui/./src/js/constraints/visit-constraint-manager.js","webpack://@tstibbs/geo-bagging-ui/./src/js/manager.js","webpack://@tstibbs/geo-bagging-ui/./src/js/map_loader.js","webpack://@tstibbs/geo-bagging-ui/./src/js/menu/settings/clustering_enabled_control.js","webpack://@tstibbs/geo-bagging-ui/./src/js/params.js","webpack://@tstibbs/geo-bagging-ui/./src/js/popup_view.js","webpack://@tstibbs/geo-bagging-ui/./src/js/utils/geojson-translator.js","webpack://@tstibbs/geo-bagging-ui/./src/js/utils/geojson.js","webpack://@tstibbs/geo-bagging-ui/./src/js/vendor-wrappers/leaflet-marker-cluster.js","webpack://@tstibbs/geo-bagging-ui/./src/js/utils/marker-cluster.js","webpack://@tstibbs/geo-bagging-ui/./src/js/vendor-wrappers/leaflet.js"],"sourcesContent":["var map = {\n\t\"./abstract_bundle_builder.js\": [\n\t\t8001\n\t],\n\t\"./abstract_geojson_builder.js\": [\n\t\t1995\n\t],\n\t\"./abstract_points_builder.js\": [\n\t\t4758\n\t],\n\t\"./coastallandmarks/config.js\": [\n\t\t3228,\n\t\t228\n\t],\n\t\"./coastallandmarks/points_builder.js\": [\n\t\t5553,\n\t\t553\n\t],\n\t\"./defence/config.js\": [\n\t\t1912,\n\t\t912\n\t],\n\t\"./defence/points_builder.js\": [\n\t\t1613,\n\t\t613\n\t],\n\t\"./external-geojson/config.js\": [\n\t\t8384\n\t],\n\t\"./external-gpx/config.js\": [\n\t\t5982\n\t],\n\t\"./follies/config.js\": [\n\t\t8788,\n\t\t788\n\t],\n\t\"./follies/points_builder.js\": [\n\t\t8402,\n\t\t402\n\t],\n\t\"./hills/classifications.js\": [\n\t\t929,\n\t\t929\n\t],\n\t\"./hills/config.js\": [\n\t\t6201,\n\t\t201\n\t],\n\t\"./hills/config_all.js\": [\n\t\t8224,\n\t\t224\n\t],\n\t\"./hills/constants.js\": [\n\t\t1732,\n\t\t732\n\t],\n\t\"./hills/points_builder.js\": [\n\t\t2089,\n\t\t89\n\t],\n\t\"./milestones/config.js\": [\n\t\t393,\n\t\t723\n\t],\n\t\"./milestones/points_builder.js\": [\n\t\t4673,\n\t\t673\n\t],\n\t\"./nationalparks/builder.js\": [\n\t\t4190,\n\t\t190\n\t],\n\t\"./nationalparks/config.js\": [\n\t\t1156,\n\t\t156\n\t],\n\t\"./nt/config.js\": [\n\t\t7649,\n\t\t649\n\t],\n\t\"./nt/points_builder.js\": [\n\t\t6723,\n\t\t102\n\t],\n\t\"./rnli/config.js\": [\n\t\t6689,\n\t\t689\n\t],\n\t\"./rnli/points_builder.js\": [\n\t\t269,\n\t\t269\n\t],\n\t\"./trails/builder.js\": [\n\t\t8840,\n\t\t840\n\t],\n\t\"./trails/config.js\": [\n\t\t2081,\n\t\t81\n\t],\n\t\"./trigs/config.js\": [\n\t\t9896,\n\t\t240\n\t],\n\t\"./trigs/config_base.js\": [\n\t\t4317,\n\t\t952\n\t],\n\t\"./trigs/config_embedding.js\": [\n\t\t1764,\n\t\t374\n\t],\n\t\"./trigs/config_mini.js\": [\n\t\t2831,\n\t\t518\n\t],\n\t\"./trigs/points_builder.js\": [\n\t\t3052,\n\t\t52\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(() => {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn Promise.all(ids.slice(1).map(__webpack_require__.e)).then(() => {\n\t\treturn __webpack_require__(id);\n\t});\n}\nwebpackAsyncContext.keys = () => (Object.keys(map));\nwebpackAsyncContext.id = 2981;\nmodule.exports = webpackAsyncContext;","//heavily borrowed from www.movable-type.co.uk/scripts/latlong-gridref.html (MIT licence)\nimport proj4 from 'proj4'\n\nvar osgbProj = proj4(\n\t'+proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy +datum=OSGB36 +units=m +no_defs'\n)\n\nfunction pad(num, w) {\n\tvar n = num.toString()\n\twhile (n.length < w) n = '0' + n\n\treturn n\n}\n\nexport default {\n\tlatLngToGridRef: function (lat, lng) {\n\t\tvar digits = 10\n\n\t\tvar out = osgbProj.forward([lng, lat]) //from WSG84\n\t\tvar eastings = out[0]\n\t\tvar northings = out[1]\n\n\t\tdigits = digits === undefined ? 10 : Number(digits)\n\t\tif (isNaN(digits)) throw new Error('Invalid precision')\n\n\t\tvar e = Number(Number(eastings))\n\t\tvar n = Number(Number(northings))\n\n\t\tif (isNaN(e) || isNaN(n)) throw new Error('Invalid grid reference: ' + [lat, lng])\n\n\t\t// use digits = 0 to return numeric format (in metres)\n\t\tif (digits === 0) return pad(e, 6) + ',' + pad(n, 6)\n\n\t\t// get the 100km-grid indices\n\t\tvar e100k = Math.floor(e / 100000),\n\t\t\tn100k = Math.floor(n / 100000)\n\n\t\tif (e100k < 0 || e100k > 6 || n100k < 0 || n100k > 12) return ''\n\n\t\t// translate those into numeric equivalents of the grid letters\n\t\tvar l1 = 19 - n100k - ((19 - n100k) % 5) + Math.floor((e100k + 10) / 5)\n\t\tvar l2 = (((19 - n100k) * 5) % 25) + (e100k % 5)\n\n\t\t// compensate for skipped 'I' and build grid letter-pairs\n\t\tif (l1 > 7) l1++\n\t\tif (l2 > 7) l2++\n\t\tvar letPair = String.fromCharCode(l1 + 'A'.charCodeAt(0), l2 + 'A'.charCodeAt(0))\n\n\t\t// strip 100km-grid indices from easting & northing, and reduce precision\n\t\te = Math.floor((e % 100000) / Math.pow(10, 5 - digits / 2))\n\t\tn = Math.floor((n % 100000) / Math.pow(10, 5 - digits / 2))\n\n\t\tvar gridRef = letPair + ' ' + pad(e, digits / 2) + ' ' + pad(n, digits / 2)\n\n\t\treturn gridRef\n\t},\n\n\tosgbToLngLat: function (eastings, northings) {\n\t\tvar out = osgbProj.inverse([eastings, northings]) //to WSG84\n\t\treturn out\n\t},\n\n\tgridRefToOsgb: function (/*String*/ gridref) {\n\t\tgridref = String(gridref).trim()\n\t\tthis._determineGridRefType(gridref)\n\n\t\t// check for fully numeric comma-separated gridref format\n\t\tvar match = gridref.match(/^(\\d+),\\s*(\\d+)$/)\n\t\tif (match) return new OsGridRef(match[1], match[2])\n\n\t\t// validate format\n\t\tmatch = gridref.match(/^[A-Z]{2}\\s*[0-9]+\\s*[0-9]+$/i)\n\t\tif (!match) throw new Error('Invalid grid reference: ' + gridref)\n\n\t\t// get numeric values of letter references, mapping A->0, B->1, C->2, etc:\n\t\tvar l1 = gridref.toUpperCase().charCodeAt(0) - 'A'.charCodeAt(0)\n\t\tvar l2 = gridref.toUpperCase().charCodeAt(1) - 'A'.charCodeAt(0)\n\t\t// shuffle down letters after 'I' since 'I' is not used in grid:\n\t\tif (l1 > 7) l1--\n\t\tif (l2 > 7) l2--\n\n\t\t// convert grid letters into 100km-square indexes from false origin (grid square SV):\n\t\tvar e100km = ((l1 - 2) % 5) * 5 + (l2 % 5)\n\t\tvar n100km = 19 - Math.floor(l1 / 5) * 5 - Math.floor(l2 / 5)\n\n\t\t// skip grid letters to get numeric (easting/northing) part of ref\n\t\tvar en = gridref.slice(2).trim().split(/\\s+/)\n\t\t// if e/n not whitespace separated, split half way\n\t\tif (en.length == 1) en = [en[0].slice(0, en[0].length / 2), en[0].slice(en[0].length / 2)]\n\n\t\t//fix for grid refs technically part of the grid but outside of the uk\n\t\t//this helped to work this out: https://raw.githubusercontent.com/wu-lee/dinty/master/national-grid.png\n\t\tif (e100km >= 15) {\n\t\t\te100km -= 25\n\t\t}\n\t\tif (n100km > 20) {\n\t\t\tn100km -= 25\n\t\t}\n\n\t\t// validation\n\t\tif (e100km < -10 || n100km < -5)\n\t\t\tthrow new Error('Invalid grid reference: gridref=' + gridref + ', e100km=' + e100km + ', n100km=' + n100km)\n\t\tif (en.length != 2) throw new Error('Invalid grid reference: ' + gridref)\n\t\tif (en[0].length != en[1].length) throw new Error('Invalid grid reference: ' + gridref)\n\n\t\t// standardise to 10-digit refs (metres)\n\t\ten[0] = (en[0] + '00000').slice(0, 5)\n\t\ten[1] = (en[1] + '00000').slice(0, 5)\n\n\t\tvar e = parseInt(e100km + '00000') + parseInt(en[0])\n\t\tvar n = parseInt(n100km + '00000') + parseInt(en[1])\n\n\t\treturn [e, n]\n\t},\n\n\tgridRefToLngLat: function (/*String*/ gridref) {\n\t\tvar lngLat = this.gridRefToOsgb(gridref)\n\t\tvar out = osgbProj.inverse(lngLat) //to WSG84\n\t\treturn out\n\t},\n\n\t_determineGridRefType: function (gridref) {\n\t\tif (/^\\w\\s*\\d{3,}\\s*\\d{3,}$/.test(gridref)) {\n\t\t\tthrow new Error('Irish grid references currently unsupported: ' + gridref)\n\t\t}\n\t}\n}\n","import leaflet from 'VendorWrappers/leaflet.js'\nimport $ from 'jquery'\nimport constants from '../constants.js'\n\nvar AbstractBundleBuilder = leaflet.Class.extend({\n\tinitialize: function (manager, bundleConfig, bundleName) {\n\t\tthis._markerList = null\n\t\tthis._manager = manager\n\t\tthis._config = manager.getConfig()\n\t\tthis._bundleConfig = bundleConfig\n\t\tthis._bundleName = bundleName.indexOf('/') == -1 ? bundleName : bundleName.substring(0, bundleName.lastIndexOf('/'))\n\t\tthis._urlPrefix = this._bundleConfig.dataLocationUrlPrefix ?? `${this._config.baseUrl}bundles/`\n\t\tthis._visits = []\n\t},\n\n\t_buildDataUrl: function () {\n\t\treturn this._urlPrefix + this._bundleName + '/' + this._bundleConfig.dataToLoad\n\t},\n\n\t_doFetchData: function () {\n\t\tvar dataToLoad = this._buildDataUrl()\n\t\tvar dataLoadPromise = $.ajax({\n\t\t\turl: dataToLoad,\n\t\t\tdataType: 'json'\n\t\t}).fail(function (xhr, textError, error) {\n\t\t\tconsole.error('Failed to load map data: ' + textError)\n\t\t\tconsole.log(error)\n\t\t})\n\n\t\tif (this._manager.shouldManageVisits()) {\n\t\t\t//not loading visits is ok, because we won't display the info either if not authenticated\n\t\t\tvar visitsLoadPromise = $.get({\n\t\t\t\turl: constants.legacyApiBackendBaseUrl + 'listVisits?source=' + this._bundleName,\n\t\t\t\tdataType: 'json',\n\t\t\t\txhrFields: {\n\t\t\t\t\twithCredentials: true\n\t\t\t\t}\n\t\t\t})\n\t\t\t\t.then(\n\t\t\t\t\tfunction (data) {\n\t\t\t\t\t\tthis._visits = data.map(\n\t\t\t\t\t\t\tfunction (visit) {\n\t\t\t\t\t\t\t\t//each visit file is named like \"visits-hills-16495\", so get everything after the second hyphen\n\t\t\t\t\t\t\t\treturn visit.substring(visit.indexOf('-', visit.indexOf('-') + 1) + 1)\n\t\t\t\t\t\t\t}.bind(this)\n\t\t\t\t\t\t)\n\t\t\t\t\t}.bind(this)\n\t\t\t\t)\n\t\t\t\t.fail(function (xhr, textError, error) {\n\t\t\t\t\tconsole.error('Failed to load map data: ' + textError)\n\t\t\t\t\tconsole.log(error)\n\t\t\t\t})\n\n\t\t\treturn $.when(dataLoadPromise, visitsLoadPromise).then(function (datas) {\n\t\t\t\treturn datas[0] //only need to pass the actual data on, not the visits\n\t\t\t})\n\t\t} else {\n\t\t\treturn dataLoadPromise\n\t\t}\n\t},\n\n\tfetchMeta: function () {\n\t\tvar dataToLoad = this._buildDataUrl() + '.meta'\n\t\treturn $.ajax({\n\t\t\turl: dataToLoad,\n\t\t\tdataType: 'json'\n\t\t})\n\t\t\t.fail(function (xhr, textError, error) {\n\t\t\t\tconsole.error('Failed to load source metadata: ' + textError)\n\t\t\t\tconsole.log(error)\n\t\t\t})\n\t\t\t.done(\n\t\t\t\tfunction (data) {\n\t\t\t\t\tthis._meta = data\n\t\t\t\t}.bind(this)\n\t\t\t)\n\t},\n\n\tgetMeta: function () {\n\t\treturn this._meta\n\t},\n\n\tgetVisits: function () {\n\t\treturn this._visits\n\t},\n\n\tgetBundleConfig: function () {\n\t\treturn this._bundleConfig\n\t},\n\n\tgetBundleName: function () {\n\t\treturn this._bundleName\n\t}\n})\n\nexport default AbstractBundleBuilder\n","import AbstractBundleBuilder from './abstract_bundle_builder.js'\nimport GeoJsonTranslator from '../utils/geojson-translator.js'\n\nconst colour = '#3388ff'\n\nvar GeojsonLayer = AbstractBundleBuilder.extend({\n\tinitialize: function (manager, bundleConfig, bundleName) {\n\t\tAbstractBundleBuilder.prototype.initialize.call(this, manager, bundleConfig, bundleName)\n\t\tthis._data = null\n\t\tthis._bundleConfig = bundleConfig\n\t\tthis._translator = new GeoJsonTranslator(manager, colour, bundleConfig.initialOutlineWidth)\n\t},\n\n\tfetchData: function () {\n\t\treturn this._doFetchData().done(\n\t\t\tfunction (data) {\n\t\t\t\tthis._data = data\n\t\t\t}.bind(this)\n\t\t)\n\t},\n\n\t_parseDatas: function () {\n\t\treturn this._data.features.map(\n\t\t\tfunction (feature) {\n\t\t\t\treturn this.parse(feature)\n\t\t\t}.bind(this)\n\t\t)\n\t},\n\n\tbuildLayers: function () {\n\t\tvar layerDatas = this._parseDatas()\n\t\tvar layers = this._translator.dataToLayers(layerDatas)\n\t\tlayers = Object.fromEntries(\n\t\t\tObject.entries(layers).map(([id, layer]) => {\n\t\t\t\tlet dimensionString = this._manager.getVisitConstraintManager().translateDimensionString(id, this._bundleName)\n\t\t\t\treturn [dimensionString, layer]\n\t\t\t})\n\t\t)\n\t\treturn layers\n\t},\n\n\tgetAttribution: function () {\n\t\treturn this._bundleConfig.attribution\n\t}\n})\n\nexport default GeojsonLayer\n","import AbstractBundleBuilder from './abstract_bundle_builder.js'\n\nvar PointsBuilder = AbstractBundleBuilder.extend({\n\tinitialize: function (manager, bundleConfig, bundleName) {\n\t\tAbstractBundleBuilder.prototype.initialize.call(this, manager, bundleConfig, bundleName)\n\t\tthis._markerList = null\n\t\tthis._bundleConfig = bundleConfig\n\t},\n\n\tfetchData: function () {\n\t\treturn this._doFetchData().done(\n\t\t\tfunction (data) {\n\t\t\t\tthis.addMarkers(data)\n\t\t\t}.bind(this)\n\t\t)\n\t},\n\n\taddMarkers: function (data) {\n\t\tvar pointsToLoad = data.data\n\t\tfor (var i = 0; i < pointsToLoad.length; i++) {\n\t\t\tthis.parse(pointsToLoad[i])\n\t\t}\n\t\tif (this._bundleConfig.attribution != null) {\n\t\t\tthis._attributionText = this._bundleConfig.attribution\n\t\t} else {\n\t\t\tthis._attributionText = data.attribution\n\t\t}\n\t},\n\n\taddMarker: function (id, lat, lng, url, name, extraTexts, icon, dimensionValues, layerId) {\n\t\tid = encodeURIComponent(id)\n\t\tvar latLng = [parseFloat(lat), parseFloat(lng)]\n\t\tvar visited = this.getVisits().indexOf(id) != -1\n\t\tvar marker = {\n\t\t\tid: id, // for filtering purposes\n\t\t\tlatLng: latLng,\n\t\t\tname: name,\n\t\t\textraTexts: extraTexts,\n\t\t\texportName: name,\n\t\t\turl: url,\n\t\t\ticon: icon,\n\t\t\tlayerId: layerId,\n\t\t\tvisited: visited\n\t\t}\n\n\t\tif (this._config.dimensional_layering && dimensionValues != null && dimensionValues.length !== 0) {\n\t\t\tif (this._markerList == null) {\n\t\t\t\tthis._markerList = {}\n\t\t\t}\n\n\t\t\tif (this._withinConstraints(marker)) {\n\t\t\t\tvar currentMap = this._markerList\n\t\t\t\tdimensionValues = this._manager\n\t\t\t\t\t.getVisitConstraintManager()\n\t\t\t\t\t.translateDimensionValues(dimensionValues, id, this._bundleName)\n\t\t\t\tfor (var i = 0; i < dimensionValues.length - 1; i++) {\n\t\t\t\t\t// all but the last one\n\t\t\t\t\tvar key = dimensionValues[i]\n\t\t\t\t\tif (currentMap[key] == null) {\n\t\t\t\t\t\tcurrentMap[key] = {}\n\t\t\t\t\t}\n\t\t\t\t\tcurrentMap = currentMap[key]\n\t\t\t\t}\n\t\t\t\tvar lastKey = dimensionValues[dimensionValues.length - 1]\n\t\t\t\tif (currentMap[lastKey] == null) {\n\t\t\t\t\tcurrentMap[lastKey] = [] // set the last level to be an array\n\t\t\t\t}\n\t\t\t\tcurrentMap[lastKey].push(marker)\n\t\t\t}\n\t\t} else {\n\t\t\tif (this._markerList == null) {\n\t\t\t\tthis._markerList = []\n\t\t\t}\n\t\t\tthis._markerList.push(marker)\n\t\t}\n\t},\n\n\t_withinConstraints: function (marker) {\n\t\tvar matcher = this._manager.getViewConstraints()\n\t\treturn matcher == null || matcher(marker.latLng)\n\t},\n\n\tbuildImageLinks: function (linksArray) {\n\t\treturn linksArray.map(function (elem, index) {\n\t\t\treturn ['Image ' + (index + 1), elem]\n\t\t})\n\t},\n\n\tsplit: function (values, labels) {\n\t\treturn values.split(';').map(function (value) {\n\t\t\tvar label = labels[value]\n\t\t\treturn label != null ? label : value\n\t\t})\n\t},\n\n\tgetMarkerList: function () {\n\t\treturn this._markerList\n\t},\n\n\tgetAttribution: function () {\n\t\treturn this._attributionText\n\t}\n})\n\nexport default PointsBuilder\n","import {rawGeoJsonToGeoJson} from '../../utils/geojson.js'\n\nexport default {\n\taspectLabel: 'GeoJson Files',\n\tloadLabel: 'GeoJson',\n\tloadExtensions: '.geojson',\n\tcolour: 'darkblue',\n\tinitialOutlineWidth: 1,\n\tfileContentsParser: rawGeoJsonToGeoJson\n}\n","import {rawGpxToGeoJson} from '../../utils/geojson.js'\n\nexport default {\n\taspectLabel: 'GPX Files',\n\tloadLabel: 'GPX',\n\tloadExtensions: '.gpx',\n\tcolour: '#bd007e', //dark pinky crimson\n\tinitialOutlineWidth: 2,\n\tfileContentsParser: rawGpxToGeoJson\n}\n","import leaflet from 'leaflet'\nimport $ from 'jquery'\nimport global from './global.js'\nimport params from './params.js'\nimport conversion from '@tstibbs/geo-bagging-shared/conversion.js'\n\nvar defaultPageId = global.location.pathname.split('/').pop()\n\nvar defaults = {\n\tbaseUrl: window.geoBaggingBaseUrl != null ? window.geoBaggingBaseUrl : '',\n\tmap_style: 'full', //full, mini, embedded\n\tcluster: true,\n\tdimensional_layering: false,\n\tinitial_zoom: 13,\n\tstart_position: [53.374694, -1.711474], //lat, long\n\tforce_config_override: false, //if true, start position and zoom will be taken from config, not from local storage\n\tmap_element_id: 'map',\n\tmap_outer_container_element: $('body'),\n\tpage_id: defaultPageId,\n\tshow_zoom_control: true,\n\tshow_selection_control: true,\n\tshow_search_control: true,\n\tshow_locate_control: true,\n\tshow_layers_control: true,\n\tshow_position_control: true,\n\tshow_hider_control: 'mobile', // false, true, 'mobile'\n\tuse_sidebar: true,\n\thider_control_start_visible: true,\n\ticons: {},\n\tdimensionNames: [],\n\tdimensionValueLabels: {},\n\tdefaultLayer: 'OS',\n\tmarkerConstraints: null //e.g. will constrain it to show only those markers within a bounding boc\n}\n\nvar Config = leaflet.Class.extend({\n\tinitialize: function (options, configBundles) {\n\t\tvar resolvedConfig = $.extend({}, defaults, options)\n\t\tthis._checkForUndefaultedProperties(options, 'window config')\n\t\tresolvedConfig.bundles = configBundles\n\n\t\tthis._storageId = 'os_map:' + resolvedConfig.page_id + 'config'\n\n\t\tif (options == null || options.force_config_override !== true) {\n\t\t\t//check *options*, don't want to retrieve this persisted value\n\t\t\t//unless we've set the attribute to force override local config with the coded config, we should grab the local storage version and overwrite any matching keys\n\t\t\tvar saved = this._getSavedConfig()\n\t\t\tresolvedConfig = $.extend({}, resolvedConfig, saved)\n\t\t}\n\n\t\tif (params.test('startPosition')) {\n\t\t\t//lat, long\n\t\t\tresolvedConfig.start_position = params.test('startPosition').split(',')\n\t\t}\n\t\tif (params.test('startZoom')) {\n\t\t\tresolvedConfig.initial_zoom = params.test('startZoom')\n\t\t}\n\t\tthis._buildMarkerConstraints(resolvedConfig)\n\n\t\t//set all values locally so that the exporter object works like a hash\n\t\tfor (var property in resolvedConfig) {\n\t\t\tif (resolvedConfig.hasOwnProperty(property)) {\n\t\t\t\tthis[property] = resolvedConfig[property]\n\t\t\t}\n\t\t}\n\t},\n\n\t_buildMarkerConstraints: function (resolvedConfig) {\n\t\tvar constraintsString = null\n\t\tif (params.test('constraints') != null) {\n\t\t\t// params takes priority\n\t\t\tconstraintsString = params.test('constraints')\n\t\t} else if (resolvedConfig.markerConstraints != null && typeof resolvedConfig.markerConstraints == 'string') {\n\t\t\tconstraintsString = resolvedConfig.markerConstraints\n\t\t}\n\t\tif (constraintsString != null) {\n\t\t\tvar points = constraintsString.split(',')\n\t\t\tvar tlLat = null\n\t\t\tvar tlLng = null\n\t\t\tvar brLat = null\n\t\t\tvar brLng = null\n\t\t\tif (points.length == 2) {\n\t\t\t\t//must be os grid refs\n\t\t\t\tvar topLeft = conversion.gridRefToLngLat(points[0])\n\t\t\t\ttlLng = topLeft[0]\n\t\t\t\ttlLat = topLeft[1]\n\t\t\t\tvar bottomRight = conversion.gridRefToLngLat(points[1])\n\t\t\t\tbrLng = bottomRight[0]\n\t\t\t\tbrLat = bottomRight[1]\n\t\t\t} else {\n\t\t\t\t//lat,lng,lat,lng\n\t\t\t\ttlLat = parseFloat(points[0])\n\t\t\t\ttlLng = parseFloat(points[1])\n\t\t\t\tbrLat = parseFloat(points[2])\n\t\t\t\tbrLng = parseFloat(points[3])\n\t\t\t}\n\t\t\tresolvedConfig.markerConstraints = [\n\t\t\t\t[brLat, tlLng],\n\t\t\t\t[tlLat, brLng]\n\t\t\t] //<LatLng> southWest, <LatLng> northEast\n\t\t}\n\t\tif (resolvedConfig.markerConstraints != null && Array.isArray(resolvedConfig.markerConstraints)) {\n\t\t\tresolvedConfig.markerConstraints = leaflet.latLngBounds(resolvedConfig.markerConstraints) //[[bottom, left], [top, right]]\n\t\t}\n\t\tif (resolvedConfig.markerConstraints != null && typeof resolvedConfig.markerConstraints === 'function') {\n\t\t\tresolvedConfig.markerConstraintsMatcher = resolvedConfig.markerConstraints\n\t\t}\n\t\tif (resolvedConfig.markerConstraints != null && resolvedConfig.markerConstraintsMatcher == null) {\n\t\t\tresolvedConfig.markerConstraintsMatcher = function (marker) {\n\t\t\t\treturn resolvedConfig.markerConstraints.contains(marker.latLng)\n\t\t\t}\n\t\t}\n\t},\n\n\t_checkForUndefaultedProperties: function (newConfig, source) {\n\t\tfor (var property in newConfig) {\n\t\t\tif (newConfig.hasOwnProperty(property) && !defaults.hasOwnProperty(property)) {\n\t\t\t\tconsole.warn('Property \"' + property + '\" (set from ' + source + ') should have a default')\n\t\t\t}\n\t\t}\n\t},\n\n\t_getSavedConfig: function () {\n\t\tif (localStorage !== undefined) {\n\t\t\tvar saved = localStorage.getItem(this._storageId)\n\t\t\tif (saved != null) {\n\t\t\t\treturn JSON.parse(saved)\n\t\t\t} else {\n\t\t\t\treturn null\n\t\t\t}\n\t\t} else {\n\t\t\treturn null\n\t\t}\n\t},\n\n\tpersist: function (options) {\n\t\tif (localStorage !== undefined) {\n\t\t\tvar saved = this._getSavedConfig()\n\t\t\tif (saved != null) {\n\t\t\t\toptions = $.extend({}, saved, options)\n\t\t\t}\n\t\t\tlocalStorage.setItem(this._storageId, JSON.stringify(options))\n\t\t}\n\t}\n})\n\nexport default Config\n","const baseBackendUrl = 'https://d1548rv5kyvrdp.cloudfront.net'\n\nexport default {\n\tbingKey: 'AgYJwt3nv3bZyK31EDXorMaO8aIix-5kAa32O5TTwFAhdVYtZdIKhw3ttntsmgqy',\n\tdataSources: ['follies', 'hills', 'milestones', 'defence', 'trails', 'rnli', 'nationalparks', 'coastallandmarks'],\n\tlegacyApiBackendBaseUrl: 'https://not_deployed.execute-api.eu-west-2.amazonaws.com/prod/',\n\tdataBackendBaseUrl: `${baseBackendUrl}/data/`,\n\tintegrationBackendBaseUrl: `${baseBackendUrl}/integration/`\n}\n","import $ from 'jquery'\n\nvar FullScreenLink = function (config, leafletMap) {\n\tvar container = $('div.full-screen-link')\n\tif (container.length > 0) {\n\t\tvar link = $('<a href=\"#\">Open in full screen</a>')\n\t\tlink.click(function () {\n\t\t\tvar zoom = leafletMap.getZoom()\n\t\t\tvar centre = leafletMap.getCenter()\n\t\t\tvar newUrl =\n\t\t\t\tconfig.baseUrl +\n\t\t\t\t'index.html?datasources=trigs&startPosition=' +\n\t\t\t\tcentre.lat +\n\t\t\t\t',' +\n\t\t\t\tcentre.lng +\n\t\t\t\t'&startZoom=' +\n\t\t\t\tzoom\n\t\t\twindow.location.href = newUrl\n\t\t})\n\t\t$('div.full-screen-link').append(link)\n\t}\n}\n\nexport default FullScreenLink\n","export default window //if it isn't window, we'll be stubbing this module anyway\n","export const ZOOM_OUT_EVENT = 'zoomOut'\nexport const ZOOM_IN_EVENT = 'zoomIn'\n\nexport function detectZoomDirection(map) {\n\tlet previousZoom = map.getZoom()\n\t//zoomstart would be better, so we can make changes to things before zooming, but at the zoomstart point you don't know whether you're zooming in or out\n\tmap.on('zoom', () => {\n\t\tlet currentZoom = map.getZoom()\n\t\tif (Number.isInteger(currentZoom)) {\n\t\t\t//wait for pinch-zooms to finish so we know we've settled on the final zoom level\n\t\t\t//high numbers are \"zoomed in\", low numbers are \"zoomed out\"\n\t\t\tif (currentZoom < previousZoom) {\n\t\t\t\tconsole.debug(`zoom out: from=${previousZoom} to=${currentZoom}`)\n\t\t\t\tmap.fire(ZOOM_OUT_EVENT)\n\t\t\t} else if (currentZoom > previousZoom) {\n\t\t\t\tconsole.debug(`zoom in: from=${previousZoom} to=${currentZoom}`)\n\t\t\t\tmap.fire(ZOOM_IN_EVENT)\n\t\t\t} //else ignore because they're the same (perhaps we're mid-zoom)\n\t\t\t//store for next time\n\t\t\tpreviousZoom = map.getZoom()\n\t\t}\n\t})\n}\n","import global from './global.js'\nimport params from './params.js'\n\n//all taken from http://detectmobilebrowsers.com/ (licence is UNLICENSE - http://unlicense.org/)\n\nvar firstRegex =\n\t/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i\n\nvar secondRegex =\n\t/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i\n\nvar devHack = params.test('mobile')\n\nexport default {\n\tisMobile: function () {\n\t\tif (devHack) {\n\t\t\treturn true\n\t\t} else {\n\t\t\tvar testString = global.navigator.userAgent || global.navigator.vendor || global.opera\n\t\t\treturn firstRegex.test(testString) || secondRegex.test(testString.substr(0, 4))\n\t\t}\n\t}\n}\n","import BingLayer from 'leaflet-plugins/layer/tile/Bing.js'\n\nexport default BingLayer\n","import leaflet from 'VendorWrappers/leaflet.js'\nimport LeafletBing from 'VendorWrappers/bing-layer.js'\nimport constants from './constants.js'\nconst minOverallZoom = 1\nconst maxOverallZoom = 19\n\n//because we have a mix of zooms, we have to either change the maxZoom value on the main map whenever we change layer, or we have to set the min and max the same for each layer(/layergroup). The latter is simpler, but means we have to set maxNativeZoom for those sources which can't provide tiles at the max overall zoom level. However, setting detectRetina=true breaks this, as per https://github.com/Leaflet/Leaflet/issues/8850\n//thus, we disable detectRetina in all sources to ensure that the maxNativeZoom property is correctly obeyed :(\n\nvar defaults = {\n\tminZoom: minOverallZoom,\n\tmaxZoom: maxOverallZoom,\n\tdetectRetina: false\n}\nvar bingDefaults = leaflet.extend({}, defaults, {\n\tkey: constants.bingKey,\n\tmaxNativeZoom: 18\n})\n\n//Bing standard maps\nvar bingRoads = new LeafletBing(leaflet.extend({}, bingDefaults, {imagerySet: 'RoadOnDemand'}))\nvar bingHybrid = new LeafletBing(leaflet.extend({}, bingDefaults, {imagerySet: 'AerialWithLabelsOnDemand'}))\nvar bingAerial = new LeafletBing(leaflet.extend({}, bingDefaults, {imagerySet: 'Aerial'}))\n\n//OS\nvar bingOsLayer = new LeafletBing(\n\tleaflet.extend({}, bingDefaults, {\n\t\timagerySet: 'OrdnanceSurvey',\n\t\tminZoom: 12,\n\t\tmaxNativeZoom: 17\n\t})\n) //note OS doesn't support retina\n//fallback layer because the OS maps don't scale well when you zoom out\nvar bingFallbackLayer = new LeafletBing(\n\tleaflet.extend({}, bingDefaults, {\n\t\timagerySet: 'RoadOnDemand',\n\t\tmaxZoom: 11\n\t})\n)\nvar bingOsGroup = leaflet.layerGroup([bingOsLayer, bingFallbackLayer])\n\n//OSM\nvar osm = new leaflet.TileLayer(\n\t'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',\n\tleaflet.extend({}, defaults, {\n\t\tattribution: 'Map data  <a href=\"http://openstreetmap.org\">OpenStreetMap</a> contributors'\n\t})\n)\n\nvar layers = {\n\tOS: bingOsGroup,\n\t'Bing Roads': bingRoads,\n\t'Bing Satellite': bingAerial,\n\t'Bing Hybrid': bingHybrid,\n\tOSM: osm\n}\n\nfunction _listenForLayerChange(layerId, layer, config) {\n\tlayer.on(\n\t\t'add',\n\t\tfunction () {\n\t\t\tconfig.persist({defaultLayer: layerId})\n\t\t}.bind(this)\n\t)\n}\n\nvar LayerAdder = function (map, config) {\n\t//if we have a default layer set, select that now\n\tvar layerToSelect = layers[config.defaultLayer]\n\tif (layerToSelect != null) {\n\t\tlayerToSelect.addTo(map)\n\t} else {\n\t\tbingOsGroup.addTo(map)\n\t}\n\n\t//set up listener to persist which layer is selected\n\tfor (var id in layers) {\n\t\t_listenForLayerChange(id, layers[id], config)\n\t}\n\n\treturn layers\n}\n\nexport default LayerAdder\nexport {maxOverallZoom, minOverallZoom}\n","import leaflet from 'VendorWrappers/leaflet.js'\nimport $ from 'jquery'\nimport fullscreen_link from './fullscreen_link.js'\nimport mobile from './mobile.js'\nimport {detectZoomDirection} from './leaflet-plugins/zoom-detector.js'\nimport {maxOverallZoom, minOverallZoom} from './layers.js'\n\nvar MapView = leaflet.Class.extend({\n\tinitialize: function (config) {\n\t\tthis._config = config\n\t\tthis._createView()\n\t\t// set up the map\n\t\tthis._map = new leaflet.Map(this._config.map_element_id, {\n\t\t\t//these controls will be added by the controls module\n\t\t\tzoomControl: false,\n\t\t\t//set up the min and max zoom first to prevent the min/max changing when layers are loading, as this could change the zoom we set below in setView.\n\t\t\tminZoom: minOverallZoom,\n\t\t\tmaxZoom: maxOverallZoom\n\t\t})\n\n\t\t//set start point\n\t\tthis._map.setView(\n\t\t\tnew leaflet.LatLng(this._config.start_position[0], this._config.start_position[1]),\n\t\t\tthis._config.initial_zoom\n\t\t)\n\t\tfullscreen_link(this._config, this._map)\n\n\t\t//hook up listener to save the location when we move it\n\t\tthis._map.on(\n\t\t\t'zoomend moveend dragend',\n\t\t\tfunction () {\n\t\t\t\tthis._saveLocation()\n\t\t\t},\n\t\t\tthis\n\t\t)\n\n\t\t//hook up zoom in/out detector\n\t\tdetectZoomDirection(this._map)\n\t},\n\n\t//creates the html we need to display errors, loading screen and the map container\n\t_createView: function () {\n\t\tvar content = ''\n\n\t\tvar mapClass = ''\n\t\tif (this._config.map_style == 'mini' || this._config.map_style == 'mini_embedded') {\n\t\t\tmapClass = ' class=\"mini-map\"'\n\t\t} else if (this._config.map_style == 'full') {\n\t\t\tmapClass = ' class=\"full-screen\"'\n\t\t} else if (this._config.map_style == 'embedded') {\n\t\t\tmapClass = ' class=\"embedded-map\"'\n\t\t}\n\n\t\tif (this._config.map_style == 'mini' || this._config.map_style == 'mini_embedded') {\n\t\t\tcontent += '<div class=\"mini-map\">'\n\t\t}\n\t\tcontent += '<div id=\"' + this._config.map_element_id + '\"' + mapClass + '></div>'\n\t\tif (this._config.map_style == 'mini') {\n\t\t\tcontent += '</div>'\n\t\t\tcontent += '<div class=\"full-screen-link\"></div>'\n\t\t}\n\n\t\tif (this._config.map_style == 'full') {\n\t\t\tthis._config.map_outer_container_element.addClass('full-screen')\n\t\t}\n\t\tif (mobile.isMobile()) {\n\t\t\tthis._config.map_outer_container_element.addClass('mobile')\n\t\t}\n\t\tthis._config.map_outer_container_element.prepend($(content))\n\t},\n\n\t_saveLocation: function () {\n\t\tvar center = this._map.getCenter()\n\t\tvar start_position = [center.lat, center.lng]\n\t\tvar initial_zoom = this._map.getZoom()\n\t\tif (localStorage !== undefined) {\n\t\t\tvar hash = {\n\t\t\t\tstart_position: start_position,\n\t\t\t\tinitial_zoom: initial_zoom\n\t\t\t}\n\t\t\tthis._config.persist(hash)\n\t\t\tconsole.debug(JSON.stringify(hash))\n\t\t}\n\t},\n\n\tgetMap: function () {\n\t\treturn this._map\n\t}\n})\n\nexport default MapView\n","import SubGroup from 'leaflet.featuregroup.subgroup/dist/leaflet.featuregroup.subgroup-src.js'\nexport default SubGroup\n","import $ from 'jquery'\nimport _ from 'underscore'\nimport leaflet from 'VendorWrappers/leaflet.js'\nimport popupView from './popup_view.js'\nimport constants from './constants.js'\n\nexport default {\n\ttranslateMarker: function (markerConfig, bundleConfig, aspectName, manager) {\n\t\tvar latLng = markerConfig.latLng\n\t\tvar name = markerConfig.name\n\t\tvar extraTexts = markerConfig.extraTexts\n\t\tvar exportName = markerConfig.exportName\n\t\tvar icon = markerConfig.icon\n\t\tvar url = markerConfig.url\n\t\tvar visited = markerConfig.visited\n\n\t\tif (!popupView.notEmpty(name)) {\n\t\t\tname = url\n\t\t}\n\t\tif (popupView.notEmpty(exportName)) {\n\t\t\texportName = name\n\t\t}\n\n\t\tvar popupText = popupView.buildPopup(manager, name, url, latLng, extraTexts, visited)\n\n\t\tvar markerOptions = {}\n\t\tif (bundleConfig.icons != null && bundleConfig.icons[icon] != null) {\n\t\t\tmarkerOptions.icon = bundleConfig.icons[icon]\n\t\t} else if (bundleConfig.defaultIcon != null) {\n\t\t\tmarkerOptions.icon = bundleConfig.defaultIcon\n\t\t}\n\t\tmarkerOptions.layerId = markerConfig.layerId\n\t\tvar marker = leaflet.marker(latLng, markerOptions)\n\t\tvar popupElem = $('<div>' + popupText + '</div>')\n\t\tif (manager.shouldManageVisits()) {\n\t\t\t$('input', popupElem).change(function () {\n\t\t\t\tvar endpoint = ''\n\t\t\t\tif (this.checked) {\n\t\t\t\t\tendpoint = 'recordVisit'\n\t\t\t\t} else {\n\t\t\t\t\tendpoint = 'removeVisit'\n\t\t\t\t}\n\t\t\t\t$.post({\n\t\t\t\t\turl: constants.legacyApiBackendBaseUrl + endpoint,\n\t\t\t\t\tdata: JSON.stringify({\n\t\t\t\t\t\tsource: aspectName,\n\t\t\t\t\t\tname: markerConfig.id\n\t\t\t\t\t}),\n\t\t\t\t\tcontentType: 'application/json',\n\t\t\t\t\txhrFields: {\n\t\t\t\t\t\twithCredentials: true\n\t\t\t\t\t}\n\t\t\t\t}).catch(function (jqXhr, textStatus, errorThrown) {\n\t\t\t\t\tif (jqXhr.status == 401) {\n\t\t\t\t\t\tconsole.log('Authentication required')\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.log('Request failed: ' + jqXhr.status + ', ' + textStatus + ', ' + errorThrown)\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t})\n\t\t}\n\t\tmarker.bindPopup(popupElem[0])\n\n\t\texportName = _.escape(markerConfig.exportName)\n\t\tvar cmt = null\n\t\tvar desc = null\n\t\tif (extraTexts != null) {\n\t\t\tcmt = _.escape(popupView.buildShortDescription(extraTexts)) //build the extra texts html but escape it to encode into the exported xml\n\t\t\tdesc = _.escape(popupView.buildDescription(extraTexts)) //build the extra texts html but escape it to encode into the exported xml\n\t\t}\n\t\t//selection control looks for .exportData in its default actions\n\t\tmarker.exportData = {\n\t\t\tname: exportName,\n\t\t\tlink: url,\n\t\t\tcmt: cmt,\n\t\t\tdesc: desc\n\t\t}\n\t\treturn marker\n\t}\n}\n","import _ from 'underscore'\nimport $ from 'jquery'\nimport leaflet from 'leaflet'\nimport {buildMarkerClusterGroup} from './utils/marker-cluster.js'\nimport 'leaflet.markercluster.freezable' //side effects on leaflet_cluster\nimport LeafletSubgroup from 'VendorWrappers/leaflet-subgroup.js'\nimport markerView from './marker_view.js'\n\nvar PointsView = leaflet.Class.extend({\n\tinitialize: function (map, config, modelsByAspect, matrixLayerControl, controls, bundles, manager) {\n\t\tthis._map = map\n\t\tthis._config = config\n\t\tthis._modelsByAspect = modelsByAspect\n\t\tthis._matrixLayerControl = matrixLayerControl\n\t\tthis._controls = controls\n\t\tthis._bundles = bundles\n\t\tthis._parentGroup = null\n\t\tthis._manager = manager\n\t},\n\n\t_translateMarkerGroup: function (group, bundleConfig, aspect) {\n\t\tif (group != null) {\n\t\t\tif (group.constructor === Array) {\n\t\t\t\tgroup.forEach(function (markerConfig, i, group) {\n\t\t\t\t\tgroup[i] = markerView.translateMarker(markerConfig, bundleConfig, aspect, this._manager)\n\t\t\t\t}, this)\n\t\t\t} else {\n\t\t\t\t//is hash\n\t\t\t\tfor (var dimension in group) {\n\t\t\t\t\tgroup[dimension] = this._translateMarkerGroup(group[dimension], bundleConfig, aspect)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn group\n\t},\n\n\tfinish: function (finished) {\n\t\tvar deferredObject = $.Deferred()\n\n\t\tif (this._config.cluster) {\n\t\t\tthis._parentGroup = buildMarkerClusterGroup(this._manager.getMap(), {\n\t\t\t\tchunkProgress: function (processed, total, elapsed, layersArray) {\n\t\t\t\t\tif (processed === total) {\n\t\t\t\t\t\tdeferredObject.resolve()\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t} else {\n\t\t\tthis._parentGroup = leaflet.layerGroup()\n\t\t\tdeferredObject.resolve()\n\t\t}\n\n\t\tthis._parentGroup.addTo(this._map)\n\t\tif (!this._config.dimensional_layering) {\n\t\t\tvar markerLists = Object.keys(this._modelsByAspect)\n\t\t\t\t.map(\n\t\t\t\t\tfunction (aspect) {\n\t\t\t\t\t\tvar model = this._modelsByAspect[aspect]\n\t\t\t\t\t\treturn this._translateMarkerGroup(model.getMarkerList(), model.getBundleConfig(), aspect)\n\t\t\t\t\t}.bind(this)\n\t\t\t\t)\n\t\t\t\t.filter(function (value) {\n\t\t\t\t\treturn value != null\n\t\t\t\t})\n\t\t\tvar allMarkers = [].concat.apply([], markerLists)\n\t\t\tif (this._config.cluster) {\n\t\t\t\tvar nullLayerId = 'null'\n\t\t\t\tvar markersByLayer = allMarkers.reduce(function (markersByLayer, marker) {\n\t\t\t\t\tvar layerId = marker.options.layerId\n\t\t\t\t\tlayerId = layerId == null ? nullLayerId : layerId //because the Object.keys layer will coerce into a string anyway\n\t\t\t\t\tif (markersByLayer[layerId] == null) {\n\t\t\t\t\t\tmarkersByLayer[layerId] = []\n\t\t\t\t\t}\n\t\t\t\t\tmarkersByLayer[layerId].push(marker)\n\t\t\t\t\treturn markersByLayer\n\t\t\t\t}, {})\n\n\t\t\t\t//add things that don't specify a layer to the default clustered layer\n\t\t\t\tthis._parentGroup.addLayers(markersByLayer[nullLayerId])\n\t\t\t\t//add everything else to individual, non-clustered, layers\n\t\t\t\tObject.keys(markersByLayer)\n\t\t\t\t\t.filter(function (layerId) {\n\t\t\t\t\t\treturn layerId !== nullLayerId\n\t\t\t\t\t})\n\t\t\t\t\t.forEach(\n\t\t\t\t\t\tfunction (layerId) {\n\t\t\t\t\t\t\tvar markers = markersByLayer[layerId]\n\t\t\t\t\t\t\tvar layerGroup = leaflet.layerGroup()\n\t\t\t\t\t\t\tfor (var i = 0; i < markers.length; i++) {\n\t\t\t\t\t\t\t\tlayerGroup.addLayer(markers[i])\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tlayerGroup.addTo(this._map)\n\t\t\t\t\t\t}.bind(this)\n\t\t\t\t\t)\n\t\t\t} else {\n\t\t\t\tfor (var i = 0; i < allMarkers.length; i++) {\n\t\t\t\t\tthis._parentGroup.addLayer(allMarkers[i])\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tfor (var aspect in this._modelsByAspect) {\n\t\t\t\tvar model = this._modelsByAspect[aspect]\n\t\t\t\tthis.addClusteredModel(aspect, model)\n\t\t\t}\n\t\t}\n\n\t\treturn deferredObject.promise()\n\t},\n\n\taddClusteredModel: function (aspect, model) {\n\t\tif (model.getMarkerList() != null) {\n\t\t\tvar markerList = this._translateMarkerGroup(model.getMarkerList(), model.getBundleConfig(), aspect)\n\t\t\tvar matrixOverlays = {}\n\t\t\tthis.depthFirstIteration(markerList, '', matrixOverlays)\n\t\t\tvar aspectOptions = this._bundles[aspect] //will have other options, but collisions are unlikely\n\t\t\taspectOptions = this._manager.getVisitConstraintManager().translateAspect(aspectOptions, model.getBundleName())\n\t\t\tthis._matrixLayerControl.addAspect(aspect, matrixOverlays, aspectOptions)\n\t\t}\n\t},\n\n\tdepthFirstIteration: function (markers, path, overlays) {\n\t\tif (markers.constructor === Array) {\n\t\t\tvar subGroup = new LeafletSubgroup(this._parentGroup, markers)\n\t\t\t//don't add to the map yet - let the layer control do that if it thinks it needs to - otherwise we could add all layers then immediately try to remove them all, which can cause UI weirdness\n\t\t\toverlays[path] = subGroup\n\t\t} else {\n\t\t\tObject.keys(markers).forEach(\n\t\t\t\tfunction (dimValue) {\n\t\t\t\t\tvar newPath = path.length === 0 ? dimValue : path + '/' + dimValue\n\t\t\t\t\tvar sublist = markers[dimValue]\n\t\t\t\t\tthis.depthFirstIteration(sublist, newPath, overlays)\n\t\t\t\t}.bind(this)\n\t\t\t)\n\t\t}\n\t}\n})\n\nexport default PointsView\n","import $ from 'jquery'\nimport leaflet from 'VendorWrappers/leaflet.js'\n\nvar GeojsonView = leaflet.Class.extend({\n\tinitialize: function (manager, map, config, modelsByAspect, matrixLayerControl, bundles) {\n\t\tthis._manager = manager\n\t\tthis._map = map\n\t\tthis._config = config\n\t\tthis._modelsByAspect = modelsByAspect\n\t\tthis._matrixLayerControl = matrixLayerControl\n\t\tthis._bundles = bundles\n\t},\n\n\tfinish: function (finished) {\n\t\tif (!this._config.dimensional_layering && Object.keys(this._modelsByAspect).length > 0) {\n\t\t\tthrow new Error('!dimensional_layering is not supported yet.')\n\t\t} else {\n\t\t\tvar parentGroup = leaflet.layerGroup()\n\t\t\tvar markerLists = Object.keys(this._modelsByAspect).forEach(\n\t\t\t\tfunction (aspect) {\n\t\t\t\t\tvar model = this._modelsByAspect[aspect]\n\t\t\t\t\tthis.addClusteredModel(aspect, model)\n\t\t\t\t}.bind(this)\n\t\t\t)\n\t\t}\n\t\t//no async here, but stick to the convention of the other views\n\t\treturn $.Deferred().resolve().promise()\n\t},\n\n\taddClusteredModel: function (aspect, model) {\n\t\tvar aspectOptions = this._bundles[aspect] //will have other options, but collisions are unlikely\n\t\tvar layers = model.buildLayers()\n\t\tObject.values(layers).forEach(\n\t\t\tfunction (layer) {\n\t\t\t\tlayer.addTo(this._map)\n\t\t\t}.bind(this)\n\t\t)\n\t\taspectOptions = this._manager.getVisitConstraintManager().translateAspect(aspectOptions, model.getBundleName())\n\t\tthis._matrixLayerControl.addAspect(aspect, layers, aspectOptions)\n\t}\n})\n\nexport default GeojsonView\n","import leaflet from 'VendorWrappers/leaflet.js'\nimport params from '../params.js'\n\nvar UrlHandler = leaflet.Class.extend({\n\tinitialize: function () {\n\t\tthis._tester = new params.tester()\n\t},\n\n\tsourceLoaded: function (sourceName) {\n\t\tthis._tester.update()\n\t\tvar params = this._tester.getParams()\n\t\tvar datasource = params['datasources']\n\t\tdatasource = datasource == null ? '' : datasource\n\t\tdelete params['datasources']\n\t\tdatasource = datasource.length > 0 ? datasource + ',' + sourceName : sourceName\n\t\tvar newParams = Object.keys(params)\n\t\t\t.map(function (paramKey) {\n\t\t\t\treturn paramKey + '=' + params[paramKey]\n\t\t\t})\n\t\t\t.join('&')\n\t\tnewParams = (newParams.length > 0 ? newParams + '&' : '') + 'datasources=' + datasource\n\t\tvar newUrl = document.location.origin + document.location.pathname + '?' + newParams\n\t\t//history.replaceState({}, \"GeoBagging\", newUrl);//do nothing for now until we come up with a nice way to make this bookmarkable\n\t}\n})\n\nexport default UrlHandler\n","import leaflet from 'VendorWrappers/leaflet.js'\nimport $ from 'jquery'\nimport PointsView from './points_view.js'\nimport GeojsonView from './geojson_view.js'\nimport AbstractPointsBuilder from './bundles/abstract_points_builder.js'\nimport AbstractGeojsonBuilder from './bundles/abstract_geojson_builder.js'\nimport UrlHandler from './utils/url_handler.js'\n\nvar ModelViews = leaflet.Class.extend({\n\tinitialize: function (bundles, manager) {\n\t\tthis._bundles = bundles\n\t\tthis._manager = manager\n\t\tthis._controls = manager.getControls()\n\t\tthis._urlHandler = new UrlHandler()\n\t\tthis._lazyCallbacks = {}\n\t},\n\n\t_filterModels: function (bundleModels, className) {\n\t\tvar matchingModels = {}\n\t\tObject.keys(bundleModels)\n\t\t\t.filter(function (bundleName) {\n\t\t\t\tvar model = bundleModels[bundleName]\n\t\t\t\treturn model instanceof className\n\t\t\t})\n\t\t\t.forEach(function (bundleName) {\n\t\t\t\tmatchingModels[bundleName] = bundleModels[bundleName]\n\t\t\t})\n\t\treturn matchingModels\n\t},\n\n\tloadSource: function (bundleName) {\n\t\treturn this._lazyCallbacks[bundleName]()\n\t},\n\n\t_addLazyModels: function (lazyModels, addCallback) {\n\t\tObject.keys(lazyModels).forEach(\n\t\t\tfunction (bundleName) {\n\t\t\t\tvar model = lazyModels[bundleName]\n\t\t\t\tvar callback = function () {\n\t\t\t\t\treturn model.fetchData().done(\n\t\t\t\t\t\tfunction () {\n\t\t\t\t\t\t\taddCallback(bundleName, model)\n\t\t\t\t\t\t\tthis._addAttribution(bundleName, model)\n\t\t\t\t\t\t\tthis._urlHandler.sourceLoaded(bundleName)\n\t\t\t\t\t\t}.bind(this)\n\t\t\t\t\t)\n\t\t\t\t}.bind(this)\n\t\t\t\tthis._lazyCallbacks[bundleName] = callback\n\t\t\t\tvar meta = model.getMeta()\n\t\t\t\tvar description = meta.recordCount + ' items (last updated ' + meta.lastUpdated + ')'\n\t\t\t\tvar bundleDetails = this._bundles[bundleName]\n\t\t\t\tthis._manager.getMatrixLayerControl().addLazyAspect(bundleName, bundleDetails, {\n\t\t\t\t\tdescription: description,\n\t\t\t\t\tcallback: callback\n\t\t\t\t})\n\t\t\t}.bind(this)\n\t\t)\n\t},\n\n\t_addAttribution: function (bundleName, model) {\n\t\tvar attribution = model.getAttribution()\n\t\tif (attribution != null && attribution.length > 0) {\n\t\t\tvar dataSourceLabel = model.getBundleConfig().aspectLabel\n\t\t\tthis._controls.addAttribution(dataSourceLabel, attribution)\n\t\t}\n\t},\n\n\tloadModelViews: function (bundleModels, lazyModels, config, callback) {\n\t\tvar pointsModels = this._filterModels(bundleModels, AbstractPointsBuilder)\n\t\tvar geojsonModels = this._filterModels(bundleModels, AbstractGeojsonBuilder)\n\t\tvar lazyPointsModels = this._filterModels(lazyModels, AbstractPointsBuilder)\n\t\tvar lazyGeojsonModels = this._filterModels(lazyModels, AbstractGeojsonBuilder)\n\n\t\tvar pointsView = new PointsView(\n\t\t\tthis._manager.getMap(),\n\t\t\tconfig,\n\t\t\tpointsModels,\n\t\t\tthis._manager.getMatrixLayerControl(),\n\t\t\tthis._controls,\n\t\t\tthis._bundles,\n\t\t\tthis._manager\n\t\t)\n\t\tvar geojsonView = new GeojsonView(\n\t\t\tthis._manager,\n\t\t\tthis._manager.getMap(),\n\t\t\tconfig,\n\t\t\tgeojsonModels,\n\t\t\tthis._manager.getMatrixLayerControl(),\n\t\t\tthis._bundles\n\t\t)\n\t\tvar promises = [pointsView.finish(), geojsonView.finish()]\n\n\t\tif (config.dimensional_layering) {\n\t\t\tthis._addLazyModels(lazyPointsModels, function (bundleName, model) {\n\t\t\t\tpointsView.addClusteredModel(bundleName, model)\n\t\t\t})\n\t\t\tthis._addLazyModels(lazyGeojsonModels, function (bundleName, model) {\n\t\t\t\tgeojsonView.addClusteredModel(bundleName, model)\n\t\t\t})\n\t\t}\n\n\t\t$.when.apply($, promises).always(\n\t\t\tfunction () {\n\t\t\t\tif (config.dimensional_layering) {\n\t\t\t\t\t//override the basic layers control\n\t\t\t\t\tthis._controls.addControl(this._manager.getMatrixLayerControl())\n\t\t\t\t}\n\t\t\t\t//add attribution texts\n\t\t\t\tObject.keys(bundleModels).forEach(\n\t\t\t\t\tfunction (aspect) {\n\t\t\t\t\t\tvar model = bundleModels[aspect]\n\t\t\t\t\t\tthis._addAttribution(aspect, model)\n\t\t\t\t\t}.bind(this)\n\t\t\t\t)\n\t\t\t\tcallback()\n\t\t\t}.bind(this)\n\t\t)\n\t}\n})\n\nexport default ModelViews\n","import $ from 'jquery'\nimport leaflet from 'VendorWrappers/leaflet.js'\nimport constants from './constants.js'\nimport ModelViews from './model_views.js'\nimport params from './params.js'\n\nvar SourceLoader = leaflet.Class.extend({\n\tinitialize: function (manager, config) {\n\t\tthis._manager = manager\n\t\tthis._config = config\n\t},\n\n\t_parseSources: function (paramName) {\n\t\tvar sourcesString = params.test(paramName)\n\t\treturn sourcesString != null && sourcesString.length > 0 ? sourcesString.split(',') : []\n\t},\n\n\tloadSources: function (selectedSourceIds) {\n\t\tvar extraDataSources = this._parseSources('extra-datasources')\n\t\tvar sourceIds = $.uniqueSort(selectedSourceIds.concat(constants.dataSources, extraDataSources))\n\t\tvar sourceModuleIds = this._sourceIdsToDataSources(sourceIds)\n\t\tvar deferredObject = $.Deferred()\n\t\tvar sources = {}\n\t\tlet promises = sourceModuleIds.map(source => import('./bundles/' + source + '.js'))\n\t\tPromise.all(promises).then(modules => {\n\t\t\tmodules.forEach((sourceModule, i) => {\n\t\t\t\tsourceModule = sourceModule.default\n\t\t\t\tif (typeof sourceModule == 'function') {\n\t\t\t\t\tsourceModule = sourceModule(this._config)\n\t\t\t\t}\n\t\t\t\tsources[sourceModuleIds[i]] = sourceModule\n\t\t\t})\n\n\t\t\tvar sourceModels = {}\n\t\t\tvar lazyModels = {}\n\t\t\tvar promises = Object.keys(sources).map(\n\t\t\t\tfunction (sourceName) {\n\t\t\t\t\tvar source = sources[sourceName]\n\t\t\t\t\tvar parser = new source.parser(this._manager, source, sourceName)\n\n\t\t\t\t\tvar metaPromise = parser.fetchMeta()\n\t\t\t\t\tif (selectedSourceIds.indexOf(sourceName) != -1) {\n\t\t\t\t\t\tvar dataPromise = parser.fetchData()\n\t\t\t\t\t\tsourceModels[sourceName] = parser\n\t\t\t\t\t\treturn $.when(metaPromise, dataPromise)\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlazyModels[sourceName] = parser\n\t\t\t\t\t\treturn metaPromise\n\t\t\t\t\t}\n\t\t\t\t}.bind(this)\n\t\t\t)\n\n\t\t\t$.when.apply($, promises).always(\n\t\t\t\tfunction () {\n\t\t\t\t\tthis._modelViews = new ModelViews(sources, this._manager)\n\t\t\t\t\tthis._modelViews.loadModelViews(sourceModels, lazyModels, this._config, this._finish.bind(this))\n\t\t\t\t\t//don't need to wait for ModelViews to finish, callback will update UI when the time comes, but can safely return after this call\n\t\t\t\t\tdeferredObject.resolve()\n\t\t\t\t}.bind(this)\n\t\t\t)\n\n\t\t\tsetTimeout(() => {\n\t\t\t\tdeferredObject.resolve()\n\t\t\t}, 1)\n\t\t})\n\t\treturn deferredObject.promise() //TODO if one of the bundles is missing, we error, but the error is hidden...\n\t},\n\n\t_sourceIdsToDataSources: function (allSources) {\n\t\tif (allSources != null) {\n\t\t\tallSources = allSources.map(function (source) {\n\t\t\t\tif (source.indexOf('/') == -1) {\n\t\t\t\t\treturn source + '/config'\n\t\t\t\t} else {\n\t\t\t\t\treturn source\n\t\t\t\t}\n\t\t\t})\n\t\t} else {\n\t\t\tallSources = []\n\t\t}\n\t\treturn allSources\n\t},\n\n\t_autoLoadSources: async function () {\n\t\tlet sourceIds = this._parseSources('auto-load-datasources')\n\t\tlet dataSources = this._sourceIdsToDataSources(sourceIds)\n\t\tlet promises = dataSources.map(sourceId => this._modelViews.loadSource(sourceId))\n\t\tawait Promise.all(promises)\n\t},\n\n\t_finish: async function () {\n\t\tawait this._autoLoadSources()\n\t\t$('div#loading-message-pane').hide()\n\t}\n})\n\nexport default SourceLoader\n","import MatrixControl from 'leaflet-matrix-layers-control'\n\nimport 'leaflet-matrix-layers-control/src/matrixControl.css'\n\nexport default MatrixControl\n","import ControlHider from 'leaflet-control-hider'\n\nimport 'leaflet-control-hider/src/hider.css'\n\nexport default ControlHider\n","import {BoxSelectorControl, BoxSelectorGpx} from 'VendorWrappers/leaflet-box-selector.js'\n\nvar SelectionControl = BoxSelectorControl.extend({\n\toptions: {\n\t\tactions: {\n\t\t\tgpx: {\n\t\t\t\tdisplay: 'Export to GPX file',\n\t\t\t\taction: BoxSelectorGpx(function () {\n\t\t\t\t\t//just append the date in case they export multiple - prevents the browser overwriting it\n\t\t\t\t\tvar d = new Date()\n\t\t\t\t\tvar dateString =\n\t\t\t\t\t\td.getFullYear() +\n\t\t\t\t\t\t'-' +\n\t\t\t\t\t\t(d.getMonth() + 1) +\n\t\t\t\t\t\t'-' +\n\t\t\t\t\t\td.getDate() +\n\t\t\t\t\t\t'_' +\n\t\t\t\t\t\td.getHours() +\n\t\t\t\t\t\t'-' +\n\t\t\t\t\t\td.getMinutes() +\n\t\t\t\t\t\t'-' +\n\t\t\t\t\t\td.getSeconds()\n\t\t\t\t\treturn 'geoPoints_' + dateString + '.gpx'\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t}\n})\n\nexport default SelectionControl\n","import leaflet_locate from 'leaflet.locatecontrol'\nimport 'leaflet.locatecontrol/dist/L.Control.Locate.min.css'\n\nvar Locate = leaflet_locate.extend({\n\toptions: {\n\t\tkeepCurrentZoomLevel: true,\n\t\tsetView: 'once'\n\t}\n})\n\nexport default Locate\n","import leaflet from 'VendorWrappers/leaflet.js'\nimport {GeoSearchControl, BingProvider} from 'leaflet-geosearch'\n\n//leaflet-geosearch creates a new class every time you create a control. This makes it difficult to do instanceof checks, so we create a dummy control and extract the 'real' prototype, and then create our own wrapper class for subsequent use\nconst dummyControl = new GeoSearchControl({\n\tprovider: function dummy() {}\n})\n\nfunction GeoSearchControlWrapper(/*arguments*/) {\n\tif (this.initialize) {\n\t\tthis.initialize.apply(this, arguments)\n\t}\n}\n\nvar parentProto = Object.getPrototypeOf(dummyControl)\nGeoSearchControlWrapper.__super__ = parentProto\nGeoSearchControlWrapper.prototype = leaflet.Util.create(parentProto)\nGeoSearchControlWrapper.prototype.constructor = GeoSearchControlWrapper\n\nexport const GeosearchControl = GeoSearchControlWrapper\nexport const GeosearchBing = BingProvider\n","import MousePosition from 'leaflet-mouse-position'\n\nimport 'leaflet-mouse-position/src/L.Control.MousePosition.css'\n\nexport default MousePosition\n","import Leaflet_MousePosition from 'VendorWrappers/leaflet-mouse-position.js'\nimport conversion from '@tstibbs/geo-bagging-shared/conversion.js'\n\nvar MousePositionOsgb = Leaflet_MousePosition.extend({\n\toptions: {\n\t\tformatter: function (lng, lat) {\n\t\t\treturn conversion.latLngToGridRef(lat, lng)\n\t\t}\n\t}\n})\n\nexport default MousePositionOsgb\n","import MapCenterCoord from 'Leaflet.MapCenterCoord/src/L.Control.MapCenterCoord.js'\n\nimport 'Leaflet.MapCenterCoord/src/L.Control.MapCenterCoord.css'\n\nexport default MapCenterCoord\n","import Leaflet_ScreenPosition from 'VendorWrappers/leaflet-map-center-coord.js'\nimport conversion from '@tstibbs/geo-bagging-shared/conversion.js'\nimport $ from 'jquery'\n\nvar ScreenPositionOsgb = Leaflet_ScreenPosition.extend({\n\toptions: {\n\t\tonMove: true,\n\t\ticon: true,\n\t\tlatLngFormatter: function (lat, lng) {\n\t\t\treturn conversion.latLngToGridRef(lat, lng)\n\t\t}\n\t},\n\n\taddTo: function (map) {\n\t\tLeaflet_ScreenPosition.prototype.addTo.call(this, map)\n\t\tthis._addShowHideHandling()\n\t},\n\n\t_addShowHideHandling: function () {\n\t\tvar $icon = $('div.leaflet-control-mapcentercoord-icon.leaflet-zoom-hide')\n\t\tvar isIconVisible = false\n\t\tvar $control = $('div.leaflet-control-mapcentercoord.leaflet-control')\n\n\t\tfunction hideIcon() {\n\t\t\t$icon.css('visibility', 'hidden')\n\t\t\tisIconVisible = false\n\t\t}\n\n\t\tfunction showIcon() {\n\t\t\t$icon.css('visibility', 'visible')\n\t\t\tisIconVisible = true\n\t\t}\n\n\t\t$control.click(function () {\n\t\t\tif (isIconVisible) {\n\t\t\t\thideIcon()\n\t\t\t} else {\n\t\t\t\tshowIcon()\n\t\t\t}\n\t\t})\n\t\t//start with crosshairs hidden\n\t\thideIcon()\n\t}\n})\n\nexport default ScreenPositionOsgb\n","import Sidebar from 'sidebar-v2/js/leaflet-sidebar.js'\n\nimport 'sidebar-v2/css/leaflet-sidebar.css'\n\nexport default Sidebar\n","import $ from 'jquery'\nimport leaflet from 'VendorWrappers/leaflet.js'\n\nvar AttributionView = leaflet.Class.extend({\n\tinitialize: function (container) {\n\t\tthis._container = container\n\t\tlet copyright = $(\n\t\t\t`<div class=\"attribution-entry\"></div>\n\t<span class=\"attribution-source\">Geo-bagging</span>\n\t<span>\n\t\tThe code on this site is copyright \n\t\t<a href=\"https://github.com/tstibbs\">tstibbs</a>/stripycoder, \n\t\tlicenced under AGPL, \n\t\tsource code available at \n\t\t<a href=\"https://github.com/tstibbs/geo-bagging\">here</a>.\n\t</span>\n\t<br />\n\t<span>\n\t\tMany open source libraries help make this project, see a full list in <a href=\"licenses.txt\">licenses.txt</a>.\n\t</span>\n</div>`\n\t\t)\n\t\tthis._container.append(copyright)\n\t},\n\n\taddAttribution: function (dataSourceName, text) {\n\t\tlet attribution = $(\n\t\t\t`<div class=\"attribution-entry\">\n\t<span class=\"attribution-source\">${dataSourceName} data</span>\n\t<span>${text}</span>\n</div>`\n\t\t)\n\t\tthis._container.append(attribution)\n\t}\n})\n\nexport default AttributionView\n","import $ from 'jquery'\nimport leaflet from 'VendorWrappers/leaflet.js'\nimport constants from '../constants.js'\n\nvar UserMenu = leaflet.Class.extend({\n\tinitialize: function (manager) {\n\t\tthis._view = $('<div class=\"setting\"></div>')\n\t\tif (manager.isAuthenticated()) {\n\t\t\tthis._view.append($('<span>Logged in as ' + manager.getLoggedInUser() + '</span>'))\n\t\t} else {\n\t\t\tthis._view.append($('<a href=\"' + constants.legacyApiBackendBaseUrl + 'login\">Click here to log in</a>'))\n\t\t}\n\t},\n\n\tgetView: function () {\n\t\treturn this._view\n\t}\n})\n\nexport default UserMenu\n","import $ from 'jquery'\nimport leaflet from 'VendorWrappers/leaflet.js'\nimport {ClusteringEnabledControl} from './clustering_enabled_control.js'\n\nvar SettingsView = leaflet.Class.extend({\n\tinitialize: function (manager) {\n\t\tthis._view = $('<div></div>')\n\n\t\tvar clusteringEnabledControl = new ClusteringEnabledControl(manager)\n\t\tthis._view.append(clusteringEnabledControl.getView())\n\t},\n\n\tgetView: function () {\n\t\treturn this._view\n\t}\n})\n\nexport default SettingsView\n","import leaflet from 'VendorWrappers/leaflet.js'\n\nconst ExternalSourceLoader = leaflet.Class.extend({\n\tinitialize: function (manager) {\n\t\tthis._manager = manager\n\t\tthis._displayedSources = []\n\t},\n\n\taddLayers: function (sourceName, fileNameToLayers) {\n\t\tObject.values(fileNameToLayers).forEach(layer => layer.addTo(this._manager.getMap()))\n\t\tif (!this._displayedSources.includes(sourceName)) {\n\t\t\tthis._displayedSources.push(sourceName)\n\t\t\tthis._manager.getMatrixLayerControl().addAspect(sourceName, fileNameToLayers, {\n\t\t\t\tdimensionNames: [sourceName]\n\t\t\t})\n\t\t} else {\n\t\t\tObject.entries(fileNameToLayers).forEach(([fileName, layer]) => {\n\t\t\t\tthis._manager.getMatrixLayerControl()._addMatrixOverlay(layer, fileName, sourceName)\n\t\t\t})\n\t\t}\n\t\t//force new layers to be visible initially - even if layers with those names were deselected in a previous session\n\t\tObject.keys(fileNameToLayers).forEach(fileName => this._setLayerVis(sourceName, fileName, true))\n\t\tthis._manager.getMatrixLayerControl()._onInputClick()\n\t\tthis._manager.getMatrixLayerControl()._update()\n\t},\n\n\thideLayers: function (sourceName, fileNameToLayers) {\n\t\tObject.entries(fileNameToLayers).forEach(([fileName, layer]) => {\n\t\t\tthis._setLayerVis(sourceName, fileName, false)\n\t\t\tlayer.remove()\n\t\t})\n\t},\n\n\t_setLayerVis: function (sourceName, fileName, visible) {\n\t\tthis._manager.getMatrixLayerControl()._model(sourceName).inputChanged(sourceName, fileName, visible)\n\t}\n})\n\nexport default ExternalSourceLoader\n","import leaflet from 'VendorWrappers/leaflet.js'\nimport ExternalSourceLoader from '../../utils/external-source-loader.js'\nimport GeoJsonTranslator from '../../utils/geojson-translator.js'\n\nvar FilesView = leaflet.Class.extend({\n\tinitialize: function (manager, sourceName, colour, initialOutlineWidth) {\n\t\tthis._sourceName = sourceName\n\t\tthis._layers = {}\n\t\tthis._externalSourceLoader = new ExternalSourceLoader(manager)\n\t\tthis._translator = new GeoJsonTranslator(manager, colour, initialOutlineWidth)\n\t},\n\n\thideOldLayers: function () {\n\t\t//un-show the old layers\n\t\tthis._externalSourceLoader.hideLayers(this._sourceName, this._layers)\n\t},\n\n\tshowNewLayers: function (files) {\n\t\tlet layerData = files.map(({features, name}) => ({\n\t\t\tname,\n\t\t\tgeojson: features\n\t\t}))\n\t\tlet newLayers = this._translator.dataToLayers(layerData)\n\t\tthis._externalSourceLoader.addLayers(this._sourceName, newLayers)\n\t\tthis._layers = {...this._layers, ...newLayers}\n\t}\n})\n\nexport default FilesView\n","import leaflet from 'VendorWrappers/leaflet.js'\nimport $ from 'jquery'\n\nvar FileLoadView = leaflet.Class.extend({\n\tinitialize: function (loadLabel, loadExtensions) {\n\t\tthis._view = $('<div class=\"setting\"></div>')\n\t\tthis._view.append($(`<span>${loadLabel}: </span></br>`))\n\t\tthis._fileInput = $(`<input type=\"file\" accept=\"${loadExtensions}\" multiple>`)\n\t\tthis._view.append(this._fileInput)\n\t\tthis._fileInput.on('change', this._readFiles.bind(this))\n\t\tthis._fileCounter = 0\n\t},\n\n\t_readFiles: async function () {\n\t\tvar datas = []\n\t\tvar files = this._fileInput[0].files\n\t\tfor (var i = 0; i < files.length; i++) {\n\t\t\tconst file = files.item(i)\n\t\t\tvar parsed = await this._parseFileContents(file)\n\t\t\tdatas.push({\n\t\t\t\tname: `${this._fileCounter} - ${file.name}`, //counter just to make the name unique\n\t\t\t\t...parsed\n\t\t\t})\n\t\t\tthis._fileCounter++\n\t\t\tif (datas.length == files.length) {\n\t\t\t\tthis._finishedReadingFiles(datas)\n\t\t\t}\n\t\t}\n\t},\n\n\t_finishedReadingFiles: function (datas) {\n\t\tthrow new Error('Not implemented')\n\t},\n\n\t_parseFileContents: async function (file) {\n\t\tthrow new Error('Not implemented')\n\t},\n\n\tgetView: function () {\n\t\treturn this._view\n\t}\n})\n\nexport default FileLoadView\n","import FilesView from './files_view.js'\nimport FileLoadView from './file_load_view.js'\n\nvar FileFeaturesLoadView = FileLoadView.extend({\n\tinitialize: function (manager, bundle) {\n\t\tFileLoadView.prototype.initialize.call(this, bundle.loadLabel, bundle.loadExtensions)\n\t\tthis._bundle = bundle\n\t\tthis._filesView = new FilesView(\n\t\t\tmanager,\n\t\t\tthis._bundle.aspectLabel,\n\t\t\tthis._bundle.colour,\n\t\t\tthis._bundle.initialOutlineWidth\n\t\t)\n\t},\n\n\t_finishedReadingFiles: function (datas) {\n\t\t//datas is [{name, bounds, features}]\n\t\tthis._filesView.showNewLayers(datas)\n\t},\n\n\t_parseFileContents: async function (file) {\n\t\tconst {features, bounds} = this._bundle.fileContentsParser(await file.text())\n\t\treturn {\n\t\t\tfeatures,\n\t\t\tbounds\n\t\t}\n\t}\n})\n\nexport default FileFeaturesLoadView\n","import FileFeaturesLoadView from '../external-files/file_features_load_view.js'\n\nvar FileConstraintLoadView = FileFeaturesLoadView.extend({\n\tinitialize: function (manager, constraintsView, bundle) {\n\t\tFileFeaturesLoadView.prototype.initialize.call(this, manager, bundle)\n\t\tthis._constraintsView = constraintsView\n\t},\n\n\t_finishedReadingFiles: function (tracks) {\n\t\tvar combinedBounds = tracks.map(function (track) {\n\t\t\treturn track.bounds\n\t\t})\n\t\tcombinedBounds = combinedBounds.flat()\n\t\tthis._constraintsView.limitToGeoJsonPolygons(this, combinedBounds)\n\t\tFileFeaturesLoadView.prototype._finishedReadingFiles.call(this, tracks)\n\t},\n\n\treset: function () {\n\t\tthis._fileInput.val('')\n\t\tthis._filesView.hideOldLayers()\n\t}\n})\n\nexport default FileConstraintLoadView\n","import FileConstraintLoadView from './file-constraint-load-view.js'\nimport gpxBundle from '../../bundles/external-gpx/config.js'\n\nconst label = 'Upload GPX tracks to see markers around those tracks'\n\nconst configBundle = {\n\t...gpxBundle,\n\taspectLabel: 'GPX Tracks',\n\tcolour: '#FF0000', //red\n\tloadLabel: label\n}\n\nvar TrackConstraintsLoadView = FileConstraintLoadView.extend({\n\tinitialize: function (manager, constraintsView) {\n\t\tFileConstraintLoadView.prototype.initialize.call(this, manager, constraintsView, configBundle)\n\t}\n})\n\nexport default TrackConstraintsLoadView\n","import leaflet from 'VendorWrappers/leaflet.js'\nimport $ from 'jquery'\n\nvar CurrentLocationView = leaflet.Class.extend({\n\tinitialize: function (manager, constraintsView) {\n\t\tthis._manager = manager\n\t\tthis._constraintsView = constraintsView\n\n\t\tthis._view = $('<div class=\"setting\"></div>')\n\t\tvar currentLocationLimitButton = $('<button type=\"button\">Limit to 5 miles from current location</button>')\n\t\tcurrentLocationLimitButton.click(this._limitToCurrentLocation.bind(this))\n\t\tthis._view.append(currentLocationLimitButton)\n\t},\n\n\t_limitToCurrentLocation: function () {\n\t\tvar map = this._manager.getMap()\n\t\tvar listener = function (e) {\n\t\t\tmap.off('locationfound', listener) //only want to be called once\n\t\t\tvar lat = e.latlng.lat\n\t\t\tvar lng = e.latlng.lng\n\t\t\tvar latExtra = 0.08 //roughly 5 miles difference in lattitude in the UK\n\t\t\tvar lngExtra = 0.12 //roughly 5 miles difference in longitude in the UK\n\t\t\tvar latLngBounds = new leaflet.LatLngBounds([lat + latExtra, lng + lngExtra], [lat - latExtra, lng - lngExtra])\n\t\t\tthis._constraintsView.limitToBounds(this, latLngBounds)\n\t\t}.bind(this)\n\t\tmap.on('locationfound', listener)\n\t\tmap.stopLocate()\n\t\tmap.locate()\n\t},\n\n\tgetView: function () {\n\t\treturn this._view\n\t},\n\n\treset: function () {\n\t\t//nothing to do\n\t}\n})\n\nexport default CurrentLocationView\n","import leaflet from 'VendorWrappers/leaflet.js'\nimport $ from 'jquery'\n\nvar CurrentAreaView = leaflet.Class.extend({\n\tinitialize: function (manager, constraintsView) {\n\t\tthis._manager = manager\n\t\tthis._constraintsView = constraintsView\n\n\t\tthis._view = $('<div class=\"setting\"></div>')\n\t\tthis._currentAreaLimit = $('<input type=\"checkbox\">')\n\t\tvar desc = $('<label>Limit new markers to current area</label>')\n\t\tdesc.prepend(this._currentAreaLimit)\n\n\t\tthis._currentAreaLimit.change(\n\t\t\tfunction (event) {\n\t\t\t\tif (event.target.checked) {\n\t\t\t\t\tthis._constraintsView.limitToBounds(this, this._manager.getMap().getBounds())\n\t\t\t\t} else {\n\t\t\t\t\tthis._constraintsView.unlimit()\n\t\t\t\t}\n\t\t\t}.bind(this)\n\t\t)\n\n\t\tthis._view.append(desc)\n\t},\n\n\tgetView: function () {\n\t\treturn this._view\n\t},\n\n\treset: function () {\n\t\tthis._currentAreaLimit.prop('checked', false)\n\t}\n})\n\nexport default CurrentAreaView\n","import FileConstraintLoadView from './file-constraint-load-view.js'\nimport geojsonBundle from '../../bundles/external-geojson/config.js'\n\nconst label = 'Upload a GeoJSON file to see markers within the polygons specified in the geojson file'\n\nconst configBundle = {\n\t...geojsonBundle,\n\taspectLabel: 'GeoJson Constraints',\n\tcolour: 'orange',\n\tloadLabel: label\n}\n\nexport const GeoJsonConstraintLoadView = FileConstraintLoadView.extend({\n\tinitialize: function (manager, constraintsView) {\n\t\tFileConstraintLoadView.prototype.initialize.call(this, manager, constraintsView, configBundle)\n\t}\n})\n","import RBush from 'rbush'\nimport {bbox, intersect, union, featureCollection} from '@turf/turf'\n\nexport function mergePolygons(features) {\n\t//load tree\n\tconst tree = new RBush()\n\tconst featuresWithBounds = features.map(feature => {\n\t\tconst [minX, minY, maxX, maxY] = bbox(feature)\n\t\treturn {\n\t\t\tminX,\n\t\t\tminY,\n\t\t\tmaxX,\n\t\t\tmaxY,\n\t\t\tfeature\n\t\t}\n\t})\n\ttree.load(featuresWithBounds)\n\n\t//iterate polygons and merge\n\tlet mergedPolygons = []\n\tconst processedFeatures = new Set()\n\n\tlet aMergeHappened = false\n\tfeatures.forEach(feature => {\n\t\t//skip features that were processed due to merging with a previous feature\n\t\tif (!processedFeatures.has(feature)) {\n\t\t\tlet currentPolygon = feature\n\t\t\tconst featuresToMerge = []\n\n\t\t\t//Find features who's bounds overlap (but the polygons might not)\n\t\t\tconst [minX, minY, maxX, maxY] = bbox(feature)\n\t\t\tconst potentialOverlaps = tree.search({\n\t\t\t\tminX,\n\t\t\t\tminY,\n\t\t\t\tmaxX,\n\t\t\t\tmaxY\n\t\t\t})\n\n\t\t\tpotentialOverlaps.forEach(potentialOverlap => {\n\t\t\t\tconst poFeature = potentialOverlap.feature\n\t\t\t\t//skip this feature and any already processed\n\t\t\t\tif (feature !== poFeature && !processedFeatures.has(poFeature)) {\n\t\t\t\t\tconst intersection = intersect(featureCollection([currentPolygon, poFeature]))\n\t\t\t\t\tif (intersection) {\n\t\t\t\t\t\t// Check if they _actually_ intersect\n\t\t\t\t\t\tfeaturesToMerge.push(poFeature)\n\t\t\t\t\t\tprocessedFeatures.add(poFeature)\n\t\t\t\t\t\taMergeHappened = true\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\n\t\t\t//merge all actual overlaps\n\t\t\tfeaturesToMerge.forEach(poFeature => {\n\t\t\t\tcurrentPolygon = union(featureCollection([currentPolygon, poFeature]))\n\t\t\t})\n\n\t\t\tmergedPolygons.push(currentPolygon)\n\t\t\tprocessedFeatures.add(feature)\n\t\t}\n\t})\n\t//if a merge happened, recur down until no more merges happen (because the\n\t// resulting polygons might overlap even though their initial members didn't)\n\tif (aMergeHappened) {\n\t\tmergedPolygons = mergePolygons(mergedPolygons)\n\t}\n\treturn mergedPolygons\n}\n","import $ from 'jquery'\nimport leaflet from 'VendorWrappers/leaflet.js'\nimport TrackConstraintsLoadView from './track_load_view.js'\nimport CurrentLocationView from './current_location_view.js'\nimport CurrentAreaView from './current_area_view.js'\nimport {GeoJsonConstraintLoadView} from './geo-json-load-view.js'\nimport {geoJsonCoordsToLeaflet, geoJsonBoundsToLeaflet} from '../../utils/geojson.js'\nimport {mergePolygons} from '../../utils/polygon-merger.js'\nimport {polygon} from '@turf/turf'\n\nvar ConstraintsView = leaflet.Class.extend({\n\tinitialize: function (manager) {\n\t\tthis._manager = manager\n\t\tthis._constraintPolygons = []\n\t\tthis._limitOriginView = null //the view that triggered the current limits\n\t\tthis._view = $('<div></div>')\n\t\tvar info = $(\n\t\t\t'<div class=\"info\">This section allows you to limit how much data is displayed on screen. This can be useful for example when on older or mobile devices which may struggle to remain responsive if a large amount of data is loaded.</div>'\n\t\t)\n\t\tthis._view.append(info)\n\t\tthis._view.append('<hr class=\"info\">')\n\n\t\tvar currentAreaView = new CurrentAreaView(manager, this)\n\t\tthis._view.append(currentAreaView.getView())\n\n\t\tvar currentLocationView = new CurrentLocationView(manager, this)\n\t\tthis._view.append(currentLocationView.getView())\n\n\t\tthis._trackConstraintsLoadView = new TrackConstraintsLoadView(manager, this)\n\t\tthis._view.append(this._trackConstraintsLoadView.getView())\n\n\t\tthis._geoJsonConstraintLoadView = new GeoJsonConstraintLoadView(manager, this)\n\t\tthis._view.append(this._geoJsonConstraintLoadView.getView())\n\n\t\tvar reset = this._buildReset()\n\t\tthis._view.append(reset)\n\t},\n\n\t_buildReset: function () {\n\t\tvar wrapper = $('<div class=\"setting\"></div>')\n\t\tvar currentLocationLimitButton = $('<button type=\"button\">Reset</button>')\n\t\tcurrentLocationLimitButton.click(this.unlimit.bind(this))\n\t\twrapper.append(currentLocationLimitButton)\n\t\treturn wrapper\n\t},\n\n\tlimitToBounds: function (limitOriginView, /*LatLngBounds*/ bounds) {\n\t\t//translating to geojson just to translate back is somewhat inefficient, but as it's only a single polygon it shouldn't cause a noticeable slowdown. It's simpler to do this than to have two versions of the main limitTo function\n\t\tlet polygonPoints = [\n\t\t\tbounds.getSouthWest(),\n\t\t\tbounds.getNorthWest(),\n\t\t\tbounds.getNorthEast(),\n\t\t\tbounds.getSouthEast(),\n\t\t\tbounds.getSouthWest()\n\t\t].map(latLng => leaflet.GeoJSON.latLngToCoords(latLng))\n\t\tlet boundsAsGeoJson = polygon([polygonPoints])\n\t\tthis.limitToGeoJsonPolygons(limitOriginView, [boundsAsGeoJson])\n\t},\n\n\tlimitToGeoJsonPolygons: function (limitOriginView, /*[GeoJson Polygon]*/ bounds) {\n\t\tthis.unlimit()\n\t\tthis._limitOriginView = limitOriginView\n\t\tif (!Array.isArray(bounds)) {\n\t\t\tbounds = [bounds]\n\t\t}\n\t\tthis._manager.setViewConstraints(this._buildLimitFunction(bounds))\n\t\tvar polygonPoints = [\n\t\t\t[\n\t\t\t\t[-90, -180],\n\t\t\t\t[90, -180],\n\t\t\t\t[90, 180],\n\t\t\t\t[-90, 180]\n\t\t\t] //outer - should cover the entire map\n\t\t]\n\t\tlet geoJsonBounds = mergePolygons(bounds)\n\t\tgeoJsonBounds.forEach(hole => {\n\t\t\tlet coords = hole.geometry.coordinates\n\t\t\t//take polygon bounds (the first element in the array) to make a hole in the main polygon\n\t\t\tlet holePoints = geoJsonCoordsToLeaflet(coords[0])\n\t\t\tpolygonPoints.push(holePoints)\n\t\t\t//take polygon holes (the remaining elements in the array) to re-add a constraint polygon for any holes-within-holes\n\t\t\tlet holesInHoles = coords.slice(1)\n\t\t\tholesInHoles.forEach(holeInHole => {\n\t\t\t\tlet holeInHolePolygon = geoJsonCoordsToLeaflet(holeInHole)\n\t\t\t\tthis._addMaskPolygon(holeInHolePolygon)\n\t\t\t})\n\t\t})\n\t\tthis._addMaskPolygon(polygonPoints)\n\t},\n\n\t_addMaskPolygon: function (polygonPoints) {\n\t\tlet polygon = new L.Polygon(polygonPoints, {\n\t\t\tcolor: 'rgb(0, 0, 0, 0)',\n\t\t\tfillColor: 'rgb(90, 90, 90)',\n\t\t\tfillOpacity: 0.3\n\t\t})\n\t\tpolygon.addTo(this._manager.getMap())\n\t\tthis._constraintPolygons.push(polygon)\n\t},\n\n\t_buildLimitFunction: function (geoJsonPolygons) {\n\t\tlet bounds = geoJsonBoundsToLeaflet(geoJsonPolygons)\n\t\treturn function (latLng) {\n\t\t\tfor (var i = 0; i < bounds.length; i++) {\n\t\t\t\tif (bounds[i].contains(latLng)) {\n\t\t\t\t\treturn true\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false\n\t\t}\n\t},\n\n\tunlimit: function () {\n\t\tif (this._limitOriginView != null) {\n\t\t\tthis._limitOriginView.reset()\n\t\t\tthis._limitOriginView = null\n\t\t}\n\t\tthis._manager.resetViewConstraints()\n\t\tif (this._constraintPolygons != null) {\n\t\t\tthis._constraintPolygons.forEach(polygon => polygon.remove())\n\t\t\tthis._constraintPolygons = []\n\t\t}\n\t},\n\n\tgetView: function () {\n\t\treturn this._view\n\t}\n})\n\nexport default ConstraintsView\n","import ExcelJS from 'exceljs'\n\nconst ID_FIELD_NAME = 'ID'\nconst SOURCE_FIELD_NAME = 'Source ID'\n\nexport async function fileToSources(file) {\n\tconst workbook = new ExcelJS.Workbook()\n\tconst arrayBuffer = await file.arrayBuffer()\n\tawait workbook.xlsx.load(arrayBuffer)\n\tconst worksheet = workbook.getWorksheet(1)\n\n\tconst rawData = []\n\tworksheet.eachRow({includeEmpty: true}, row => {\n\t\tconst rowData = []\n\t\trow.eachCell({includeEmpty: true}, cell => {\n\t\t\trowData.push(cell.value)\n\t\t})\n\t\trawData.push(rowData)\n\t})\n\tconst headerRow = rawData[0]\n\tconst dataRows = rawData.slice(1)\n\tconst idIdx = headerRow.indexOf(ID_FIELD_NAME)\n\tconst sourceIdx = headerRow.indexOf(SOURCE_FIELD_NAME)\n\tif (idIdx == -1 || sourceIdx == -1) {\n\t\tthrow new Error(`Malformed excel, must contains columns named '${ID_FIELD_NAME}' and '${SOURCE_FIELD_NAME}'.`)\n\t}\n\tconst data = dataRows\n\t\t.map(row => ({\n\t\t\tid: row.at(idIdx),\n\t\t\tsource: row.at(sourceIdx)\n\t\t}))\n\t\t.filter(({id, source}) => id != null && source != null)\n\t\t.map(({id, source}) => ({\n\t\t\tid: stringify(id),\n\t\t\tsource: stringify(source)\n\t\t}))\n\t\t.filter(({id, source}) => !empty(id) && !empty(source))\n\tconst dataBySource = Object.groupBy(data, row => row.source)\n\tconst idsBySource = Object.fromEntries(\n\t\tObject.entries(dataBySource).map(([source, entries]) => {\n\t\t\tconst ids = entries.map(({id}) => id)\n\t\t\treturn [source, ids]\n\t\t})\n\t)\n\treturn idsBySource\n}\n\nfunction empty(str) {\n\treturn str == null || str.trim().length == 0\n}\n\nfunction stringify(val) {\n\treturn typeof val === 'string' ? val : `${val}`\n}\n","import FileLoadView from '../external-files/file_load_view.js'\nimport {fileToSources} from '../../constraints/visits-excel-parser.js'\n\nexport const VisitsLoadView = FileLoadView.extend({\n\tinitialize: function (manager, visitsMenuView) {\n\t\tFileLoadView.prototype.initialize.call(this, \"Upload file listing 'visited' POIs\", '.xlsx')\n\t\tthis._manager = manager\n\t\tthis._visitsMenuView = visitsMenuView\n\t},\n\n\t_finishedReadingFiles: function (datas) {\n\t\tconst visits = datas.map(data => data.visits)\n\t\tconst mergedData = {}\n\t\tconst keys = new Set(visits.map(Object.keys).flat())\n\t\tfor (const key of keys) {\n\t\t\tmergedData[key] = visits\n\t\t\t\t.filter(data => key in data)\n\t\t\t\t.map(data => data[key])\n\t\t\t\t.flat()\n\t\t}\n\t\tthis._visitsMenuView.setVisits(this, mergedData)\n\t},\n\n\t_parseFileContents: async function (file) {\n\t\tlet sources = await fileToSources(file)\n\t\treturn {\n\t\t\tvisits: sources\n\t\t}\n\t},\n\n\treset: function () {\n\t\tthis._fileInput.val('')\n\t}\n})\n","import $ from 'jquery'\nimport leaflet from 'VendorWrappers/leaflet.js'\nimport {VisitsLoadView} from './visits_load_view.js'\n\nexport const VisitsMenuView = leaflet.Class.extend({\n\tinitialize: function (manager) {\n\t\tthis._manager = manager\n\t\tthis._limitOriginView = null //the view that triggered the current limits\n\t\tthis._view = $('<div></div>')\n\t\tvar info = $(\n\t\t\t'<div class=\"info\">This section allows you to upload an excel file listing all the POIs you have visited. This information will then be added to the category selectors to allow you to select POIs based on whether they have been visited, not visited, or both.</div>'\n\t\t)\n\t\tthis._view.append(info)\n\t\tthis._view.append('<hr class=\"info\">')\n\n\t\tthis._VisitsLoadView = new VisitsLoadView(manager, this)\n\t\tthis._view.append(this._VisitsLoadView.getView())\n\n\t\tvar reset = this._buildReset()\n\t\tthis._view.append(reset)\n\t},\n\n\t_buildReset: function () {\n\t\tvar wrapper = $('<div class=\"setting\"></div>')\n\t\tvar currentLocationLimitButton = $('<button type=\"button\">Reset</button>')\n\t\tcurrentLocationLimitButton.click(this.reset.bind(this))\n\t\twrapper.append(currentLocationLimitButton)\n\t\treturn wrapper\n\t},\n\n\tsetVisits: function (originView, visitData) {\n\t\tthis._limitOriginView = originView\n\t\tthis._manager.getVisitConstraintManager().setVisitConstraints(visitData)\n\t},\n\n\treset: function () {\n\t\tif (this._limitOriginView != null) {\n\t\t\tthis._limitOriginView.reset()\n\t\t\tthis._limitOriginView = null\n\t\t}\n\t\tthis._manager.getVisitConstraintManager().reset()\n\t},\n\n\tgetView: function () {\n\t\treturn this._view\n\t}\n})\n","import $ from 'jquery'\nimport leaflet from 'VendorWrappers/leaflet.js'\nimport FileFeaturesLoadView from './file_features_load_view.js'\nimport geojsonBundle from '../../bundles/external-geojson/config.js'\nimport gpxBundle from '../../bundles/external-gpx/config.js'\n\nvar ExternalFilesView = leaflet.Class.extend({\n\tinitialize: function (manager) {\n\t\tthis._view = $('<div></div>')\n\t\tvar info = $(\n\t\t\t'<div class=\"info\">Load external files to overlay on to map. Parsing is basic and limited information will be loaded - overlays will be mostly just visuals.</div>'\n\t\t)\n\t\tthis._view.append(info)\n\t\tthis._view.append('<hr class=\"info\">')\n\n\t\tconst geojsonLoadView = new FileFeaturesLoadView(manager, geojsonBundle)\n\t\tthis._view.append(geojsonLoadView.getView())\n\n\t\tconst gpxLoadView = new FileFeaturesLoadView(manager, gpxBundle)\n\t\tthis._view.append(gpxLoadView.getView())\n\t},\n\n\tgetView: function () {\n\t\treturn this._view\n\t}\n})\n\nexport default ExternalFilesView\n","import $ from 'jquery'\nimport leaflet from 'VendorWrappers/leaflet.js'\nimport LeafletSidebar from 'VendorWrappers/sidebar.js'\nimport AttributionView from './attribution.js'\nimport UserView from './user.js'\nimport SettingsView from './settings/view.js'\nimport ConstraintsView from './constraints/view.js'\nimport {VisitsMenuView} from './visits/view.js'\nimport ExternalFilesView from './external-files/files_load_panel.js'\nimport params from '../params.js'\n\nvar MenuView = leaflet.Class.extend({\n\tinitialize: function (manager) {\n\t\tthis._manager = manager\n\t\tthis._buildView()\n\t\tthis._buildControl()\n\t},\n\n\t_buildView: function () {\n\t\tvar view = ''\n\n\t\tvar classes = ['sidebar', 'collapsed', 'leaflet-container']\n\n\t\tvar showUserSettings = params.test('testing') == 'true'\n\n\t\t//top of the navigation bar\n\t\tview += '<div id=\"sidebar\" class=\"' + classes.join(' ') + '\">'\n\t\tview += '    <div class=\"sidebar-tabs\">'\n\t\tview += '        <ul role=\"tablist\">'\n\t\tview += '            <li><a href=\"#sidebar-layers\" role=\"tab\"><i class=\"fa fa-bars\"></i></a></li>'\n\t\tview += '            <li><a href=\"#sidebar-settings\" role=\"tab\"><i class=\"fa fa-sliders\"></i></a></li>'\n\t\tview += '            <li><a href=\"#sidebar-constraints\" role=\"tab\"><i class=\"fa fa-map-o\"></i></a></li>'\n\t\tview += `            <li>\n                                 <a href=\"#sidebar-visits\" role=\"tab\">\n                                     <span class=\"fa fa-stack\">\n                                         <i class=\"fa-check fa fa-stack-1x fa-small-icon\"></i>\n                                         <i class=\"fa-map-o fa fa-stack-1x\"></i>\n                                     </span>\n                                 </a>\n                             </li>`\n\t\tview += '            <li><a href=\"#sidebar-external-files\" role=\"tab\"><i class=\"fa fa-plus-square-o\"></i></a></li>'\n\t\tview += '        </ul>'\n\n\t\t//bottom of the navigation bar\n\t\tview += '        <ul role=\"tablist\">'\n\t\tif (showUserSettings) {\n\t\t\tview += '            <li><a href=\"#sidebar-user\" role=\"tab\"><i class=\"fa fa-user\"></i></a></li>'\n\t\t}\n\t\tview += '            <li><a href=\"#sidebar-attribution\" role=\"tab\"><i class=\"fa fa-copyright\"></i></a></li>'\n\t\tview += '        </ul>'\n\t\tview += '    </div>'\n\n\t\t//tab contents\n\t\tview += '    <div class=\"sidebar-content\">'\n\t\tview += '        <div id=\"sidebar-layers\" class=\"sidebar-pane\">'\n\t\tview +=\n\t\t\t'            <h1 class=\"sidebar-header\">Layers<span class=\"sidebar-close\"><i class=\"fa fa-caret-left\"></i></span></h1>'\n\t\tview += '        </div>'\n\t\tview += '        <div id=\"sidebar-settings\" class=\"sidebar-pane\">'\n\t\tview +=\n\t\t\t'            <h1 class=\"sidebar-header\">Settings<span class=\"sidebar-close\"><i class=\"fa fa-caret-left\"></i></span></h1>'\n\t\tview += '        </div>'\n\t\tview += '        <div id=\"sidebar-constraints\" class=\"sidebar-pane\">'\n\t\tview +=\n\t\t\t'            <h1 class=\"sidebar-header\">Data Limits<span class=\"sidebar-close\"><i class=\"fa fa-caret-left\"></i></span></h1>'\n\t\tview += '        </div>'\n\t\tview += '        <div id=\"sidebar-visits\" class=\"sidebar-pane\">'\n\t\tview +=\n\t\t\t'            <h1 class=\"sidebar-header\">Upload Visits<span class=\"sidebar-close\"><i class=\"fa fa-caret-left\"></i></span></h1>'\n\t\tview += '        </div>'\n\t\tview += '        <div id=\"sidebar-external-files\" class=\"sidebar-pane\">'\n\t\tview +=\n\t\t\t'            <h1 class=\"sidebar-header\">External Files<span class=\"sidebar-close\"><i class=\"fa fa-caret-left\"></i></span></h1>'\n\t\tview += '        </div>'\n\t\tview += '        <div id=\"sidebar-attribution\" class=\"sidebar-pane\">'\n\t\tview +=\n\t\t\t'            <h1 class=\"sidebar-header\">Attribution<span class=\"sidebar-close\"><i class=\"fa fa-caret-left\"></i></span></h1>'\n\t\tview += '        </div>'\n\t\tif (showUserSettings) {\n\t\t\tview += '        <div id=\"sidebar-user\" class=\"sidebar-pane\">'\n\t\t\tview +=\n\t\t\t\t'            <h1 class=\"sidebar-header\">User Settings<span class=\"sidebar-close\"><i class=\"fa fa-caret-left\"></i></span></h1>'\n\t\t\tview += '        </div>'\n\t\t}\n\t\tview += '    </div>'\n\t\tview += '</div>'\n\n\t\tthis._view = $(view)\n\t\tthis._manager.getConfig().map_outer_container_element.append(this._view)\n\n\t\tvar attributionContainer = $('<div></div>')\n\t\t$('#sidebar-attribution', this._view).append(attributionContainer)\n\t\tthis._attributionView = new AttributionView(attributionContainer)\n\n\t\tif (showUserSettings) {\n\t\t\tvar userView = new UserView(this._manager)\n\t\t\t$('#sidebar-user', this._view).append(userView.getView())\n\t\t}\n\n\t\tvar settingsView = new SettingsView(this._manager)\n\t\t$('#sidebar-settings', this._view).append(settingsView.getView())\n\n\t\tvar constraintsView = new ConstraintsView(this._manager)\n\t\t$('#sidebar-constraints', this._view).append(constraintsView.getView())\n\n\t\tvar visitsView = new VisitsMenuView(this._manager)\n\t\t$('#sidebar-visits', this._view).append(visitsView.getView())\n\n\t\tconst externalFilesView = new ExternalFilesView(this._manager)\n\t\t$('#sidebar-external-files', this._view).append(externalFilesView.getView())\n\t},\n\n\t_buildControl: function () {\n\t\tthis._control = new LeafletSidebar('sidebar')\n\t},\n\n\taddTo: function (map) {\n\t\tthis._control.addTo(map)\n\t},\n\n\tgetContainer: function () {\n\t\treturn this._view[0] //get raw dom element from jquery\n\t},\n\n\taddLayers: function (matrixLayerControl) {\n\t\t$('#sidebar-layers', this._view).append(matrixLayerControl.getContainer())\n\t},\n\n\taddAttribution: function (dataSourceName, text) {\n\t\tthis._attributionView.addAttribution(dataSourceName, text)\n\t}\n})\n\nexport default MenuView\n","import leaflet from 'VendorWrappers/leaflet.js'\nimport $ from 'jquery'\nimport Leaflet_ControlHider from 'VendorWrappers/leaflet-control-hider.js'\nimport Selection from './selection.js'\nimport Locate from './locate.js'\nimport mobile from './mobile.js'\nimport {GeosearchControl, GeosearchBing} from 'VendorWrappers/leaflet-geosearch.js'\nimport Mouseposition_Osgb from './mouseposition_osgb.js'\nimport Screenposition_Osgb from './screenposition_osgb.js'\nimport constants from './constants.js'\nimport MenuView from './menu/view.js'\nimport Leaflet_MatrixLayers from 'VendorWrappers/leaflet-matrix-layers-control.js'\n\n//even if some items aren't used in this particular configuration, we'll stick to a given order (resulting gaps are fine)\nvar order = [\n\tLeaflet_ControlHider,\n\tMenuView,\n\tleaflet.Control.Zoom,\n\tLocate,\n\tGeosearchControl,\n\tleaflet.Control.Layers, //matrix layers extends this, so will appear in the same slot\n\tSelection,\n\tMouseposition_Osgb,\n\tScreenposition_Osgb,\n\tleaflet.Control.Attribution\n]\n\nvar Controls = leaflet.Class.extend({\n\tinitialize: function (config, layers, map, manager) {\n\t\tthis._controlsToHide = []\n\t\tthis._controlsToAdd = []\n\t\tthis._config = config\n\t\tthis._layers = layers\n\t\tthis._manager = manager\n\t\tthis._addDefaults()\n\t\tif (map != null) {\n\t\t\tthis._addAllTo(map)\n\t\t}\n\t},\n\n\t_addDefaults: function () {\n\t\t//default leaflet controls\n\t\tvar configOverrides = {}\n\t\tif (this._config.use_sidebar) {\n\t\t\tthis._menuView = new MenuView(this._manager)\n\t\t\tthis.addControl(this._menuView)\n\t\t\tconfigOverrides = {position: 'topright'}\n\t\t}\n\t\tif (this._config.show_zoom_control) {\n\t\t\tthis.addControl(new leaflet.Control.Zoom(configOverrides))\n\t\t}\n\t\t//custom controls\n\t\tif (this._config.show_selection_control) {\n\t\t\tthis.addControl(new Selection())\n\t\t}\n\t\tif (this._config.show_search_control) {\n\t\t\tthis.addControl(\n\t\t\t\tnew GeosearchControl(\n\t\t\t\t\t$.extend(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tshowPopup: true,\n\t\t\t\t\t\t\tprovider: new GeosearchBing({\n\t\t\t\t\t\t\t\tparams: {\n\t\t\t\t\t\t\t\t\tkey: constants.bingKey\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t},\n\t\t\t\t\t\tconfigOverrides\n\t\t\t\t\t)\n\t\t\t\t)\n\t\t\t)\n\t\t}\n\t\tif (\n\t\t\tthis._config.show_hider_control === true ||\n\t\t\t(this._config.show_hider_control == 'mobile' && mobile.isMobile())\n\t\t) {\n\t\t\tthis.addControl(\n\t\t\t\tnew Leaflet_ControlHider(this._controlsToHide, {\n\t\t\t\t\tvisibleByDefault: this._config.hider_control_start_visible\n\t\t\t\t})\n\t\t\t)\n\t\t}\n\t\tif (this._config.show_locate_control) {\n\t\t\tthis.addControl(new Locate(configOverrides))\n\t\t}\n\t\tif (this._config.show_layers_control && this._layers != null && Object.keys(this._layers).length > 1) {\n\t\t\tthis.addControl(new leaflet.Control.Layers(this._layers, null))\n\t\t}\n\t\tif (this._config.show_position_control) {\n\t\t\t//position displays\n\t\t\tif (mobile.isMobile()) {\n\t\t\t\tthis.addControl(new Screenposition_Osgb())\n\t\t\t} else {\n\t\t\t\tthis.addControl(new Mouseposition_Osgb())\n\t\t\t}\n\t\t}\n\t},\n\n\taddControl: function (control) {\n\t\tvar oldControl = null\n\t\tvar found = false\n\t\tfor (var i = 0; i < order.length; i++) {\n\t\t\tif (control instanceof order[i]) {\n\t\t\t\tif (this._controlsToAdd[i] != null) {\n\t\t\t\t\tif (console) {\n\t\t\t\t\t\tconsole.debug('Overwriting existing control \"' + this._controlsToAdd[i] + '\" with \"' + control + '\".')\n\t\t\t\t\t}\n\t\t\t\t\toldControl = this._controlsToAdd[i]\n\t\t\t\t}\n\t\t\t\tthis._controlsToAdd[i] = control\n\t\t\t\tif (!(control instanceof Leaflet_ControlHider)) {\n\t\t\t\t\tthis._controlsToHide.push(control)\n\t\t\t\t}\n\t\t\t\tfound = true\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t\tif (!found) {\n\t\t\tconsole.error('Unrecognised control: ' + control)\n\t\t\tthis._controlsToHide.push(control)\n\t\t\tthis._controlsToAdd[Math.max(order.length, this._controlsToAdd.length)] = control\n\t\t}\n\t\t//won't run for anything in addDefaults because this._map won't be populated at that point\n\t\tif (this._map != null) {\n\t\t\tcontrol.addTo(this._map) //add it, could be in the wrong place, but we'll move it later if necessary\n\t\t\tif (oldControl != null) {\n\t\t\t\tif (\n\t\t\t\t\tcontrol instanceof Leaflet_MatrixLayers &&\n\t\t\t\t\toldControl instanceof leaflet.Control.Layers &&\n\t\t\t\t\tthis._config.use_sidebar\n\t\t\t\t) {\n\t\t\t\t\t//remove standard layer control and put the new one on the menu\n\t\t\t\t\toldControl.remove()\n\t\t\t\t\tthis._menuView.addLayers(control)\n\t\t\t\t} else {\n\t\t\t\t\tvar newContainer = control._container\n\t\t\t\t\tvar oldContainer = oldControl._container\n\t\t\t\t\t$(newContainer).remove() //remove from incorrect location\n\t\t\t\t\t$(oldContainer).replaceWith(newContainer) //reattach at new location\n\t\t\t\t\toldControl.remove()\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\t_addAllTo: function (map) {\n\t\tthis._controlsToAdd.forEach(\n\t\t\tfunction (control) {\n\t\t\t\tif (control != null) {\n\t\t\t\t\tcontrol.addTo(map)\n\t\t\t\t}\n\t\t\t}.bind(this)\n\t\t)\n\t\tthis._map = map\n\t},\n\n\taddAttribution: function (dataSourceName, text) {\n\t\tif (this._config.use_sidebar) {\n\t\t\tthis._menuView.addAttribution(dataSourceName, text)\n\t\t}\n\t}\n})\n\nexport default Controls\n","const DIMENSION_NAME = 'Visited'\nconst DIMENSION_LABEL = 'Visited?'\n\nexport const VisitConstraintManager = class {\n\t#hasVisitLimits = false\n\t#visitConstraints = {}\n\n\ttranslateAspect(aspectOptions, bundleName) {\n\t\tif (this.#hasVisitsForSource(bundleName)) {\n\t\t\taspectOptions.dimensionNames = [DIMENSION_NAME, ...aspectOptions.dimensionNames]\n\t\t\taspectOptions.dimensionLabels = {\n\t\t\t\t[DIMENSION_NAME]: DIMENSION_LABEL,\n\t\t\t\t...(aspectOptions.dimensionLabels ?? {})\n\t\t\t}\n\t\t}\n\t\treturn aspectOptions\n\t}\n\n\ttranslateDimensionString(id, bundleName) {\n\t\tlet dimensionValues = id\n\t\tif (this.#hasVisitsForSource(bundleName)) {\n\t\t\tdimensionValues = this.translateDimensionValues([id], id, bundleName).join('/')\n\t\t}\n\t\treturn dimensionValues\n\t}\n\n\ttranslateDimensionValues(dimensionValues, id, bundleName) {\n\t\tif (this.#hasVisitsForSource(bundleName)) {\n\t\t\tlet visited = this.#visitConstraints[bundleName]?.includes(id)\n\t\t\tlet value = visited ? 'Visited' : 'Not Visited'\n\t\t\tdimensionValues = [value, ...dimensionValues]\n\t\t}\n\t\treturn dimensionValues\n\t}\n\n\t#hasVisitsForSource(bundleName) {\n\t\treturn this.#hasVisitLimits && this.#visitConstraints[bundleName] != null\n\t}\n\n\tsetVisitConstraints(visitConstraints) {\n\t\tthis.#hasVisitLimits = true\n\t\tthis.#visitConstraints = visitConstraints\n\t}\n\n\treset() {\n\t\tthis.#hasVisitLimits = false\n\t\tthis.#visitConstraints = {}\n\t}\n}\n","import $ from 'jquery'\nimport leaflet from 'VendorWrappers/leaflet.js'\nimport Leaflet_MatrixLayers from 'VendorWrappers/leaflet-matrix-layers-control.js'\nimport Controls from './controls.js'\nimport layersBuilder from './layers.js'\nimport constants from './constants.js'\nimport params from './params.js'\nimport {VisitConstraintManager} from './constraints/visit-constraint-manager.js'\n\n//basic manager class that simplifies interoperation between other components\nvar Manager = leaflet.Class.extend({\n\tinitialize: function (map, config) {\n\t\tthis._authenticated = false //default\n\t\tthis._visitConstraintManager = new VisitConstraintManager()\n\t\tvar showUserSettings = params.test('testing') == 'true'\n\t\tif (showUserSettings) {\n\t\t\tthis._initializePromise = $.Deferred(\n\t\t\t\tfunction (deferred) {\n\t\t\t\t\t$.get({\n\t\t\t\t\t\turl: constants.legacyApiBackendBaseUrl + 'isAuthenticated',\n\t\t\t\t\t\txhrFields: {\n\t\t\t\t\t\t\twithCredentials: true\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t\t.then(\n\t\t\t\t\t\t\tfunction (data) {\n\t\t\t\t\t\t\t\tif (data == false) {\n\t\t\t\t\t\t\t\t\tthis._authenticated = false\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tthis._authenticated = true\n\t\t\t\t\t\t\t\t\tthis._loggedInUser = data.email\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tdeferred.resolve()\n\t\t\t\t\t\t\t}.bind(this)\n\t\t\t\t\t\t)\n\t\t\t\t\t\t.fail(\n\t\t\t\t\t\t\tfunction (xhr, textError, error) {\n\t\t\t\t\t\t\t\tif (xhr.status != 401) {\n\t\t\t\t\t\t\t\t\t//401 just means we're not logged in, it's not an error we need to report on\n\t\t\t\t\t\t\t\t\tconsole.error(\n\t\t\t\t\t\t\t\t\t\t'Failed to check authentication status - this can be ignored unless trying to record visits: ' +\n\t\t\t\t\t\t\t\t\t\t\ttextError\n\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\tconsole.log(error)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tthis._authenticated = false\n\t\t\t\t\t\t\t\tdeferred.resolve()\n\t\t\t\t\t\t\t}.bind(this)\n\t\t\t\t\t\t)\n\t\t\t\t}.bind(this)\n\t\t\t).promise()\n\t\t} else {\n\t\t\tthis._initializePromise = $.Deferred().resolve()\n\t\t}\n\t\tthis._initializePromise = this._initializePromise.always(\n\t\t\tfunction () {\n\t\t\t\tthis._map = map\n\t\t\t\tthis._config = config\n\t\t\t\tthis._layers = layersBuilder(map, config)\n\t\t\t\tif (this._config.dimensional_layering) {\n\t\t\t\t\tthis._matrixLayerControl = new Leaflet_MatrixLayers(\n\t\t\t\t\t\tthis._layers,\n\t\t\t\t\t\tnull,\n\t\t\t\t\t\t{},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmultiAspects: true,\n\t\t\t\t\t\t\tembeddable: this._config.use_sidebar\n\t\t\t\t\t\t}\n\t\t\t\t\t)\n\t\t\t\t}\n\t\t\t\tthis._controls = new Controls(config, this._layers, map, this)\n\t\t\t}.bind(this)\n\t\t)\n\t},\n\n\twaitForInitialization: function () {\n\t\treturn this._initializePromise\n\t},\n\n\tresetViewConstraints: function () {\n\t\tthis._limitFunction = null\n\t},\n\n\tsetViewConstraints: function (limitFunction) {\n\t\tthis._limitFunction = limitFunction //function(latLng) {return true or false}\n\t},\n\n\tgetViewConstraints: function () {\n\t\treturn this._limitFunction\n\t},\n\n\tgetControls: function () {\n\t\treturn this._controls\n\t},\n\n\tgetMap: function () {\n\t\treturn this._map\n\t},\n\n\tgetLayers: function () {\n\t\treturn this._layers\n\t},\n\n\tgetConfig: function () {\n\t\treturn this._config\n\t},\n\n\tgetMatrixLayerControl: function () {\n\t\treturn this._matrixLayerControl\n\t},\n\n\tsetAuthenticated: function (/*boolean*/ authenticated) {\n\t\tthis._authenticated = authenticated\n\t},\n\n\tisAuthenticated: function () {\n\t\treturn this._authenticated\n\t},\n\n\tshouldManageVisits: function () {\n\t\t//currently just checks that we're authenticated\n\t\treturn this.isAuthenticated()\n\t},\n\n\tgetLoggedInUser: function () {\n\t\treturn this._loggedInUser\n\t},\n\n\tgetVisitConstraintManager: function () {\n\t\treturn this._visitConstraintManager\n\t}\n})\n\nexport default Manager\n","import Config from './config.js'\nimport params from './params.js'\nimport $ from 'jquery'\nimport MapView from './map_view.js'\nimport SourceLoader from './source_loader.js'\nimport Manager from './manager.js'\n\nexport default {\n\tgetBundleIds: function (bundles) {\n\t\tvar allBundles = []\n\t\tif (bundles != null) {\n\t\t\tallBundles.push.apply(allBundles, bundles)\n\t\t}\n\t\tvar dataSourcesString = params.test('datasources')\n\t\tif (dataSourcesString != null && dataSourcesString.length > 0) {\n\t\t\tallBundles.push.apply(allBundles, dataSourcesString.split(','))\n\t\t}\n\t\t//legacy options\n\t\tif (params.test('hills') == 'true') {\n\t\t\tallBundles.push('hills')\n\t\t}\n\t\tif (params.test('trigs') == 'true') {\n\t\t\tallBundles.push('trigs')\n\t\t}\n\t\t//end legacy options\n\t\treturn allBundles\n\t},\n\n\tloadMap: function (options, bundleIds) {\n\t\tif (options == null) {\n\t\t\toptions = {}\n\t\t}\n\t\tvar allBundles = this.getBundleIds(bundleIds)\n\t\tif (this.hasUrlData()) {\n\t\t\talert('Loading data from URL is no longer an option.')\n\t\t\tthrow new Error('Loading data from URL is no longer an option.')\n\t\t} else if (options.pointsToLoad != null) {\n\t\t\tvar generalPoints = options.pointsToLoad.generalPoints\n\t\t\toptions.cluster = generalPoints.length > 300\n\t\t\toptions.dimensional_layering = false\n\t\t\tallBundles = ['trigs/config_embedding']\n\t\t}\n\t\toptions = $.extend(\n\t\t\t{\n\t\t\t\t//set some defaults that can be overriden by the page or by loadMiniMap\n\t\t\t\tcluster: true,\n\t\t\t\tdimensional_layering: true\n\t\t\t},\n\t\t\toptions\n\t\t)\n\n\t\tvar mapView = this._buildMap(options)\n\t\tvar manager = new Manager(mapView.getMap(), this._config)\n\t\treturn manager\n\t\t\t.waitForInitialization()\n\t\t\t.then(\n\t\t\t\tfunction () {\n\t\t\t\t\treturn new SourceLoader(manager, this._config).loadSources(allBundles)\n\t\t\t\t}.bind(this)\n\t\t\t)\n\t\t\t.then(function () {\n\t\t\t\treturn manager\n\t\t\t})\n\t},\n\n\tloadMiniMap: function () {\n\t\t//set some defaults that can be overriden by the page\n\t\tvar options = {\n\t\t\tcluster: false,\n\t\t\tdimensional_layering: false,\n\t\t\tinitial_zoom: 10,\n\t\t\tstart_position: [54.454463, -3.213515],\n\t\t\tshow_search_control: false,\n\t\t\tshow_locate_control: false,\n\t\t\tshow_hider_control: true,\n\t\t\thider_control_start_visible: false,\n\t\t\tmap_style: 'mini',\n\t\t\tuse_sidebar: false\n\t\t}\n\t\tvar bundles = ['trigs/config_mini']\n\t\tthis.loadMap(options, bundles)\n\t},\n\n\t_buildMap: function (options) {\n\t\tthis._config = new Config(options)\n\t\treturn new MapView(this._config)\n\t},\n\n\thasUrlData: function () {\n\t\treturn params.test('trigs') != null\n\t}\n}\n","import leaflet from 'VendorWrappers/leaflet.js'\nimport $ from 'jquery'\nimport {ZOOM_OUT_EVENT} from '../../leaflet-plugins/zoom-detector.js'\n\nexport const ENABLE_CLUSTERING_EVENT = 'enableClustering'\nexport const DISABLE_CLUSTERING_EVENT = 'disableClustering'\n\nexport const ClusteringEnabledControl = leaflet.Class.extend({\n\tinitialize: function (manager) {\n\t\tconst map = manager.getMap()\n\n\t\tthis._view = $('<div class=\"setting\"></div>')\n\t\tthis._clusteringEnabled = $('<input type=\"checkbox\" checked>')\n\t\tvar desc = $('<label>Clustering enabled?</label>')\n\t\tdesc.prepend(this._clusteringEnabled)\n\n\t\tlet lastDisabledZoomLevel = null\n\t\tthis._clusteringEnabled.on('change', event => {\n\t\t\tif (event.target.checked) {\n\t\t\t\tlastDisabledZoomLevel = null\n\t\t\t\tmap.fire(ENABLE_CLUSTERING_EVENT)\n\t\t\t} else {\n\t\t\t\tlastDisabledZoomLevel = map.getZoom()\n\t\t\t\tmap.fire(DISABLE_CLUSTERING_EVENT)\n\t\t\t}\n\t\t})\n\t\t//re-enable clustering if map is zoomed out past the level at which clustering was disabled, as this is quite likely to bring too many markers on to the screen - clustering can easily be re-disabled if desired.\n\t\t//note the zoom detector can only detect once zoom has started, thus we might not actually get to renable clustering until after the zoom has taken place.\n\t\tmap.on(ZOOM_OUT_EVENT, () => {\n\t\t\tlet currentZoom = map.getZoom()\n\t\t\t//low numbers are \"zoomed out\"\n\t\t\tif (lastDisabledZoomLevel != null && currentZoom < lastDisabledZoomLevel) {\n\t\t\t\t//tick the box in the UI and then trigger the event so that the listeners above will actually renable clustering\n\t\t\t\tthis._clusteringEnabled.prop('checked', true).trigger('change')\n\t\t\t}\n\t\t})\n\n\t\tthis._view.append(desc)\n\n\t\tvar clusteringInfo = $(\n\t\t\t'<div>Disable clustering with care! Disabling clustering when there are a large number of markers on screen could slow down or even crash your browser, particularly on mobile devices. Similarly, even if there are not a large number of markers currently visible, you may still have a problem if you disable clustering and then perform an action which brings more markers in to view (e.g. zooming out, adding data sources or simply panning to a location with more markers).</div>'\n\t\t)\n\t\tthis._view.append(clusteringInfo)\n\t},\n\n\tgetView: function () {\n\t\treturn this._view\n\t}\n})\n","import global from './global.js'\nimport leaflet from 'VendorWrappers/leaflet.js'\n\nvar ParamChecker = leaflet.Class.extend({\n\tinitialize: function () {\n\t\tthis.update()\n\t},\n\n\tupdate: function () {\n\t\tthis._params = {}\n\t\tvar search = global.location.search\n\t\tif (search.length > 0) {\n\t\t\tsearch = search.substr(1)\n\t\t\tvar paramString = search.split('&')\n\t\t\tparamString.forEach(\n\t\t\t\tfunction (item) {\n\t\t\t\t\tvar tmp = item.split('=')\n\t\t\t\t\tthis._params[tmp[0]] = decodeURIComponent(tmp[1])\n\t\t\t\t}.bind(this)\n\t\t\t)\n\t\t}\n\t},\n\n\tgetParams: function () {\n\t\treturn this._params\n\t},\n\n\ttest: function (key) {\n\t\treturn this._params[key]\n\t}\n})\n\nvar defaultInstance = new ParamChecker()\nexport default {\n\t//bit dirty, but 'test' function makes it easy to check params, while the 'tester' gives you a class you can instantiate to check stuff at the relevant time.\n\ttest: function (key) {\n\t\treturn defaultInstance.test(key)\n\t},\n\ttester: ParamChecker\n}\n","import _ from 'underscore'\n\nconst maxDisplayTextLength = 100\nconst maxDisplayArrayLength = 10\n\nexport default {\n\tnotEmpty: function (input) {\n\t\treturn input !== undefined && input !== null && input.length > 0\n\t},\n\n\t_truncateDisplayString: function (value) {\n\t\t//truncate values if they are long, to prevent popup boxes getting too large\n\t\tif (value.length > maxDisplayTextLength) {\n\t\t\treturn value.substring(0, maxDisplayTextLength - 3) + '...'\n\t\t} else {\n\t\t\treturn value\n\t\t}\n\t},\n\n\t_truncateDisplayArray: function (value) {\n\t\t//truncate values if they are long, to prevent popup boxes getting too large\n\t\tif (value.length > maxDisplayArrayLength) {\n\t\t\treturn [...value.slice(0, maxDisplayArrayLength), '...']\n\t\t} else {\n\t\t\treturn value\n\t\t}\n\t},\n\n\t_buildValue: function (value) {\n\t\tif (typeof value === 'object' && 'url' in value) {\n\t\t\tlet {url, text, type} = value\n\t\t\turl = this._escapeValue(url)\n\t\t\ttext = this._truncateDisplayString(this._escapeValue(text))\n\t\t\tif (type != null && type.startsWith('image/')) {\n\t\t\t\treturn `\n\t\t\t\t<div class=\"popup-image-width-preserver\"></div>\n\t\t\t\t<a href=\"${url}\">\n\t\t\t\t\t<img class=\"popup-image\" src=\"${url}\" title=\"${text}\">\n\t\t\t\t</a>`\n\t\t\t} else {\n\t\t\t\treturn `<a href=\"${url}\">${text}</a>`\n\t\t\t}\n\t\t} else if (Array.isArray(value) && value.length == 2) {\n\t\t\t//legacy array-based method\n\t\t\tlet text = this._truncateDisplayString(this._escapeValue(value[0]))\n\t\t\tlet url = this._escapeValue(value[1])\n\t\t\treturn `<a href=\"${url}\">${text}</a>`\n\t\t} else {\n\t\t\treturn this._truncateDisplayString(this._escapeValue(value))\n\t\t}\n\t},\n\n\t_escapeValue: function (value) {\n\t\tif (Array.isArray(value)) {\n\t\t\treturn value.map(this._escapeValue.bind(this))\n\t\t} else {\n\t\t\tif (value == null) {\n\t\t\t\treturn value\n\t\t\t}\n\t\t\tif (typeof value !== 'string') {\n\t\t\t\tvalue = JSON.stringify(value) //prevents '[Object object]' showing up on the ui if this turns out to be an object because of some bad data\n\t\t\t}\n\t\t\treturn _.escape(value)\n\t\t}\n\t},\n\n\tbuildShortDescription: function (extraTexts) {\n\t\treturn Object.keys(extraTexts)\n\t\t\t.map(function (key) {\n\t\t\t\treturn extraTexts[key]\n\t\t\t})\n\t\t\t.filter(function (value) {\n\t\t\t\treturn value != null && value != ''\n\t\t\t})\n\t\t\t.map(function (value) {\n\t\t\t\tfunction extractValue(val) {\n\t\t\t\t\tif (Array.isArray(val) && val.length == 2) {\n\t\t\t\t\t\treturn val[0]\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn val\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (Array.isArray(value)) {\n\t\t\t\t\treturn value.map(extractValue).join('/')\n\t\t\t\t} else {\n\t\t\t\t\treturn extractValue(value)\n\t\t\t\t}\n\t\t\t})\n\t\t\t.join(', ')\n\t},\n\n\tbuildDescription: function (extraTexts) {\n\t\tvar popupText = ''\n\t\textraTexts.forEach(\n\t\t\tfunction (keyAndVal) {\n\t\t\t\tvar key = keyAndVal[0]\n\t\t\t\tvar value = keyAndVal[1]\n\t\t\t\tif (value != null && value != '') {\n\t\t\t\t\tif (popupText.length > 0) {\n\t\t\t\t\t\tpopupText += '<br />'\n\t\t\t\t\t}\n\t\t\t\t\tpopupText += '<span class=\"popup-entry-key\">' + _.escape(key) + ': </span>'\n\t\t\t\t\tif (Array.isArray(value)) {\n\t\t\t\t\t\tif (value.length > 1) {\n\t\t\t\t\t\t\tvalue = this._truncateDisplayArray(value)\n\t\t\t\t\t\t\tpopupText += '<ul class=\"popup-entry-list\">'\n\t\t\t\t\t\t\tfor (var i = 0; i < value.length; i++) {\n\t\t\t\t\t\t\t\tpopupText += '<li>' + this._buildValue(value[i]) + '</li>'\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tpopupText += '</ul>'\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tpopupText += '<span>' + this._buildValue(value[0]) + '</span>'\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpopupText += '<span>' + this._buildValue(value) + '</span>'\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}.bind(this)\n\t\t)\n\t\treturn popupText\n\t},\n\n\tbuildPopup: function (manager, unescapedName, unescapedUrl, latLng, unescapedExtraTexts, visited) {\n\t\t//get everything from the model - anything that gets put into the dom needs to be escaped to prevent XSS\n\t\tvar name = _.escape(unescapedName)\n\t\tvar url = _.escape(unescapedUrl)\n\n\t\tvar popupText = '<div>'\n\t\tif (this.notEmpty(url)) {\n\t\t\tpopupText = '<a href=\"' + url + '\" class=\"popup-title\">' + name + '</a>'\n\t\t} else if (this.notEmpty(name)) {\n\t\t\tpopupText = '<span class=\"popup-title\">' + name + '</span>'\n\t\t}\n\t\tif (manager.shouldManageVisits() && visited != null) {\n\t\t\tpopupText += '<label class=\"fancy-checkbox\" title=\"Visited?\">'\n\t\t\tpopupText += '    <input type=\"checkbox\"' + (visited ? ' checked' : '') + '/>'\n\t\t\tpopupText += '    <i class=\"fa fa-check\"></i>'\n\t\t\tpopupText += '</label>'\n\t\t}\n\t\tif (unescapedExtraTexts != null) {\n\t\t\tif (popupText.length > 0) {\n\t\t\t\tpopupText += '<br />'\n\t\t\t}\n\t\t\tpopupText += this.buildDescription(unescapedExtraTexts)\n\t\t}\n\n\t\tif (latLng != null) {\n\t\t\tvar lat = latLng[0]\n\t\t\tvar lng = latLng[1]\n\t\t\tvar googleUrl = 'https://www.google.com/maps/place/' + lat + '+' + lng + '/@' + lat + ',' + lng + ',15z'\n\t\t\tvar bingUrl =\n\t\t\t\t'https://www.bing.com/maps/?mkt=en-gb&v=2&cp=' +\n\t\t\t\tlat +\n\t\t\t\t'~' +\n\t\t\t\tlng +\n\t\t\t\t'&lvl=14&sp=Point.' +\n\t\t\t\tlat +\n\t\t\t\t'_' +\n\t\t\t\tlng +\n\t\t\t\t'_' +\n\t\t\t\tname\n\t\t\tvar geohackUrl =\n\t\t\t\t'https://tools.wmflabs.org/geohack/geohack.php?pagename=' +\n\t\t\t\tname +\n\t\t\t\t'&params=' +\n\t\t\t\tlat +\n\t\t\t\t'_N_' +\n\t\t\t\tlng +\n\t\t\t\t'_E_region%3AGB_'\n\n\t\t\tpopupText += '<div class=\"expandable expandable-links\">'\n\t\t\tpopupText += '<input type=\"checkbox\" value=\"selected\" id=\"links-checkbox\" class=\"expandable-checkbox\">'\n\t\t\tpopupText +=\n\t\t\t\t'<label for=\"links-checkbox\" class=\"expandable-checkbox-label\"><i class=\"fa fa-external-link\" aria-hidden=\"true\"></i></label>'\n\t\t\tpopupText += '<div class=\"expandable-content links\">'\n\t\t\tpopupText += '<a href=\"' + googleUrl + '\">View on google maps</a>'\n\t\t\tpopupText += '<br /><a href=\"' + bingUrl + '\">View on bing maps</a>'\n\t\t\tpopupText += '<br /><a href=\"' + geohackUrl + '\">View on geohack</a>'\n\t\t\tpopupText += '</div>'\n\t\t\tpopupText += '</div>'\n\t\t}\n\n\t\tpopupText += '</div>'\n\t\treturn popupText\n\t}\n}\n","import leaflet from 'VendorWrappers/leaflet.js'\nimport popupView from '../popup_view.js'\nimport {buildMarkerClusterGroup} from './marker-cluster.js'\n\nconst selectedOutlineWidth = 3\n\nvar GeoJsonTranslator = leaflet.Class.extend({\n\tinitialize: function (manager, colour, initialOutlineWidth) {\n\t\tthis._manager = manager\n\t\tthis._colour = colour\n\t\tthis._initialOutlineWidth = initialOutlineWidth\n\t},\n\n\t_showAsSelected: function (layer) {\n\t\t// check first if we _can_ style, as some layers can be things like Marker objects which\n\t\t// don't have a setStyle function - this feels hacky but that's what they do in leaflet\n\t\t// (see https://github.com/Leaflet/Leaflet/blob/5e9e3c74902af8fbd834e483870c838a9d436e49/src/layer/GeoJSON.js#L156)\n\t\tif (layer.setStyle) {\n\t\t\tlayer.setStyle({\n\t\t\t\tweight: selectedOutlineWidth\n\t\t\t})\n\t\t}\n\t},\n\n\t_extractName: function (feature, extraInfos, fileName) {\n\t\tconst findAndExtract = (regex, fallback) => {\n\t\t\tlet index = extraInfos.findIndex(([key, value]) => regex.test(key))\n\t\t\tif (index != -1) {\n\t\t\t\tlet value = extraInfos[index][1]\n\t\t\t\tif (value != null && `${value}`.length > 0) {\n\t\t\t\t\tif (fallback) {\n\t\t\t\t\t\t//if it's a fallback property then prefix with the file name, otherwise it's unlikely it will make much sense\n\t\t\t\t\t\tvalue = `${fileName} / ${value}`\n\t\t\t\t\t} else {\n\t\t\t\t\t\t//if the property was something like 'name' then remove the element so it isn't shown in the infos section\n\t\t\t\t\t\textraInfos.splice(index, 1)\n\t\t\t\t\t}\n\t\t\t\t\treturn value //stop looking\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tlet name = null\n\t\t// properties that could be used for the name, in order of preference\n\t\tconst nameProperties = [/name/, /Name/, /name/i]\n\t\tconst fallBackProperties = [/ID/i, /OBJECTID/i, /GLOBALID/i]\n\t\tfor (let nameRegex of nameProperties) {\n\t\t\tname = findAndExtract(nameRegex, false)\n\t\t\tif (name != null) {\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t\tif (name == null) {\n\t\t\tfor (let nameRegex of fallBackProperties) {\n\t\t\t\tname = findAndExtract(nameRegex, true)\n\t\t\t\tif (name != null) {\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t//fallback if nothing suitable found\n\t\tif (name == null) {\n\t\t\tname = fileName\n\t\t}\n\t\tif (feature.properties == null) {\n\t\t\tfeature.properties = {}\n\t\t}\n\t\tfeature.properties.name = name\n\t},\n\n\t_buildExtraInfos: function (featureProperties) {\n\t\t//filter out blanks\n\t\tlet infos = []\n\t\tif (featureProperties != null) {\n\t\t\tinfos = Object.entries(featureProperties).filter(([key, value]) => value != null && `${value}`.length > 0)\n\t\t}\n\t\t//now get the props into shape for displaying\n\t\tconst gpxPropsToIgnore = ['sym', '_gpxType', 'coordTimes', 'coordinateProperties']\n\t\tconst gpxPrefixesToIgnore = ['SHAPE_']\n\t\tconst filterPropName = propName => {\n\t\t\treturn !gpxPropsToIgnore.includes(propName) && !gpxPrefixesToIgnore.some(prefix => propName.startsWith(prefix))\n\t\t}\n\t\t//filter out some gpx properties we know we don't want\n\t\tinfos = infos\n\t\t\t.filter(([key, value]) => filterPropName(key))\n\t\t\t//translate links from gpx into our format\n\t\t\t.map(([key, value]) => {\n\t\t\t\tif (key == 'links') {\n\t\t\t\t\tvalue = value.map(link => {\n\t\t\t\t\t\tlet {href, type, text} = link\n\t\t\t\t\t\tif (text == null || text.trim().length == 0) {\n\t\t\t\t\t\t\ttext = href\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\turl: href,\n\t\t\t\t\t\t\ttext,\n\t\t\t\t\t\t\ttype\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t} else if (Array.isArray(value)) {\n\t\t\t\t\tvalue = value.map(entry => {\n\t\t\t\t\t\treturn JSON.stringify(entry) //who knows what the structure is like, not much we can do\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\treturn [key, value]\n\t\t\t})\n\t\treturn infos\n\t},\n\n\tdataToLayers: function (layerDatas) {\n\t\t//add the new layers\n\t\tlet newLayers = Object.fromEntries(\n\t\t\tlayerDatas.map(layerData => {\n\t\t\t\tconst {name, url, geojson, extraInfos} = layerData\n\t\t\t\tconst nameToFeatures = {}\n\t\t\t\tconst onFeatureClick = e => {\n\t\t\t\t\tlet layer = e.target\n\t\t\t\t\tthis._showAsSelected(layer)\n\t\t\t\t\tlet featureName = layer.feature.properties.name\n\t\t\t\t\tif (featureName) {\n\t\t\t\t\t\tlet layers = nameToFeatures[featureName]\n\t\t\t\t\t\tif (layer != null) {\n\t\t\t\t\t\t\tlayers.forEach(this._showAsSelected)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tlet geoJsonLayer = leaflet.geoJSON(geojson, {\n\t\t\t\t\tweight: this._initialOutlineWidth, //stroke width in pixels - aka border width\n\t\t\t\t\tcolor: this._colour,\n\t\t\t\t\tonEachFeature: (feature, layer) => {\n\t\t\t\t\t\tlet featureExtraInfos = extraInfos != undefined ? extraInfos : this._buildExtraInfos(feature.properties)\n\t\t\t\t\t\tthis._extractName(feature, featureExtraInfos, name)\n\t\t\t\t\t\tlet featureName = feature.properties.name\n\t\t\t\t\t\tvar visited = null //not supported on geojson sources for now\n\t\t\t\t\t\tvar popup = popupView.buildPopup(this._manager, featureName, url, null, featureExtraInfos, visited)\n\t\t\t\t\t\tlayer.bindPopup(popup)\n\t\t\t\t\t\tif (!(featureName in nameToFeatures)) {\n\t\t\t\t\t\t\tnameToFeatures[featureName] = []\n\t\t\t\t\t\t}\n\t\t\t\t\t\tnameToFeatures[featureName].push(layer)\n\t\t\t\t\t\tlayer.on({\n\t\t\t\t\t\t\tclick: onFeatureClick\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t})\n\n\t\t\t\t//add clustering layer to cluster any 'point' objects in the geojson\n\t\t\t\tlet clusterGroup = buildMarkerClusterGroup(this._manager.getMap())\n\t\t\t\tclusterGroup.addLayers(geoJsonLayer)\n\t\t\t\t//reset all styles when the map is clicked anywhere. Style will be re-added if it is one of these features that is clicked (same way the popups work)\n\t\t\t\tthis._manager.getMap().on({\n\t\t\t\t\tpreclick: () => {\n\t\t\t\t\t\tgeoJsonLayer.resetStyle()\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\treturn [name, clusterGroup]\n\t\t\t})\n\t\t)\n\t\treturn newLayers\n\t}\n})\n\nexport default GeoJsonTranslator\n","import leaflet from 'VendorWrappers/leaflet.js'\nimport {gpx as toGeoJSON} from '@tmcw/togeojson'\nimport {polygon, bbox} from '@turf/turf'\n\nexport function calcGeoJsonBounds(geoJson) {\n\tlet {features} = geoJson\n\tif (geoJson.type !== 'FeatureCollection') {\n\t\tfeatures = [geoJson]\n\t}\n\t//margin for the bounding box:\n\tconst latAdjustment = 0.005\n\tconst lngAdjustment = 0.01\n\tlet polygons = features.map(function (feature) {\n\t\tconst [minLng, minLat, maxLng, maxLat] = bbox(feature)\n\t\tlet top = maxLat + latAdjustment\n\t\tlet bottom = minLat - latAdjustment\n\t\tlet left = minLng - lngAdjustment\n\t\tlet right = maxLng + lngAdjustment\n\t\tlet polygonCoords = [\n\t\t\t[left, top],\n\t\t\t[right, top],\n\t\t\t[right, bottom],\n\t\t\t[left, bottom],\n\t\t\t[left, top]\n\t\t]\n\t\treturn polygon([polygonCoords])\n\t})\n\treturn polygons\n}\n\nexport function rawGpxToGeoJson(gpxAsString) {\n\t//xml editing in nodejs is hard, so quick and dirty replace for common mistake in gpx files (url tag with value used instead of link tag with attribute)\n\tgpxAsString = gpxAsString.replace(/<url( [^>]+)?>(.+)<\\/url>/g, `<link href=\"$2\"></link>`)\n\tvar dom = new DOMParser().parseFromString(gpxAsString, 'text/xml')\n\tvar geoJson = toGeoJSON(dom)\n\tlet multiBounds = calcGeoJsonBounds(geoJson)\n\treturn {\n\t\tfeatures: geoJson,\n\t\tbounds: multiBounds\n\t}\n}\n\nexport function rawGeoJsonToGeoJson(geojsonAsString) {\n\tlet parsed = JSON.parse(geojsonAsString)\n\tlet multiBounds = calcGeoJsonBounds(parsed)\n\treturn {\n\t\tfeatures: parsed,\n\t\tbounds: multiBounds\n\t}\n}\n\nexport function geoJsonCoordsToLeaflet(geojsonCoords) {\n\treturn leaflet.GeoJSON.coordsToLatLngs(geojsonCoords)\n}\n\nexport function geoJsonBoundsToLeaflet(bounds) {\n\treturn bounds.map(polygon => {\n\t\tconst coordinates = geoJsonCoordsToLeaflet(polygon.geometry.coordinates[0])\n\t\tconst bound = new leaflet.LatLngBounds()\n\t\tfor (const coord of coordinates) {\n\t\t\tbound.extend(coord)\n\t\t}\n\t\treturn bound\n\t})\n}\n","import 'leaflet.markercluster/dist/MarkerCluster.Default.css'\nimport 'leaflet.markercluster/dist/MarkerCluster.css'\n\nimport leaflet_cluster from 'leaflet.markercluster'\n\nexport default leaflet_cluster\n","import leaflet_cluster from 'VendorWrappers/leaflet-marker-cluster.js'\nimport $ from 'jquery'\n\nimport {ENABLE_CLUSTERING_EVENT, DISABLE_CLUSTERING_EVENT} from '../menu/settings/clustering_enabled_control.js'\n\nexport function buildMarkerClusterGroup(map, options = {}) {\n\tvar mapElem = $('div#map')\n\tvar radius = Math.max(mapElem[0].offsetHeight, mapElem[0].offsetWidth) / 10 //if map window is resized or changed (e.g. portrait to landscape) then this value will be out of date, but will still work ok so not worth the effort to update\n\tlet clusterGroup = new leaflet_cluster.MarkerClusterGroup({\n\t\t...options, // must be first to override anything that follows\n\t\tdisableClusteringAtZoom: 15,\n\t\tmaxClusterRadius: radius,\n\t\tchunkedLoading: true\n\t})\n\tmap.on(ENABLE_CLUSTERING_EVENT, () => {\n\t\tclusterGroup.enableClustering()\n\t})\n\tmap.on(DISABLE_CLUSTERING_EVENT, () => {\n\t\tclusterGroup.disableClustering()\n\t})\n\treturn clusterGroup\n}\n","import leaflet from 'leaflet'\n\nimport 'leaflet/dist/leaflet.css'\n\n// workaround for https://github.com/Leaflet/Leaflet/issues/4968\nimport iconUrl from 'leaflet/dist/images/marker-icon.png'\nimport retinaUrl from 'leaflet/dist/images/marker-icon-2x.png'\nimport shadowUrl from 'leaflet/dist/images/marker-shadow.png'\n\ndelete leaflet.Icon.Default.prototype._getIconUrl\n\nleaflet.Icon.Default.mergeOptions({\n\ticonRetinaUrl: retinaUrl,\n\ticonUrl: iconUrl,\n\tshadowUrl: shadowUrl\n})\n\nexport default leaflet\n"],"names":["map","webpackAsyncContext","req","__webpack_require__","o","Promise","resolve","then","e","Error","code","ids","id","all","slice","keys","Object","module","exports","osgbProj","pad","num","w","n","toString","length","latLngToGridRef","lat","lng","digits","out","forward","eastings","northings","undefined","Number","isNaN","e100k","Math","floor","n100k","l1","l2","letPair","String","fromCharCode","charCodeAt","pow","osgbToLngLat","inverse","gridRefToOsgb","gridref","trim","this","_determineGridRefType","match","OsGridRef","toUpperCase","e100km","n100km","en","split","parseInt","gridRefToLngLat","lngLat","test","Class","extend","initialize","manager","bundleConfig","bundleName","_markerList","_manager","_config","getConfig","_bundleConfig","_bundleName","indexOf","substring","lastIndexOf","_urlPrefix","dataLocationUrlPrefix","baseUrl","_visits","_buildDataUrl","dataToLoad","_doFetchData","dataLoadPromise","url","dataType","fail","xhr","textError","error","console","log","shouldManageVisits","visitsLoadPromise","legacyApiBackendBaseUrl","xhrFields","withCredentials","data","visit","bind","datas","fetchMeta","done","_meta","getMeta","getVisits","getBundleConfig","getBundleName","prototype","call","_data","_translator","initialOutlineWidth","fetchData","_parseDatas","features","feature","parse","buildLayers","layerDatas","layers","dataToLayers","fromEntries","entries","layer","getVisitConstraintManager","translateDimensionString","getAttribution","attribution","addMarkers","pointsToLoad","i","_attributionText","addMarker","name","extraTexts","icon","dimensionValues","layerId","marker","encodeURIComponent","latLng","parseFloat","exportName","visited","dimensional_layering","_withinConstraints","currentMap","translateDimensionValues","key","lastKey","push","matcher","getViewConstraints","buildImageLinks","linksArray","elem","index","values","labels","value","label","getMarkerList","aspectLabel","loadLabel","loadExtensions","colour","fileContentsParser","defaultPageId","location","pathname","pop","defaults","window","geoBaggingBaseUrl","map_style","cluster","initial_zoom","start_position","force_config_override","map_element_id","map_outer_container_element","page_id","show_zoom_control","show_selection_control","show_search_control","show_locate_control","show_layers_control","show_position_control","show_hider_control","use_sidebar","hider_control_start_visible","icons","dimensionNames","dimensionValueLabels","defaultLayer","markerConstraints","options","configBundles","resolvedConfig","_checkForUndefaultedProperties","bundles","_storageId","saved","_getSavedConfig","property","_buildMarkerConstraints","hasOwnProperty","constraintsString","points","tlLat","tlLng","brLat","brLng","topLeft","bottomRight","Array","isArray","markerConstraintsMatcher","contains","newConfig","source","warn","localStorage","getItem","JSON","persist","setItem","stringify","baseBackendUrl","bingKey","dataSources","dataBackendBaseUrl","integrationBackendBaseUrl","config","leafletMap","link","click","zoom","getZoom","centre","getCenter","newUrl","href","append","ZOOM_OUT_EVENT","ZOOM_IN_EVENT","detectZoomDirection","previousZoom","on","currentZoom","isInteger","debug","fire","firstRegex","secondRegex","devHack","params","testString","global","navigator","userAgent","vendor","opera","substr","minZoom","maxZoom","detectRetina","bingDefaults","leaflet","constants","maxNativeZoom","bingRoads","imagerySet","bingHybrid","bingAerial","bingOsLayer","bingFallbackLayer","bingOsGroup","layerGroup","osm","TileLayer","OS","OSM","_listenForLayerChange","layerToSelect","addTo","MapView","_createView","_map","Map","zoomControl","setView","LatLng","fullscreen_link","_saveLocation","content","mapClass","addClass","mobile","prepend","center","hash","getMap","markerConfig","aspectName","notEmpty","popupText","buildPopup","markerOptions","defaultIcon","popupElem","change","endpoint","checked","contentType","catch","jqXhr","textStatus","errorThrown","status","bindPopup","cmt","desc","buildShortDescription","buildDescription","exportData","PointsView","modelsByAspect","matrixLayerControl","controls","_modelsByAspect","_matrixLayerControl","_controls","_bundles","_parentGroup","_translateMarkerGroup","group","aspect","constructor","forEach","dimension","finish","finished","deferredObject","chunkProgress","processed","total","elapsed","layersArray","model","addClusteredModel","markerLists","filter","allMarkers","concat","apply","nullLayerId","markersByLayer","reduce","addLayers","markers","addLayer","promise","markerList","matrixOverlays","depthFirstIteration","aspectOptions","translateAspect","addAspect","path","overlays","subGroup","dimValue","newPath","sublist","GeojsonView","_tester","tester","sourceLoaded","sourceName","update","getParams","datasource","newParams","paramKey","join","document","origin","ModelViews","getControls","_urlHandler","_lazyCallbacks","_filterModels","bundleModels","className","matchingModels","loadSource","_addLazyModels","lazyModels","addCallback","callback","_addAttribution","meta","description","recordCount","lastUpdated","bundleDetails","getMatrixLayerControl","addLazyAspect","dataSourceLabel","addAttribution","loadModelViews","pointsModels","geojsonModels","lazyPointsModels","lazyGeojsonModels","pointsView","geojsonView","promises","always","addControl","SourceLoader","_parseSources","paramName","sourcesString","loadSources","selectedSourceIds","extraDataSources","sourceIds","sourceModuleIds","_sourceIdsToDataSources","sources","modules","sourceModule","default","sourceModels","parser","metaPromise","dataPromise","_modelViews","_finish","setTimeout","allSources","_autoLoadSources","async","sourceId","hide","actions","gpx","display","action","d","Date","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","keepCurrentZoomLevel","dummyControl","provider","GeoSearchControlWrapper","arguments","parentProto","getPrototypeOf","__super__","Util","create","GeosearchControl","GeosearchBing","formatter","conversion","onMove","latLngFormatter","_addShowHideHandling","$icon","isIconVisible","hideIcon","css","AttributionView","container","_container","copyright","dataSourceName","text","_view","isAuthenticated","getLoggedInUser","getView","clusteringEnabledControl","_displayedSources","fileNameToLayers","includes","fileName","_addMatrixOverlay","_setLayerVis","_onInputClick","_update","hideLayers","remove","visible","_model","inputChanged","_sourceName","_layers","_externalSourceLoader","hideOldLayers","showNewLayers","files","layerData","geojson","newLayers","_fileInput","_readFiles","_fileCounter","file","item","parsed","_parseFileContents","_finishedReadingFiles","bundle","_bundle","_filesView","bounds","constraintsView","_constraintsView","tracks","combinedBounds","track","flat","limitToGeoJsonPolygons","reset","val","configBundle","currentLocationLimitButton","_limitToCurrentLocation","listener","off","latlng","latLngBounds","LatLngBounds","limitToBounds","stopLocate","locate","_currentAreaLimit","event","target","getBounds","unlimit","prop","GeoJsonConstraintLoadView","mergePolygons","tree","featuresWithBounds","minX","minY","maxX","maxY","load","mergedPolygons","processedFeatures","Set","aMergeHappened","has","currentPolygon","featuresToMerge","search","potentialOverlap","poFeature","add","_constraintPolygons","_limitOriginView","info","currentAreaView","currentLocationView","_trackConstraintsLoadView","_geoJsonConstraintLoadView","_buildReset","wrapper","limitOriginView","polygonPoints","getSouthWest","getNorthWest","getNorthEast","getSouthEast","GeoJSON","latLngToCoords","boundsAsGeoJson","setViewConstraints","_buildLimitFunction","hole","coords","geometry","coordinates","holePoints","holeInHole","holeInHolePolygon","_addMaskPolygon","polygon","L","Polygon","color","fillColor","fillOpacity","geoJsonPolygons","resetViewConstraints","SOURCE_FIELD_NAME","empty","str","VisitsLoadView","visitsMenuView","_visitsMenuView","visits","mergedData","setVisits","workbook","arrayBuffer","xlsx","worksheet","getWorksheet","rawData","eachRow","includeEmpty","row","rowData","eachCell","cell","headerRow","dataRows","idIdx","sourceIdx","at","dataBySource","groupBy","fileToSources","VisitsMenuView","_VisitsLoadView","originView","visitData","setVisitConstraints","geojsonLoadView","gpxLoadView","MenuView","_buildView","_buildControl","view","showUserSettings","attributionContainer","_attributionView","userView","settingsView","visitsView","externalFilesView","_control","getContainer","order","Control","Zoom","Layers","Attribution","Controls","_controlsToHide","_controlsToAdd","_addDefaults","_addAllTo","configOverrides","_menuView","position","showPopup","visibleByDefault","control","oldControl","found","max","newContainer","oldContainer","replaceWith","DIMENSION_NAME","Manager","_authenticated","_visitConstraintManager","dimensionLabels","visitConstraints","_initializePromise","deferred","_loggedInUser","email","multiAspects","embeddable","waitForInitialization","_limitFunction","limitFunction","getLayers","setAuthenticated","authenticated","getBundleIds","allBundles","dataSourcesString","loadMap","bundleIds","hasUrlData","alert","generalPoints","mapView","_buildMap","loadMiniMap","ENABLE_CLUSTERING_EVENT","DISABLE_CLUSTERING_EVENT","ClusteringEnabledControl","_clusteringEnabled","lastDisabledZoomLevel","trigger","clusteringInfo","ParamChecker","_params","tmp","decodeURIComponent","defaultInstance","input","_truncateDisplayString","maxDisplayTextLength","_truncateDisplayArray","_buildValue","type","_escapeValue","startsWith","extractValue","keyAndVal","unescapedName","unescapedUrl","unescapedExtraTexts","_colour","_initialOutlineWidth","_showAsSelected","setStyle","weight","_extractName","extraInfos","findAndExtract","regex","fallback","findIndex","splice","nameProperties","fallBackProperties","nameRegex","properties","_buildExtraInfos","featureProperties","infos","gpxPropsToIgnore","gpxPrefixesToIgnore","filterPropName","propName","some","prefix","entry","nameToFeatures","onFeatureClick","featureName","geoJsonLayer","geoJSON","onEachFeature","featureExtraInfos","popup","clusterGroup","preclick","resetStyle","calcGeoJsonBounds","geoJson","minLng","minLat","maxLng","maxLat","top","bottom","left","right","polygonCoords","rawGpxToGeoJson","gpxAsString","replace","dom","DOMParser","parseFromString","rawGeoJsonToGeoJson","geojsonAsString","geoJsonCoordsToLeaflet","geojsonCoords","coordsToLatLngs","geoJsonBoundsToLeaflet","bound","coord","buildMarkerClusterGroup","mapElem","radius","offsetHeight","offsetWidth","MarkerClusterGroup","disableClusteringAtZoom","maxClusterRadius","chunkedLoading","enableClustering","disableClustering","Default","_getIconUrl","mergeOptions","iconRetinaUrl","iconUrl","shadowUrl"],"sourceRoot":""}