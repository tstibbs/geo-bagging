"use strict";(self.webpackChunk_tstibbs_geo_bagging_ui=self.webpackChunk_tstibbs_geo_bagging_ui||[]).push([[556],{8966:(t,i,n)=>{var e=n(9755),o=n(4260),r=n(4543),a=n(3508);({showMap:function(){/^https?:\/\/trigpointing\.uk\/trig\/\d+/.test(window.location.href)?this.embedSingleMap():/^https?:\/\/trigpointing\.uk\/trigs\/view-trigs\.php.*/.test(window.location.href)?this.showMapForSearch():/^https?:\/\/trigpointing\.uk\/trigtools\/find.php.*/.test(window.location.href)?alert("Map display not supported on this page, please use the 'detailed search' page instead: http://trigpointing.uk/trigs/"):alert("Map display not supported on this page.")},showMapForSearch:function(){this.getPointsFromSearch(window.location.search,(function(t){var i={pointsToLoad:{generalPoints:t},force_config_override:!0,use_sidebar:!1};e("body").empty(),r.Z.loadMap(i).done((function(i){t.forEach((function(t){var i=t.eastings,o=t.northings;(null==n||i<n)&&(n=i),(null==e||i>e)&&(e=i),(null==r||o<r)&&(r=o),(null==a||o>a)&&(a=o)}));var n,e,r,a,s=o.Z.osgbToLngLat(n,r),p=o.Z.osgbToLngLat(e,a);i.getMap().fitBounds([[s[1],s[0]],[p[1],p[0]]])}))}))},embedSingleMap:function(){var t=e("div:contains('Grid reference : '):not(:has(*)) + div a").text(),i=o.Z.gridRefToLngLat(t),n=i[0],s=i[1];const p=t=>{e.ajax(t).done(function(t,i,o){var a="?"+e(e.parseHTML(t)).find("a:contains('Interactive Map')").attr("href").split("?")[1];this.getPointsFromSearch(a,(function(t){var i=e('map[name="trigmap"]').parent();i.empty();var o=window.location.pathname.split(/\//).pop();o=/0*([^0].*)/.exec(o)[1];var a=null;t=t.filter((function(t){return t.id!=o||(a=t,!1)}));var p={map_style:"mini_embedded",cluster:!1,hider_control_start_visible:!1,show_hider_control:!0,start_position:[s,n],map_outer_container_element:i,pointsToLoad:{significantPoint:a,generalPoints:t},force_config_override:!0,initial_zoom:13,use_sidebar:!1};r.Z.loadMap(p)}))}.bind(this))};var g=e("a:contains('trigpoints')").attr("href");let l=g.match(/^\/trigs\/search-parse.php\?trig=([\d\w]+)$/);if(null!=l){let t=`${a.Z.integrationBackendBaseUrl}trigs/search-parse.php/${l[1]}`;e.ajax(t).done(((t,i,n)=>{null!=t.redirectTo&&t.redirectTo.length>0&&(g=t.redirectTo),p(g)})).fail((t=>{console.error(t),p(g)}))}else p(g)},getPointsFromSearch:function(t,i){e.get("/trigs/down-flash.php"+t,(function(t,n,o){var r=/Showing trigpoints \d+ to \d+ of (\d+)/g,a=e("body").text();if(!0===(!(r.test(a)&&parseInt(r.exec(a)[1])>1e3)||confirm("Map will only display the first 1000 points, are you sure you want to continue?"))){var s=decodeURIComponent(t),p=e(e.parseXML(s)).find("C").map((function(t,i){var n=e(i),o=n.attr("I"),r="http://trigpointing.uk/trig/"+o;return{eastings:parseInt(n.attr("E")),northings:parseInt(n.attr("N")),url:r,id:o,name:n.attr("D")}})).toArray();i(p)}}))}}).showMap()}},t=>{t.O(0,[216,543],(()=>{return i=8966,t(t.s=i);var i}));t.O()}]);
//# sourceMappingURL=integration.590b1ab10db3c652f95a.js.map