(self.webpackChunk_tstibbs_geo_bagging_ui=self.webpackChunk_tstibbs_geo_bagging_ui||[]).push([[430],{2981:(t,i,e)=>{var n={"./abstract_bundle_builder.js":[8001],"./abstract_geojson_builder.js":[1995],"./abstract_points_builder.js":[4758],"./coastallandmarks/config.js":[3228,228],"./coastallandmarks/points_builder.js":[5553,553],"./counties/builder.js":[4792,792],"./counties/config.js":[3523,523],"./defence/config.js":[1912,912],"./defence/points_builder.js":[1613,613],"./external-geojson/config.js":[8384],"./external-gpx/config.js":[5982],"./follies/config.js":[8788,788],"./follies/points_builder.js":[8402,402],"./hills/classifications.js":[929,929],"./hills/config.js":[6201,201],"./hills/config_all.js":[8224,224],"./hills/constants.js":[1732,732],"./hills/points_builder.js":[2089,89],"./milestones/config.js":[393,723],"./milestones/points_builder.js":[4673,673],"./nationalparks/builder.js":[4190,190],"./nationalparks/config.js":[1156,156],"./nt/config.js":[7649,649],"./nt/points_builder.js":[6723,102],"./rnli/config.js":[6689,689],"./rnli/points_builder.js":[269,269],"./trails/builder.js":[8840,840],"./trails/config.js":[2081,81],"./trigs/config.js":[9896,240],"./trigs/config_base.js":[4317,952],"./trigs/config_embedding.js":[1764,374],"./trigs/config_mini.js":[2831,518],"./trigs/points_builder.js":[3052,52]};function s(t){if(!e.o(n,t))return Promise.resolve().then((()=>{var i=new Error("Cannot find module '"+t+"'");throw i.code="MODULE_NOT_FOUND",i}));var i=n[t],s=i[0];return Promise.all(i.slice(1).map(e.e)).then((()=>e(s)))}s.keys=()=>Object.keys(n),s.id=2981,t.exports=s},1930:(t,i,e)=>{"use strict";e.d(i,{Z:()=>a});var n=(0,e(8251).Z)("+proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy +datum=OSGB36 +units=m +no_defs");function s(t,i){for(var e=t.toString();e.length<i;)e="0"+e;return e}const a={latLngToGridRef:function(t,i){var e=10,a=n.forward([i,t]),r=a[0],o=a[1];if(e=void 0===e?10:Number(e),isNaN(e))throw new Error("Invalid precision");var l=Number(Number(r)),c=Number(Number(o));if(isNaN(l)||isNaN(c))throw new Error("Invalid grid reference: "+[t,i]);if(0===e)return s(l,6)+","+s(c,6);var d=Math.floor(l/1e5),u=Math.floor(c/1e5);if(d<0||d>6||u<0||u>12)return"";var h=19-u-(19-u)%5+Math.floor((d+10)/5),f=5*(19-u)%25+d%5;h>7&&h++,f>7&&f++;var p=String.fromCharCode(h+"A".charCodeAt(0),f+"A".charCodeAt(0));return l=Math.floor(l%1e5/Math.pow(10,5-e/2)),c=Math.floor(c%1e5/Math.pow(10,5-e/2)),p+" "+s(l,e/2)+" "+s(c,e/2)},osgbToLngLat:function(t,i){return n.inverse([t,i])},gridRefToOsgb:function(t){t=String(t).trim(),this._determineGridRefType(t);var i=t.match(/^(\d+),\s*(\d+)$/);if(i)return new OsGridRef(i[1],i[2]);if(!(i=t.match(/^[A-Z]{2}\s*[0-9]+\s*[0-9]+$/i)))throw new Error("Invalid grid reference: "+t);var e=t.toUpperCase().charCodeAt(0)-"A".charCodeAt(0),n=t.toUpperCase().charCodeAt(1)-"A".charCodeAt(0);e>7&&e--,n>7&&n--;var s=(e-2)%5*5+n%5,a=19-5*Math.floor(e/5)-Math.floor(n/5),r=t.slice(2).trim().split(/\s+/);if(1==r.length&&(r=[r[0].slice(0,r[0].length/2),r[0].slice(r[0].length/2)]),s>=15&&(s-=25),a>20&&(a-=25),s<-10||a<-5)throw new Error("Invalid grid reference: gridref="+t+", e100km="+s+", n100km="+a);if(2!=r.length)throw new Error("Invalid grid reference: "+t);if(r[0].length!=r[1].length)throw new Error("Invalid grid reference: "+t);return r[0]=(r[0]+"00000").slice(0,5),r[1]=(r[1]+"00000").slice(0,5),[parseInt(s+"00000")+parseInt(r[0]),parseInt(a+"00000")+parseInt(r[1])]},gridRefToLngLat:function(t){var i=this.gridRefToOsgb(t);return n.inverse(i)},_determineGridRefType:function(t){if(/^\w\s*\d{3,}\s*\d{3,}$/.test(t))throw new Error("Irish grid references currently unsupported: "+t)}}},8001:(t,i,e)=>{"use strict";e.r(i),e.d(i,{default:()=>r});var n=e(7830),s=e(9755),a=e(3508);const r=n.Z.Class.extend({initialize:function(t,i,e){this._markerList=null,this._manager=t,this._config=t.getConfig(),this._bundleConfig=i,this._bundleName=-1==e.indexOf("/")?e:e.substring(0,e.lastIndexOf("/")),this._urlPrefix=this._bundleConfig.dataLocationUrlPrefix??`${this._config.baseUrl}bundles/`,this._visits=[]},_buildDataUrl:function(){return this._urlPrefix+this._bundleName+"/"+this._bundleConfig.dataToLoad},_doFetchData:function(){var t=this._buildDataUrl(),i=s.ajax({url:t,dataType:"json"}).fail((function(t,i,e){console.error("Failed to load map data: "+i),console.log(e)}));if(this._manager.shouldManageVisits()){var e=s.get({url:a.Z.legacyApiBackendBaseUrl+"listVisits?source="+this._bundleName,dataType:"json",xhrFields:{withCredentials:!0}}).then(function(t){this._visits=t.map(function(t){return t.substring(t.indexOf("-",t.indexOf("-")+1)+1)}.bind(this))}.bind(this)).fail((function(t,i,e){console.error("Failed to load map data: "+i),console.log(e)}));return s.when(i,e).then((function(t){return t[0]}))}return i},fetchMeta:function(){var t=this._buildDataUrl()+".meta";return s.ajax({url:t,dataType:"json"}).fail((function(t,i,e){console.error("Failed to load source metadata: "+i),console.log(e)})).done(function(t){this._meta=t}.bind(this))},getMeta:function(){return this._meta},getVisits:function(){return this._visits},getBundleConfig:function(){return this._bundleConfig},getBundleName:function(){return this._bundleName}})},1995:(t,i,e)=>{"use strict";e.r(i),e.d(i,{default:()=>a});var n=e(8001),s=e(9846);const a=n.default.extend({initialize:function(t,i,e){n.default.prototype.initialize.call(this,t,i,e),this._data=null,this._bundleConfig=i,this._translator=new s.Z(t,{color:"#3388ff",...i.style})},fetchData:function(){return this._doFetchData().done(function(t){this._data=t}.bind(this))},_parseDatas:function(){return this._data.features.map(function(t){return this.parse(t)}.bind(this))},buildLayers:function(){var t=this._parseDatas(),i=this._translator.dataToLayers(t);return i=Object.fromEntries(Object.entries(i).map((([t,i])=>[this._manager.getVisitConstraintManager().translateDimensionString(t,this._bundleName),i])))},getAttribution:function(){return this._bundleConfig.attribution}})},4758:(t,i,e)=>{"use strict";e.r(i),e.d(i,{default:()=>s});var n=e(8001);const s=n.default.extend({initialize:function(t,i,e){n.default.prototype.initialize.call(this,t,i,e),this._markerList=null,this._bundleConfig=i},fetchData:function(){return this._doFetchData().done(function(t){this.addMarkers(t)}.bind(this))},addMarkers:function(t){for(var i=t.data,e=0;e<i.length;e++)this.parse(i[e]);null!=this._bundleConfig.attribution?this._attributionText=this._bundleConfig.attribution:this._attributionText=t.attribution},addMarker:function(t,i,e,n,s,a,r,o,l){var c={id:t=encodeURIComponent(t),latLng:[parseFloat(i),parseFloat(e)],name:s,extraTexts:a,exportName:s,url:n,icon:r,layerId:l,visited:-1!=this.getVisits().indexOf(t)};if(this._config.dimensional_layering&&null!=o&&0!==o.length){if(null==this._markerList&&(this._markerList={}),this._withinConstraints(c)){var d=this._markerList;o=this._manager.getVisitConstraintManager().translateDimensionValues(o,t,this._bundleName);for(var u=0;u<o.length-1;u++){var h=o[u];null==d[h]&&(d[h]={}),d=d[h]}var f=o[o.length-1];null==d[f]&&(d[f]=[]),d[f].push(c)}}else null==this._markerList&&(this._markerList=[]),this._markerList.push(c)},_withinConstraints:function(t){var i=this._manager.getViewConstraints();return null==i||i(t.latLng)},buildImageLinks:function(t){return t.map((function(t,i){return["Image "+(i+1),t]}))},split:function(t,i){return t.split(";").map((function(t){var e=i[t];return null!=e?e:t}))},getMarkerList:function(){return this._markerList},getAttribution:function(){return this._attributionText}})},8384:(t,i,e)=>{"use strict";e.r(i),e.d(i,{default:()=>n});const n={aspectLabel:"GeoJson Files",loadLabel:"GeoJson",loadExtensions:".geojson",style:{color:"darkblue",initialOutlineWidth:1},fileContentsParser:e(5449).aS}},5982:(t,i,e)=>{"use strict";e.r(i),e.d(i,{default:()=>n});const n={aspectLabel:"GPX Files",loadLabel:"GPX",loadExtensions:".gpx",style:{color:"#bd007e",initialOutlineWidth:2},fileContentsParser:e(5449).n7}},6582:(t,i,e)=>{"use strict";e.d(i,{Z:()=>d});var n=e(5243),s=e(9755),a=e(8382),r=e(5857),o=e(1930),l=a.Z.location.pathname.split("/").pop(),c={baseUrl:null!=window.geoBaggingBaseUrl?window.geoBaggingBaseUrl:"",map_style:"full",cluster:!0,dimensional_layering:!1,initial_zoom:13,start_position:[53.374694,-1.711474],force_config_override:!1,map_element_id:"map",map_outer_container_element:s("body"),page_id:l,show_zoom_control:!0,show_selection_control:!0,show_search_control:!0,show_locate_control:!0,show_layers_control:!0,show_position_control:!0,show_hider_control:"mobile",use_sidebar:!0,hider_control_start_visible:!0,icons:{},dimensionNames:[],dimensionValueLabels:{},defaultLayer:"OS",markerConstraints:null};const d=n.Class.extend({initialize:function(t,i){var e=s.extend({},c,t);if(this._checkForUndefaultedProperties(t,"window config"),e.bundles=i,this._storageId="os_map:"+e.page_id+"config",null==t||!0!==t.force_config_override){var n=this._getSavedConfig();e=s.extend({},e,n)}for(var a in r.Z.test("startPosition")&&(e.start_position=r.Z.test("startPosition").split(",")),r.Z.test("startZoom")&&(e.initial_zoom=r.Z.test("startZoom")),this._buildMarkerConstraints(e),e)e.hasOwnProperty(a)&&(this[a]=e[a])},_buildMarkerConstraints:function(t){var i=null;if(null!=r.Z.test("constraints")?i=r.Z.test("constraints"):null!=t.markerConstraints&&"string"==typeof t.markerConstraints&&(i=t.markerConstraints),null!=i){var e=i.split(","),s=null,a=null,l=null,c=null;if(2==e.length){var d=o.Z.gridRefToLngLat(e[0]);a=d[0],s=d[1];var u=o.Z.gridRefToLngLat(e[1]);c=u[0],l=u[1]}else s=parseFloat(e[0]),a=parseFloat(e[1]),l=parseFloat(e[2]),c=parseFloat(e[3]);t.markerConstraints=[[l,a],[s,c]]}null!=t.markerConstraints&&Array.isArray(t.markerConstraints)&&(t.markerConstraints=n.latLngBounds(t.markerConstraints)),null!=t.markerConstraints&&"function"==typeof t.markerConstraints&&(t.markerConstraintsMatcher=t.markerConstraints),null!=t.markerConstraints&&null==t.markerConstraintsMatcher&&(t.markerConstraintsMatcher=function(i){return t.markerConstraints.contains(i.latLng)})},_checkForUndefaultedProperties:function(t,i){for(var e in t)t.hasOwnProperty(e)&&!c.hasOwnProperty(e)&&console.warn('Property "'+e+'" (set from '+i+") should have a default")},_getSavedConfig:function(){if(void 0!==localStorage){var t=localStorage.getItem(this._storageId);return null!=t?JSON.parse(t):null}return null},persist:function(t){if(void 0!==localStorage){var i=this._getSavedConfig();null!=i&&(t=s.extend({},i,t)),localStorage.setItem(this._storageId,JSON.stringify(t))}}})},3508:(t,i,e)=>{"use strict";e.d(i,{Z:()=>s});const n="https://d1548rv5kyvrdp.cloudfront.net",s={mapTilerKey:"77JoMiPunwbv4PUOWDp6",osOpenDataKey:"vWnckqIMRUgvAqfaN8jece3GEG3EGWZD",dataSources:["follies","hills","milestones","defence","trails","rnli","nationalparks","coastallandmarks"],legacyApiBackendBaseUrl:"https://not_deployed.execute-api.eu-west-2.amazonaws.com/prod/",dataBackendBaseUrl:`${n}/data/`,integrationBackendBaseUrl:`${n}/integration/`}},4846:(t,i,e)=>{"use strict";e.d(i,{Z:()=>s});var n=e(9755);const s=function(t,i){if(n("div.full-screen-link").length>0){var e=n('<a href="#">Open in full screen</a>');e.click((function(){var e=i.getZoom(),n=i.getCenter(),s=t.baseUrl+"index.html?datasources=trigs&startPosition="+n.lat+","+n.lng+"&startZoom="+e;window.location.href=s})),n("div.full-screen-link").append(e)}}},8382:(t,i,e)=>{"use strict";e.d(i,{Z:()=>n});const n=window},7742:(t,i,e)=>{"use strict";e.d(i,{BR:()=>a,ut:()=>n});const n="zoomOut",s="zoomIn";function a(t){let i=t.getZoom();t.on("zoom",(()=>{let e=t.getZoom();Number.isInteger(e)&&(e<i?(console.debug(`zoom out: from=${i} to=${e}`),t.fire(n)):e>i&&(console.debug(`zoom in: from=${i} to=${e}`),t.fire(s)),i=t.getZoom())}))}},3430:(t,i,e)=>{"use strict";e.d(i,{Z:()=>Kt});var n=e(6582),s=e(5857),a=e(9755),r=e(7830),o=e(4846),l=e(8382),c=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i,d=/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i,u=s.Z.test("mobile");const h=function(){if(u)return!0;var t=l.Z.navigator.userAgent||l.Z.navigator.vendor||l.Z.opera;return c.test(t)||d.test(t.substr(0,4))};var f=e(7742),p=e(3508);e(4291),e(1751);const _=new r.Z.Proj.CRS("EPSG:27700","+proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy +towgs84=446.448,-125.157,542.06,0.15,0.247,0.842,-20.489 +units=m +no_defs",{resolutions:[896,448,224,112,56,28,14,7,3.5,1.75,.875,.4285,.21425],origin:[-238375,1376256]}),g={key:p.Z.osOpenDataKey,service:"WMTS",request:"GetTile",version:"2.0.0",height:256,width:256,outputFormat:"image/png",style:"default",layer:"Leisure_27700",tileMatrixSet:"EPSG:27700",tileMatrix:"{z}",tileRow:"{y}",tileCol:"{x}"},m=Object.entries(g).map((([t,i])=>`${t}=${i}`)).join("&"),b=r.Z.tileLayer("https://api.os.uk/maps/raster/v1/wmts?"+m,{crs:_,maxNativeZoom:9,attribution:"Contains OS data &copy; Crown copyright and database rights "+(new Date).getFullYear()});var v={minZoom:1,maxZoom:19,detectRetina:!1},w=new r.Z.TileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",r.Z.extend({},v,{attribution:'Map data © <a href="http://openstreetmap.org">OpenStreetMap</a> contributors'}));const y=`https://api.maptiler.com/maps/hybrid/{z}/{x}/{y}.png?key=${p.Z.mapTilerKey}`,C=new r.Z.TileLayer(y,{...v,tileSize:512,zoomOffset:-1,maxNativeZoom:18,attribution:'<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>',crossOrigin:!0});var k={"OS Maps (beta)":{layer:b,id:"os-open-data"},"Open Street Map":{layer:w,id:"OSM"},Satellite:{layer:C,id:"Satellite"}};const x=function(t,i){var e=Object.values(k).find((t=>t.id===i.defaultLayer));return(e=null==e?w:e.layer).addTo(t),t.fire("baselayerchange",{layer:e}),Object.values(k).forEach((({id:t,layer:e})=>{!function(t,i,e){i.on("add",function(){e.persist({defaultLayer:t})}.bind(this))}(t,e,i)})),Object.fromEntries(Object.entries(k).map((([t,{layer:i}])=>[t,i])))},L=r.Z.CRS.EPSG3857;var Z=r.Z.Class.extend({initialize:function(t){this._config=t,this._initLat=this._config.start_position[0],this._initLng=this._config.start_position[1],this._initZoom=this._config.initial_zoom,this._createView(),this._map=new r.Z.Map(this._config.map_element_id,{zoomControl:!1,minZoom:1,maxZoom:19,crs:L}),this._map.setView(new r.Z.LatLng(this._config.start_position[0],this._config.start_position[1]),this._config.initial_zoom),(0,o.Z)(this._config,this._map),this._map.on("zoomend moveend dragend",(function(){this._saveLocation()}),this),this._map.on("baselayerchange",(({layer:t})=>{let i=this._map.getBounds(),e=this._map.options?.crs,n=null!=t.options?.crs?t.options.crs:L;console.debug(`Switching CRS from ${e.code} to ${n.code}`),e!==n&&(this._map.options.crs=n,this._map.options.zoomSnap=0,this._map.fitBounds(i),this._map.fitBounds(i),this._map.setZoom(Math.round(this._map.getZoom())),this._map.options.zoomSnap=1)})),(0,f.BR)(this._map)},postInit:function(){console.debug(`force setting init position: ${this._initLat}, ${this._initLng}, ${this._initZoom}`),this._map.setView(new r.Z.LatLng(this._initLat,this._initLng),this._initZoom)},_createView:function(){var t="",i="";"mini"==this._config.map_style||"mini_embedded"==this._config.map_style?i=' class="mini-map"':"full"==this._config.map_style?i=' class="full-screen"':"embedded"==this._config.map_style&&(i=' class="embedded-map"'),"mini"!=this._config.map_style&&"mini_embedded"!=this._config.map_style||(t+='<div class="mini-map">'),t+='<div id="'+this._config.map_element_id+'"'+i+"></div>","mini"==this._config.map_style&&(t+="</div>",t+='<div class="full-screen-link"></div>'),"full"==this._config.map_style&&this._config.map_outer_container_element.addClass("full-screen"),h()&&this._config.map_outer_container_element.addClass("mobile"),this._config.map_outer_container_element.prepend(a(t))},_saveLocation:function(){var t=this._map.getCenter(),i=[t.lat,t.lng],e=this._map.getZoom();if(void 0!==localStorage){var n={start_position:i,initial_zoom:e};this._config.persist(n),console.debug(JSON.stringify(n))}},getMap:function(){return this._map}});const V=Z;var M=e(9050),O=e(5243),S=e(9675);e(4705);const j=e(3750);var A=e(4986);const z=function(t,i,e,n){var s=t.latLng,o=t.name,l=t.extraTexts,c=t.exportName,d=t.icon,u=t.url,h=t.visited;A.Z.notEmpty(o)||(o=u),A.Z.notEmpty(c)&&(c=o);var f=A.Z.buildPopup(n,o,u,s,l,h),_={};null!=i.icons&&null!=i.icons[d]?_.icon=i.icons[d]:null!=i.defaultIcon&&(_.icon=i.defaultIcon),_.layerId=t.layerId;var g=r.Z.marker(s,_),m=a("<div>"+f+"</div>");n.shouldManageVisits()&&a("input",m).change((function(){var i="";i=this.checked?"recordVisit":"removeVisit",a.post({url:p.Z.legacyApiBackendBaseUrl+i,data:JSON.stringify({source:e,name:t.id}),contentType:"application/json",xhrFields:{withCredentials:!0}}).catch((function(t,i,e){401==t.status?console.log("Authentication required"):console.log("Request failed: "+t.status+", "+i+", "+e)}))})),g.bindPopup(m[0]),c=M.ZP.escape(t.exportName);var b=null,v=null;return null!=l&&(b=M.ZP.escape(A.Z.buildShortDescription(l)),v=M.ZP.escape(A.Z.buildDescription(l))),g.exportData={name:c,link:u,cmt:b,desc:v},g};var T=O.Class.extend({initialize:function(t,i,e,n,s,a,r){this._map=t,this._config=i,this._modelsByAspect=e,this._matrixLayerControl=n,this._controls=s,this._bundles=a,this._parentGroup=null,this._manager=r},_translateMarkerGroup:function(t,i,e){if(null!=t)if(t.constructor===Array)t.forEach((function(t,n,s){s[n]=z(t,i,e,this._manager)}),this);else for(var n in t)t[n]=this._translateMarkerGroup(t[n],i,e);return t},finish:function(t){var i=a.Deferred();if(this._config.cluster?this._parentGroup=(0,S.r)(this._manager.getMap(),{chunkProgress:function(t,e,n,s){t===e&&i.resolve()}}):(this._parentGroup=O.layerGroup(),i.resolve()),this._parentGroup.addTo(this._map),this._config.dimensional_layering)for(var e in this._modelsByAspect){var n=this._modelsByAspect[e];this.addClusteredModel(e,n)}else{var s=Object.keys(this._modelsByAspect).map(function(t){var i=this._modelsByAspect[t];return this._translateMarkerGroup(i.getMarkerList(),i.getBundleConfig(),t)}.bind(this)).filter((function(t){return null!=t})),r=[].concat.apply([],s);if(this._config.cluster){var o="null",l=r.reduce((function(t,i){var e=i.options.layerId;return null==t[e=null==e?o:e]&&(t[e]=[]),t[e].push(i),t}),{});this._parentGroup.addLayers(l[o]),Object.keys(l).filter((function(t){return t!==o})).forEach(function(t){for(var i=l[t],e=O.layerGroup(),n=0;n<i.length;n++)e.addLayer(i[n]);e.addTo(this._map)}.bind(this))}else for(var c=0;c<r.length;c++)this._parentGroup.addLayer(r[c])}return i.promise()},addClusteredModel:function(t,i){if(null!=i.getMarkerList()){var e=this._translateMarkerGroup(i.getMarkerList(),i.getBundleConfig(),t),n={};this.depthFirstIteration(e,"",n);var s=this._bundles[t];s=this._manager.getVisitConstraintManager().translateAspect(s,i.getBundleName()),this._matrixLayerControl.addAspect(t,n,s)}},depthFirstIteration:function(t,i,e){if(t.constructor===Array){var n=new j(this._parentGroup,t);e[i]=n}else Object.keys(t).forEach(function(n){var s=0===i.length?n:i+"/"+n,a=t[n];this.depthFirstIteration(a,s,e)}.bind(this))}});const P=T;var E=r.Z.Class.extend({initialize:function(t,i,e,n,s,a){this._manager=t,this._map=i,this._config=e,this._modelsByAspect=n,this._matrixLayerControl=s,this._bundles=a},finish:function(t){if(!this._config.dimensional_layering&&Object.keys(this._modelsByAspect).length>0)throw new Error("!dimensional_layering is not supported yet.");r.Z.layerGroup(),Object.keys(this._modelsByAspect).forEach(function(t){var i=this._modelsByAspect[t];this.addClusteredModel(t,i)}.bind(this));return a.Deferred().resolve().promise()},addClusteredModel:function(t,i){var e=this._bundles[t],n=i.buildLayers();Object.values(n).forEach(function(t){t.addTo(this._map)}.bind(this)),e=this._manager.getVisitConstraintManager().translateAspect(e,i.getBundleName()),this._matrixLayerControl.addAspect(t,n,e)}});const I=E;var D=e(4758),F=e(1995);const N=r.Z.Class.extend({initialize:function(){this._tester=new s.Z.tester},sourceLoaded:function(t){this._tester.update();var i=this._tester.getParams(),e=i.datasources;e=null==e?"":e,delete i.datasources,e=e.length>0?e+","+t:t;var n=Object.keys(i).map((function(t){return t+"="+i[t]})).join("&");n=(n.length>0?n+"&":"")+"datasources="+e;document.location.origin,document.location.pathname}});var B=r.Z.Class.extend({initialize:function(t,i){this._bundles=t,this._manager=i,this._controls=i.getControls(),this._urlHandler=new N,this._lazyCallbacks={}},_filterModels:function(t,i){var e={};return Object.keys(t).filter((function(e){return t[e]instanceof i})).forEach((function(i){e[i]=t[i]})),e},loadSource:function(t){return this._lazyCallbacks[t]()},_addLazyModels:function(t,i){Object.keys(t).forEach(function(e){var n=t[e],s=function(){return n.fetchData().done(function(){i(e,n),this._addAttribution(e,n),this._urlHandler.sourceLoaded(e)}.bind(this))}.bind(this);this._lazyCallbacks[e]=s;var a=n.getMeta(),r=a.recordCount+" items (last updated "+a.lastUpdated+")",o=this._bundles[e];this._manager.getMatrixLayerControl().addLazyAspect(e,o,{description:r,callback:s})}.bind(this))},_addAttribution:function(t,i){var e=i.getAttribution();if(null!=e&&e.length>0){var n=i.getBundleConfig().aspectLabel;this._controls.addAttribution(n,e)}},loadModelViews:function(t,i,e,n){var s=this._filterModels(t,D.default),r=this._filterModels(t,F.default),o=this._filterModels(i,D.default),l=this._filterModels(i,F.default),c=new P(this._manager.getMap(),e,s,this._manager.getMatrixLayerControl(),this._controls,this._bundles,this._manager),d=new I(this._manager,this._manager.getMap(),e,r,this._manager.getMatrixLayerControl(),this._bundles),u=[c.finish(),d.finish()];e.dimensional_layering&&(this._addLazyModels(o,(function(t,i){c.addClusteredModel(t,i)})),this._addLazyModels(l,(function(t,i){d.addClusteredModel(t,i)}))),a.when.apply(a,u).always(function(){e.dimensional_layering&&this._controls.addControl(this._manager.getMatrixLayerControl()),Object.keys(t).forEach(function(i){var e=t[i];this._addAttribution(i,e)}.bind(this)),n()}.bind(this))}});const G=B;var U=r.Z.Class.extend({initialize:function(t,i){this._manager=t,this._config=i},_parseSources:function(t){var i=s.Z.test(t);return null!=i&&i.length>0?i.split(","):[]},loadSources:function(t){var i=this._parseSources("extra-datasources"),n=a.uniqueSort(t.concat(p.Z.dataSources,i)),s=this._sourceIdsToDataSources(n),r=a.Deferred(),o={};let l=s.map((t=>e(2981)("./"+t+".js")));return Promise.all(l).then((i=>{i.forEach(((t,i)=>{"function"==typeof(t=t.default)&&(t=t(this._config)),o[s[i]]=t}));var e={},n={},l=Object.keys(o).map(function(i){var s=o[i],r=new s.parser(this._manager,s,i),l=r.fetchMeta();if(-1!=t.indexOf(i)){var c=r.fetchData();return e[i]=r,a.when(l,c)}return n[i]=r,l}.bind(this));a.when.apply(a,l).always(function(){this._modelViews=new G(o,this._manager),this._modelViews.loadModelViews(e,n,this._config,this._finish.bind(this)),r.resolve()}.bind(this)),setTimeout((()=>{r.resolve()}),1)})),r.promise()},_sourceIdsToDataSources:function(t){return t=null!=t?t.map((function(t){return-1==t.indexOf("/")?t+"/config":t})):[]},_autoLoadSources:async function(){let t=this._parseSources("auto-load-datasources"),i=this._sourceIdsToDataSources(t).map((t=>this._modelViews.loadSource(t)));await Promise.all(i)},_finish:async function(){await this._autoLoadSources(),a("div#loading-message-pane").hide()}});const R=U;const $=e(1143);const J=e(8486).Z;var W=e(6937),q=e(4358);const H=W.extend({options:{actions:{gpx:{display:"Export to GPX file",action:q((function(){var t=new Date;return"geoPoints_"+(t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()+"_"+t.getHours()+"-"+t.getMinutes()+"-"+t.getSeconds())+".gpx"}))}}}});const X=e(687).extend({options:{keepCurrentZoomLevel:!0,setView:"once"}});var Y=e(4225);const K=new Y.C1({provider:function(){}});function Q(){this.initialize&&this.initialize.apply(this,arguments)}var tt=Object.getPrototypeOf(K);Q.__super__=tt,Q.prototype=r.Z.Util.create(tt),Q.prototype.constructor=Q;const it=Q,et=Y.Zm;const nt=e(5516).Z;var st=e(1930);const at=nt.extend({options:{formatter:function(t,i){return st.Z.latLngToGridRef(i,t)}}});const rt=e(6058).Z;const ot=rt.extend({options:{onMove:!0,icon:!0,latLngFormatter:function(t,i){return st.Z.latLngToGridRef(t,i)}},addTo:function(t){rt.prototype.addTo.call(this,t),this._addShowHideHandling()},_addShowHideHandling:function(){var t=a("div.leaflet-control-mapcentercoord-icon.leaflet-zoom-hide"),i=!1;function e(){t.css("visibility","hidden"),i=!1}a("div.leaflet-control-mapcentercoord.leaflet-control").click((function(){i?e():(t.css("visibility","visible"),i=!0)})),e()}});const lt=e(136).Z;var ct=r.Z.Class.extend({initialize:function(t){this._container=t;let i=a('<div class="attribution-entry"></div>\n\t<span class="attribution-source">Geo-bagging</span>\n\t<span>\n\t\tThe code on this site is copyright \n\t\t<a href="https://github.com/tstibbs">tstibbs</a>/stripycoder, \n\t\tlicenced under AGPL, \n\t\tsource code available at \n\t\t<a href="https://github.com/tstibbs/geo-bagging">here</a>.\n\t</span>\n\t<br />\n\t<span>\n\t\tMany open source libraries help make this project, see a full list in <a href="licenses.txt">licenses.txt</a>.\n\t</span>\n</div>');this._container.append(i)},addAttribution:function(t,i){let e=a(`<div class="attribution-entry">\n\t<span class="attribution-source">${t} data</span>\n\t<span>${i}</span>\n</div>`);this._container.append(e)}});const dt=ct;const ut=r.Z.Class.extend({initialize:function(t){this._view=a('<div class="setting"></div>'),t.isAuthenticated()?this._view.append(a("<span>Logged in as "+t.getLoggedInUser()+"</span>")):this._view.append(a('<a href="'+p.Z.legacyApiBackendBaseUrl+'login">Click here to log in</a>'))},getView:function(){return this._view}});var ht=e(7714);const ft=r.Z.Class.extend({initialize:function(t){this._view=a("<div></div>");var i=new ht.qF(t);this._view.append(i.getView())},getView:function(){return this._view}}),pt=r.Z.Class.extend({initialize:function(t){this._manager=t,this._displayedSources=[]},addLayers:function(t,i){Object.values(i).forEach((t=>t.addTo(this._manager.getMap()))),this._displayedSources.includes(t)?Object.entries(i).forEach((([i,e])=>{this._manager.getMatrixLayerControl()._addMatrixOverlay(e,i,t)})):(this._displayedSources.push(t),this._manager.getMatrixLayerControl().addAspect(t,i,{dimensionNames:[t]})),Object.keys(i).forEach((i=>this._setLayerVis(t,i,!0))),this._manager.getMatrixLayerControl()._onInputClick(),this._manager.getMatrixLayerControl()._update()},hideLayers:function(t,i){Object.entries(i).forEach((([i,e])=>{this._setLayerVis(t,i,!1),e.remove()}))},_setLayerVis:function(t,i,e){this._manager.getMatrixLayerControl()._model(t).inputChanged(t,i,e)}});var _t=e(9846);const gt=r.Z.Class.extend({initialize:function(t,i,e){this._sourceName=i,this._layers={},this._externalSourceLoader=new pt(t),this._translator=new _t.Z(t,e)},hideOldLayers:function(){this._externalSourceLoader.hideLayers(this._sourceName,this._layers)},showNewLayers:function(t){let i=t.map((({features:t,name:i})=>({name:i,geojson:t}))),e=this._translator.dataToLayers(i);this._externalSourceLoader.addLayers(this._sourceName,e),this._layers={...this._layers,...e}}});const mt=r.Z.Class.extend({initialize:function(t,i){this._view=a('<div class="setting"></div>'),this._view.append(a(`<span>${t}: </span></br>`)),this._fileInput=a(`<input type="file" accept="${i}" multiple>`),this._view.append(this._fileInput),this._fileInput.on("change",this._readFiles.bind(this)),this._fileCounter=0},_readFiles:async function(){for(var t=[],i=this._fileInput[0].files,e=0;e<i.length;e++){const s=i.item(e);var n=await this._parseFileContents(s);t.push({name:`${this._fileCounter} - ${s.name}`,...n}),this._fileCounter++,t.length==i.length&&this._finishedReadingFiles(t)}},_finishedReadingFiles:function(t){throw new Error("Not implemented")},_parseFileContents:async function(t){throw new Error("Not implemented")},getView:function(){return this._view}});const bt=mt.extend({initialize:function(t,i){mt.prototype.initialize.call(this,i.loadLabel,i.loadExtensions),this._bundle=i,this._filesView=new gt(t,this._bundle.aspectLabel,this._bundle.style)},_finishedReadingFiles:function(t){this._filesView.showNewLayers(t)},_parseFileContents:async function(t){const{features:i,bounds:e}=this._bundle.fileContentsParser(await t.text());return{features:i,bounds:e}}});const vt=bt.extend({initialize:function(t,i,e){bt.prototype.initialize.call(this,t,e),this._constraintsView=i},_finishedReadingFiles:function(t){var i=t.map((function(t){return t.bounds}));i=i.flat(),this._constraintsView.limitToGeoJsonPolygons(this,i),bt.prototype._finishedReadingFiles.call(this,t)},reset:function(){this._fileInput.val(""),this._filesView.hideOldLayers()}});var wt=e(5982);const yt={...wt.default,aspectLabel:"GPX Tracks",style:{...wt.default.style,color:"#FF0000"},loadLabel:"Upload GPX tracks to see markers around those tracks"};const Ct=vt.extend({initialize:function(t,i){vt.prototype.initialize.call(this,t,i,yt)}});const kt=r.Z.Class.extend({initialize:function(t,i){this._manager=t,this._constraintsView=i,this._view=a('<div class="setting"></div>');var e=a('<button type="button">Limit to 5 miles from current location</button>');e.click(this._limitToCurrentLocation.bind(this)),this._view.append(e)},_limitToCurrentLocation:function(){var t=this._manager.getMap(),i=function(e){t.off("locationfound",i);var n=e.latlng.lat,s=e.latlng.lng,a=new r.Z.LatLngBounds([n+.08,s+.12],[n-.08,s-.12]);this._constraintsView.limitToBounds(this,a)}.bind(this);t.on("locationfound",i),t.stopLocate(),t.locate()},getView:function(){return this._view},reset:function(){}});const xt=r.Z.Class.extend({initialize:function(t,i){this._manager=t,this._constraintsView=i,this._view=a('<div class="setting"></div>'),this._currentAreaLimit=a('<input type="checkbox">');var e=a("<label>Limit new markers to current area</label>");e.prepend(this._currentAreaLimit),this._currentAreaLimit.change(function(t){t.target.checked?this._constraintsView.limitToBounds(this,this._manager.getMap().getBounds()):this._constraintsView.unlimit()}.bind(this)),this._view.append(e)},getView:function(){return this._view},reset:function(){this._currentAreaLimit.prop("checked",!1)}});var Lt=e(8384);const Zt={...Lt.default,aspectLabel:"GeoJson Constraints",style:{...Lt.default.style,color:"orange"},loadLabel:"Upload a GeoJSON file to see markers within the polygons specified in the geojson file"},Vt=vt.extend({initialize:function(t,i){vt.prototype.initialize.call(this,t,i,Zt)}});var Mt=e(5449),Ot=e(5521),St=e(6290),jt=e(5480),At=e(883),zt=e(7294);function Tt(t){const i=new Ot.Z,e=t.map((t=>{const[i,e,n,s]=(0,St.V)(t);return{minX:i,minY:e,maxX:n,maxY:s,feature:t}}));i.load(e);let n=[];const s=new Set;let a=!1;return t.forEach((t=>{if(!s.has(t)){let e=t;const r=[],[o,l,c,d]=(0,St.V)(t);i.search({minX:o,minY:l,maxX:c,maxY:d}).forEach((i=>{const n=i.feature;if(t!==n&&!s.has(n)){(0,jt.w)((0,At.uf)([e,n]))&&(r.push(n),s.add(n),a=!0)}})),r.forEach((t=>{e=(0,zt.G)((0,At.uf)([e,t]))})),n.push(e),s.add(t)}})),a&&(n=Tt(n)),n}var Pt=e(5243);const Et=r.Z.Class.extend({initialize:function(t){this._manager=t,this._constraintPolygons=[],this._limitOriginView=null,this._view=a("<div></div>");var i=a('<div class="info">This section allows you to limit how much data is displayed on screen. This can be useful for example when on older or mobile devices which may struggle to remain responsive if a large amount of data is loaded.</div>');this._view.append(i),this._view.append('<hr class="info">');var e=new xt(t,this);this._view.append(e.getView());var n=new kt(t,this);this._view.append(n.getView()),this._trackConstraintsLoadView=new Ct(t,this),this._view.append(this._trackConstraintsLoadView.getView()),this._geoJsonConstraintLoadView=new Vt(t,this),this._view.append(this._geoJsonConstraintLoadView.getView());var s=this._buildReset();this._view.append(s)},_buildReset:function(){var t=a('<div class="setting"></div>'),i=a('<button type="button">Reset</button>');return i.click(this.unlimit.bind(this)),t.append(i),t},limitToBounds:function(t,i){let e=[i.getSouthWest(),i.getNorthWest(),i.getNorthEast(),i.getSouthEast(),i.getSouthWest()].map((t=>r.Z.GeoJSON.latLngToCoords(t))),n=(0,At.yu)([e]);this.limitToGeoJsonPolygons(t,[n])},limitToGeoJsonPolygons:function(t,i){this.unlimit(),this._limitOriginView=t,Array.isArray(i)||(i=[i]),this._manager.setViewConstraints(this._buildLimitFunction(i));var e=[[[-90,-180],[90,-180],[90,180],[-90,180]]];Tt(i).forEach((t=>{let i=t.geometry.coordinates,n=(0,Mt.Og)(i[0]);e.push(n),i.slice(1).forEach((t=>{let i=(0,Mt.Og)(t);this._addMaskPolygon(i)}))})),this._addMaskPolygon(e)},_addMaskPolygon:function(t){let i=new Pt.Polygon(t,{color:"rgb(0, 0, 0, 0)",fillColor:"rgb(90, 90, 90)",fillOpacity:.3});i.addTo(this._manager.getMap()),this._constraintPolygons.push(i)},_buildLimitFunction:function(t){let i=(0,Mt.cF)(t);return function(t){for(var e=0;e<i.length;e++)if(i[e].contains(t))return!0;return!1}},unlimit:function(){null!=this._limitOriginView&&(this._limitOriginView.reset(),this._limitOriginView=null),this._manager.resetViewConstraints(),null!=this._constraintPolygons&&(this._constraintPolygons.forEach((t=>t.remove())),this._constraintPolygons=[])},getView:function(){return this._view}});var It=e(4295);const Dt="Source ID";function Ft(t){return null==t||0==t.trim().length}function Nt(t){return"string"==typeof t?t:`${t}`}const Bt=mt.extend({initialize:function(t,i){mt.prototype.initialize.call(this,"Upload file listing 'visited' POIs",".xlsx"),this._manager=t,this._visitsMenuView=i},_finishedReadingFiles:function(t){const i=t.map((t=>t.visits)),e={},n=new Set(i.map(Object.keys).flat());for(const t of n)e[t]=i.filter((i=>t in i)).map((i=>i[t])).flat();this._visitsMenuView.setVisits(this,e)},_parseFileContents:async function(t){let i=await async function(t){const i=new It.Workbook,e=await t.arrayBuffer();await i.xlsx.load(e);const n=i.getWorksheet(1),s=[];n.eachRow({includeEmpty:!0},(t=>{const i=[];t.eachCell({includeEmpty:!0},(t=>{i.push(t.value)})),s.push(i)}));const a=s[0],r=s.slice(1),o=a.indexOf("ID"),l=a.indexOf(Dt);if(-1==o||-1==l)throw new Error(`Malformed excel, must contains columns named 'ID' and '${Dt}'.`);const c=r.map((t=>({id:t.at(o),source:t.at(l)}))).filter((({id:t,source:i})=>null!=t&&null!=i)).map((({id:t,source:i})=>({id:Nt(t),source:Nt(i)}))).filter((({id:t,source:i})=>!Ft(t)&&!Ft(i))),d=Object.groupBy(c,(t=>t.source));return Object.fromEntries(Object.entries(d).map((([t,i])=>[t,i.map((({id:t})=>t))])))}(t);return{visits:i}},reset:function(){this._fileInput.val("")}}),Gt=r.Z.Class.extend({initialize:function(t){this._manager=t,this._limitOriginView=null,this._view=a("<div></div>");var i=a('<div class="info">This section allows you to upload an excel file listing all the POIs you have visited. This information will then be added to the category selectors to allow you to select POIs based on whether they have been visited, not visited, or both.</div>');this._view.append(i),this._view.append('<hr class="info">'),this._VisitsLoadView=new Bt(t,this),this._view.append(this._VisitsLoadView.getView());var e=this._buildReset();this._view.append(e)},_buildReset:function(){var t=a('<div class="setting"></div>'),i=a('<button type="button">Reset</button>');return i.click(this.reset.bind(this)),t.append(i),t},setVisits:function(t,i){this._limitOriginView=t,this._manager.getVisitConstraintManager().setVisitConstraints(i)},reset:function(){null!=this._limitOriginView&&(this._limitOriginView.reset(),this._limitOriginView=null),this._manager.getVisitConstraintManager().reset()},getView:function(){return this._view}});const Ut=r.Z.Class.extend({initialize:function(t){this._view=a("<div></div>");var i=a('<div class="info">Load external files to overlay on to map. Parsing is basic and limited information will be loaded - overlays will be mostly just visuals.</div>');this._view.append(i),this._view.append('<hr class="info">');const e=new bt(t,Lt.default);this._view.append(e.getView());const n=new bt(t,wt.default);this._view.append(n.getView())},getView:function(){return this._view}});var Rt=r.Z.Class.extend({initialize:function(t){this._manager=t,this._buildView(),this._buildControl()},_buildView:function(){var t="",i="true"==s.Z.test("testing");t+='<div id="sidebar" class="'+["sidebar","collapsed","leaflet-container"].join(" ")+'">',t+='    <div class="sidebar-tabs">',t+='        <ul role="tablist">',t+='            <li><a href="#sidebar-layers" role="tab"><i class="fa fa-bars"></i></a></li>',t+='            <li><a href="#sidebar-settings" role="tab"><i class="fa fa-sliders"></i></a></li>',t+='            <li><a href="#sidebar-constraints" role="tab"><i class="fa fa-map-o"></i></a></li>',t+='            <li>\n                                 <a href="#sidebar-visits" role="tab">\n                                     <span class="fa fa-stack">\n                                         <i class="fa-check fa fa-stack-1x fa-small-icon"></i>\n                                         <i class="fa-map-o fa fa-stack-1x"></i>\n                                     </span>\n                                 </a>\n                             </li>',t+='            <li><a href="#sidebar-external-files" role="tab"><i class="fa fa-plus-square-o"></i></a></li>',t+="        </ul>",t+='        <ul role="tablist">',i&&(t+='            <li><a href="#sidebar-user" role="tab"><i class="fa fa-user"></i></a></li>'),t+='            <li><a href="#sidebar-attribution" role="tab"><i class="fa fa-copyright"></i></a></li>',t+="        </ul>",t+="    </div>",t+='    <div class="sidebar-content">',t+='        <div id="sidebar-layers" class="sidebar-pane">',t+='            <h1 class="sidebar-header">Layers<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>',t+="        </div>",t+='        <div id="sidebar-settings" class="sidebar-pane">',t+='            <h1 class="sidebar-header">Settings<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>',t+="        </div>",t+='        <div id="sidebar-constraints" class="sidebar-pane">',t+='            <h1 class="sidebar-header">Data Limits<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>',t+="        </div>",t+='        <div id="sidebar-visits" class="sidebar-pane">',t+='            <h1 class="sidebar-header">Upload Visits<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>',t+="        </div>",t+='        <div id="sidebar-external-files" class="sidebar-pane">',t+='            <h1 class="sidebar-header">External Files<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>',t+="        </div>",t+='        <div id="sidebar-attribution" class="sidebar-pane">',t+='            <h1 class="sidebar-header">Attribution<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>',t+="        </div>",i&&(t+='        <div id="sidebar-user" class="sidebar-pane">',t+='            <h1 class="sidebar-header">User Settings<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>',t+="        </div>"),t+="    </div>",t+="</div>",this._view=a(t),this._manager.getConfig().map_outer_container_element.append(this._view);var e=a("<div></div>");if(a("#sidebar-attribution",this._view).append(e),this._attributionView=new dt(e),i){var n=new ut(this._manager);a("#sidebar-user",this._view).append(n.getView())}var r=new ft(this._manager);a("#sidebar-settings",this._view).append(r.getView());var o=new Et(this._manager);a("#sidebar-constraints",this._view).append(o.getView());var l=new Gt(this._manager);a("#sidebar-visits",this._view).append(l.getView());const c=new Ut(this._manager);a("#sidebar-external-files",this._view).append(c.getView())},_buildControl:function(){this._control=new lt("sidebar")},addTo:function(t){this._control.addTo(t)},getContainer:function(){return this._view[0]},addLayers:function(t){a("#sidebar-layers",this._view).append(t.getContainer())},addAttribution:function(t,i){this._attributionView.addAttribution(t,i)}});const $t=Rt;var Jt=[J,$t,r.Z.Control.Zoom,X,it,r.Z.Control.Layers,H,at,ot,r.Z.Control.Attribution],Wt=r.Z.Class.extend({initialize:function(t,i,e,n){this._controlsToHide=[],this._controlsToAdd=[],this._config=t,this._layers=i,this._manager=n,this._addDefaults(),null!=e&&this._addAllTo(e)},_addDefaults:function(){var t={};this._config.use_sidebar&&(this._menuView=new $t(this._manager),this.addControl(this._menuView),t={position:"topright"}),this._config.show_zoom_control&&this.addControl(new r.Z.Control.Zoom(t)),this._config.show_selection_control&&this.addControl(new H),this._config.show_search_control&&this.addControl(new it(a.extend({showPopup:!0,provider:new et},t))),(!0===this._config.show_hider_control||"mobile"==this._config.show_hider_control&&h())&&this.addControl(new J(this._controlsToHide,{visibleByDefault:this._config.hider_control_start_visible})),this._config.show_locate_control&&this.addControl(new X(t)),this._config.show_layers_control&&null!=this._layers&&Object.keys(this._layers).length>1&&this.addControl(new r.Z.Control.Layers(this._layers,null)),this._config.show_position_control&&(h()?this.addControl(new ot):this.addControl(new at))},addControl:function(t){for(var i=null,e=!1,n=0;n<Jt.length;n++)if(t instanceof Jt[n]){null!=this._controlsToAdd[n]&&(console&&console.debug('Overwriting existing control "'+this._controlsToAdd[n]+'" with "'+t+'".'),i=this._controlsToAdd[n]),this._controlsToAdd[n]=t,t instanceof J||this._controlsToHide.push(t),e=!0;break}if(e||(console.error("Unrecognised control: "+t),this._controlsToHide.push(t),this._controlsToAdd[Math.max(Jt.length,this._controlsToAdd.length)]=t),null!=this._map&&(t.addTo(this._map),null!=i))if(t instanceof $&&i instanceof r.Z.Control.Layers&&this._config.use_sidebar)i.remove(),this._menuView.addLayers(t);else{var s=t._container,o=i._container;a(s).remove(),a(o).replaceWith(s),i.remove()}},_addAllTo:function(t){this._controlsToAdd.forEach(function(i){null!=i&&i.addTo(t)}.bind(this)),this._map=t},addAttribution:function(t,i){this._config.use_sidebar&&this._menuView.addAttribution(t,i)}});const qt=Wt,Ht="Visited";var Xt=r.Z.Class.extend({initialize:function(t,i){this._authenticated=!1,this._visitConstraintManager=new class{#t=!1;#i={};translateAspect(t,i){return this.#e(i)&&(t.dimensionNames=[Ht,...t.dimensionNames],t.dimensionLabels={[Ht]:"Visited?",...t.dimensionLabels??{}}),t}translateDimensionString(t,i){let e=t;return this.#e(i)&&(e=this.translateDimensionValues([t],t,i).join("/")),e}translateDimensionValues(t,i,e){if(this.#e(e)){let n=this.#i[e]?.includes(i);t=[n?"Visited":"Not Visited",...t]}return t}#e(t){return this.#t&&null!=this.#i[t]}setVisitConstraints(t){this.#t=!0,this.#i=t}reset(){this.#t=!1,this.#i={}}};var e="true"==s.Z.test("testing");this._initializePromise=e?a.Deferred(function(t){a.get({url:p.Z.legacyApiBackendBaseUrl+"isAuthenticated",xhrFields:{withCredentials:!0}}).then(function(i){0==i?this._authenticated=!1:(this._authenticated=!0,this._loggedInUser=i.email),t.resolve()}.bind(this)).fail(function(i,e,n){401!=i.status&&(console.error("Failed to check authentication status - this can be ignored unless trying to record visits: "+e),console.log(n)),this._authenticated=!1,t.resolve()}.bind(this))}.bind(this)).promise():a.Deferred().resolve(),this._initializePromise=this._initializePromise.always(function(){this._map=t,this._config=i,this._layers=x(t,i),this._config.dimensional_layering&&(this._matrixLayerControl=new $(this._layers,null,{},{multiAspects:!0,embeddable:this._config.use_sidebar})),this._controls=new qt(i,this._layers,t,this)}.bind(this))},waitForInitialization:function(){return this._initializePromise},resetViewConstraints:function(){this._limitFunction=null},setViewConstraints:function(t){this._limitFunction=t},getViewConstraints:function(){return this._limitFunction},getControls:function(){return this._controls},getMap:function(){return this._map},getLayers:function(){return this._layers},getConfig:function(){return this._config},getMatrixLayerControl:function(){return this._matrixLayerControl},setAuthenticated:function(t){this._authenticated=t},isAuthenticated:function(){return this._authenticated},shouldManageVisits:function(){return this.isAuthenticated()},getLoggedInUser:function(){return this._loggedInUser},getVisitConstraintManager:function(){return this._visitConstraintManager}});const Yt=Xt,Kt={getBundleIds:function(t){var i=[];null!=t&&i.push.apply(i,t);var e=s.Z.test("datasources");return null!=e&&e.length>0&&i.push.apply(i,e.split(",")),"true"==s.Z.test("hills")&&i.push("hills"),"true"==s.Z.test("trigs")&&i.push("trigs"),i},loadMap:function(t,i){null==t&&(t={});var e=this.getBundleIds(i);if(this.hasUrlData())throw alert("Loading data from URL is no longer an option."),new Error("Loading data from URL is no longer an option.");if(null!=t.pointsToLoad){var n=t.pointsToLoad.generalPoints;t.cluster=n.length>300,t.dimensional_layering=!1,e=["trigs/config_embedding"]}t=a.extend({cluster:!0,dimensional_layering:!0},t);var s=this._buildMap(t),r=new Yt(s.getMap(),this._config);return r.waitForInitialization().then(function(){return s.postInit(),new R(r,this._config).loadSources(e)}.bind(this)).then((function(){return r}))},loadMiniMap:function(){this.loadMap({cluster:!1,dimensional_layering:!1,initial_zoom:10,start_position:[54.454463,-3.213515],show_search_control:!1,show_locate_control:!1,show_hider_control:!0,hider_control_start_visible:!1,map_style:"mini",use_sidebar:!1},["trigs/config_mini"])},_buildMap:function(t){return this._config=new n.Z(t),new V(this._config)},hasUrlData:function(){return null!=s.Z.test("trigs")}}},7714:(t,i,e)=>{"use strict";e.d(i,{Mx:()=>o,hG:()=>r,qF:()=>l});var n=e(7830),s=e(9755),a=e(7742);const r="enableClustering",o="disableClustering",l=n.Z.Class.extend({initialize:function(t){const i=t.getMap();this._view=s('<div class="setting"></div>'),this._clusteringEnabled=s('<input type="checkbox" checked>');var e=s("<label>Clustering enabled?</label>");e.prepend(this._clusteringEnabled);let n=null;this._clusteringEnabled.on("change",(t=>{t.target.checked?(n=null,i.fire(r)):(n=i.getZoom(),i.fire(o))})),i.on(a.ut,(()=>{let t=i.getZoom();null!=n&&t<n&&this._clusteringEnabled.prop("checked",!0).trigger("change")})),this._view.append(e);var l=s("<div>Disable clustering with care! Disabling clustering when there are a large number of markers on screen could slow down or even crash your browser, particularly on mobile devices. Similarly, even if there are not a large number of markers currently visible, you may still have a problem if you disable clustering and then perform an action which brings more markers in to view (e.g. zooming out, adding data sources or simply panning to a location with more markers).</div>");this._view.append(l)},getView:function(){return this._view}})},5857:(t,i,e)=>{"use strict";e.d(i,{Z:()=>r});var n=e(8382),s=e(7830).Z.Class.extend({initialize:function(){this.update()},update:function(){this._params={};var t=n.Z.location.search;t.length>0&&(t=t.substr(1)).split("&").forEach(function(t){var i=t.split("=");this._params[i[0]]=decodeURIComponent(i[1])}.bind(this))},getParams:function(){return this._params},test:function(t){return this._params[t]}}),a=new s;const r={test:function(t){return a.test(t)},tester:s}},4986:(t,i,e)=>{"use strict";e.d(i,{Z:()=>s});var n=e(9050);const s={notEmpty:function(t){return null!=t&&t.length>0},_truncateDisplayString:function(t){return t.length>100?t.substring(0,97)+"...":t},_truncateDisplayArray:function(t){return t.length>10?[...t.slice(0,10),"..."]:t},_buildValue:function(t){if("object"==typeof t&&"url"in t){let{url:i,text:e,type:n}=t;return i=this._escapeValue(i),e=this._truncateDisplayString(this._escapeValue(e)),null!=n&&n.startsWith("image/")?`\n\t\t\t\t<div class="popup-image-width-preserver"></div>\n\t\t\t\t<a href="${i}">\n\t\t\t\t\t<img class="popup-image" src="${i}" title="${e}">\n\t\t\t\t</a>`:`<a href="${i}">${e}</a>`}if(Array.isArray(t)&&2==t.length){let i=this._truncateDisplayString(this._escapeValue(t[0]));return`<a href="${this._escapeValue(t[1])}">${i}</a>`}return this._truncateDisplayString(this._escapeValue(t))},_escapeValue:function(t){return Array.isArray(t)?t.map(this._escapeValue.bind(this)):null==t?t:("string"!=typeof t&&(t=JSON.stringify(t)),n.ZP.escape(t))},buildShortDescription:function(t){return Object.keys(t).map((function(i){return t[i]})).filter((function(t){return null!=t&&""!=t})).map((function(t){function i(t){return Array.isArray(t)&&2==t.length?t[0]:t}return Array.isArray(t)?t.map(i).join("/"):i(t)})).join(", ")},buildDescription:function(t){var i="";return t.forEach(function(t){var e=t[0],s=t[1];if(null!=s&&""!=s)if(i.length>0&&(i+="<br />"),i+='<span class="popup-entry-key">'+n.ZP.escape(e)+": </span>",Array.isArray(s))if(s.length>1){s=this._truncateDisplayArray(s),i+='<ul class="popup-entry-list">';for(var a=0;a<s.length;a++)i+="<li>"+this._buildValue(s[a])+"</li>";i+="</ul>"}else i+="<span>"+this._buildValue(s[0])+"</span>";else i+="<span>"+this._buildValue(s)+"</span>"}.bind(this)),i},buildPopup:function(t,i,e,s,a,r){var o=n.ZP.escape(i),l=n.ZP.escape(e),c="<div>";if(this.notEmpty(l)?c='<a href="'+l+'" class="popup-title">'+o+"</a>":this.notEmpty(o)&&(c='<span class="popup-title">'+o+"</span>"),t.shouldManageVisits()&&null!=r&&(c+='<label class="fancy-checkbox" title="Visited?">',c+='    <input type="checkbox"'+(r?" checked":"")+"/>",c+='    <i class="fa fa-check"></i>',c+="</label>"),null!=a&&(c.length>0&&(c+="<br />"),c+=this.buildDescription(a)),null!=s){var d=s[0],u=s[1];c+='<div class="expandable expandable-links">',c+='<input type="checkbox" value="selected" id="links-checkbox" class="expandable-checkbox">',c+='<label for="links-checkbox" class="expandable-checkbox-label"><i class="fa fa-external-link" aria-hidden="true"></i></label>',c+='<div class="expandable-content links">',c+='<a href="'+("https://www.google.com/maps/place/"+d+"+"+u+"/@"+d+","+u+",15z")+'">View on google maps</a>',c+='<br /><a href="'+("https://www.bing.com/maps/?mkt=en-gb&v=2&cp="+d+"~"+u+"&lvl=14&sp=Point."+d+"_"+u+"_"+o)+'">View on bing maps</a>',c+='<br /><a href="'+("https://tools.wmflabs.org/geohack/geohack.php?pagename="+o+"&params="+d+"_N_"+u+"_E_region%3AGB_")+'">View on geohack</a>',c+="</div>",c+="</div>"}return c+="</div>"}}},9846:(t,i,e)=>{"use strict";e.d(i,{Z:()=>r});e(4291),e(1751);var n=e(7830),s=e(4986),a=e(9675);const r=n.Z.Class.extend({initialize:function(t,i){this._manager=t,this._unselectedStyle=i,null!=i.initialOutlineWidth&&(this._unselectedStyle.weight=i.initialOutlineWidth)},_showAsSelected:function(t){t.setStyle&&t.setStyle({weight:3,fillOpacity:.2})},_extractName:function(t,i,e){const n=(t,n)=>{let s=i.findIndex((([i,e])=>t.test(i)));if(-1!=s){let t=i[s][1];if(null!=t&&`${t}`.length>0)return n?t=`${e} / ${t}`:i.splice(s,1),t}};let s=null;const a=[/name/,/Name/,/name/i],r=[/ID/i,/OBJECTID/i,/GLOBALID/i];for(let t of a)if(s=n(t,!1),null!=s)break;if(null==s)for(let t of r)if(s=n(t,!0),null!=s)break;null==s&&(s=e),null==t.properties&&(t.properties={}),t.properties.name=s},_buildExtraInfos:function(t){let i=[];null!=t&&(i=Object.entries(t).filter((([t,i])=>null!=i&&`${i}`.length>0)));const e=["sym","_gpxType","coordTimes","coordinateProperties"],n=["SHAPE_"];return i=i.filter((([t,i])=>{return s=t,!e.includes(s)&&!n.some((t=>s.startsWith(t)));var s})).map((([t,i])=>("links"==t?i=i.map((t=>{let{href:i,type:e,text:n}=t;return null!=n&&0!=n.trim().length||(n=i),{url:i,text:n,type:e}})):Array.isArray(i)&&(i=i.map((t=>JSON.stringify(t)))),[t,i]))),i},dataToLayers:function(t){return Object.fromEntries(t.map((t=>{const{name:i,url:e,geojson:r,extraInfos:o}=t,l={},c=t=>{let i=t.target;this._showAsSelected(i);let e=i.feature.properties.name;if(e){let t=l[e];null!=i&&t.forEach(this._showAsSelected)}};let d=n.Z.Proj.geoJson(r,{style:this._unselectedStyle,onEachFeature:(t,n)=>{let a=null!=o?o:this._buildExtraInfos(t.properties);this._extractName(t,a,i);let r=t.properties.name;var d=s.Z.buildPopup(this._manager,r,e,null,a,null);n.bindPopup(d),r in l||(l[r]=[]),l[r].push(n),n.on({click:c})}}),u=(0,a.r)(this._manager.getMap());return u.addLayers(d),this._manager.getMap().on({preclick:()=>{d.resetStyle()}}),[i,u]})))}})},5449:(t,i,e)=>{"use strict";e.d(i,{Og:()=>d,aS:()=>c,bp:()=>o,cF:()=>u,n7:()=>l});var n=e(7830),s=e(5153),a=e(6290),r=e(883);function o(t){let{features:i}=t;"FeatureCollection"!==t.type&&(i=[t]);return i.map((function(t){const[i,e,n,s]=(0,a.V)(t);let o=s+.005,l=e-.005,c=i-.01,d=n+.01,u=[[c,o],[d,o],[d,l],[c,l],[c,o]];return(0,r.yu)([u])}))}function l(t){t=t.replace(/<url( [^>]+)?>(.+)<\/url>/g,'<link href="$2"></link>');var i=(new DOMParser).parseFromString(t,"text/xml"),e=(0,s.ng)(i);return{features:e,bounds:o(e)}}function c(t){let i=JSON.parse(t);return{features:i,bounds:o(i)}}function d(t){return n.Z.GeoJSON.coordsToLatLngs(t)}function u(t){return t.map((t=>{const i=d(t.geometry.coordinates[0]),e=new n.Z.LatLngBounds;for(const t of i)e.extend(t);return e}))}},9675:(t,i,e)=>{"use strict";e.d(i,{r:()=>r});const n=e(5732);var s=e(9755),a=e(7714);function r(t,i={}){var e=s("div#map"),r=Math.max(e[0].offsetHeight,e[0].offsetWidth)/10;let o=new n.MarkerClusterGroup({...i,disableClusteringAtZoom:15,maxClusterRadius:r,chunkedLoading:!0});return t.on(a.hG,(()=>{o.enableClustering()})),t.on(a.Mx,(()=>{o.disableClustering()})),o}},7830:(t,i,e)=>{"use strict";e.d(i,{Z:()=>o});var n=e(5243),s=e(6094),a=e(403),r=e(5965);delete n.Icon.Default.prototype._getIconUrl,n.Icon.Default.mergeOptions({iconRetinaUrl:a,iconUrl:s,shadowUrl:r});const o=n}}]);
//# sourceMappingURL=430.a4681dcafec854a3ca84.js.map