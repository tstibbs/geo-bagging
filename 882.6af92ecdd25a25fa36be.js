(self.webpackChunk_tstibbs_geo_bagging_ui=self.webpackChunk_tstibbs_geo_bagging_ui||[]).push([[882],{2981:(t,e,i)=>{var n={"./abstract_bundle_builder.js":[8001],"./abstract_geojson_builder.js":[1995],"./abstract_points_builder.js":[4758],"./coastallandmarks/config.js":[3228,228],"./coastallandmarks/points_builder.js":[5553,553],"./defence/config.js":[1912,912],"./defence/points_builder.js":[1613,613],"./external-geojson/config.js":[8384],"./external-gpx/config.js":[5982],"./follies/config.js":[8788,788],"./follies/points_builder.js":[8402,402],"./hills/classifications.js":[929,929],"./hills/config.js":[6201,201],"./hills/config_all.js":[8224,224],"./hills/points_builder.js":[2089,89],"./milestones/config.js":[393,723],"./milestones/points_builder.js":[4673,673],"./nationalparks/builder.js":[4190,190],"./nationalparks/config.js":[1156,156],"./nt/config.js":[7649,649],"./nt/points_builder.js":[6723,102],"./rnli/config.js":[6689,689],"./rnli/points_builder.js":[269,269],"./trails/builder.js":[8840,840],"./trails/config.js":[2081,81],"./trigs/config.js":[9896,240],"./trigs/config_base.js":[4317,952],"./trigs/config_embedding.js":[1764,374],"./trigs/config_mini.js":[2831,518],"./trigs/points_builder.js":[3052,52]};function s(t){if(!i.o(n,t))return Promise.resolve().then((()=>{var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}));var e=n[t],s=e[0];return Promise.all(e.slice(1).map(i.e)).then((()=>i(s)))}s.keys=()=>Object.keys(n),s.id=2981,t.exports=s},8001:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>r});var n=i(7830),s=i(9755),a=i(3508);const r=n.Z.Class.extend({initialize:function(t,e,i){this._markerList=null,this._manager=t,this._config=t.getConfig(),this._bundleConfig=e,this._bundleName=-1==i.indexOf("/")?i:i.substring(0,i.lastIndexOf("/")),this._urlPrefix=this._bundleConfig.dataLocationUrlPrefix??`${this._config.baseUrl}bundles/`,this._visits=[]},_buildDataUrl:function(){return this._urlPrefix+this._bundleName+"/"+this._bundleConfig.dataToLoad},_doFetchData:function(){var t=this._buildDataUrl(),e=s.ajax({url:t,dataType:"json"}).fail((function(t,e,i){console.error("Failed to load map data: "+e),console.log(i)}));if(this._manager.shouldManageVisits()){var i=s.get({url:a.Z.legacyApiBackendBaseUrl+"listVisits?source="+this._bundleName,dataType:"json",xhrFields:{withCredentials:!0}}).then(function(t){this._visits=t.map(function(t){return t.substring(t.indexOf("-",t.indexOf("-")+1)+1)}.bind(this))}.bind(this)).fail((function(t,e,i){console.error("Failed to load map data: "+e),console.log(i)}));return s.when(e,i).then((function(t){return t[0]}))}return e},fetchMeta:function(){var t=this._buildDataUrl()+".meta";return s.ajax({url:t,dataType:"json"}).fail((function(t,e,i){console.error("Failed to load source metadata: "+e),console.log(i)})).done(function(t){this._meta=t}.bind(this))},getMeta:function(){return this._meta},getVisits:function(){return this._visits},getBundleConfig:function(){return this._bundleConfig}})},1995:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>a});var n=i(8001),s=i(9846);const a=n.default.extend({initialize:function(t,e,i){n.default.prototype.initialize.call(this,t,e,i),this._data=null,this._bundleConfig=e,this._translator=new s.Z(t,"#3388ff",e.initialOutlineWidth)},fetchData:function(){return this._doFetchData().done(function(t){this._data=t}.bind(this))},_parseDatas:function(){return this._data.features.map(function(t){return this.parse(t)}.bind(this))},buildLayers:function(){var t=this._parseDatas();return this._translator.dataToLayers(t)},getAttribution:function(){return this._bundleConfig.attribution}})},4758:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>s});var n=i(8001);const s=n.default.extend({initialize:function(t,e,i){n.default.prototype.initialize.call(this,t,e,i),this._markerList=null,this._bundleConfig=e},fetchData:function(){return this._doFetchData().done(function(t){this.addMarkers(t)}.bind(this))},addMarkers:function(t){for(var e=t.data,i=0;i<e.length;i++)this.parse(e[i]);null!=this._bundleConfig.attribution?this._attributionText=this._bundleConfig.attribution:this._attributionText=t.attribution},addMarker:function(t,e,i,n,s,a,r,o,l){var c={id:t=encodeURIComponent(t),latLng:[parseFloat(e),parseFloat(i)],name:s,extraTexts:a,exportName:s,url:n,icon:r,layerId:l,visited:-1!=this.getVisits().indexOf(t)};if(this._config.dimensional_layering||null==o||0===o.length){if(null==this._markerList&&(this._markerList={}),this._withinConstraints(c)){for(var d=this._markerList,u=0;u<o.length-1;u++){var h=o[u];null==d[h]&&(d[h]={}),d=d[h]}var f=o[o.length-1];null==d[f]&&(d[f]=[]),d[f].push(c)}}else null==this._markerList&&(this._markerList=[]),this._markerList.push(c)},_withinConstraints:function(t){var e=this._manager.getViewConstraints();return null==e||e(t.latLng)},buildImageLinks:function(t){return t.map((function(t,e){return["Image "+(e+1),t]}))},split:function(t,e){return t.split(";").map((function(t){var i=e[t];return null!=i?i:t}))},getMarkerList:function(){return this._markerList},getAttribution:function(){return this._attributionText}})},8384:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>n});const n={aspectLabel:"GeoJson Files",loadLabel:"GeoJson",loadExtensions:".geojson",colour:"darkblue",initialOutlineWidth:1,fileContentsParser:i(5449).aS}},5982:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>n});const n={aspectLabel:"GPX Files",loadLabel:"GPX",loadExtensions:".gpx",colour:"#bd007e",initialOutlineWidth:2,fileContentsParser:i(5449).n7}},6582:(t,e,i)=>{"use strict";i.d(e,{Z:()=>d});var n=i(5243),s=i(9755),a=i(8382),r=i(5857),o=i(4260),l=a.Z.location.pathname.split("/").pop(),c={baseUrl:null!=window.geoBaggingBaseUrl?window.geoBaggingBaseUrl:"",map_style:"full",cluster:!0,dimensional_layering:!1,initial_zoom:13,start_position:[53.374694,-1.711474],force_config_override:!1,map_element_id:"map",map_outer_container_element:s("body"),page_id:l,show_zoom_control:!0,show_selection_control:!0,show_search_control:!0,show_locate_control:!0,show_layers_control:!0,show_position_control:!0,show_hider_control:"mobile",use_sidebar:!0,hider_control_start_visible:!0,icons:{},dimensionNames:[],dimensionValueLabels:{},defaultLayer:"OS",markerConstraints:null};const d=n.Class.extend({initialize:function(t,e){var i=s.extend({},c,t);if(this._checkForUndefaultedProperties(t,"window config"),i.bundles=e,this._storageId="os_map:"+i.page_id+"config",null==t||!0!==t.force_config_override){var n=this._getSavedConfig();i=s.extend({},i,n)}for(var a in r.Z.test("startPosition")&&(i.start_position=r.Z.test("startPosition").split(",")),r.Z.test("startZoom")&&(i.initial_zoom=r.Z.test("startZoom")),this._buildMarkerConstraints(i),i)i.hasOwnProperty(a)&&(this[a]=i[a])},_buildMarkerConstraints:function(t){var e=null;if(null!=r.Z.test("constraints")?e=r.Z.test("constraints"):null!=t.markerConstraints&&"string"==typeof t.markerConstraints&&(e=t.markerConstraints),null!=e){var i=e.split(","),s=null,a=null,l=null,c=null;if(2==i.length){var d=o.Z.gridRefToLngLat(i[0]);a=d[0],s=d[1];var u=o.Z.gridRefToLngLat(i[1]);c=u[0],l=u[1]}else s=parseFloat(i[0]),a=parseFloat(i[1]),l=parseFloat(i[2]),c=parseFloat(i[3]);t.markerConstraints=[[l,a],[s,c]]}null!=t.markerConstraints&&Array.isArray(t.markerConstraints)&&(t.markerConstraints=n.latLngBounds(t.markerConstraints)),null!=t.markerConstraints&&"function"==typeof t.markerConstraints&&(t.markerConstraintsMatcher=t.markerConstraints),null!=t.markerConstraints&&null==t.markerConstraintsMatcher&&(t.markerConstraintsMatcher=function(e){return t.markerConstraints.contains(e.latLng)})},_checkForUndefaultedProperties:function(t,e){for(var i in t)t.hasOwnProperty(i)&&!c.hasOwnProperty(i)&&console.warn('Property "'+i+'" (set from '+e+") should have a default")},_getSavedConfig:function(){if(void 0!==localStorage){var t=localStorage.getItem(this._storageId);return null!=t?JSON.parse(t):null}return null},persist:function(t){if(void 0!==localStorage){var e=this._getSavedConfig();null!=e&&(t=s.extend({},e,t)),localStorage.setItem(this._storageId,JSON.stringify(t))}}})},3508:(t,e,i)=>{"use strict";i.d(e,{Z:()=>s});const n="https://d1548rv5kyvrdp.cloudfront.net",s={bingKey:"AgYJwt3nv3bZyK31EDXorMaO8aIix-5kAa32O5TTwFAhdVYtZdIKhw3ttntsmgqy",dataSources:["follies","hills","milestones","defence","trails","rnli","nationalparks","coastallandmarks"],legacyApiBackendBaseUrl:"https://not_deployed.execute-api.eu-west-2.amazonaws.com/prod/",dataBackendBaseUrl:`${n}/data/`,integrationBackendBaseUrl:`${n}/integration/`}},4260:(t,e,i)=>{"use strict";i.d(e,{Z:()=>a});var n=(0,i(4472).Z)("+proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy +datum=OSGB36 +units=m +no_defs");function s(t,e){for(var i=t.toString();i.length<e;)i="0"+i;return i}const a={latLngToGridRef:function(t,e){var i=10,a=n.forward([e,t]),r=a[0],o=a[1];if(i=void 0===i?10:Number(i),isNaN(i))throw new Error("Invalid precision");var l=Number(Number(r)),c=Number(Number(o));if(isNaN(l)||isNaN(c))throw new Error("Invalid grid reference: "+[t,e]);if(0===i)return s(l,6)+","+s(c,6);var d=Math.floor(l/1e5),u=Math.floor(c/1e5);if(d<0||d>6||u<0||u>12)return"";var h=19-u-(19-u)%5+Math.floor((d+10)/5),f=5*(19-u)%25+d%5;h>7&&h++,f>7&&f++;var p=String.fromCharCode(h+"A".charCodeAt(0),f+"A".charCodeAt(0));return l=Math.floor(l%1e5/Math.pow(10,5-i/2)),c=Math.floor(c%1e5/Math.pow(10,5-i/2)),p+" "+s(l,i/2)+" "+s(c,i/2)},osgbToLngLat:function(t,e){return n.inverse([t,e])},gridRefToOsgb:function(t){t=String(t).trim(),this._determineGridRefType(t);var e=t.match(/^(\d+),\s*(\d+)$/);if(e)return new OsGridRef(e[1],e[2]);if(!(e=t.match(/^[A-Z]{2}\s*[0-9]+\s*[0-9]+$/i)))throw new Error("Invalid grid reference: "+t);var i=t.toUpperCase().charCodeAt(0)-"A".charCodeAt(0),n=t.toUpperCase().charCodeAt(1)-"A".charCodeAt(0);i>7&&i--,n>7&&n--;var s=(i-2)%5*5+n%5,a=19-5*Math.floor(i/5)-Math.floor(n/5),r=t.slice(2).trim().split(/\s+/);if(1==r.length&&(r=[r[0].slice(0,r[0].length/2),r[0].slice(r[0].length/2)]),s>=15&&(s-=25),a>20&&(a-=25),s<-10||a<-5)throw new Error("Invalid grid reference: gridref="+t+", e100km="+s+", n100km="+a);if(2!=r.length)throw new Error("Invalid grid reference: "+t);if(r[0].length!=r[1].length)throw new Error("Invalid grid reference: "+t);return r[0]=(r[0]+"00000").slice(0,5),r[1]=(r[1]+"00000").slice(0,5),[parseInt(s+"00000")+parseInt(r[0]),parseInt(a+"00000")+parseInt(r[1])]},gridRefToLngLat:function(t){var e=this.gridRefToOsgb(t);return n.inverse(e)},_determineGridRefType:function(t){if(/^\w\s*\d{3,}\s*\d{3,}$/.test(t))throw new Error("Irish grid references currently unsupported: "+t)}}},4846:(t,e,i)=>{"use strict";i.d(e,{Z:()=>s});var n=i(9755);const s=function(t,e){if(n("div.full-screen-link").length>0){var i=n('<a href="#">Open in full screen</a>');i.click((function(){var i=e.getZoom(),n=e.getCenter(),s=t.baseUrl+"index.html?datasources=trigs&startPosition="+n.lat+","+n.lng+"&startZoom="+i;window.location.href=s})),n("div.full-screen-link").append(i)}}},8382:(t,e,i)=>{"use strict";i.d(e,{Z:()=>n});const n=window},7742:(t,e,i)=>{"use strict";i.d(e,{BR:()=>a,ut:()=>n});const n="zoomOut",s="zoomIn";function a(t){let e=t.getZoom();t.on("zoom",(()=>{let i=t.getZoom();Number.isInteger(i)&&(i<e?(console.debug(`zoom out: from=${e} to=${i}`),t.fire(n)):i>e&&(console.debug(`zoom in: from=${e} to=${i}`),t.fire(s)),e=t.getZoom())}))}},7882:(t,e,i)=>{"use strict";i.d(e,{Z:()=>Nt});var n=i(6582),s=i(5857),a=i(9755),r=i(7830),o=i(4846),l=i(8382),c=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i,d=/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i,u=s.Z.test("mobile");const h=function(){if(u)return!0;var t=l.Z.navigator.userAgent||l.Z.navigator.vendor||l.Z.opera;return c.test(t)||d.test(t.substr(0,4))};var f=i(7742);const p=i(7654).Z;var _=i(3508),g={key:_.Z.bingKey},m=r.Z.extend({maxZoom:18,minZoom:0,detectRetina:!0},g),b=new p(r.Z.extend({imagerySet:"OrdnanceSurvey",minZoom:12,maxZoom:18,maxNativeZoom:17},g)),v=new p(r.Z.extend({imagerySet:"RoadOnDemand",maxZoom:11,minZoom:0},g)),w=r.Z.layerGroup([b,v]),y=new p(r.Z.extend({imagerySet:"RoadOnDemand"},m)),k=new p(r.Z.extend({imagerySet:"AerialWithLabelsOnDemand"},m)),x=new p(r.Z.extend({imagerySet:"Aerial"},m)),C=new r.Z.TileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{minZoom:0,maxZoom:19,attribution:'Map data © <a href="http://openstreetmap.org">OpenStreetMap</a> contributors'}),L={OS:w,"Bing Roads":y,"Bing Satellite":x,"Bing Hybrid":k,OSM:C};const{max:Z,min:A}=function t(e){let i=0,n=Number.MAX_SAFE_INTEGER;return e.forEach((e=>{if(e.getLayers){let{max:s,min:a}=t(e.getLayers());i=Math.max(i,s),n=Math.min(n,a)}e.options?.maxZoom&&(i=Math.max(i,e.options.maxZoom)),e.options?.maxZoom&&(n=Math.min(n,e.options.minZoom))})),{max:i,min:n}}(Object.values(L));function M(t,e,i){e.on("add",function(){i.persist({defaultLayer:t})}.bind(this))}const V=function(t,e){var i=L[e.defaultLayer];for(var n in null!=i?i.addTo(t):w.addTo(t),L)M(n,L[n],e);return L};var O=r.Z.Class.extend({initialize:function(t){this._config=t,this._createView(),this._map=new r.Z.Map(this._config.map_element_id,{zoomControl:!1,minZoom:A,maxZoom:Z}),this._map.setView(new r.Z.LatLng(this._config.start_position[0],this._config.start_position[1]),this._config.initial_zoom),(0,o.Z)(this._config,this._map),this._map.on("zoomend moveend dragend",(function(){this._saveLocation()}),this),(0,f.BR)(this._map)},_createView:function(){var t="",e="";"mini"==this._config.map_style||"mini_embedded"==this._config.map_style?e=' class="mini-map"':"full"==this._config.map_style?e=' class="full-screen"':"embedded"==this._config.map_style&&(e=' class="embedded-map"'),"mini"!=this._config.map_style&&"mini_embedded"!=this._config.map_style||(t+='<div class="mini-map">'),t+='<div id="'+this._config.map_element_id+'"'+e+"></div>","mini"==this._config.map_style&&(t+="</div>",t+='<div class="full-screen-link"></div>'),"full"==this._config.map_style&&this._config.map_outer_container_element.addClass("full-screen"),h()&&this._config.map_outer_container_element.addClass("mobile"),this._config.map_outer_container_element.prepend(a(t))},_saveLocation:function(){var t=this._map.getCenter(),e=[t.lat,t.lng],i=this._map.getZoom();if(void 0!==localStorage){var n={start_position:e,initial_zoom:i};this._config.persist(n),console.debug(JSON.stringify(n))}},getMap:function(){return this._map}});const S=O;var j=i(9050),z=i(5243),T=i(9675);i(4705);const P=i(3750);var I=i(4986);const E=function(t,e,i,n){var s=t.latLng,o=t.name,l=t.extraTexts,c=t.exportName,d=t.icon,u=t.url,h=t.visited;I.Z.notEmpty(o)||(o=u),I.Z.notEmpty(c)&&(c=o);var f=I.Z.buildPopup(n,o,u,s,l,h),p={};null!=e.icons&&null!=e.icons[d]?p.icon=e.icons[d]:null!=e.defaultIcon&&(p.icon=e.defaultIcon),p.layerId=t.layerId;var g=r.Z.marker(s,p),m=a("<div>"+f+"</div>");n.shouldManageVisits()&&a("input",m).change((function(){var e="";e=this.checked?"recordVisit":"removeVisit",a.post({url:_.Z.legacyApiBackendBaseUrl+e,data:JSON.stringify({source:i,name:t.id}),contentType:"application/json",xhrFields:{withCredentials:!0}}).catch((function(t,e,i){401==t.status?console.log("Authentication required"):console.log("Request failed: "+t.status+", "+e+", "+i)}))})),g.bindPopup(m[0]),c=j.ZP.escape(t.exportName);var b=null,v=null;return null!=l&&(b=j.ZP.escape(I.Z.buildShortDescription(l)),v=j.ZP.escape(I.Z.buildDescription(l))),g.exportData={name:c,link:u,cmt:b,desc:v},g};var D=z.Class.extend({initialize:function(t,e,i,n,s,a,r){this._map=t,this._config=e,this._modelsByAspect=i,this._matrixLayerControl=n,this._controls=s,this._bundles=a,this._parentGroup=null,this._manager=r},_translateMarkerGroup:function(t,e,i){if(null!=t)if(t.constructor===Array)t.forEach((function(t,n,s){s[n]=E(t,e,i,this._manager)}),this);else for(var n in t)t[n]=this._translateMarkerGroup(t[n],e,i);return t},finish:function(t){var e=a.Deferred();if(this._config.cluster?this._parentGroup=(0,T.r)(this._manager.getMap(),{chunkProgress:function(t,i,n,s){t===i&&e.resolve()}}):(this._parentGroup=z.layerGroup(),e.resolve()),this._parentGroup.addTo(this._map),this._config.dimensional_layering)for(var i in this._modelsByAspect){var n=this._modelsByAspect[i];this.addClusteredModel(i,n)}else{var s=Object.keys(this._modelsByAspect).map(function(t){var e=this._modelsByAspect[t];return this._translateMarkerGroup(e.getMarkerList(),e.getBundleConfig(),t)}.bind(this)).filter((function(t){return null!=t})),r=[].concat.apply([],s);if(this._config.cluster){var o="null",l=r.reduce((function(t,e){var i=e.options.layerId;return null==t[i=null==i?o:i]&&(t[i]=[]),t[i].push(e),t}),{});this._parentGroup.addLayers(l[o]),Object.keys(l).filter((function(t){return t!==o})).forEach(function(t){for(var e=l[t],i=z.layerGroup(),n=0;n<e.length;n++)i.addLayer(e[n]);i.addTo(this._map)}.bind(this))}else for(var c=0;c<r.length;c++)this._parentGroup.addLayer(r[c])}return e.promise()},addClusteredModel:function(t,e){if(null!=e.getMarkerList()){var i=this._translateMarkerGroup(e.getMarkerList(),e.getBundleConfig(),t),n={};this.depthFirstIteration(i,"",n);var s=this._bundles[t];this._matrixLayerControl.addAspect(t,n,s)}},depthFirstIteration:function(t,e,i){if(t.constructor===Array){var n=new P(this._parentGroup,t);i[e]=n}else Object.keys(t).forEach(function(n){var s=0===e.length?n:e+"/"+n,a=t[n];this.depthFirstIteration(a,s,i)}.bind(this))}});const F=D;var B=r.Z.Class.extend({initialize:function(t,e,i,n,s){this._map=t,this._config=e,this._modelsByAspect=i,this._matrixLayerControl=n,this._bundles=s},finish:function(t){if(!this._config.dimensional_layering&&Object.keys(this._modelsByAspect).length>0)throw new Error("!dimensional_layering is not supported yet.");r.Z.layerGroup(),Object.keys(this._modelsByAspect).forEach(function(t){var e=this._modelsByAspect[t];this.addClusteredModel(t,e)}.bind(this));return a.Deferred().resolve().promise()},addClusteredModel:function(t,e){var i=this._bundles[t],n=e.buildLayers();Object.values(n).forEach(function(t){t.addTo(this._map)}.bind(this)),this._matrixLayerControl.addAspect(t,n,i)}});const N=B;var U=i(4758),G=i(1995);const R=r.Z.Class.extend({initialize:function(){this._tester=new s.Z.tester},sourceLoaded:function(t){this._tester.update();var e=this._tester.getParams(),i=e.datasources;i=null==i?"":i,delete e.datasources,i=i.length>0?i+","+t:t;var n=Object.keys(e).map((function(t){return t+"="+e[t]})).join("&");n=(n.length>0?n+"&":"")+"datasources="+i;document.location.origin,document.location.pathname}});var $=r.Z.Class.extend({initialize:function(t,e){this._bundles=t,this._manager=e,this._controls=e.getControls(),this._urlHandler=new R,this._lazyCallbacks={}},_filterModels:function(t,e){var i={};return Object.keys(t).filter((function(i){return t[i]instanceof e})).forEach((function(e){i[e]=t[e]})),i},loadSource:function(t){return this._lazyCallbacks[t]()},_addLazyModels:function(t,e){Object.keys(t).forEach(function(i){var n=t[i],s=function(){return n.fetchData().done(function(){e(i,n),this._addAttribution(i,n),this._urlHandler.sourceLoaded(i)}.bind(this))}.bind(this);this._lazyCallbacks[i]=s;var a=n.getMeta(),r=a.recordCount+" items (last updated "+a.lastUpdated+")",o=this._bundles[i];this._manager.getMatrixLayerControl().addLazyAspect(i,o,{description:r,callback:s})}.bind(this))},_addAttribution:function(t,e){var i=e.getAttribution();if(null!=i&&i.length>0){var n=e.getBundleConfig().aspectLabel;this._controls.addAttribution(n,i)}},loadModelViews:function(t,e,i,n){var s=this._filterModels(t,U.default),r=this._filterModels(t,G.default),o=this._filterModels(e,U.default),l=this._filterModels(e,G.default),c=new F(this._manager.getMap(),i,s,this._manager.getMatrixLayerControl(),this._controls,this._bundles,this._manager),d=new N(this._manager.getMap(),i,r,this._manager.getMatrixLayerControl(),this._bundles),u=[c.finish(),d.finish()];i.dimensional_layering&&(this._addLazyModels(o,(function(t,e){c.addClusteredModel(t,e)})),this._addLazyModels(l,(function(t,e){d.addClusteredModel(t,e)}))),a.when.apply(a,u).always(function(){i.dimensional_layering&&this._controls.addControl(this._manager.getMatrixLayerControl()),Object.keys(t).forEach(function(e){var i=t[e];this._addAttribution(e,i)}.bind(this)),n()}.bind(this))}});const J=$;var H=r.Z.Class.extend({initialize:function(t,e){this._manager=t,this._config=e},_parseSources:function(t){var e=s.Z.test(t);return null!=e&&e.length>0?e.split(","):[]},loadSources:function(t){var e=this._parseSources("extra-datasources"),n=a.uniqueSort(t.concat(_.Z.dataSources,e)),s=this._sourceIdsToDataSources(n),r=a.Deferred(),o={};let l=s.map((t=>i(2981)("./"+t+".js")));return Promise.all(l).then((e=>{e.forEach(((t,e)=>{"function"==typeof(t=t.default)&&(t=t(this._config)),o[s[e]]=t}));var i={},n={},l=Object.keys(o).map(function(e){var s=o[e],r=new s.parser(this._manager,s,e),l=r.fetchMeta();if(-1!=t.indexOf(e)){var c=r.fetchData();return i[e]=r,a.when(l,c)}return n[e]=r,l}.bind(this));a.when.apply(a,l).always(function(){this._modelViews=new J(o,this._manager),this._modelViews.loadModelViews(i,n,this._config,this._finish.bind(this)),r.resolve()}.bind(this)),setTimeout((()=>{r.resolve()}),1)})),r.promise()},_sourceIdsToDataSources:function(t){return t=null!=t?t.map((function(t){return-1==t.indexOf("/")?t+"/config":t})):[]},_autoLoadSources:async function(){let t=this._parseSources("auto-load-datasources"),e=this._sourceIdsToDataSources(t).map((t=>this._modelViews.loadSource(t)));await Promise.all(e)},_finish:async function(){await this._autoLoadSources(),a("div#loading-message-pane").hide()}});const q=H;const W=i(1143);const X=i(8486).Z;var K=i(6937),Y=i(4358);const Q=K.extend({options:{actions:{gpx:{display:"Export to GPX file",action:Y((function(){var t=new Date;return"geoPoints_"+(t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()+"_"+t.getHours()+"-"+t.getMinutes()+"-"+t.getSeconds())+".gpx"}))}}}});const tt=i(687).extend({options:{keepCurrentZoomLevel:!0,setView:"once"}});var et=i(4225);const it=new et.C1({provider:function(){}});function nt(){this.initialize&&this.initialize.apply(this,arguments)}var st=Object.getPrototypeOf(it);nt.__super__=st,nt.prototype=r.Z.Util.create(st),nt.prototype.constructor=nt;const at=nt,rt=et.Z3;const ot=i(5516).Z;var lt=i(4260);const ct=ot.extend({options:{formatter:function(t,e){return lt.Z.latLngToGridRef(e,t)}}});const dt=i(6058).Z;const ut=dt.extend({options:{onMove:!0,icon:!0,latLngFormatter:function(t,e){return lt.Z.latLngToGridRef(t,e)}},addTo:function(t){dt.prototype.addTo.call(this,t),this._addShowHideHandling()},_addShowHideHandling:function(){var t=a("div.leaflet-control-mapcentercoord-icon.leaflet-zoom-hide"),e=!1;function i(){t.css("visibility","hidden"),e=!1}a("div.leaflet-control-mapcentercoord.leaflet-control").click((function(){e?i():(t.css("visibility","visible"),e=!0)})),i()}});const ht=i(136).Z;var ft=r.Z.Class.extend({initialize:function(t){this._container=t;let e=a('<div class="attribution-entry"></div>\n\t<span class="attribution-source">Geo-bagging</span>\n\t<span>\n\t\tThe code on this site is copyright \n\t\t<a href="https://github.com/tstibbs">tstibbs</a>/stripycoder, \n\t\tlicenced under AGPL, \n\t\tsource code available at \n\t\t<a href="https://github.com/tstibbs/geo-bagging">here</a>.\n\t</span>\n\t<br />\n\t<span>\n\t\tMany open source libraries help make this project, see a full list in <a href="licenses.txt">licenses.txt</a>.\n\t</span>\n</div>');this._container.append(e)},addAttribution:function(t,e){let i=a(`<div class="attribution-entry">\n\t<span class="attribution-source">${t} data</span>\n\t<span>${e}</span>\n</div>`);this._container.append(i)}});const pt=ft;const _t=r.Z.Class.extend({initialize:function(t){this._view=a('<div class="setting"></div>'),t.isAuthenticated()?this._view.append(a("<span>Logged in as "+t.getLoggedInUser()+"</span>")):this._view.append(a('<a href="'+_.Z.legacyApiBackendBaseUrl+'login">Click here to log in</a>'))},getView:function(){return this._view}});var gt=i(7714);const mt=r.Z.Class.extend({initialize:function(t){this._view=a("<div></div>");var e=new gt.qF(t);this._view.append(e.getView())},getView:function(){return this._view}}),bt=r.Z.Class.extend({initialize:function(t){this._manager=t,this._displayedSources=[]},addLayers:function(t,e){Object.values(e).forEach((t=>t.addTo(this._manager.getMap()))),this._displayedSources.includes(t)?Object.entries(e).forEach((([e,i])=>{this._manager.getMatrixLayerControl()._addMatrixOverlay(i,e,t)})):(this._displayedSources.push(t),this._manager.getMatrixLayerControl().addAspect(t,e,{dimensionNames:[t]})),Object.keys(e).forEach((e=>this._setLayerVis(t,e,!0))),this._manager.getMatrixLayerControl()._onInputClick(),this._manager.getMatrixLayerControl()._update()},hideLayers:function(t,e){Object.entries(e).forEach((([e,i])=>{this._setLayerVis(t,e,!1),i.remove()}))},_setLayerVis:function(t,e,i){this._manager.getMatrixLayerControl()._model(t).inputChanged(t,e,i)}});var vt=i(9846);const wt=r.Z.Class.extend({initialize:function(t,e,i,n){this._sourceName=e,this._layers={},this._externalSourceLoader=new bt(t),this._translator=new vt.Z(t,i,n)},hideOldLayers:function(){this._externalSourceLoader.hideLayers(this._sourceName,this._layers)},showNewLayers:function(t){let e=t.map((({features:t,name:e})=>({name:e,geojson:t}))),i=this._translator.dataToLayers(e);this._externalSourceLoader.addLayers(this._sourceName,i),this._layers={...this._layers,...i}}});const yt=r.Z.Class.extend({initialize:function(t,e){this._bundle=e,this._view=a('<div class="setting"></div>'),this._view.append(a(`<span>${this._bundle.loadLabel}: </span></br>`)),this._fileInput=a(`<input type="file" accept="${this._bundle.loadExtensions}" multiple>`),this._view.append(this._fileInput),this._fileInput.on("change",this._readFiles.bind(this)),this._fileCounter=0,this._filesView=new wt(t,this._bundle.aspectLabel,this._bundle.colour,this._bundle.initialOutlineWidth)},_readFiles:function(){for(var t=[],e=this._fileInput[0].files,i=0;i<e.length;i++)(function(i){var n=new FileReader;n.onload=function(s){var a=this._parseFileContents(n.result);t.push({name:`${this._fileCounter} - ${i.name}`,...a}),this._fileCounter++,t.length==e.length&&this._finishedReadingFiles(t)}.bind(this),n.readAsText(i)}).bind(this)(e.item(i))},_finishedReadingFiles:function(t){this._filesView.showNewLayers(t)},_parseFileContents:function(t){const{features:e,bounds:i}=this._bundle.fileContentsParser(t);return{features:e,bounds:i}},getView:function(){return this._view}});const kt=yt.extend({initialize:function(t,e,i){yt.prototype.initialize.call(this,t,i),this._constraintsView=e},_finishedReadingFiles:function(t){var e=t.map((function(t){return t.bounds}));e=e.flat(),this._constraintsView.limitTo(this,e),yt.prototype._finishedReadingFiles.call(this,t)},reset:function(){this._fileInput.val(""),this._filesView.hideOldLayers()}});var xt=i(5982);const Ct={...xt.default,aspectLabel:"GPX Tracks",colour:"#FF0000",loadLabel:"Upload GPX tracks to see markers around those tracks"};const Lt=kt.extend({initialize:function(t,e){kt.prototype.initialize.call(this,t,e,Ct)}});const Zt=r.Z.Class.extend({initialize:function(t,e){this._manager=t,this._constraintsView=e,this._view=a('<div class="setting"></div>');var i=a('<button type="button">Limit to 5 miles from current location</button>');i.click(this._limitToCurrentLocation.bind(this)),this._view.append(i)},_limitToCurrentLocation:function(){var t=this._manager.getMap(),e=function(i){t.off("locationfound",e);var n=i.latlng.lat,s=i.latlng.lng,a=new r.Z.latLngBounds([n+.08,s+.12],[n-.08,s-.12]);this._constraintsView.limitTo(this,a)}.bind(this);t.on("locationfound",e),t.stopLocate(),t.locate()},getView:function(){return this._view},reset:function(){}});const At=r.Z.Class.extend({initialize:function(t,e){this._manager=t,this._constraintsView=e,this._view=a('<div class="setting"></div>'),this._currentAreaLimit=a('<input type="checkbox">');var i=a("<label>Limit new markers to current area</label>");i.prepend(this._currentAreaLimit),this._currentAreaLimit.change(function(t){t.target.checked?this._constraintsView.limitTo(this,this._manager.getMap().getBounds()):this._constraintsView.unlimit()}.bind(this)),this._view.append(i)},getView:function(){return this._view},reset:function(){this._currentAreaLimit.prop("checked",!1)}});var Mt=i(8384);const Vt={...Mt.default,aspectLabel:"GeoJson Constraints",colour:"orange",loadLabel:"Upload a GeoJSON file to see markers within the polygons specified in the geojson file"},Ot=kt.extend({initialize:function(t,e){kt.prototype.initialize.call(this,t,e,Vt)}});var St=i(5243);const jt=r.Z.Class.extend({initialize:function(t){this._manager=t,this._limitOriginView=null,this._view=a("<div></div>");var e=a('<div class="info">This section allows you to limit how much data is displayed on screen. This can be useful for example when on older or mobile devices which may struggle to remain responsive if a large amount of data is loaded.</div>');this._view.append(e),this._view.append('<hr class="info">');var i=new At(t,this);this._view.append(i.getView());var n=new Zt(t,this);this._view.append(n.getView()),this._trackConstraintsLoadView=new Lt(t,this),this._view.append(this._trackConstraintsLoadView.getView()),this._geoJsonConstraintLoadView=new Ot(t,this),this._view.append(this._geoJsonConstraintLoadView.getView());var s=this._buildReset();this._view.append(s)},_buildReset:function(){var t=a('<div class="setting"></div>'),e=a('<button type="button">Reset</button>');return e.click(this.unlimit.bind(this)),t.append(e),t},limitTo:function(t,e){this.unlimit(),this._limitOriginView=t,this._manager.setViewConstraints(this._buildLimitFunction(e)),null!=this._constraintPolygon&&this._constraintPolygon.remove();var i=[[[-90,-180],[90,-180],[90,180],[-90,180]]];Array.isArray(e)||(e=[e]),e.forEach((function(t){i.push([t.getSouthWest(),t.getNorthWest(),t.getNorthEast(),t.getSouthEast()])})),this._constraintPolygon=new St.Polygon(i,{color:"rgb(0, 0, 0, 0)",fillColor:"rgb(90, 90, 90)",fillOpacity:.3}),this._constraintPolygon.addTo(this._manager.getMap())},_buildLimitFunction:function(t){return Array.isArray(t)?function(e){for(var i=0;i<t.length;i++)if(t[i].contains(e))return!0;return!1}:function(e){return t.contains(e)}},unlimit:function(){null!=this._limitOriginView&&(this._limitOriginView.reset(),this._limitOriginView=null),this._manager.setViewConstraints(null),null!=this._constraintPolygon&&this._constraintPolygon.remove()},getView:function(){return this._view}});const zt=r.Z.Class.extend({initialize:function(t){this._view=a("<div></div>");var e=a('<div class="info">Load external files to overlay on to map. Parsing is basic and limited information will be loaded - overlays will be mostly just visuals.</div>');this._view.append(e),this._view.append('<hr class="info">');const i=new yt(t,Mt.default);this._view.append(i.getView());const n=new yt(t,xt.default);this._view.append(n.getView())},getView:function(){return this._view}});var Tt=r.Z.Class.extend({initialize:function(t){this._manager=t,this._buildView(),this._buildControl()},_buildView:function(){var t="",e="true"==s.Z.test("testing");t+='<div id="sidebar" class="'+["sidebar","collapsed","leaflet-container"].join(" ")+'">',t+='    <div class="sidebar-tabs">',t+='        <ul role="tablist">',t+='            <li><a href="#sidebar-layers" role="tab"><i class="fa fa-bars"></i></a></li>',t+='            <li><a href="#sidebar-settings" role="tab"><i class="fa fa-sliders"></i></a></li>',t+='            <li><a href="#sidebar-constraints" role="tab"><i class="fa fa-map-o"></i></a></li>',t+='            <li><a href="#sidebar-external-files" role="tab"><i class="fa fa-plus-square-o"></i></a></li>',t+="        </ul>",t+='        <ul role="tablist">',e&&(t+='            <li><a href="#sidebar-user" role="tab"><i class="fa fa-user"></i></a></li>'),t+='            <li><a href="#sidebar-attribution" role="tab"><i class="fa fa-copyright"></i></a></li>',t+="        </ul>",t+="    </div>",t+='    <div class="sidebar-content">',t+='        <div id="sidebar-layers" class="sidebar-pane">',t+='            <h1 class="sidebar-header">Layers<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>',t+="        </div>",t+='        <div id="sidebar-settings" class="sidebar-pane">',t+='            <h1 class="sidebar-header">Settings<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>',t+="        </div>",t+='        <div id="sidebar-constraints" class="sidebar-pane">',t+='            <h1 class="sidebar-header">Data Limits<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>',t+="        </div>",t+='        <div id="sidebar-external-files" class="sidebar-pane">',t+='            <h1 class="sidebar-header">External Files<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>',t+="        </div>",t+='        <div id="sidebar-attribution" class="sidebar-pane">',t+='            <h1 class="sidebar-header">Attribution<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>',t+="        </div>",e&&(t+='        <div id="sidebar-user" class="sidebar-pane">',t+='            <h1 class="sidebar-header">User Settings<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>',t+="        </div>"),t+="    </div>",t+="</div>",this._view=a(t),this._manager.getConfig().map_outer_container_element.append(this._view);var i=a("<div></div>");if(a("#sidebar-attribution",this._view).append(i),this._attributionView=new pt(i),e){var n=new _t(this._manager);a("#sidebar-user",this._view).append(n.getView())}var r=new mt(this._manager);a("#sidebar-settings",this._view).append(r.getView());var o=new jt(this._manager);a("#sidebar-constraints",this._view).append(o.getView());const l=new zt(this._manager);a("#sidebar-external-files",this._view).append(l.getView())},_buildControl:function(){this._control=new ht("sidebar")},addTo:function(t){this._control.addTo(t)},getContainer:function(){return this._view[0]},addLayers:function(t){a("#sidebar-layers",this._view).append(t.getContainer())},addAttribution:function(t,e){this._attributionView.addAttribution(t,e)}});const Pt=Tt;var It=[X,Pt,r.Z.Control.Zoom,tt,at,r.Z.Control.Layers,Q,ct,ut,r.Z.Control.Attribution],Et=r.Z.Class.extend({initialize:function(t,e,i,n){this._controlsToHide=[],this._controlsToAdd=[],this._config=t,this._layers=e,this._manager=n,this._addDefaults(),null!=i&&this._addAllTo(i)},_addDefaults:function(){var t={};this._config.use_sidebar&&(this._menuView=new Pt(this._manager),this.addControl(this._menuView),t={position:"topright"}),this._config.show_zoom_control&&this.addControl(new r.Z.Control.Zoom(t)),this._config.show_selection_control&&this.addControl(new Q),this._config.show_search_control&&this.addControl(new at(a.extend({showPopup:!0,provider:new rt({params:{key:_.Z.bingKey}})},t))),(!0===this._config.show_hider_control||"mobile"==this._config.show_hider_control&&h())&&this.addControl(new X(this._controlsToHide,{visibleByDefault:this._config.hider_control_start_visible})),this._config.show_locate_control&&this.addControl(new tt(t)),this._config.show_layers_control&&null!=this._layers&&Object.keys(this._layers).length>1&&this.addControl(new r.Z.Control.Layers(this._layers,null)),this._config.show_position_control&&(h()?this.addControl(new ut):this.addControl(new ct))},addControl:function(t){for(var e=null,i=!1,n=0;n<It.length;n++)if(t instanceof It[n]){null!=this._controlsToAdd[n]&&(console&&console.debug('Overwriting existing control "'+this._controlsToAdd[n]+'" with "'+t+'".'),e=this._controlsToAdd[n]),this._controlsToAdd[n]=t,t instanceof X||this._controlsToHide.push(t),i=!0;break}if(i||(console.error("Unrecognised control: "+t),this._controlsToHide.push(t),this._controlsToAdd[Math.max(It.length,this._controlsToAdd.length)]=t),null!=this._map&&(t.addTo(this._map),null!=e))if(t instanceof W&&e instanceof r.Z.Control.Layers&&this._config.use_sidebar)e.remove(),this._menuView.addLayers(t);else{var s=t._container,o=e._container;a(s).remove(),a(o).replaceWith(s),e.remove()}},_addAllTo:function(t){this._controlsToAdd.forEach(function(e){null!=e&&e.addTo(t)}.bind(this)),this._map=t},addAttribution:function(t,e){this._config.use_sidebar&&this._menuView.addAttribution(t,e)}});const Dt=Et;var Ft=r.Z.Class.extend({initialize:function(t,e){this._authenticated=!1;var i="true"==s.Z.test("testing");this._initializePromise=i?a.Deferred(function(t){a.get({url:_.Z.legacyApiBackendBaseUrl+"isAuthenticated",xhrFields:{withCredentials:!0}}).then(function(e){0==e?this._authenticated=!1:(this._authenticated=!0,this._loggedInUser=e.email),t.resolve()}.bind(this)).fail(function(e,i,n){401!=e.status&&(console.error("Failed to check authentication status - this can be ignored unless trying to record visits: "+i),console.log(n)),this._authenticated=!1,t.resolve()}.bind(this))}.bind(this)).promise():a.Deferred().resolve(),this._initializePromise=this._initializePromise.always(function(){this._map=t,this._config=e,this._layers=V(t,e),this._config.dimensional_layering&&(this._matrixLayerControl=new W(this._layers,null,{},{multiAspects:!0,embeddable:this._config.use_sidebar})),this._controls=new Dt(e,this._layers,t,this)}.bind(this))},waitForInitialization:function(){return this._initializePromise},setViewConstraints:function(t){this._limitFunction=t},getViewConstraints:function(){return this._limitFunction},getControls:function(){return this._controls},getMap:function(){return this._map},getLayers:function(){return this._layers},getConfig:function(){return this._config},getMatrixLayerControl:function(){return this._matrixLayerControl},setAuthenticated:function(t){this._authenticated=t},isAuthenticated:function(){return this._authenticated},shouldManageVisits:function(){return this.isAuthenticated()},getLoggedInUser:function(){return this._loggedInUser}});const Bt=Ft,Nt={getBundleIds:function(t){var e=[];null!=t&&e.push.apply(e,t);var i=s.Z.test("datasources");return null!=i&&i.length>0&&e.push.apply(e,i.split(",")),"true"==s.Z.test("hills")&&e.push("hills"),"true"==s.Z.test("trigs")&&e.push("trigs"),e},loadMap:function(t,e){null==t&&(t={});var i=this.getBundleIds(e);if(this.hasUrlData())throw alert("Loading data from URL is no longer an option."),new Error("Loading data from URL is no longer an option.");if(null!=t.pointsToLoad){var n=t.pointsToLoad.generalPoints;t.cluster=n.length>300,t.dimensional_layering=!1,i=["trigs/config_embedding"]}t=a.extend({cluster:!0,dimensional_layering:!0},t);var s=this._buildMap(t),r=new Bt(s.getMap(),this._config);return r.waitForInitialization().then(function(){return new q(r,this._config).loadSources(i)}.bind(this)).then((function(){return r}))},loadMiniMap:function(){this.loadMap({cluster:!1,dimensional_layering:!1,initial_zoom:10,start_position:[54.454463,-3.213515],show_search_control:!1,show_locate_control:!1,show_hider_control:!0,hider_control_start_visible:!1,map_style:"mini",use_sidebar:!1},["trigs/config_mini"])},_buildMap:function(t){return this._config=new n.Z(t),new S(this._config)},hasUrlData:function(){return null!=s.Z.test("trigs")}}},7714:(t,e,i)=>{"use strict";i.d(e,{Mx:()=>o,hG:()=>r,qF:()=>l});var n=i(7830),s=i(9755),a=i(7742);const r="enableClustering",o="disableClustering",l=n.Z.Class.extend({initialize:function(t){const e=t.getMap();this._view=s('<div class="setting"></div>'),this._clusteringEnabled=s('<input type="checkbox" checked>');var i=s("<label>Clustering enabled?</label>");i.prepend(this._clusteringEnabled);let n=null;this._clusteringEnabled.on("change",(t=>{t.target.checked?(n=null,e.fire(r)):(n=e.getZoom(),e.fire(o))})),e.on(a.ut,(()=>{let t=e.getZoom();null!=n&&t<n&&this._clusteringEnabled.prop("checked",!0).trigger("change")})),this._view.append(i);var l=s("<div>Disable clustering with care! Disabling clustering when there are a large number of markers on screen could slow down or even crash your browser, particularly on mobile devices. Similarly, even if there are not a large number of markers currently visible, you may still have a problem if you disable clustering and then perform an action which brings more markers in to view (e.g. zooming out, adding data sources or simply panning to a location with more markers).</div>");this._view.append(l)},getView:function(){return this._view}})},5857:(t,e,i)=>{"use strict";i.d(e,{Z:()=>r});var n=i(8382),s=i(7830).Z.Class.extend({initialize:function(){this.update()},update:function(){this._params={};var t=n.Z.location.search;t.length>0&&(t=t.substr(1)).split("&").forEach(function(t){var e=t.split("=");this._params[e[0]]=decodeURIComponent(e[1])}.bind(this))},getParams:function(){return this._params},test:function(t){return this._params[t]}}),a=new s;const r={test:function(t){return a.test(t)},tester:s}},4986:(t,e,i)=>{"use strict";i.d(e,{Z:()=>s});var n=i(9050);const s={notEmpty:function(t){return null!=t&&t.length>0},_truncateDisplayString:function(t){return t.length>100?t.substring(0,97)+"...":t},_truncateDisplayArray:function(t){return t.length>10?[...t.slice(0,10),"..."]:t},_buildValue:function(t){return Array.isArray(t)&&2==t.length?'<a href="'+this._truncateDisplayString(t[1])+'">'+t[0]+"</a>":this._truncateDisplayString(t)},_escapeValue:function(t){return Array.isArray(t)?t.map(this._escapeValue.bind(this)):null==t?t:("string"!=typeof t&&(t=JSON.stringify(t)),n.ZP.escape(t))},buildShortDescription:function(t){return Object.keys(t).map((function(e){return t[e]})).filter((function(t){return null!=t&&""!=t})).map((function(t){function e(t){return Array.isArray(t)&&2==t.length?t[0]:t}return Array.isArray(t)?t.map(e).join("/"):e(t)})).join(", ")},buildDescription:function(t){var e="";return t.forEach(function(t){var i=t[0],n=t[1];if(null!=n&&""!=n)if(e.length>0&&(e+="<br />"),e+='<span class="popup-entry-key">'+i+": </span>",Array.isArray(n))if(n.length>1){n=this._truncateDisplayArray(n),e+='<ul class="popup-entry-list">';for(var s=0;s<n.length;s++)e+="<li>"+this._buildValue(n[s])+"</li>";e+="</ul>"}else e+="<span>"+this._buildValue(n[0])+"</span>";else e+="<span>"+this._buildValue(n)+"</span>"}.bind(this)),e},buildPopup:function(t,e,i,s,a,r){var o=n.ZP.escape(e),l=n.ZP.escape(i),c=null;null!=a&&(c=a.map(function(t){var e=t[0],i=t[1];return[n.ZP.escape(e),this._escapeValue(i)]}.bind(this)));var d="<div>";if(this.notEmpty(l)?d='<a href="'+l+'" class="popup-title">'+o+"</a>":this.notEmpty(o)&&(d='<span class="popup-title">'+o+"</span>"),t.shouldManageVisits()&&null!=r&&(d+='<label class="fancy-checkbox" title="Visited?">',d+='    <input type="checkbox"'+(r?" checked":"")+"/>",d+='    <i class="fa fa-check"></i>',d+="</label>"),null!=c&&(d.length>0&&(d+="<br />"),d+=this.buildDescription(c)),null!=s){var u=s[0],h=s[1];d+='<div class="expandable expandable-links">',d+='<input type="checkbox" value="selected" id="links-checkbox" class="expandable-checkbox">',d+='<label for="links-checkbox" class="expandable-checkbox-label"><i class="fa fa-external-link" aria-hidden="true"></i></label>',d+='<div class="expandable-content links">',d+='<a href="'+("https://www.google.com/maps/place/"+u+"+"+h+"/@"+u+","+h+",15z")+'">View on google maps</a>',d+='<br /><a href="'+("https://www.bing.com/maps/?mkt=en-gb&v=2&cp="+u+"~"+h+"&lvl=14&sp=Point."+u+"_"+h+"_"+o)+'">View on bing maps</a>',d+='<br /><a href="'+("https://tools.wmflabs.org/geohack/geohack.php?pagename="+o+"&params="+u+"_N_"+h+"_E_region%3AGB_")+'">View on geohack</a>',d+="</div>",d+="</div>"}return d+="</div>"}}},9846:(t,e,i)=>{"use strict";i.d(e,{Z:()=>r});var n=i(7830),s=i(4986),a=i(9675);const r=n.Z.Class.extend({initialize:function(t,e,i){this._manager=t,this._colour=e,this._initialOutlineWidth=i},_showAsSelected:function(t){t.setStyle&&t.setStyle({weight:3})},_extractName:function(t,e,i){const n=(t,n)=>{let s=e.findIndex((([e,i])=>t.test(e)));if(-1!=s){let t=e[s][1];if(null!=t&&`${t}`.length>0)return n?t=`${i} / ${t}`:e.splice(s,1),t}};let s=null;const a=[/name/,/Name/,/name/i],r=[/ID/i,/OBJECTID/i,/GLOBALID/i];for(let t of a)if(s=n(t,!1),null!=s)break;if(null==s)for(let t of r)if(s=n(t,!0),null!=s)break;null==s&&(s=i),null==t.properties&&(t.properties={}),t.properties.name=s},_buildExtraInfos:function(t){let e=[];null!=t&&(e=Object.entries(t).filter((([t,e])=>null!=e&&`${e}`.length>0)));const i=["sym","_gpxType","coordTimes","coordinateProperties"],n=["SHAPE_"];return e=e.filter((([t,e])=>{return s=t,!i.includes(s)&&!n.some((t=>s.startsWith(t)));var s})).map((([t,e])=>(Array.isArray(e)&&(e=e.map((t=>{let e=Object.entries(t);if(1==e.length&&"href"==e[0][0]){let t=e[0][1];return[t,t]}return JSON.stringify(t)}))),[t,e]))),e},dataToLayers:function(t){return Object.fromEntries(t.map((t=>{const{name:e,url:i,geojson:r,extraInfos:o}=t,l={},c=t=>{let e=t.target;this._showAsSelected(e);let i=e.feature.properties.name;if(i){let t=l[i];null!=e&&t.forEach(this._showAsSelected)}};let d=n.Z.geoJSON(r,{weight:this._initialOutlineWidth,color:this._colour,onEachFeature:(t,n)=>{let a=null!=o?o:this._buildExtraInfos(t.properties);this._extractName(t,a,e);let r=t.properties.name;var d=s.Z.buildPopup(this._manager,r,i,null,a,null);n.bindPopup(d),r in l||(l[r]=[]),l[r].push(n),n.on({click:c})}}),u=(0,a.r)(this._manager.getMap());return u.addLayers(d),this._manager.getMap().on({preclick:()=>{d.resetStyle()}}),[e,u]})))}})},5449:(t,e,i)=>{"use strict";i.d(e,{aS:()=>o,n7:()=>r});var n=i(7830),s=i(5153);function a(t){return"FeatureCollection"!==t.type&&console.log(`incompatible geoJson.type=${t.type}, attempting to parse anyway...`),t.features.map((function(t){var e=null,i=null,s=null,a=null,r=t.geometry;const o=t=>{var n=t[0],r=t[1];(null==e||n<e)&&(e=n),(null==i||n>i)&&(i=n),(null==s||r<s)&&(s=r),(null==a||r>a)&&(a=r)};var l=function(t){t.forEach(o)};"MultiLineString"==r.type||"Polygon"==r.type?r.coordinates.forEach(l):"MultiPolygon"==r.type?r.coordinates.forEach((t=>t.forEach(l))):"Point"==r.type?o(r.coordinates):("LineString"==r.type||"MultiPoint"==r.type||console.log(`Unhandled geometry type: ${r.type}`),l(r.coordinates));var c=[s-.005,e-.01],d=[a+.005,i+.01];return n.Z.latLngBounds(c,d)}))}function r(t){t=t.replace(/<url( [^>]+)?>(.+)<\/url>/g,'<link href="$2"></link>');var e=(new DOMParser).parseFromString(t,"text/xml"),i=(0,s.ng)(e);return{features:i,bounds:a(i)}}function o(t){let e=JSON.parse(t);return{features:e,bounds:a(e)}}},9675:(t,e,i)=>{"use strict";i.d(e,{r:()=>r});const n=i(5732);var s=i(9755),a=i(7714);function r(t,e={}){var i=s("div#map"),r=Math.max(i[0].offsetHeight,i[0].offsetWidth)/10;let o=new n.MarkerClusterGroup({...e,disableClusteringAtZoom:15,maxClusterRadius:r,chunkedLoading:!0});return t.on(a.hG,(()=>{o.enableClustering()})),t.on(a.Mx,(()=>{o.disableClustering()})),o}},7830:(t,e,i)=>{"use strict";i.d(e,{Z:()=>o});var n=i(5243),s=i(6094),a=i(403),r=i(5965);delete n.Icon.Default.prototype._getIconUrl,n.Icon.Default.mergeOptions({iconRetinaUrl:a,iconUrl:s,shadowUrl:r});const o=n}}]);
//# sourceMappingURL=882.6af92ecdd25a25fa36be.js.map