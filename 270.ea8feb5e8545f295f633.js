(self.webpackChunk_tstibbs_geo_bagging_ui=self.webpackChunk_tstibbs_geo_bagging_ui||[]).push([[270],{6651:(t,i,e)=>{"use strict";e.r(i),e.d(i,{default:()=>r});var n=e(8492),s=e(9755),a=e(975);const r=n.Z.Class.extend({initialize:function(t,i,e,n){this._markerList=null,this._manager=t,this._config=t.getConfig(),this._bundleConfig=i,this._bundleName=-1==e.indexOf("/")?e:e.substring(0,e.lastIndexOf("/")),this._urlPrefix=null!=n?n:"",this._visits=[]},_buildDataUrl:function(){return this._urlPrefix+"bundles/"+this._bundleName+"/"+this._bundleConfig.dataToLoad},_doFetchData:function(){var t=this._buildDataUrl(),i=s.ajax({url:t,dataType:"json"}).fail((function(t,i,e){console.error("Failed to load map data: "+i),console.log(e)}));if(this._manager.shouldManageVisits()){var e=s.get({url:a.Z.backendBaseUrl+"listVisits?source="+this._bundleName,dataType:"json",xhrFields:{withCredentials:!0}}).then(function(t){this._visits=t.map(function(t){return t.substring(t.indexOf("-",t.indexOf("-")+1)+1)}.bind(this))}.bind(this)).fail((function(t,i,e){console.error("Failed to load map data: "+i),console.log(e)}));return s.when(i,e).then((function(t){return t[0]}))}return i},fetchMeta:function(){var t=this._buildDataUrl()+".meta";return s.ajax({url:t,dataType:"json"}).fail((function(t,i,e){console.error("Failed to load source metadata: "+i),console.log(e)})).done(function(t){this._meta=t}.bind(this))},getMeta:function(){return this._meta},getVisits:function(){return this._visits},getBundleConfig:function(){return this._bundleConfig}})},1865:(t,i,e)=>{"use strict";e.r(i),e.d(i,{default:()=>r});var n=e(8492),s=e(6651),a=e(2495);const r=s.default.extend({initialize:function(t,i,e,n){s.default.prototype.initialize.call(this,t,i,e,n),this._data=null,this._bundleConfig=i},fetchData:function(t){return this._doFetchData(t).done(function(t){this._data=t}.bind(this))},_parseDatas:function(){return this._data.features.map(function(t){return this.parse(t)}.bind(this))},_translateDatas:function(t){var i={};return t.forEach(function(t){var e=t.name,s=t.url,r=t.geojson,o=t.extraInfos,l=n.Z.geoJSON(r,{onEachFeature:function(t,i){var n=a.Z.buildPopup(this._manager,e,s,null,o,null);i.bindPopup(n)}.bind(this)});i[e]=l}.bind(this)),i},buildLayers:function(){var t=this._parseDatas();return this._translateDatas(t)},getAttribution:function(){return this._bundleConfig.attribution}})},7085:(t,i,e)=>{"use strict";e.r(i),e.d(i,{default:()=>s});var n=e(6651);const s=n.default.extend({initialize:function(t,i,e,s){n.default.prototype.initialize.call(this,t,i,e,s),this._markerList=null,this._bundleConfig=i},fetchData:function(t){return this._doFetchData(t).done(function(t){this.addMarkers(t)}.bind(this))},addMarkers:function(t){for(var i=t.data,e=0;e<i.length;e++)this.parse(i[e]);null!=this._bundleConfig.attribution?this._attributionText=this._bundleConfig.attribution:this._attributionText=t.attribution},addMarker:function(t,i,e,n,s,a,r,o,l){var c={id:t=encodeURIComponent(t),latLng:[parseFloat(i),parseFloat(e)],name:s,extraTexts:a,exportName:s,url:n,icon:r,layerId:l,visited:-1!=this.getVisits().indexOf(t)};if(this._config.dimensional_layering||null==o||0===o.length){if(null==this._markerList&&(this._markerList={}),this._withinConstraints(c)){for(var d=this._markerList,u=0;u<o.length-1;u++){var h=o[u];null==d[h]&&(d[h]={}),d=d[h]}var f=o[o.length-1];null==d[f]&&(d[f]=[]),d[f].push(c)}}else null==this._markerList&&(this._markerList=[]),this._markerList.push(c)},_withinConstraints:function(t){var i=this._manager.getViewConstraints();return null==i||i(t.latLng)},buildImageLinks:function(t){return t.map((function(t,i){return["Image "+(i+1),t]}))},split:function(t,i){return t.split(";").map((function(t){var e=i[t];return null!=e?e:t}))},getMarkerList:function(){return this._markerList},getAttribution:function(){return this._attributionText}})},2981:(t,i,e)=>{var n={"./abstract_bundle_builder.js":[6651],"./abstract_geojson_builder.js":[1865],"./abstract_points_builder.js":[7085],"./coastallandmarks/config.js":[7730,730],"./coastallandmarks/points_builder.js":[8657,657],"./defence/config.js":[5394,394],"./defence/points_builder.js":[7621,621],"./follies/config.js":[8897,897],"./follies/points_builder.js":[8602,602],"./hills/config.js":[3159,159],"./hills/config_all.js":[4544,544],"./hills/points_builder.js":[720,720],"./milestones/config.js":[320,320],"./milestones/points_builder.js":[514,514],"./nationalparks/builder.js":[5658,658],"./nationalparks/config.js":[4673,673],"./nt/config.js":[7368,368],"./nt/points_builder.js":[732,732],"./rnli/config.js":[9974,974],"./rnli/points_builder.js":[3166,166],"./trails/builder.js":[6023,23],"./trails/config.js":[7703,703],"./trigs/config.js":[8494,494],"./trigs/config_base.js":[7154,154],"./trigs/config_embedding.js":[4029,29],"./trigs/config_mini.js":[5769,769],"./trigs/points_builder.js":[4589,589]};function s(t){if(!e.o(n,t))return Promise.resolve().then((()=>{var i=new Error("Cannot find module '"+t+"'");throw i.code="MODULE_NOT_FOUND",i}));var i=n[t],s=i[0];return Promise.all(i.slice(1).map(e.e)).then((()=>e(s)))}s.keys=()=>Object.keys(n),s.id=2981,t.exports=s},6914:(t,i,e)=>{"use strict";e.d(i,{Z:()=>d});var n=e(5243),s=e(9755),a=e(2714),r=e(3300),o=e(942),l=a.Z.location.pathname.split("/").pop(),c={baseUrl:null!=window.geoBaggingBaseUrl?window.geoBaggingBaseUrl:"",remoteData:!1,map_style:"full",cluster:!0,dimensional_layering:!1,initial_zoom:13,start_position:[53.374694,-1.711474],force_config_override:!1,map_element_id:"map",map_outer_container_element:s("body"),page_id:l,show_zoom_control:!0,show_selection_control:!0,show_search_control:!0,show_locate_control:!0,show_layers_control:!0,show_position_control:!0,show_hider_control:"mobile",use_sidebar:!0,hider_control_start_visible:!0,icons:{},dimensionNames:[],dimensionValueLabels:{},defaultLayer:"OS",markerConstraints:null};const d=n.Class.extend({initialize:function(t,i){var e=s.extend({},c,t);if(this._checkForUndefaultedProperties(t,"window config"),e.bundles=i,this._storageId="os_map:"+e.page_id+"config",null==t||!0!==t.force_config_override){var n=this._getSavedConfig();e=s.extend({},e,n)}for(var a in r.Z.test("startPosition")&&(e.start_position=r.Z.test("startPosition").split(",")),r.Z.test("startZoom")&&(e.initial_zoom=r.Z.test("startZoom")),this._buildMarkerConstraints(e),"true"==r.Z.test("remoteData")&&(e.remoteData=!0),e)e.hasOwnProperty(a)&&(this[a]=e[a])},_buildMarkerConstraints:function(t){var i=null;if(null!=r.Z.test("constraints")?i=r.Z.test("constraints"):null!=t.markerConstraints&&"string"==typeof t.markerConstraints&&(i=t.markerConstraints),null!=i){var e=i.split(","),s=null,a=null,l=null,c=null;if(2==e.length){var d=o.Z.gridRefToLngLat(e[0]);a=d[0],s=d[1];var u=o.Z.gridRefToLngLat(e[1]);c=u[0],l=u[1]}else s=parseFloat(e[0]),a=parseFloat(e[1]),l=parseFloat(e[2]),c=parseFloat(e[3]);t.markerConstraints=[[l,a],[s,c]]}null!=t.markerConstraints&&Array.isArray(t.markerConstraints)&&(t.markerConstraints=n.latLngBounds(t.markerConstraints)),null!=t.markerConstraints&&"function"==typeof t.markerConstraints&&(t.markerConstraintsMatcher=t.markerConstraints),null!=t.markerConstraints&&null==t.markerConstraintsMatcher&&(t.markerConstraintsMatcher=function(i){return t.markerConstraints.contains(i.latLng)})},_checkForUndefaultedProperties:function(t,i){for(var e in t)t.hasOwnProperty(e)&&!c.hasOwnProperty(e)&&console.warn('Property "'+e+'" (set from '+i+") should have a default")},_getSavedConfig:function(){if(void 0!==localStorage){var t=localStorage.getItem(this._storageId);return null!=t?JSON.parse(t):null}return null},persist:function(t){if(void 0!==localStorage){var i=this._getSavedConfig();null!=i&&(t=s.extend({},i,t)),localStorage.setItem(this._storageId,JSON.stringify(t))}}})},975:(t,i,e)=>{"use strict";e.d(i,{Z:()=>n});const n={bingKey:"AgYJwt3nv3bZyK31EDXorMaO8aIix-5kAa32O5TTwFAhdVYtZdIKhw3ttntsmgqy",dataSources:["follies","hills","milestones","defence","trails","rnli","nationalparks","coastallandmarks"],backendBaseUrl:"https://niiud546d5.execute-api.eu-west-2.amazonaws.com/prod/"}},942:(t,i,e)=>{"use strict";e.d(i,{Z:()=>a});var n=(0,e(6280).Z)("+proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy +datum=OSGB36 +units=m +no_defs");function s(t,i){for(var e=t.toString();e.length<i;)e="0"+e;return e}const a={latLngToGridRef:function(t,i){var e=10,a=n.forward([i,t]),r=a[0],o=a[1];if(e=void 0===e?10:Number(e),isNaN(e))throw new Error("Invalid precision");var l=Number(Number(r)),c=Number(Number(o));if(isNaN(l)||isNaN(c))throw new Error("Invalid grid reference: "+[t,i]);if(0===e)return s(l,6)+","+s(c,6);var d=Math.floor(l/1e5),u=Math.floor(c/1e5);if(d<0||d>6||u<0||u>12)return"";var h=19-u-(19-u)%5+Math.floor((d+10)/5),f=5*(19-u)%25+d%5;h>7&&h++,f>7&&f++;var p=String.fromCharCode(h+"A".charCodeAt(0),f+"A".charCodeAt(0));return l=Math.floor(l%1e5/Math.pow(10,5-e/2)),c=Math.floor(c%1e5/Math.pow(10,5-e/2)),p+" "+s(l,e/2)+" "+s(c,e/2)},osgbToLngLat:function(t,i){return n.inverse([t,i])},gridRefToOsgb:function(t){t=String(t).trim(),this._determineGridRefType(t);var i=t.match(/^(\d+),\s*(\d+)$/);if(i)return new OsGridRef(i[1],i[2]);if(!(i=t.match(/^[A-Z]{2}\s*[0-9]+\s*[0-9]+$/i)))throw new Error("Invalid grid reference: "+t);var e=t.toUpperCase().charCodeAt(0)-"A".charCodeAt(0),n=t.toUpperCase().charCodeAt(1)-"A".charCodeAt(0);e>7&&e--,n>7&&n--;var s=(e-2)%5*5+n%5,a=19-5*Math.floor(e/5)-Math.floor(n/5),r=t.slice(2).trim().split(/\s+/);if(1==r.length&&(r=[r[0].slice(0,r[0].length/2),r[0].slice(r[0].length/2)]),s>=15&&(s-=25),a>20&&(a-=25),s<-10||a<-5)throw new Error("Invalid grid reference: gridref="+t+", e100km="+s+", n100km="+a);if(2!=r.length)throw new Error("Invalid grid reference: "+t);if(r[0].length!=r[1].length)throw new Error("Invalid grid reference: "+t);return r[0]=(r[0]+"00000").slice(0,5),r[1]=(r[1]+"00000").slice(0,5),[parseInt(s+"00000")+parseInt(r[0]),parseInt(a+"00000")+parseInt(r[1])]},gridRefToLngLat:function(t){var i=this.gridRefToOsgb(t);return n.inverse(i)},_determineGridRefType:function(t){if(/^\w\s*\d{3,}\s*\d{3,}$/.test(t))throw new Error("Irish grid references currently unsupported: "+t)}}},1908:(t,i,e)=>{"use strict";e.d(i,{Z:()=>s});var n=e(9755);const s=function(t,i){if(n("div.full-screen-link").length>0){var e=n('<a href="#">Open in full screen</a>');e.click((function(){var e=i.getZoom(),n=i.getCenter(),s=t.baseUrl+"index.html?datasources=trigs&startPosition="+n.lat+","+n.lng+"&startZoom="+e;window.location.href=s})),n("div.full-screen-link").append(e)}}},2714:(t,i,e)=>{"use strict";e.d(i,{Z:()=>n});const n=window},1270:(t,i,e)=>{"use strict";e.d(i,{Z:()=>pt});var n=e(6914),s=e(3300),a=e(9755),r=e(8492),o=e(1908),l=e(2714),c=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i,d=/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i,u=s.Z.test("mobile");const h=function(){if(u)return!0;var t=l.Z.navigator.userAgent||l.Z.navigator.vendor||l.Z.opera;return c.test(t)||d.test(t.substr(0,4))};const f=r.Z.Class.extend({initialize:function(t){this._config=t,this._createView(),this._map=new r.Z.Map(this._config.map_element_id,{zoomControl:!1}),this._map.setView(new r.Z.LatLng(this._config.start_position[0],this._config.start_position[1]),this._config.initial_zoom),(0,o.Z)(this._config,this._map),this._map.on("zoomend moveend dragend",(function(){this._saveLocation()}),this)},_createView:function(){var t="",i="";"mini"==this._config.map_style||"mini_embedded"==this._config.map_style?i=' class="mini-map"':"full"==this._config.map_style?i=' class="full-screen"':"embedded"==this._config.map_style&&(i=' class="embedded-map"'),"mini"!=this._config.map_style&&"mini_embedded"!=this._config.map_style||(t+='<div class="mini-map">'),t+='<div id="'+this._config.map_element_id+'"'+i+"></div>","mini"==this._config.map_style&&(t+="</div>",t+='<div class="full-screen-link"></div>'),"full"==this._config.map_style&&this._config.map_outer_container_element.addClass("full-screen"),h()&&this._config.map_outer_container_element.addClass("mobile"),this._config.map_outer_container_element.prepend(a(t))},_saveLocation:function(){var t=this._map.getCenter(),i=[t.lat,t.lng],e=this._map.getZoom();if(void 0!==localStorage){var n={start_position:i,initial_zoom:e};this._config.persist(n)}},getMap:function(){return this._map}});var p=e(975),_=e(7963),g=e(5243);const m=e(5732);const b=e(3750);var v=e(2495);const w=function(t,i,e,n){var s=t.latLng,o=t.name,l=t.extraTexts,c=t.exportName,d=t.icon,u=t.url,h=t.visited;v.Z.notEmpty(o)||(o=u),v.Z.notEmpty(c)&&(c=o);var f=v.Z.buildPopup(n,o,u,s,l,h),g={};null!=i.icons&&null!=i.icons[d]?g.icon=i.icons[d]:null!=i.defaultIcon&&(g.icon=i.defaultIcon),g.layerId=t.layerId;var m=r.Z.marker(s,g),b=a("<div>"+f+"</div>");n.shouldManageVisits()&&a("input",b).change((function(){var i="";i=this.checked?"recordVisit":"removeVisit",a.post({url:p.Z.backendBaseUrl+i,data:JSON.stringify({source:e,name:t.id}),contentType:"application/json",xhrFields:{withCredentials:!0}}).catch((function(t,i,e){401==t.status?console.log("Authentication required"):console.log("Request failed: "+t.status+", "+i+", "+e)}))})),m.bindPopup(b[0]),c=_.ZP.escape(t.exportName);var w=null,y=null;return null!=l&&(w=_.ZP.escape(v.Z.buildShortDescription(l)),y=_.ZP.escape(v.Z.buildDescription(l))),m.exportData={name:c,link:u,cmt:w,desc:y},m};const y=g.Class.extend({initialize:function(t,i,e,n,s,a,r){this._map=t,this._config=i,this._modelsByAspect=e,this._matrixLayerControl=n,this._controls=s,this._bundles=a,this._parentGroup=null,this._manager=r},_translateMarkerGroup:function(t,i,e){if(null!=t)if(t.constructor===Array)t.forEach((function(t,n,s){s[n]=w(t,i,e,this._manager)}),this);else for(var n in t)t[n]=this._translateMarkerGroup(t[n],i,e);return t},finish:function(t){var i=a.Deferred();if(this._config.cluster){var e=a("div#map"),n=Math.max(e[0].offsetHeight,e[0].offsetWidth)/10;this._parentGroup=new m.MarkerClusterGroup({disableClusteringAtZoom:15,maxClusterRadius:n,chunkedLoading:!0,chunkProgress:function(t,e,n,s){t===e&&i.resolve()}})}else this._parentGroup=g.layerGroup(),i.resolve();if(this._parentGroup.addTo(this._map),this._config.dimensional_layering)for(var s in this._modelsByAspect){var r=this._modelsByAspect[s];this.addClusteredModel(s,r)}else{var o=Object.keys(this._modelsByAspect).map(function(t){var i=this._modelsByAspect[t];return this._translateMarkerGroup(i.getMarkerList(),i.getBundleConfig(),t)}.bind(this)).filter((function(t){return null!=t})),l=[].concat.apply([],o);if(this._config.cluster){var c="null",d=l.reduce((function(t,i){var e=i.options.layerId;return null==t[e=null==e?c:e]&&(t[e]=[]),t[e].push(i),t}),{});this._parentGroup.addLayers(d.null),Object.keys(d).filter((function(t){return t!==c})).forEach(function(t){for(var i=d[t],e=g.layerGroup(),n=0;n<i.length;n++)e.addLayer(i[n]);e.addTo(this._map)}.bind(this))}else for(var u=0;u<l.length;u++)this._parentGroup.addLayer(l[u])}return i.promise()},addClusteredModel:function(t,i){if(null!=i.getMarkerList()){var e=this._translateMarkerGroup(i.getMarkerList(),i.getBundleConfig(),t),n={};this.depthFirstIteration(e,"",n);var s=this._bundles[t];this._matrixLayerControl.addAspect(t,n,s)}},depthFirstIteration:function(t,i,e){if(t.constructor===Array){var n=new b(this._parentGroup,t);e[i]=n}else Object.keys(t).forEach(function(n){var s=0===i.length?n:i+"/"+n,a=t[n];this.depthFirstIteration(a,s,e)}.bind(this))}});const k=r.Z.Class.extend({initialize:function(t,i,e,n,s){this._map=t,this._config=i,this._modelsByAspect=e,this._matrixLayerControl=n,this._bundles=s},finish:function(t){if(!this._config.dimensional_layering&&Object.keys(this._modelsByAspect).length>0)throw new Error("!dimensional_layering is not supported yet.");r.Z.layerGroup(),Object.keys(this._modelsByAspect).forEach(function(t){var i=this._modelsByAspect[t];this.addClusteredModel(t,i)}.bind(this));return a.Deferred().resolve().promise()},addClusteredModel:function(t,i){var e=this._bundles[t],n=i.buildLayers();Object.values(n).forEach(function(t){t.addTo(this._map)}.bind(this)),this._matrixLayerControl.addAspect(t,n,e)}});var C=e(7085),x=e(1865);const Z=e(1143);const L=r.Z.Class.extend({initialize:function(){this._tester=new s.Z.tester},sourceLoaded:function(t){this._tester.update();var i=this._tester.getParams(),e=i.datasources;e=null==e?"":e,delete i.datasources,e=e.length>0?e+","+t:t;var n=Object.keys(i).map((function(t){return t+"="+i[t]})).join("&");n=(n.length>0?n+"&":"")+"datasources="+e;document.location.origin,document.location.pathname}});const A=r.Z.Class.extend({initialize:function(t,i){this._bundles=t,this._manager=i,this._controls=i.getControls(),this._matrixLayerControl=null,this._urlHandler=new L},_filterModels:function(t,i){var e={};return Object.keys(t).filter((function(e){return t[e]instanceof i})).forEach((function(i){e[i]=t[i]})),e},_addLazyModels:function(t,i){Object.keys(t).forEach(function(e){var n=t[e],s=function(){n.fetchData().done(function(){i(e,n),this._addAttribution(e,n),this._urlHandler.sourceLoaded(e)}.bind(this))}.bind(this),a=n.getMeta(),r=a.recordCount+" items (last updated "+a.lastUpdated+")",o=this._bundles[e];this._matrixLayerControl.addLazyAspect(e,o,{description:r,callback:s})}.bind(this))},_addAttribution:function(t,i){var e=i.getAttribution();if(null!=e&&e.length>0){var n=i.getBundleConfig().aspectLabel;this._controls.addAttribution(n,e)}},loadModelViews:function(t,i,e,n){var s=this._filterModels(t,C.default),r=this._filterModels(t,x.default),o=this._filterModels(i,C.default),l=this._filterModels(i,x.default);e.dimensional_layering&&(this._matrixLayerControl=new Z(this._manager.getLayers(),null,{},{multiAspects:!0,embeddable:e.use_sidebar}));var c=new y(this._manager.getMap(),e,s,this._matrixLayerControl,this._controls,this._bundles,this._manager),d=new k(this._manager.getMap(),e,r,this._matrixLayerControl,this._bundles),u=[c.finish(),d.finish()];e.dimensional_layering&&(this._addLazyModels(o,(function(t,i){c.addClusteredModel(t,i)})),this._addLazyModels(l,(function(t,i){d.addClusteredModel(t,i)}))),a.when.apply(a,u).always(function(){e.dimensional_layering&&this._controls.addControl(this._matrixLayerControl),Object.keys(t).forEach(function(i){var e=t[i];this._addAttribution(i,e)}.bind(this)),n()}.bind(this))}});const M=r.Z.Class.extend({initialize:function(t,i){this._manager=t,this._config=i},loadSources:function(t){var i=s.Z.test("extra-datasources"),n=null!=i&&i.length>0?i.split(","):[],r=a.uniqueSort(t.concat(p.Z.dataSources,n)),o=this._sourceIdsToDataSources(r),l=a.Deferred(),c={};let d=o.map((t=>e(2981)("./"+t+".js")));return Promise.all(d).then((i=>{i.forEach(((t,i)=>{"function"==typeof(t=t.default)&&(t=t(this._config)),c[o[i]]=t}));var e=this._config.remoteData?"https://cdn.jsdelivr.net/gh/tstibbs/geo-bagging@gh-pages":this._config.baseUrl,n={},s={},r=Object.keys(c).map(function(i){var r=c[i],o=new r.parser(this._manager,r,i,e),l=o.fetchMeta();if(-1!=t.indexOf(i)){var d=o.fetchData();return n[i]=o,a.when(l,d)}return s[i]=o,l}.bind(this));a.when.apply(a,r).always(function(){new A(c,this._manager).loadModelViews(n,s,this._config,this._finish),l.resolve()}.bind(this)),setTimeout((()=>{this._finish(),l.resolve()}),1)})),l.promise()},_sourceIdsToDataSources:function(t){return t=null!=t?t.map((function(t){return-1==t.indexOf("/")?t+"/config":t})):[]},_finish:function(){a("div#loading-message-pane").hide()}});const T=e(8486).Z;var V=e(6937),j=e(4358);const z=V.extend({options:{actions:{gpx:{display:"Export to GPX file",action:j((function(){var t=new Date;return"geoPoints_"+(t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()+"_"+t.getHours()+"-"+t.getMinutes()+"-"+t.getSeconds())+".gpx"}))}}}});const O=e(687).extend({options:{keepCurrentZoomLevel:!0,setView:"once"}});var I=e(2524),P=e(4623);const D=e(5516).Z;var S=e(942);const E=D.extend({options:{formatter:function(t,i){return S.Z.latLngToGridRef(i,t)}}});const F=e(6058).Z;const B=F.extend({options:{onMove:!0,icon:!0,latLngFormatter:function(t,i){return S.Z.latLngToGridRef(t,i)}},addTo:function(t){F.prototype.addTo.call(this,t),this._addShowHideHandling()},_addShowHideHandling:function(){var t=a("div.leaflet-control-mapcentercoord-icon.leaflet-zoom-hide"),i=!1;function e(){t.css("visibility","hidden"),i=!1}a("div.leaflet-control-mapcentercoord.leaflet-control").click((function(){i?e():(t.css("visibility","visible"),i=!0)})),e()}});const U=e(136).Z;const N=r.Z.Class.extend({initialize:function(t){this._container=t;let i=a('<div class="attribution-entry"></div>\n\t<span class="attribution-source">Geo-bagging</span>\n\t<span>\n\t\tThe code on this site is copyright \n\t\t<a href="https://github.com/tstibbs">tstibbs</a>/stripycoder, \n\t\tlicenced under AGPL, \n\t\tsource code available at \n\t\t<a href="https://github.com/tstibbs/geo-bagging">here</a>.\n\t</span>\n\t<br />\n\t<span>\n\t\tMany open source libraries help make this project, see a full list in <a href="licenses.txt">licenses.txt</a>.\n\t</span>\n</div>');this._container.append(i)},addAttribution:function(t,i){let e=a(`<div class="attribution-entry">\n\t<span class="attribution-source">${t} data</span>\n\t<span>${i}</span>\n</div>`);this._container.append(e)}});const G=r.Z.Class.extend({initialize:function(t){this._view=a('<div class="setting"></div>'),t.isAuthenticated()?this._view.append(a("<span>Logged in as "+t.getLoggedInUser()+"</span>")):this._view.append(a('<a href="'+p.Z.backendBaseUrl+'login">Click here to log in</a>'))},getView:function(){return this._view}});var R=e(7520);const H=r.Z.Class.extend({initialize:function(t){this._manager=t,this._colour="#FF0000",this._layers=[]},showTracks:function(t){this._layers.forEach((function(t){t.remove()})),this._layers=t.map(function(t){let i=r.Z.geoJSON(t,{color:this._colour,onEachFeature:function(t,i){t.properties&&t.properties.name&&i.bindPopup(t.properties.name)}});return i.addTo(this._manager.getMap()),i}.bind(this))}});const q=r.Z.Class.extend({initialize:function(t,i){this._constraintsView=i,this._tracksView=new H(t),this._view=a('<div class="setting"></div>'),this._view.append(a("<span>Upload GPX tracks to see markers around those tracks:</span>")),this._fileInput=a('<input type="file" multiple>'),this._view.append(this._fileInput),this._fileInput.on("change",this._readFiles.bind(this))},_readFiles:function(){for(var t=[],i=this._fileInput[0].files,e=0;e<i.length;e++)(function(e){var n=new FileReader;n.onload=function(e){var s=this._loadTrack(n.result);t.push(s),t.length==i.length&&this._finishedReadingFiles(t)}.bind(this),n.readAsText(e)}).bind(this)(i.item(e))},_finishedReadingFiles:function(t){var i=t.map((function(t){return t.bounds})),e=t.map((function(t){return t.features}));this._constraintsView.limitTo(this,i),this._tracksView.showTracks(e)},_loadTrack:function(t){var i=(new DOMParser).parseFromString(t,"text/xml"),e=(0,R.gpx)(i);return{features:e,bounds:this._geoJsonBounds(e)}},_geoJsonBounds:function(t){var i,e,n,s;t.features.forEach((function(t){var a=t.geometry,r=function(t){t.forEach((function(t){var a=t[0],r=t[1];(null==i||a<i)&&(i=a),(null==e||a>e)&&(e=a),(null==n||r<n)&&(n=r),(null==s||r>s)&&(s=r)}))};"MultiLineString"==a.type?a.coordinates.forEach(r):r(a.coordinates)}));var a=[n-.005,i-.01],o=[s+.005,e+.01];return r.Z.latLngBounds(a,o)},getView:function(){return this._view},reset:function(){this._fileInput.val(""),this._tracksView.showTracks([])}});const J=r.Z.Class.extend({initialize:function(t,i){this._manager=t,this._constraintsView=i,this._view=a('<div class="setting"></div>');var e=a('<button type="button">Limit to 5 miles from current location</button>');e.click(this._limitToCurrentLocation.bind(this)),this._view.append(e)},_limitToCurrentLocation:function(){var t=this._manager.getMap(),i=function(e){t.off("locationfound",i);var n=e.latlng.lat,s=e.latlng.lng,a=new r.Z.latLngBounds([n+.08,s+.12],[n-.08,s-.12]);this._constraintsView.limitTo(this,a)}.bind(this);t.on("locationfound",i),t.stopLocate(),t.locate()},getView:function(){return this._view},reset:function(){}});const K=r.Z.Class.extend({initialize:function(t,i){this._manager=t,this._constraintsView=i,this._view=a('<div class="setting"></div>'),this._currentAreaLimit=a('<input type="checkbox">');var e=a("<label>Limit new markers to current area</label>");e.prepend(this._currentAreaLimit),this._currentAreaLimit.change(function(t){t.target.checked?this._constraintsView.limitTo(this,this._manager.getMap().getBounds()):this._constraintsView.unlimit()}.bind(this)),this._view.append(e)},getView:function(){return this._view},reset:function(){this._currentAreaLimit.prop("checked",!1)}});var W=e(5243);const $=r.Z.Class.extend({initialize:function(t){this._manager=t,this._limitOriginView=null,this._view=a("<div></div>");var i=a('<div class="info">This section allows you to limit how much data is displayed on screen. This can be useful for example when on older or mobile devices which may struggle to remain responsive if a large amount of data is loaded.</div>');this._view.append(i),this._view.append('<hr class="info">');var e=new K(t,this);this._view.append(e.getView());var n=new J(t,this);this._view.append(n.getView()),this._fileConstraintsLoadView=new q(t,this),this._view.append(this._fileConstraintsLoadView.getView());var s=this._buildReset();this._view.append(s)},_buildReset:function(){var t=a('<div class="setting"></div>'),i=a('<button type="button">Reset</button>');return i.click(this.unlimit.bind(this)),t.append(i),t},limitTo:function(t,i){this.unlimit(),this._limitOriginView=t,this._manager.setViewConstraints(this._buildLimitFunction(i)),null!=this._constraintPolygon&&this._constraintPolygon.remove();var e=[[[-90,-180],[90,-180],[90,180],[-90,180]]];Array.isArray(i)||(i=[i]),i.forEach((function(t){e.push([t.getSouthWest(),t.getNorthWest(),t.getNorthEast(),t.getSouthEast()])})),this._constraintPolygon=new W.Polygon(e,{color:"rgb(0, 0, 0, 0)",fillColor:"rgb(90, 90, 90)",fillOpacity:.3}),this._constraintPolygon.addTo(this._manager.getMap())},_buildLimitFunction:function(t){return Array.isArray(t)?function(i){for(var e=0;e<t.length;e++)if(t[e].contains(i))return!0;return!1}:function(i){return t.contains(i)}},unlimit:function(){null!=this._limitOriginView&&(this._limitOriginView.reset(),this._limitOriginView=null),this._manager.setViewConstraints(null),null!=this._constraintPolygon&&this._constraintPolygon.remove()},getView:function(){return this._view}});const X=r.Z.Class.extend({initialize:function(t){this._manager=t,this._buildView(),this._buildControl()},_buildView:function(){var t="",i="true"==s.Z.test("testing");t+='<div id="sidebar" class="'+["sidebar","collapsed","leaflet-container"].join(" ")+'">',t+='    <div class="sidebar-tabs">',t+='        <ul role="tablist">',t+='            <li><a href="#sidebar-layers" role="tab"><i class="fa fa-bars"></i></a></li>',t+='            <li><a href="#sidebar-constraints" role="tab"><i class="fa fa-map-o"></i></a></li>',t+="        </ul>",t+='        <ul role="tablist">',i&&(t+='            <li><a href="#sidebar-user" role="tab"><i class="fa fa-user"></i></a></li>'),t+='            <li><a href="#sidebar-attribution" role="tab"><i class="fa fa-copyright"></i></a></li>',t+="        </ul>",t+="    </div>",t+='    <div class="sidebar-content">',t+='        <div id="sidebar-layers" class="sidebar-pane">',t+='            <h1 class="sidebar-header">Layers<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>',t+="        </div>",t+='        <div id="sidebar-constraints" class="sidebar-pane">',t+='            <h1 class="sidebar-header">Data Limits<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>',t+="        </div>",t+='        <div id="sidebar-attribution" class="sidebar-pane">',t+='            <h1 class="sidebar-header">Attribution<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>',t+="        </div>",i&&(t+='        <div id="sidebar-user" class="sidebar-pane">',t+='            <h1 class="sidebar-header">User Settings<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>',t+="        </div>"),t+="    </div>",t+="</div>",this._view=a(t),this._manager.getConfig().map_outer_container_element.append(this._view);var e=a("<div></div>");if(a("#sidebar-attribution",this._view).append(e),this._attributionView=new N(e),i){var n=new G(this._manager);a("#sidebar-user",this._view).append(n.getView())}var r=new $(this._manager);a("#sidebar-constraints",this._view).append(r.getView())},_buildControl:function(){this._control=new U("sidebar")},addTo:function(t){this._control.addTo(t)},getContainer:function(){return this._view[0]},addLayers:function(t){a("#sidebar-layers",this._view).append(t.getContainer())},addAttribution:function(t,i){this._attributionView.addAttribution(t,i)}});var Y=[T,X,r.Z.Control.Zoom,O,I.Z,r.Z.Control.Layers,z,E,B,r.Z.Control.Attribution];const Q=r.Z.Class.extend({initialize:function(t,i,e,n){this._controlsToHide=[],this._controlsToAdd=[],this._config=t,this._layers=i,this._manager=n,this._addDefaults(),null!=e&&this._addAllTo(e)},_addDefaults:function(){var t={};this._config.use_sidebar&&(this._menuView=new X(this._manager),this.addControl(this._menuView),t={position:"topright"}),this._config.show_zoom_control&&this.addControl(new r.Z.Control.Zoom(t)),this._config.show_selection_control&&this.addControl(new z),this._config.show_search_control&&this.addControl(new I.Z(a.extend({showPopup:!0,provider:new P.Z({key:p.Z.bingKey})},t))),(!0===this._config.show_hider_control||"mobile"==this._config.show_hider_control&&h())&&this.addControl(new T(this._controlsToHide,{visibleByDefault:this._config.hider_control_start_visible})),this._config.show_locate_control&&this.addControl(new O(t)),this._config.show_layers_control&&null!=this._layers&&Object.keys(this._layers).length>1&&this.addControl(new r.Z.Control.Layers(this._layers,null)),this._config.show_position_control&&(h()?this.addControl(new B):this.addControl(new E))},addControl:function(t){for(var i=null,e=!1,n=0;n<Y.length;n++)if(t instanceof Y[n]){null!=this._controlsToAdd[n]&&(console&&console.debug('Overwriting existing control "'+this._controlsToAdd[n]+'" with "'+t+'".'),i=this._controlsToAdd[n]),this._controlsToAdd[n]=t,t instanceof T||this._controlsToHide.push(t),e=!0;break}if(e||(console.error("Unrecognised control: "+t),this._controlsToHide.push(t),this._controlsToAdd[Math.max(Y.length,this._controlsToAdd.length)]=t),null!=this._map&&(t.addTo(this._map),null!=i))if(t instanceof Z&&i instanceof r.Z.Control.Layers&&this._config.use_sidebar)i.remove(),this._menuView.addLayers(t);else{var s=t._container,o=i._container;a(s).remove(),a(o).replaceWith(s),i.remove()}},_addAllTo:function(t){this._controlsToAdd.forEach(function(i){null!=i&&i.addTo(t)}.bind(this)),this._map=t},addAttribution:function(t,i){this._config.use_sidebar&&this._menuView.addAttribution(t,i)}});const tt=e(7654).Z;var it={key:p.Z.bingKey},et=r.Z.extend({maxZoom:18,minZoom:0,detectRetina:!0},it),nt=new tt(r.Z.extend({imagerySet:"OrdnanceSurvey",minZoom:12,maxZoom:18,maxNativeZoom:17},it)),st=new tt(r.Z.extend({imagerySet:"RoadOnDemand",maxZoom:11,minZoom:0},it)),at=r.Z.layerGroup([nt,st]),rt=new tt(r.Z.extend({imagerySet:"RoadOnDemand"},et)),ot=new tt(r.Z.extend({imagerySet:"AerialWithLabelsOnDemand"},et)),lt=new tt(r.Z.extend({imagerySet:"Aerial"},et)),ct=new r.Z.TileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{minZoom:0,maxZoom:19,attribution:'Map data © <a href="http://openstreetmap.org">OpenStreetMap</a> contributors'}),dt={OS:at,"Bing Roads":rt,"Bing Satellite":lt,"Bing Hybrid":ot,OSM:ct};function ut(t,i,e){i.on("add",function(){e.persist({defaultLayer:t})}.bind(this))}const ht=function(t,i){var e=dt[i.defaultLayer];for(var n in null!=e?e.addTo(t):at.addTo(t),dt)ut(n,dt[n],i);return dt};const ft=r.Z.Class.extend({initialize:function(t,i){this._authenticated=!1;var e="true"==s.Z.test("testing");this._initializePromise=e?a.Deferred(function(t){a.get({url:p.Z.backendBaseUrl+"isAuthenticated",xhrFields:{withCredentials:!0}}).then(function(i){0==i?this._authenticated=!1:(this._authenticated=!0,this._loggedInUser=i.email),t.resolve()}.bind(this)).fail(function(i,e,n){401!=i.status&&(console.error("Failed to check authentication status - this can be ignored unless trying to record visits: "+e),console.log(n)),this._authenticated=!1,t.resolve()}.bind(this))}.bind(this)).promise():a.Deferred().resolve(),this._initializePromise=this._initializePromise.always(function(){this._map=t,this._config=i,this._layers=ht(t,i),this._controls=new Q(i,this._layers,t,this)}.bind(this))},waitForInitialization:function(){return this._initializePromise},setViewConstraints:function(t){this._limitFunction=t},getViewConstraints:function(){return this._limitFunction},getControls:function(){return this._controls},getMap:function(){return this._map},getLayers:function(){return this._layers},getConfig:function(){return this._config},setAuthenticated:function(t){this._authenticated=t},isAuthenticated:function(){return this._authenticated},shouldManageVisits:function(){return this.isAuthenticated()},getLoggedInUser:function(){return this._loggedInUser}}),pt={getBundleIds:function(t){var i=[];null!=t&&i.push.apply(i,t);var e=s.Z.test("datasources");return null!=e&&e.length>0&&i.push.apply(i,e.split(",")),"true"==s.Z.test("hills")&&i.push("hills"),"true"==s.Z.test("trigs")&&i.push("trigs"),i},loadMap:function(t,i){null==t&&(t={});var e=this.getBundleIds(i);if(this.hasUrlData())throw alert("Loading data from URL is no longer an option."),new Error("Loading data from URL is no longer an option.");if(null!=t.pointsToLoad){var n=t.pointsToLoad.generalPoints;t.cluster=n.length>300,t.dimensional_layering=!1,e=["trigs/config_embedding"]}t=a.extend({cluster:!0,dimensional_layering:!0},t);var s=this._buildMap(t),r=new ft(s.getMap(),this._config);return r.waitForInitialization().then(function(){return new M(r,this._config).loadSources(e)}.bind(this)).then((function(){return r}))},loadMiniMap:function(){this.loadMap({cluster:!1,dimensional_layering:!1,initial_zoom:10,start_position:[54.454463,-3.213515],show_search_control:!1,show_locate_control:!1,show_hider_control:!0,hider_control_start_visible:!1,map_style:"mini",use_sidebar:!1},["trigs/config_mini"])},_buildMap:function(t){return this._config=new n.Z(t),new f(this._config)},hasUrlData:function(){return null!=s.Z.test("trigs")}}},3300:(t,i,e)=>{"use strict";e.d(i,{Z:()=>r});var n=e(2714),s=e(8492).Z.Class.extend({initialize:function(){this.update()},update:function(){this._params={};var t=n.Z.location.search;t.length>0&&(t=t.substr(1)).split("&").forEach(function(t){var i=t.split("=");this._params[i[0]]=decodeURIComponent(i[1])}.bind(this))},getParams:function(){return this._params},test:function(t){return this._params[t]}}),a=new s;const r={test:function(t){return a.test(t)},tester:s}},2495:(t,i,e)=>{"use strict";e.d(i,{Z:()=>s});var n=e(7963);const s={notEmpty:function(t){return null!=t&&t.length>0},_buildValue:function(t){return Array.isArray(t)&&2==t.length?'<a href="'+t[1]+'">'+t[0]+"</a>":t},_escapeValue:function(t){return Array.isArray(t)?t.map(this._escapeValue.bind(this)):n.ZP.escape(t)},buildShortDescription:function(t){return Object.keys(t).map((function(i){return t[i]})).filter((function(t){return null!=t&&""!=t})).map((function(t){function i(t){return Array.isArray(t)&&2==t.length?t[0]:t}return Array.isArray(t)?t.map(i).join("/"):i(t)})).join(", ")},buildDescription:function(t){var i="";return t.forEach(function(t){var e=t[0],n=t[1];if(null!=n&&""!=n)if(i.length>0&&(i+="<br />"),i+='<span class="popup-entry-key">'+e+": </span>",Array.isArray(n))if(n.length>1){i+='<ul class="popup-entry-list">';for(var s=0;s<n.length;s++)i+="<li>"+this._buildValue(n[s])+"</li>";i+="</ul>"}else i+="<span>"+this._buildValue(n[0])+"</span>";else i+="<span>"+this._buildValue(n)+"</span>"}.bind(this)),i},buildPopup:function(t,i,e,s,a,r){var o=n.ZP.escape(i),l=n.ZP.escape(e),c=null;null!=a&&(c=a.map(function(t){var i=t[0],e=t[1];return[n.ZP.escape(i),this._escapeValue(e)]}.bind(this)));var d="<div>";if(this.notEmpty(l)?d='<a href="'+l+'" class="popup-title">'+o+"</a>":this.notEmpty(o)&&(d='<span class="popup-title">'+o+"</span>"),t.shouldManageVisits()&&null!=r&&(d+='<label class="fancy-checkbox" title="Visited?">',d+='    <input type="checkbox"'+(r?" checked":"")+"/>",d+='    <i class="fa fa-check"></i>',d+="</label>"),null!=c&&(d.length>0&&(d+="<br />"),d+=this.buildDescription(c)),null!=s){var u=s[0],h=s[1];d+='<div class="expandable expandable-links">',d+='<input type="checkbox" value="selected" id="links-checkbox" class="expandable-checkbox">',d+='<label for="links-checkbox" class="expandable-checkbox-label"><i class="fa fa-external-link" aria-hidden="true"></i></label>',d+='<div class="expandable-content links">',d+='<a href="'+("https://www.google.com/maps/place/"+u+"+"+h+"/@"+u+","+h+",15z")+'">View on google maps</a>',d+='<br /><a href="'+("https://www.bing.com/maps/?mkt=en-gb&v=2&cp="+u+"~"+h+"&lvl=14&sp=Point."+u+"_"+h+"_"+o)+'">View on bing maps</a>',d+='<br /><a href="'+("https://tools.wmflabs.org/geohack/geohack.php?pagename="+o+"&params="+u+"_N_"+h+"_E_region%3AGB_")+'">View on geohack</a>',d+="</div>",d+="</div>"}return d+="</div>"}}},8492:(t,i,e)=>{"use strict";e.d(i,{Z:()=>l});var n=e(5243),s=e(6713),a=e(2662),r=e(1309);delete n.Icon.Default.prototype._getIconUrl;var o=null!=window.geoBaggingBaseUrl?window.geoBaggingBaseUrl:"";n.Icon.Default.mergeOptions({iconRetinaUrl:o+a,iconUrl:o+s,shadowUrl:o+r});const l=n}}]);
//# sourceMappingURL=270.ea8feb5e8545f295f633.js.map