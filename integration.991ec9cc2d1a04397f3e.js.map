{"version":3,"sources":["webpack:///./src/js/integration/tuk.js","webpack:///./src/js/entry/integration.js"],"names":["showMap","test","window","location","href","this","embedSingleMap","showMapForSearch","alert","getPointsFromSearch","search","points","options","pointsToLoad","generalPoints","force_config_override","use_sidebar","empty","loadMap","done","manager","forEach","point","eastings","northings","minEastings","maxEastings","minNorthings","maxNorthings","bottomLeft","conversion","osgbToLngLat","topRight","getMap","fitBounds","centreGridRef","text","lngLat","gridRefToLngLat","lng","lat","searchUrl","attr","ajax","res","status","xhr","suffix","parseHTML","find","split","mapDiv","parent","id","pathname","pop","exec","significantPoint","filter","map_style","cluster","hider_control_start_visible","show_hider_control","start_position","map_outer_container_element","initial_zoom","bind","callback","get","data","textStatus","jqXHR","regex","allText","parseInt","confirm","decodedXmlString","decodeURIComponent","parseXML","map","i","element","url","name","toArray"],"mappings":"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","file":"integration.991ec9cc2d1a04397f3e.js","sourcesContent":["import $ from 'jquery'\nimport conversion from '../conversion'\nimport mapLoader from '../map_loader'\n\nexport default {\n\tshowMap: function () {\n\t\tif (/^https?:\\/\\/trigpointing\\.uk\\/trig\\/\\d+/.test(window.location.href)) {\n\t\t\t//e.g. http://trigpointing.uk/trig/2614 - single trig page\n\t\t\tthis.embedSingleMap()\n\t\t} else if (/^https?:\\/\\/trigpointing\\.uk\\/trigs\\/view-trigs\\.php.*/.test(window.location.href)) {\n\t\t\t//e.g. http://trigpointing.uk/trigs/view-trigs.php?q=2168478 - detailed search page\n\t\t\tthis.showMapForSearch()\n\t\t} else if (/^https?:\\/\\/trigpointing\\.uk\\/trigtools\\/find.php.*/.test(window.location.href)) {\n\t\t\t//e.g. http://trigpointing.uk/trigtools/find.php?t=milton - 'quick search' page (not supported)\n\t\t\talert(\n\t\t\t\t\"Map display not supported on this page, please use the 'detailed search' page instead: http://trigpointing.uk/trigs/\"\n\t\t\t)\n\t\t} else {\n\t\t\talert('Map display not supported on this page.')\n\t\t}\n\t},\n\n\tshowMapForSearch: function () {\n\t\tthis.getPointsFromSearch(window.location.search, function (points) {\n\t\t\tvar options = {\n\t\t\t\tpointsToLoad: {\n\t\t\t\t\tgeneralPoints: points\n\t\t\t\t},\n\t\t\t\tforce_config_override: true,\n\t\t\t\tuse_sidebar: false\n\t\t\t}\n\n\t\t\t$('body').empty() //our map assumes it is full screen - there's probably a better way, but this will work for now\n\t\t\tvar osMapPromise = mapLoader.loadMap(options)\n\t\t\tosMapPromise.done(function (manager) {\n\t\t\t\t//now get the map showing everything\n\t\t\t\tvar minEastings\n\t\t\t\tvar maxEastings\n\t\t\t\tvar minNorthings\n\t\t\t\tvar maxNorthings\n\n\t\t\t\tvar latLngs = points.forEach(function (point) {\n\t\t\t\t\tvar eastings = point.eastings\n\t\t\t\t\tvar northings = point.northings\n\t\t\t\t\tif (minEastings == null || eastings < minEastings) {\n\t\t\t\t\t\tminEastings = eastings\n\t\t\t\t\t}\n\t\t\t\t\tif (maxEastings == null || eastings > maxEastings) {\n\t\t\t\t\t\tmaxEastings = eastings\n\t\t\t\t\t}\n\t\t\t\t\tif (minNorthings == null || northings < minNorthings) {\n\t\t\t\t\t\tminNorthings = northings\n\t\t\t\t\t}\n\t\t\t\t\tif (maxNorthings == null || northings > maxNorthings) {\n\t\t\t\t\t\tmaxNorthings = northings\n\t\t\t\t\t}\n\t\t\t\t})\n\n\t\t\t\tvar bottomLeft = conversion.osgbToLngLat(minEastings, minNorthings)\n\t\t\t\tvar topRight = conversion.osgbToLngLat(maxEastings, maxNorthings)\n\t\t\t\tmanager.getMap().fitBounds([\n\t\t\t\t\t[bottomLeft[1], bottomLeft[0]],\n\t\t\t\t\t[topRight[1], topRight[0]]\n\t\t\t\t])\n\t\t\t})\n\t\t})\n\t},\n\n\tembedSingleMap: function () {\n\t\tvar centreGridRef = $(\"div:contains('Grid reference : '):not(:has(*)) + div a\").text()\n\t\tvar lngLat = conversion.gridRefToLngLat(centreGridRef)\n\t\tvar lng = lngLat[0]\n\t\tvar lat = lngLat[1]\n\n\t\tvar searchUrl = $(\"a:contains('trigpoints')\").attr('href')\n\t\t$.ajax(searchUrl).done(\n\t\t\tfunction (res, status, xhr) {\n\t\t\t\tvar $searchResult = $($.parseHTML(res))\n\t\t\t\tvar flashLink = $searchResult.find(\"a:contains('Interactive Map')\").attr('href')\n\t\t\t\tvar suffix = '?' + flashLink.split('?')[1]\n\t\t\t\tthis.getPointsFromSearch(suffix, function (points) {\n\t\t\t\t\tvar mapDiv = $('map[name=\"trigmap\"]').parent()\n\t\t\t\t\tmapDiv.empty()\n\n\t\t\t\t\t//get 'this' trig id\n\t\t\t\t\tvar id = window.location.pathname.split(/\\//).pop()\n\t\t\t\t\tid = /0*([^0].*)/.exec(id)[1] //strip any leading zeros\n\n\t\t\t\t\tvar significantPoint = null\n\t\t\t\t\tpoints = points.filter(function (point) {\n\t\t\t\t\t\tif (point.id == id) {\n\t\t\t\t\t\t\tsignificantPoint = point\n\t\t\t\t\t\t\treturn false\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn true\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\tvar options = {\n\t\t\t\t\t\tmap_style: 'mini_embedded',\n\t\t\t\t\t\tcluster: false,\n\t\t\t\t\t\thider_control_start_visible: false,\n\t\t\t\t\t\tshow_hider_control: true,\n\t\t\t\t\t\tstart_position: [lat, lng],\n\t\t\t\t\t\tmap_outer_container_element: mapDiv,\n\t\t\t\t\t\tpointsToLoad: {\n\t\t\t\t\t\t\tsignificantPoint: significantPoint,\n\t\t\t\t\t\t\tgeneralPoints: points\n\t\t\t\t\t\t},\n\t\t\t\t\t\tforce_config_override: true,\n\t\t\t\t\t\tinitial_zoom: 13,\n\t\t\t\t\t\tuse_sidebar: false\n\t\t\t\t\t}\n\n\t\t\t\t\tmapLoader.loadMap(options)\n\t\t\t\t})\n\t\t\t}.bind(this)\n\t\t)\n\t},\n\n\tgetPointsFromSearch: function (suffix, callback) {\n\t\t$.get('/trigs/down-flash.php' + suffix, function (data, textStatus, jqXHR) {\n\t\t\tvar regex = /Showing trigpoints \\d+ to \\d+ of (\\d+)/g\n\t\t\tvar allText = $('body').text()\n\n\t\t\tvar showMap\n\t\t\tif (regex.test(allText) && parseInt(regex.exec(allText)[1]) > 1000) {\n\t\t\t\tshowMap = confirm('Map will only display the first 1000 points, are you sure you want to continue?')\n\t\t\t} else {\n\t\t\t\tshowMap = true\n\t\t\t}\n\n\t\t\tif (showMap === true) {\n\t\t\t\tvar decodedXmlString = decodeURIComponent(data)\n\t\t\t\tvar dom = $($.parseXML(decodedXmlString))\n\t\t\t\tvar points = dom\n\t\t\t\t\t.find('C')\n\t\t\t\t\t.map(function (i, element) {\n\t\t\t\t\t\t//e.g. <C D='Castlebythe Barrow' I='2041' E='202873' N='229647' F='n'/>\n\t\t\t\t\t\tvar point = $(element)\n\t\t\t\t\t\tvar id = point.attr('I')\n\t\t\t\t\t\tvar url = 'http://trigpointing.uk/trig/' + id\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\teastings: parseInt(point.attr('E')),\n\t\t\t\t\t\t\tnorthings: parseInt(point.attr('N')),\n\t\t\t\t\t\t\turl: url,\n\t\t\t\t\t\t\tid: id,\n\t\t\t\t\t\t\tname: point.attr('D')\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.toArray()\n\t\t\t\tcallback(points)\n\t\t\t}\n\t\t})\n\t}\n}\n","import './entry_shared'\n\nimport tukIntegration from '../integration/tuk'\ntukIntegration.showMap()\n"],"sourceRoot":""}