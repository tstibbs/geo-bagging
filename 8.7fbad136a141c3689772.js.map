{"version":3,"sources":["webpack:///./src/js/vendor-wrappers/leaflet.js","webpack:///./test/config_test.js","webpack:///./src/js/params.js","webpack:///./src/js/config.js","webpack:///./src/js/global.js","webpack:///./src/js/conversion.js"],"names":["Icon","Default","prototype","_getIconUrl","iconUrl","default","retinaUrl","shadowUrl","prefix","window","geoBaggingBaseUrl","mergeOptions","iconRetinaUrl","describe","before","undefined","localStorage","clear","it","config","equal","cluster","dimensional_layering","blah","notOk","hasOwnProperty","ok","persist","config2","force_config_override","page_id","newConfig1","newConfig2","ParamChecker","Class","extend","initialize","this","update","_params","search","location","length","substr","split","forEach","item","tmp","decodeURIComponent","bind","getParams","test","key","defaultInstance","tester","defaultPageId","pathname","pop","defaults","baseUrl","remoteData","map_style","initial_zoom","start_position","map_element_id","map_outer_container_element","show_zoom_control","show_selection_control","show_search_control","show_locate_control","show_layers_control","show_position_control","show_hider_control","use_sidebar","hider_control_start_visible","icons","dimensionNames","dimensionValueLabels","defaultLayer","markerConstraints","Config","options","configBundles","resolvedConfig","_checkForUndefaultedProperties","bundles","_storageId","saved","_getSavedConfig","property","_buildMarkerConstraints","constraintsString","points","tlLat","tlLng","brLat","brLng","topLeft","gridRefToLngLat","bottomRight","parseFloat","Array","isArray","latLngBounds","markerConstraintsMatcher","marker","contains","latLng","newConfig","source","console","warn","getItem","JSON","parse","setItem","stringify","osgbProj","pad","num","w","n","toString","latLngToGridRef","lat","lng","digits","out","forward","eastings","northings","Number","isNaN","Error","e","e100k","Math","floor","n100k","l1","l2","letPair","String","fromCharCode","charCodeAt","pow","osgbToLngLat","inverse","gridRefToOsgb","gridref","trim","_determineGridRefType","match","OsGridRef","toUpperCase","e100km","n100km","en","slice","parseInt","lngLat"],"mappings":"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","file":"8.7fbad136a141c3689772.js","sourcesContent":["import leaflet from 'leaflet'\n\nimport 'leaflet/dist/leaflet.css'\n\ndelete leaflet.Icon.Default.prototype._getIconUrl\n// workaround for https://github.com/Leaflet/Leaflet/issues/4968\nlet iconUrl = require('leaflet/dist/images/marker-icon.png').default\nlet retinaUrl = require('leaflet/dist/images/marker-icon-2x.png').default\nlet shadowUrl = require('leaflet/dist/images/marker-shadow.png').default\n\nvar prefix = window.geoBaggingBaseUrl != null ? window.geoBaggingBaseUrl : ''\nleaflet.Icon.Default.mergeOptions({\n\ticonRetinaUrl: prefix + retinaUrl,\n\ticonUrl: prefix + iconUrl,\n\tshadowUrl: prefix + shadowUrl\n})\n\nexport default leaflet\n","import {assert} from 'chai'\n\nimport Config from '../src/js/config'\n\ndescribe('config', function () {\n\tbefore(function () {\n\t\tif (localStorage !== undefined) {\n\t\t\tlocalStorage.clear()\n\t\t}\n\t})\n\tit('should inherit defaults', function () {\n\t\tvar config = new Config()\n\t\tassert.equal(true, config.cluster)\n\t\tassert.equal(false, config.dimensional_layering)\n\t\tassert.equal(undefined, config.blah)\n\t\tassert.notOk(config.hasOwnProperty('blah'))\n\t})\n\tit('defaults can be overridden', function () {\n\t\tvar config = new Config({\n\t\t\tcluster: false,\n\t\t\tblah: 'stuff'\n\t\t})\n\t\tassert.equal(false, config.cluster)\n\t\tassert.equal(false, config.dimensional_layering)\n\t\tassert.equal('stuff', config.blah)\n\t\tassert.ok(config.hasOwnProperty('blah'))\n\t})\n\tdescribe('persistence', function () {\n\t\tit('can save and retrieve', function () {\n\t\t\tvar config = new Config({\n\t\t\t\tblah: 4\n\t\t\t})\n\t\t\tassert.equal(4, config.blah)\n\t\t\tconfig.persist({\n\t\t\t\tblah: 5\n\t\t\t})\n\t\t\tassert.equal(4, config.blah) //should still be 4 - persisting shouldn't change the retrieved values until we reload the page\n\t\t\tvar config2 = new Config({\n\t\t\t\tblah: 4\n\t\t\t})\n\t\t\tassert.equal(5, config2.blah) //saved value should override the value from config\n\t\t})\n\t\tit('can save and retrieve with null options', function () {\n\t\t\tvar config = new Config()\n\t\t\tconfig.persist({\n\t\t\t\tblah: 5\n\t\t\t})\n\t\t\tvar config2 = new Config()\n\t\t\tassert.equal(5, config2.blah) //saved value should now be available\n\t\t})\n\t\tit('can force override', function () {\n\t\t\tvar config = new Config()\n\t\t\tconfig.persist({\n\t\t\t\tblah: 5\n\t\t\t})\n\t\t\tvar config2 = new Config({\n\t\t\t\tforce_config_override: true,\n\t\t\t\tblah: 4\n\t\t\t})\n\t\t\tassert.equal(4, config2.blah) //passed-in value should override saved value\n\t\t})\n\t\tit('saving is for a given page id', function () {\n\t\t\t//set up\n\t\t\tvar config1 = new Config({\n\t\t\t\tpage_id: 'abc'\n\t\t\t})\n\t\t\tconfig1.persist({\n\t\t\t\tblah: 5\n\t\t\t})\n\t\t\tvar config2 = new Config({\n\t\t\t\tpage_id: 'xyz'\n\t\t\t})\n\t\t\tconfig2.persist({\n\t\t\t\tblah: 6\n\t\t\t})\n\t\t\t//test\n\t\t\tvar newConfig1 = new Config({\n\t\t\t\tpage_id: 'abc'\n\t\t\t})\n\t\t\tvar newConfig2 = new Config({\n\t\t\t\tpage_id: 'xyz'\n\t\t\t})\n\t\t\tassert.equal(5, newConfig1.blah)\n\t\t\tassert.equal(6, newConfig2.blah)\n\t\t})\n\t})\n})\n","import global from './global'\nimport leaflet from 'VendorWrappers/leaflet'\n\nvar ParamChecker = leaflet.Class.extend({\n\tinitialize: function () {\n\t\tthis.update()\n\t},\n\n\tupdate: function () {\n\t\tthis._params = {}\n\t\tvar search = global.location.search\n\t\tif (search.length > 0) {\n\t\t\tsearch = search.substr(1)\n\t\t\tvar paramString = search.split('&')\n\t\t\tparamString.forEach(\n\t\t\t\tfunction (item) {\n\t\t\t\t\tvar tmp = item.split('=')\n\t\t\t\t\tthis._params[tmp[0]] = decodeURIComponent(tmp[1])\n\t\t\t\t}.bind(this)\n\t\t\t)\n\t\t}\n\t},\n\n\tgetParams: function () {\n\t\treturn this._params\n\t},\n\n\ttest: function (key) {\n\t\treturn this._params[key]\n\t}\n})\n\nvar defaultInstance = new ParamChecker()\nexport default {\n\t//bit dirty, but 'test' function makes it easy to check params, while the 'tester' gives you a class you can instantiate to check stuff at the relevant time.\n\ttest: function (key) {\n\t\treturn defaultInstance.test(key)\n\t},\n\ttester: ParamChecker\n}\n","import leaflet from 'leaflet'\nimport $ from 'jquery'\nimport global from './global'\nimport params from './params'\nimport conversion from './conversion'\n\nvar defaultPageId = global.location.pathname.split('/').pop()\n\nvar defaults = {\n\tbaseUrl: window.geoBaggingBaseUrl != null ? window.geoBaggingBaseUrl : '',\n\tremoteData: false,\n\tmap_style: 'full', //full, mini, embedded\n\tcluster: true,\n\tdimensional_layering: false,\n\tinitial_zoom: 13,\n\tstart_position: [53.374694, -1.711474], //lat, long\n\tforce_config_override: false, //if true, start position and zoom will be taken from config, not from local storage\n\tmap_element_id: 'map',\n\tmap_outer_container_element: $('body'),\n\tpage_id: defaultPageId,\n\tshow_zoom_control: true,\n\tshow_selection_control: true,\n\tshow_search_control: true,\n\tshow_locate_control: true,\n\tshow_layers_control: true,\n\tshow_position_control: true,\n\tshow_hider_control: 'mobile', // false, true, 'mobile'\n\tuse_sidebar: true,\n\thider_control_start_visible: true,\n\ticons: {},\n\tdimensionNames: [],\n\tdimensionValueLabels: {},\n\tdefaultLayer: 'OS',\n\tmarkerConstraints: null //e.g. will constrain it to show only those markers within a bounding boc\n}\n\nvar Config = leaflet.Class.extend({\n\tinitialize: function (options, configBundles) {\n\t\tvar resolvedConfig = $.extend({}, defaults, options)\n\t\tthis._checkForUndefaultedProperties(options, 'window config')\n\t\tresolvedConfig.bundles = configBundles\n\n\t\tthis._storageId = 'os_map:' + resolvedConfig.page_id + 'config'\n\n\t\tif (options == null || options.force_config_override !== true) {\n\t\t\t//check *options*, don't want to retrieve this persisted value\n\t\t\t//unless we've set the attribute to force override local config with the coded config, we should grab the local storage version and overwrite any matching keys\n\t\t\tvar saved = this._getSavedConfig()\n\t\t\tresolvedConfig = $.extend({}, resolvedConfig, saved)\n\t\t}\n\n\t\tif (params.test('startPosition')) {\n\t\t\t//lat, long\n\t\t\tresolvedConfig.start_position = params.test('startPosition').split(',')\n\t\t}\n\t\tif (params.test('startZoom')) {\n\t\t\tresolvedConfig.initial_zoom = params.test('startZoom')\n\t\t}\n\t\tthis._buildMarkerConstraints(resolvedConfig)\n\t\tif (params.test('remoteData') == 'true') {\n\t\t\tresolvedConfig.remoteData = true\n\t\t}\n\n\t\t//set all values locally so that the exporter object works like a hash\n\t\tfor (var property in resolvedConfig) {\n\t\t\tif (resolvedConfig.hasOwnProperty(property)) {\n\t\t\t\tthis[property] = resolvedConfig[property]\n\t\t\t}\n\t\t}\n\t},\n\n\t_buildMarkerConstraints: function (resolvedConfig) {\n\t\tvar constraintsString = null\n\t\tif (params.test('constraints') != null) {\n\t\t\t// params takes priority\n\t\t\tconstraintsString = params.test('constraints')\n\t\t} else if (resolvedConfig.markerConstraints != null && typeof resolvedConfig.markerConstraints == 'string') {\n\t\t\tconstraintsString = resolvedConfig.markerConstraints\n\t\t}\n\t\tif (constraintsString != null) {\n\t\t\tvar points = constraintsString.split(',')\n\t\t\tvar tlLat = null\n\t\t\tvar tlLng = null\n\t\t\tvar brLat = null\n\t\t\tvar brLng = null\n\t\t\tif (points.length == 2) {\n\t\t\t\t//must be os grid refs\n\t\t\t\tvar topLeft = conversion.gridRefToLngLat(points[0])\n\t\t\t\ttlLng = topLeft[0]\n\t\t\t\ttlLat = topLeft[1]\n\t\t\t\tvar bottomRight = conversion.gridRefToLngLat(points[1])\n\t\t\t\tbrLng = bottomRight[0]\n\t\t\t\tbrLat = bottomRight[1]\n\t\t\t} else {\n\t\t\t\t//lat,lng,lat,lng\n\t\t\t\ttlLat = parseFloat(points[0])\n\t\t\t\ttlLng = parseFloat(points[1])\n\t\t\t\tbrLat = parseFloat(points[2])\n\t\t\t\tbrLng = parseFloat(points[3])\n\t\t\t}\n\t\t\tresolvedConfig.markerConstraints = [\n\t\t\t\t[brLat, tlLng],\n\t\t\t\t[tlLat, brLng]\n\t\t\t] //<LatLng> southWest, <LatLng> northEast\n\t\t}\n\t\tif (resolvedConfig.markerConstraints != null && Array.isArray(resolvedConfig.markerConstraints)) {\n\t\t\tresolvedConfig.markerConstraints = leaflet.latLngBounds(resolvedConfig.markerConstraints) //[[bottom, left], [top, right]]\n\t\t}\n\t\tif (resolvedConfig.markerConstraints != null && typeof resolvedConfig.markerConstraints === 'function') {\n\t\t\tresolvedConfig.markerConstraintsMatcher = resolvedConfig.markerConstraints\n\t\t}\n\t\tif (resolvedConfig.markerConstraints != null && resolvedConfig.markerConstraintsMatcher == null) {\n\t\t\tresolvedConfig.markerConstraintsMatcher = function (marker) {\n\t\t\t\treturn resolvedConfig.markerConstraints.contains(marker.latLng)\n\t\t\t}\n\t\t}\n\t},\n\n\t_checkForUndefaultedProperties: function (newConfig, source) {\n\t\tfor (var property in newConfig) {\n\t\t\tif (newConfig.hasOwnProperty(property) && !defaults.hasOwnProperty(property)) {\n\t\t\t\tconsole.warn('Property \"' + property + '\" (set from ' + source + ') should have a default')\n\t\t\t}\n\t\t}\n\t},\n\n\t_getSavedConfig: function () {\n\t\tif (localStorage !== undefined) {\n\t\t\tvar saved = localStorage.getItem(this._storageId)\n\t\t\tif (saved != null) {\n\t\t\t\treturn JSON.parse(saved)\n\t\t\t} else {\n\t\t\t\treturn null\n\t\t\t}\n\t\t} else {\n\t\t\treturn null\n\t\t}\n\t},\n\n\tpersist: function (options) {\n\t\tif (localStorage !== undefined) {\n\t\t\tvar saved = this._getSavedConfig()\n\t\t\tif (saved != null) {\n\t\t\t\toptions = $.extend({}, saved, options)\n\t\t\t}\n\t\t\tlocalStorage.setItem(this._storageId, JSON.stringify(options))\n\t\t}\n\t}\n})\n\nexport default Config\n","export default window //if it isn't window, we'll be stubbing this module anyway\n","//heavily borrowed from www.movable-type.co.uk/scripts/latlong-gridref.html (MIT licence)\nimport proj4 from 'proj4'\n\nvar osgbProj = proj4(\n\t'+proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy +datum=OSGB36 +units=m +no_defs'\n)\n\nfunction pad(num, w) {\n\tvar n = num.toString()\n\twhile (n.length < w) n = '0' + n\n\treturn n\n}\n\nexport default {\n\tlatLngToGridRef: function (lat, lng) {\n\t\tvar digits = 10\n\n\t\tvar out = osgbProj.forward([lng, lat]) //from WSG84\n\t\tvar eastings = out[0]\n\t\tvar northings = out[1]\n\n\t\tdigits = digits === undefined ? 10 : Number(digits)\n\t\tif (isNaN(digits)) throw new Error('Invalid precision')\n\n\t\tvar e = Number(Number(eastings))\n\t\tvar n = Number(Number(northings))\n\n\t\tif (isNaN(e) || isNaN(n)) throw new Error('Invalid grid reference: ' + [lat, lng])\n\n\t\t// use digits = 0 to return numeric format (in metres)\n\t\tif (digits === 0) return pad(e, 6) + ',' + pad(n, 6)\n\n\t\t// get the 100km-grid indices\n\t\tvar e100k = Math.floor(e / 100000),\n\t\t\tn100k = Math.floor(n / 100000)\n\n\t\tif (e100k < 0 || e100k > 6 || n100k < 0 || n100k > 12) return ''\n\n\t\t// translate those into numeric equivalents of the grid letters\n\t\tvar l1 = 19 - n100k - ((19 - n100k) % 5) + Math.floor((e100k + 10) / 5)\n\t\tvar l2 = (((19 - n100k) * 5) % 25) + (e100k % 5)\n\n\t\t// compensate for skipped 'I' and build grid letter-pairs\n\t\tif (l1 > 7) l1++\n\t\tif (l2 > 7) l2++\n\t\tvar letPair = String.fromCharCode(l1 + 'A'.charCodeAt(0), l2 + 'A'.charCodeAt(0))\n\n\t\t// strip 100km-grid indices from easting & northing, and reduce precision\n\t\te = Math.floor((e % 100000) / Math.pow(10, 5 - digits / 2))\n\t\tn = Math.floor((n % 100000) / Math.pow(10, 5 - digits / 2))\n\n\t\tvar gridRef = letPair + ' ' + pad(e, digits / 2) + ' ' + pad(n, digits / 2)\n\n\t\treturn gridRef\n\t},\n\n\tosgbToLngLat: function (eastings, northings) {\n\t\tvar out = osgbProj.inverse([eastings, northings]) //to WSG84\n\t\treturn out\n\t},\n\n\tgridRefToOsgb: function (/*String*/ gridref) {\n\t\tgridref = String(gridref).trim()\n\t\tthis._determineGridRefType(gridref)\n\n\t\t// check for fully numeric comma-separated gridref format\n\t\tvar match = gridref.match(/^(\\d+),\\s*(\\d+)$/)\n\t\tif (match) return new OsGridRef(match[1], match[2])\n\n\t\t// validate format\n\t\tmatch = gridref.match(/^[A-Z]{2}\\s*[0-9]+\\s*[0-9]+$/i)\n\t\tif (!match) throw new Error('Invalid grid reference: ' + gridref)\n\n\t\t// get numeric values of letter references, mapping A->0, B->1, C->2, etc:\n\t\tvar l1 = gridref.toUpperCase().charCodeAt(0) - 'A'.charCodeAt(0)\n\t\tvar l2 = gridref.toUpperCase().charCodeAt(1) - 'A'.charCodeAt(0)\n\t\t// shuffle down letters after 'I' since 'I' is not used in grid:\n\t\tif (l1 > 7) l1--\n\t\tif (l2 > 7) l2--\n\n\t\t// convert grid letters into 100km-square indexes from false origin (grid square SV):\n\t\tvar e100km = ((l1 - 2) % 5) * 5 + (l2 % 5)\n\t\tvar n100km = 19 - Math.floor(l1 / 5) * 5 - Math.floor(l2 / 5)\n\n\t\t// skip grid letters to get numeric (easting/northing) part of ref\n\t\tvar en = gridref.slice(2).trim().split(/\\s+/)\n\t\t// if e/n not whitespace separated, split half way\n\t\tif (en.length == 1) en = [en[0].slice(0, en[0].length / 2), en[0].slice(en[0].length / 2)]\n\n\t\t//fix for grid refs technically part of the grid but outside of the uk\n\t\t//this helped to work this out: https://raw.githubusercontent.com/wu-lee/dinty/master/national-grid.png\n\t\tif (e100km >= 15) {\n\t\t\te100km -= 25\n\t\t}\n\t\tif (n100km > 20) {\n\t\t\tn100km -= 25\n\t\t}\n\n\t\t// validation\n\t\tif (e100km < -10 || n100km < -5)\n\t\t\tthrow new Error('Invalid grid reference: gridref=' + gridref + ', e100km=' + e100km + ', n100km=' + n100km)\n\t\tif (en.length != 2) throw new Error('Invalid grid reference: ' + gridref)\n\t\tif (en[0].length != en[1].length) throw new Error('Invalid grid reference: ' + gridref)\n\n\t\t// standardise to 10-digit refs (metres)\n\t\ten[0] = (en[0] + '00000').slice(0, 5)\n\t\ten[1] = (en[1] + '00000').slice(0, 5)\n\n\t\tvar e = parseInt(e100km + '00000') + parseInt(en[0])\n\t\tvar n = parseInt(n100km + '00000') + parseInt(en[1])\n\n\t\treturn [e, n]\n\t},\n\n\tgridRefToLngLat: function (/*String*/ gridref) {\n\t\tvar lngLat = this.gridRefToOsgb(gridref)\n\t\tvar out = osgbProj.inverse(lngLat) //to WSG84\n\t\treturn out\n\t},\n\n\t_determineGridRefType: function (gridref) {\n\t\tif (/^\\w\\s*\\d{3,}\\s*\\d{3,}$/.test(gridref)) {\n\t\t\tthrow new Error('Irish grid references currently unsupported: ' + gridref)\n\t\t}\n\t}\n}\n"],"sourceRoot":""}