{"version":3,"sources":["webpack:///./src/js/bundles/milestones/points_builder.js","webpack:///./src/img/milestone.png","webpack:///./src/js/bundles/milestones/config.js","webpack:///./src/js/vendor-wrappers/leaflet.js","webpack:///./src/js/popup_view.js","webpack:///./src/js/bundles/trigs/points_builder.js","webpack:///./src/js/bundles/nationalparks/builder.js","webpack:///./src/js/bundles/nationalparks/config.js","webpack:///./src/js/bundles/coastallandmarks/points_builder.js","webpack:///./src/js/bundles/coastallandmarks/config.js","webpack:///./src/js/fullscreen_link.js","webpack:///./src/js/params.js","webpack:///./src/js/bundles/defence/points_builder.js","webpack:///./src/js/bundles/defence/config.js","webpack:///./src/js/config.js","webpack:///./src/js/mobile.js","webpack:///./src/js/map_view.js","webpack:///./src/js/vendor-wrappers/leaflet-marker-cluster.js","webpack:///./src/js/vendor-wrappers/leaflet-subgroup.js","webpack:///./src/js/marker_view.js","webpack:///./src/js/points_view.js","webpack:///./src/js/geojson_view.js","webpack:///./src/js/vendor-wrappers/leaflet-matrix-layers-control.js","webpack:///./src/js/utils/url_handler.js","webpack:///./src/js/model_views.js","webpack:///./src/js/source_loader.js","webpack:///./src/js/vendor-wrappers/leaflet-control-hider.js","webpack:///./src/js/selection.js","webpack:///./src/js/locate.js","webpack:///./src/js/vendor-wrappers/leaflet-mouse-position.js","webpack:///./src/js/mouseposition_osgb.js","webpack:///./src/js/vendor-wrappers/leaflet-map-center-coord.js","webpack:///./src/js/screenposition_osgb.js","webpack:///./src/js/vendor-wrappers/sidebar.js","webpack:///./src/js/menu/attribution.js","webpack:///./src/js/menu/user.js","webpack:///./src/js/menu/view.js","webpack:///./src/js/controls.js","webpack:///./src/js/vendor-wrappers/bing-layer.js","webpack:///./src/js/layers.js","webpack:///./src/js/manager.js","webpack:///./src/js/map_loader.js","webpack:///./src/js/bundles/trigs/config_embedding.js","webpack:///./src/js/bundles/hills/points_builder.js","webpack:///./src/js/bundles/hills/config.js","webpack:///./src/js/menu/constraints/current_area_view.js","webpack:///./src/js/bundles/nt/points_builder.js","webpack:///./src/js/bundles/nt/config.js","webpack:///./src/js/bundles/rnli/points_builder.js","webpack:///./src/js/bundles/rnli/config.js","webpack:///./src/js/menu/constraints/view.js","webpack:///./src/js/bundles/abstract_geojson_builder.js","webpack:///./src/js/menu/constraints/tracks_view.js","webpack:///./src/js/menu/constraints/track_load_view.js","webpack:///./src/js/constants.js","webpack:///./src/js/bundles/abstract_bundle_builder.js","webpack:///./src/js/global.js","webpack:///./src/js/bundles/follies/points_builder.js","webpack:///./src/js/bundles/follies/config.js","webpack:///./src/js/menu/constraints/current_location_view.js","webpack:///./src/js/custom_default_icon.js","webpack:///./src/js/bundles sync config.*\\.js$","webpack:///./src/img/pillar.png","webpack:///./src/js/bundles/trigs/config_base.js","webpack:///./src/js/conversion.js","webpack:///./src/js/bundles/trigs/config.js","webpack:///./src/img/hill.png","webpack:///./src/js/bundles/abstract_points_builder.js","webpack:///./src/js/bundles/trigs/config_mini.js","webpack:///./src/js/bundles/trails/builder.js","webpack:///./src/js/bundles/trails/config.js","webpack:///./src/js/entry/entry_shared.js","webpack:///./src/js/bundles/hills/config_all.js"],"names":["extend","parse","point","lng","lat","id","type","category","location","position","design","url","nullIfEmpty","value","trim","lenght","extraInfos","this","addMarker","dimensionNames","dimensionValueLabels","milestonesIcon","milestone","build","config","aspectLabel","defaultIcon","iconUrl","dataToLoad","parser","attribution","Icon","Default","prototype","_getIconUrl","default","retinaUrl","shadowUrl","prefix","window","geoBaggingBaseUrl","mergeOptions","iconRetinaUrl","notEmpty","input","length","_buildValue","Array","isArray","_escapeValue","map","bind","escape","buildShortDescription","extraTexts","Object","keys","key","filter","extractValue","val","join","buildDescription","popupText","forEach","keyAndVal","i","buildPopup","manager","unescapedName","unescapedUrl","latLng","unescapedExtraTexts","visited","name","shouldManageVisits","Builder","physicalType","condition","waypointRegex","test","exec","add","lngLat","addWithoutDimensions","icon","feature","properties","geojson","link","leafletMap","click","zoom","getZoom","centre","getCenter","newUrl","baseUrl","href","append","ParamChecker","Class","initialize","update","_params","search","substr","split","item","tmp","decodeURIComponent","getParams","defaultInstance","tester","purpose","style","description","imageLinks","includes","typeString","push","buildImageLinks","defaultPageId","pathname","pop","defaults","remoteData","map_style","cluster","dimensional_layering","initial_zoom","start_position","force_config_override","map_element_id","map_outer_container_element","page_id","show_zoom_control","show_selection_control","show_search_control","show_locate_control","show_layers_control","show_position_control","show_hider_control","use_sidebar","hider_control_start_visible","icons","defaultLayer","markerConstraints","Config","options","configBundles","resolvedConfig","_checkForUndefaultedProperties","bundles","_storageId","saved","_getSavedConfig","property","_buildMarkerConstraints","hasOwnProperty","constraintsString","points","tlLat","tlLng","brLat","brLng","topLeft","gridRefToLngLat","bottomRight","parseFloat","latLngBounds","markerConstraintsMatcher","marker","contains","newConfig","source","console","warn","undefined","localStorage","getItem","JSON","persist","setItem","stringify","firstRegex","secondRegex","devHack","params","testString","global","navigator","userAgent","vendor","opera","leaflet","_config","_createView","_map","Map","zoomControl","setView","LatLng","fullscreen_link","on","_saveLocation","content","mapClass","addClass","mobile","prepend","center","hash","getMap","markerConfig","bundleConfig","aspectName","exportName","markerOptions","layerId","popupElem","change","endpoint","checked","post","constants","backendBaseUrl","data","contentType","xhrFields","withCredentials","catch","jqXhr","textStatus","errorThrown","status","log","bindPopup","cmt","desc","exportData","modelsByAspect","matrixLayerControl","controls","_modelsByAspect","_matrixLayerControl","_controls","_bundles","_parentGroup","_manager","_translateMarkerGroup","group","aspect","constructor","dimension","finish","finished","deferredObject","Deferred","mapElem","radius","Math","max","offsetHeight","offsetWidth","MarkerClusterGroup","disableClusteringAtZoom","maxClusterRadius","chunkedLoading","chunkProgress","processed","total","elapsed","layersArray","resolve","layerGroup","addTo","model","addClusteredModel","markerLists","getMarkerList","getBundleConfig","allMarkers","concat","apply","markersByLayer","reduce","addLayers","markers","addLayer","promise","markerList","matrixOverlays","depthFirstIteration","aspectOptions","addAspect","path","overlays","subGroup","dimValue","newPath","sublist","Error","layers","buildLayers","values","layer","_tester","sourceLoaded","sourceName","datasource","newParams","paramKey","document","origin","getControls","_urlHandler","_filterModels","bundleModels","className","matchingModels","bundleName","_addLazyModels","lazyModels","addCallback","callback","fetchData","done","_addAttribution","meta","getMeta","recordCount","lastUpdated","bundleDetails","addLazyAspect","getAttribution","dataSourceLabel","addAttribution","loadModelViews","pointsModels","geojsonModels","lazyPointsModels","lazyGeojsonModels","getLayers","multiAspects","embeddable","pointsView","geojsonView","promises","when","always","addControl","cache","r","loadSources","selectedSourceIds","extraDataSourcesString","extraDataSources","sourceIds","uniqueSort","dataSources","sourceModuleIds","_sourceIdsToDataSources","sources","sourceModule","sourceDataPrefix","sourceModels","metaPromise","fetchMeta","indexOf","dataPromise","_finish","setTimeout","allSources","hide","actions","gpx","display","action","d","Date","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","keepCurrentZoomLevel","formatter","conversion","latLngToGridRef","onMove","latLngFormatter","call","_addShowHideHandling","$icon","isIconVisible","hideIcon","css","container","_container","dataSourceName","text","wrapper","html","_view","isAuthenticated","getLoggedInUser","getView","_buildView","_buildControl","view","showUserSettings","getConfig","attributionContainer","_attributionView","userView","constraintsView","_control","getContainer","order","Control","Zoom","Layers","Attribution","_controlsToHide","_controlsToAdd","_layers","_addDefaults","_addAllTo","configOverrides","_menuView","showPopup","provider","bingKey","visibleByDefault","control","oldControl","found","debug","error","remove","newContainer","oldContainer","replaceWith","bingDefaults","maxZoom","minZoom","detectRetina","bingOsLayer","imagerySet","maxNativeZoom","bingFallbackLayer","bingOsGroup","bingRoads","bingHybrid","bingAerial","osm","TileLayer","_listenForLayerChange","layerToSelect","_authenticated","_initializePromise","get","then","_loggedInUser","email","fail","xhr","textError","waitForInitialization","setViewConstraints","limitFunction","_limitFunction","getViewConstraints","setAuthenticated","authenticated","getBundleIds","allBundles","dataSourcesString","loadMap","bundleIds","hasUrlData","alert","pointsToLoad","generalPoints","mapView","_buildMap","loadMiniMap","searchResult","urlPrefix","osgbToLngLat","eastings","northings","significantPoint","classification","_bundleConfig","hillDisplayNames","hillValueLabels","displayNames","urlPaths","redIconPath","hill","CurrentAreaView","_constraintsView","_currentAreaLimit","event","target","limitTo","getBounds","unlimit","reset","prop","types","facilities","typeLabels","facilityLabels","launchMethods","typeData","launchMethodLabels","label","ConstraintsView","_limitOriginView","info","currentAreaView","currentLocationView","_fileConstraintsLoadView","_buildReset","currentLocationLimitButton","limitOriginView","bounds","_buildLimitFunction","_constraintPolygon","polygonPoints","hole","getSouthWest","getNorthWest","getNorthEast","getSouthEast","L","Polygon","color","fillColor","fillOpacity","GeojsonLayer","_data","_doFetchData","_parseDatas","features","_translateDatas","layerDatas","layerData","geoLayer","geoJSON","onEachFeature","popup","_colour","showTracks","tracks","geoJsonLayer","TrackLoadView","_tracksView","_fileInput","_readFiles","files","file","reader","FileReader","onload","e","track","_loadTrack","result","_finishedReadingFiles","readAsText","xmlString","dom","DOMParser","parseFromString","geoJson","_geoJsonBounds","minLng","maxLng","minLat","maxLat","geometry","lineParser","line","coordinates","bottomLeft","topRight","AbstractBundleBuilder","_markerList","_bundleName","substring","lastIndexOf","_urlPrefix","_visits","_buildDataUrl","dataLoadPromise","ajax","dataType","visitsLoadPromise","visit","datas","_meta","getVisits","typeDisplay","CurrentLocationView","_limitToCurrentLocation","listener","off","latlng","stopLocate","locate","CustomDefaultIcon","customIconPath","_customIconPath","webpackContext","req","webpackContextResolve","__webpack_require__","o","code","module","exports","typeValueLabels","Pillar","pillar","iconAnchor","popupAnchor","osgbProj","pad","num","w","n","toString","digits","out","forward","Number","isNaN","e100k","floor","n100k","l1","l2","letPair","String","fromCharCode","charCodeAt","pow","inverse","gridRefToOsgb","gridref","_determineGridRefType","match","OsGridRef","toUpperCase","e100km","n100km","en","slice","parseInt","PointsBuilder","addMarkers","_attributionText","dimensionValues","encodeURIComponent","_withinConstraints","currentMap","lastKey","matcher","linksArray","elem","index","labels","urls","notes","openedDate","formattedDate","toLocaleDateString","munged","replace","toLowerCase"],"mappings":"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","file":"integration~main~mini.1c92403850335563a8e5.js","sourcesContent":["import AbstractPointsBuilder from '../abstract_points_builder';\n\nvar Builder = AbstractPointsBuilder.extend({\n\tparse: function(point) {\n\t\t//[Longitude,Latitude,Id,Type,Category]\n\t\tvar lng = point[0];\n\t\tvar lat = point[1];\n\t\tvar id = point[2];\n\t\tvar type = point[3];\n\t\tvar category = point[4];\n\t\tvar location = point[5];\n\t\tvar position = point[6];\n\t\tvar design = point[7];\n\t\tvar url = point[8];\n\t\tvar additionalPhoto1 = point[9];\n\t\tvar additionalPhoto2 = point[10];\n\t\t\n\t\tfunction nullIfEmpty(value) {\n\t\t\tif (value == null || value.trim().lenght === 0 || value.trim() == ',') {\n\t\t\t\treturn null;\n\t\t\t} else {\n\t\t\t\treturn value;\n\t\t\t}\n\t\t}\n\t\t\n\t\tvar extraInfos = [\n\t\t\t['Notes', nullIfEmpty(category)],\n\t\t\t['Design', nullIfEmpty(design)],\n\t\t\t['Location', nullIfEmpty(location)],\n\t\t\t['Position', nullIfEmpty(position)]\n\t\t];\n\t\tthis.addMarker(id, lat, lng, url, id, extraInfos, null, [type]);\n\t},\n});\n\nexport default Builder\n","export default __webpack_public_path__ + \"bcdea73cee99779b48ef40c5b6dbc4e9.png\";","import PointsBuilder from './points_builder';\nimport CustomDefaultIcon from '../../custom_default_icon';\nimport milestoneIcon from '../../../img/milestone.png'\n\nvar dimensionNames = ['Waymarks'];\nvar dimensionValueLabels = {};\ndimensionValueLabels[dimensionNames[0]] = {\n\t'AA_Signs': 'AA Signs',\n\t'Boundary_Markers': 'Boundary Markers',\n\t'Canal_Milemarkers': 'Canal Milemarkers'\n};\n\nvar milestonesIcon = milestoneIcon;\n\nexport default function build(config) {\n\treturn {\n\t\taspectLabel: \"Waymarks\",\n\t\tdefaultIcon: new CustomDefaultIcon(config, milestonesIcon, {iconUrl: milestonesIcon}),\n\t\tdimensionNames: dimensionNames,\n\t\tdimensionValueLabels: dimensionValueLabels,\n\t\tdataToLoad: 'data.json',\n\t\tparser: PointsBuilder,\n\t\tattribution: '&copy; <a href=\"http://www.msocrepository.co.uk/\">The Milestone Society</a>'\n\t}\n};\n","import leaflet from 'leaflet';\n\nimport \"leaflet/dist/leaflet.css\";\n\ndelete leaflet.Icon.Default.prototype._getIconUrl;\n// workaround for https://github.com/Leaflet/Leaflet/issues/4968\nlet iconUrl = require('leaflet/dist/images/marker-icon.png').default\nlet retinaUrl = require('leaflet/dist/images/marker-icon-2x.png').default\nlet shadowUrl = require('leaflet/dist/images/marker-shadow.png').default\n\nvar prefix = window.geoBaggingBaseUrl != null ? window.geoBaggingBaseUrl : ''\nleaflet.Icon.Default.mergeOptions({\n  iconRetinaUrl: prefix + retinaUrl,\n  iconUrl: prefix + iconUrl,\n  shadowUrl: prefix + shadowUrl,\n});\n\nexport default leaflet\n","import _ from 'underscore';\n\t\nexport default {\n\tnotEmpty: function(input) {\n\t\treturn input !== undefined && input !== null && input.length > 0;\n\t},\n\t\n\t_buildValue: function(value) {\n\t\tif (Array.isArray(value) && value.length == 2) {\n\t\t\treturn '<a href=\"' + value[1] + '\">' + value[0] + '</a>';\n\t\t} else {\n\t\t\treturn value;\n\t\t}\n\t},\n\t\n\t_escapeValue: function(value) {\n\t\tif (Array.isArray(value)) {\n\t\t\treturn value.map(this._escapeValue.bind(this));\n\t\t} else {\n\t\t\treturn _.escape(value);\n\t\t}\n\t},\n\t\n\tbuildShortDescription: function(extraTexts) {\n\t\treturn Object.keys(extraTexts).map(function(key) {\n\t\t\treturn extraTexts[key]\n\t\t}).filter(function(value) {\n\t\t\treturn value != null && value != \"\";\n\t\t}).map(function(value) {\n\t\t\tfunction extractValue(val) {\n\t\t\t\tif (Array.isArray(val) && val.length == 2) {\n\t\t\t\t\treturn val[0];\n\t\t\t\t} else {\n\t\t\t\t\treturn val;\n\t\t\t\t}\n\t\t\t};\n\t\t\tif (Array.isArray(value)) {\n\t\t\t\treturn value.map(extractValue).join('/');\n\t\t\t} else {\n\t\t\t\treturn extractValue(value);\n\t\t\t}\n\t\t}).join(', ');\n\t},\n\t\n\tbuildDescription: function(extraTexts) {\n\t\tvar popupText = \"\";\n\t\textraTexts.forEach(function(keyAndVal) {\n\t\t\tvar key = keyAndVal[0]\n\t\t\tvar value = keyAndVal[1]\n\t\t\tif (value != null && value != \"\") {\n\t\t\t\tif (popupText.length > 0) {\n\t\t\t\t\tpopupText += '<br />';\n\t\t\t\t}\n\t\t\t\tpopupText += '<span class=\"popup-entry-key\">' + key + ': </span>';\n\t\t\t\tif (Array.isArray(value)) {\n\t\t\t\t\tif (value.length > 1) {\n\t\t\t\t\t\tpopupText += '<ul class=\"popup-entry-list\">';\n\t\t\t\t\t\tfor (var i = 0; i < value.length; i++) {\n\t\t\t\t\t\t\tpopupText += '<li>' + this._buildValue(value[i]) + '</li>';\n\t\t\t\t\t\t}\n\t\t\t\t\t\tpopupText += '</ul>';\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpopupText += '<span>' + this._buildValue(value[0]) + '</span>';\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tpopupText += '<span>' + this._buildValue(value) + '</span>';\n\t\t\t\t}\n\t\t\t}\n\t\t}.bind(this));\n\t\treturn popupText;\n\t},\n\t\n\tbuildPopup: function(manager, unescapedName, unescapedUrl, latLng, unescapedExtraTexts, visited) {\n\t\t//get everything from the model - anything that gets put into the dom needs to be escaped to prevent XSS\n\t\tvar name = _.escape(unescapedName);\n\t\tvar url = _.escape(unescapedUrl);\n\t\tvar extraTexts = null;\n\t\tif (unescapedExtraTexts != null) {\n\t\t\textraTexts = unescapedExtraTexts.map(function(keyAndVal) {\n\t\t\t\tvar key = keyAndVal[0]\n\t\t\t\tvar value = keyAndVal[1]\n\t\t\t\treturn [_.escape(key), this._escapeValue(value)]\n\t\t\t}.bind(this));\n\t\t}\n\t\t\n\t\tvar popupText = \"<div>\";\n\t\tif (this.notEmpty(url)) {\n\t\t\tpopupText = '<a href=\"' + url + '\" class=\"popup-title\">' + name + '</a>';\n\t\t} else if (this.notEmpty(name)) {\n\t\t\tpopupText = '<span class=\"popup-title\">' + name + '</span>';\n\t\t}\n\t\tif (manager.shouldManageVisits() && visited != null) {\n\t\t\tpopupText += '<label class=\"fancy-checkbox\" title=\"Visited?\">';\n\t\t\tpopupText += '    <input type=\"checkbox\"' + (visited ? ' checked' : '') + '/>';\n\t\t\tpopupText += '    <i class=\"fa fa-check\"></i>';\n\t\t\tpopupText += '</label>';\n\t\t}\n\t\tif (extraTexts != null) {\n\t\t\tif (popupText.length > 0) {\n\t\t\t\tpopupText += '<br />';\n\t\t\t}\n\t\t\tpopupText += this.buildDescription(extraTexts);\n\t\t}\n\t\t\n\t\tif (latLng != null) {\n\t\t\tvar lat = latLng[0];\n\t\t\tvar lng = latLng[1];\n\t\t\tvar googleUrl = 'https://www.google.com/maps/place/' + lat + '+' + lng + '/@' + lat + ',' + lng + ',15z';\n\t\t\tvar bingUrl = 'https://www.bing.com/maps/?mkt=en-gb&v=2&cp=' + lat + '~' + lng + '&lvl=14&sp=Point.' + lat + '_' + lng + '_' + name;\n\t\t\tvar geohackUrl = 'https://tools.wmflabs.org/geohack/geohack.php?pagename=' + name + '&params=' + lat + '_N_' + lng + '_E_region%3AGB_';\n\t\t\t\n\t\t\tpopupText += '<div class=\"expandable expandable-links\">';\n\t\t\t\tpopupText += '<input type=\"checkbox\" value=\"selected\" id=\"links-checkbox\" class=\"expandable-checkbox\">';\n\t\t\t\tpopupText += '<label for=\"links-checkbox\" class=\"expandable-checkbox-label\"><i class=\"fa fa-external-link\" aria-hidden=\"true\"></i></label>';\n\t\t\t\tpopupText += '<div class=\"expandable-content links\">';\n\t\t\t\t\tpopupText += '<a href=\"' + googleUrl + '\">View on google maps</a>';\n\t\t\t\t\tpopupText += '<br /><a href=\"' + bingUrl + '\">View on bing maps</a>';\n\t\t\t\t\tpopupText += '<br /><a href=\"' + geohackUrl + '\">View on geohack</a>';\n\t\t\t\tpopupText += '</div>';\n\t\t\tpopupText += '</div>';\n\t\t}\n\t\t\n\t\tpopupText += '</div>';\n\t\treturn popupText;\n\t}\n};\n","import AbstractPointsBuilder from '../abstract_points_builder';\n\nvar Builder = AbstractPointsBuilder.extend({\n\tparse: function(point) {\n\t\t//[Longitude,Latitude,Id,Name,physical_type,condition]\n\t\tvar lng = point[0];\n\t\tvar lat = point[1];\n\t\tvar id = point[2];\n\t\tvar name = point[3];\n\t\tvar physicalType = point[4];\n\t\tvar condition = point[5];\n\t\tvar waypointRegex = /TP0*(\\d+)/;\n\t\tvar url = null;\n\t\tif (waypointRegex.test(id)) {\n\t\t\tvar match = waypointRegex.exec(id);\n\t\t\tvar trigId = match[1];\n\t\t\turl = 'http://trigpointing.uk/trig/' + trigId;\n\t\t}\n\t\tvar extraTexts = [\n\t\t\t['Physical Type', physicalType],\n\t\t\t['Condition', condition]\n\t\t];\n\t\tthis.addMarker(id, lat, lng, url, name, extraTexts, physicalType, [physicalType, condition]);\n\t},\n\t\n\tadd: function (lngLat, url, name, extraTexts, physicalType, condition) {\n\t\tthis.addMarker(null, lngLat[1], lngLat[0], url, name, extraTexts, physicalType, [physicalType, condition]);\n\t},\n\n\taddWithoutDimensions: function (lngLat, url, name, icon) {\n\t\tthis.addMarker(null, lngLat[1], lngLat[0], url, name, null, icon, [null], icon);\n\t}\n});\n\nexport default Builder\n","import AbstractGeojsonBuilder from '../abstract_geojson_builder';\n\nvar Builder = AbstractGeojsonBuilder.extend({\n\tparse: function(feature) {\n\t\tvar name = feature.properties.name;\n\t\tvar geojson = {\n\t\t\t\"type\": \"FeatureCollection\",\n\t\t\t\"features\": [feature]\n\t\t};\n\t\treturn {\n\t\t\tname: name,\n\t\t\tgeojson: geojson\n\t\t}\n\t}\n});\n\nexport default Builder\n","import Builder from './builder';\n\nvar name = \"National Parks\";\n\nexport default {\n\taspectLabel: name,\n\tdimensionNames: [name],\n\tdataToLoad: 'data.geojson',\n\tparser: Builder,\n\tattribution: 'Office for National Statistics (<a href=\"http://www.nationalarchives.gov.uk/doc/open-government-licence/version/\">OGL</a>)'\n};\n","import AbstractPointsBuilder from '../abstract_points_builder';\n\n var Builder = AbstractPointsBuilder.extend({\n\t//[Longitude,Latitude,Name,Link,Type,YearBuilt]\n\tparse: function(point) {\n\t\tvar lng = point[0];\n\t\tvar lat = point[1];\n\t\tvar name = point[2];\n\t\tvar link = point[3];\n\t\tvar type = point[4];\n\t\tvar opened = point[5];\n\n\t\tvar extraInfos = [\n\t\t\t['Type', type],\n\t\t\t['Built/Opened', opened]\n\t\t];\n\t\tthis.addMarker(name, lat, lng, link, name, extraInfos, null, [type]);\n\t},\n});\n\nexport default Builder\n","import PointsBuilder from './points_builder';\n\nvar dimensionNames = [\"Type\"];\n\nexport default {\n\taspectLabel: \"Coastal Landmarks\",\n\tdimensionNames: dimensionNames,\n\tdataToLoad: 'data.json',\n\tparser: PointsBuilder,\n\tattribution: 'Adapted from data from <a href=\"https://en.wikipedia.org\">Wikipedia</a> licenced under <a href=\"https://creativecommons.org/licenses/by-sa/3.0/\">CC&nbsp;BY&#8209;SA</a>'\n};\n","import $ from 'jquery';\n\nvar FullScreenLink = function(config, leafletMap) {\n\tvar container = $('div.full-screen-link');\n\tif (container.length > 0) {\n\t\tvar link = $('<a href=\"#\">Open in full screen</a>');\n\t\tlink.click(function() {\n\t\t\tvar zoom = leafletMap.getZoom();\n\t\t\tvar centre = leafletMap.getCenter();\n\t\t\tvar newUrl = config.baseUrl + 'index.html?datasources=trigs&startPosition=' + centre.lat + ',' + centre.lng + '&startZoom=' + zoom;\n\t\t\twindow.location.href = newUrl;\n\t\t});\n\t\t$('div.full-screen-link').append(link);\n\t}\n};\n\nexport default FullScreenLink\n\t","import global from './global';\nimport leaflet from 'VendorWrappers/leaflet';\n\nvar ParamChecker = leaflet.Class.extend({\n\tinitialize: function () {\n\t\tthis.update();\n\t},\n\t\n\tupdate: function() {\n\t\tthis._params = {};\n\t\tvar search = global.location.search;\n\t\tif (search.length > 0) {\n\t\t\tsearch = search.substr(1);\n\t\t\tvar paramString = search.split(\"&\");\n\t\t\tparamString.forEach(function (item) {\n\t\t\t\tvar tmp = item.split(\"=\");\n\t\t\t\tthis._params[tmp[0]] = decodeURIComponent(tmp[1]);\n\t\t\t}.bind(this));\n\t\t}\n\t},\n\t\n\tgetParams: function() {\n\t\treturn this._params;\n\t},\n\n\ttest: function(key) {\n\t\treturn this._params[key];\n\t}\n});\n\nvar defaultInstance = new ParamChecker();\nexport default {\n\t//bit dirty, but 'test' function makes it easy to check params, while the 'tester' gives you a class you can instantiate to check stuff at the relevant time.\n\ttest: function(key) {\n\t\treturn defaultInstance.test(key);\n\t},\n\ttester: ParamChecker\n}\n","import AbstractPointsBuilder from '../abstract_points_builder';\n\nvar Builder = AbstractPointsBuilder.extend({\n    parse: function(point) {\n        //[Longitude,Latitude,Id,Type,Purpose,Category,Style,Link,location,Condition,description,imageLinks]\n        var lng = point[0];\n        var lat = point[1];\n        var id = point[2];\n        var type = point[3];\n        var purpose = point[4];\n        var category = point[5];\n        var style = point[6]\n        var url = point[7];\n        var location = point[8];\n        var condition = point[9];\n        var description = point[10];\n        var imageLinks = point[11];\n\n        var extraInfos = [\n            ['Style', style],\n            ['Position', location],\n            ['Notes', description],\n            ['Purpose', purpose]\n        ];\n        if (!style.includes(type) || category != null) { //if type is included in style and category is null, don't display\n            var typeString = type\n            if (category != null) {\n                typeString += \" / \" + category\n            }\n            extraInfos.push(['Type', typeString])\n        }\n        extraInfos.push(['Images', this.buildImageLinks(imageLinks)]);\n        this.addMarker(id, lat, lng, url, id, extraInfos, null, [purpose, type, condition]);\n    },\n});\n\nexport default Builder\n","import PointsBuilder from './points_builder';\n\nvar dimensionNames = ['Purpose', 'Type', 'Condition'];\n\nexport default {\n\taspectLabel: \"Defence of Britain\",\n\tdimensionNames: dimensionNames,\n\tdataToLoad: 'data.json',\n\tparser: PointsBuilder,\n\tattribution: '\"Defence of Britain\" data &copy; <a href=\"https://doi.org/10.5284/1000327\">Council for British Archaeology</a> 2006'\n};\n","import leaflet from \"leaflet\";\nimport $ from \"jquery\";\nimport global from \"./global\";\nimport params from \"./params\";\nimport conversion from \"./conversion\";\n\t\t\nvar defaultPageId = global.location.pathname.split(\"/\").pop();\n\nvar defaults = {\n\tbaseUrl: window.geoBaggingBaseUrl != null ? window.geoBaggingBaseUrl : '',\n\tremoteData: false,\n\tmap_style: 'full',//full, mini, embedded\n\tcluster: true,\n\tdimensional_layering: false,\n\tinitial_zoom: 13,\n\tstart_position: [53.374694, -1.711474],//lat, long\n\tforce_config_override: false,//if true, start position and zoom will be taken from config, not from local storage\n\tmap_element_id: 'map',\n\tmap_outer_container_element: $('body'),\n\tpage_id: defaultPageId,\n\tshow_zoom_control: true,\n\tshow_selection_control: true,\n\tshow_search_control: true,\n\tshow_locate_control: true,\n\tshow_layers_control: true,\n\tshow_position_control: true,\n\tshow_hider_control: 'mobile',// false, true, 'mobile'\n\tuse_sidebar: true,\n\thider_control_start_visible: true,\n\ticons: {},\n\tdimensionNames: [],\n\tdimensionValueLabels: {},\n\tdefaultLayer: \"OS\",\n\tmarkerConstraints: null //e.g. will constrain it to show only those markers within a bounding boc\n};\n\nvar Config = leaflet.Class.extend({\n\tinitialize: function (options, configBundles) {\n\t\tvar resolvedConfig = $.extend({}, defaults, options);\n\t\tthis._checkForUndefaultedProperties(options, \"window config\");\n\t\tresolvedConfig.bundles = configBundles;\n\t\t\n\t\tthis._storageId = 'os_map:' + resolvedConfig.page_id + 'config';\n\t\t\n\t\tif (options == null || options.force_config_override !== true) {//check *options*, don't want to retrieve this persisted value\n\t\t\t//unless we've set the attribute to force override local config with the coded config, we should grab the local storage version and overwrite any matching keys\n\t\t\tvar saved = this._getSavedConfig();\n\t\t\tresolvedConfig = $.extend({}, resolvedConfig, saved);\n\t\t}\n\n\t\tif (params.test('startPosition')) {//lat, long\n\t\t\tresolvedConfig.start_position = params.test('startPosition').split(',');\n\t\t}\n\t\tif (params.test('startZoom')) {\n\t\t\tresolvedConfig.initial_zoom = params.test('startZoom');\n\t\t}\n\t\tthis._buildMarkerConstraints(resolvedConfig);\n\t\tif (params.test('remoteData') == 'true') {\n\t\t\tresolvedConfig.remoteData = true;\n\t\t}\n\t\t\n\t\t//set all values locally so that the exporter object works like a hash\n\t\tfor (var property in resolvedConfig) {\n\t\t\tif (resolvedConfig.hasOwnProperty(property)) {\n\t\t\t\tthis[property] = resolvedConfig[property];\n\t\t\t}\n\t\t}\n\t},\n\t\n\t_buildMarkerConstraints: function(resolvedConfig) {\n\t\tvar constraintsString = null;\n\t\tif (params.test('constraints') != null) { // params takes priority\n\t\t\tconstraintsString = params.test('constraints');\n\t\t} else if (resolvedConfig.markerConstraints != null && typeof resolvedConfig.markerConstraints == 'string') {\n\t\t\tconstraintsString = resolvedConfig.markerConstraints;\n\t\t}\n\t\tif (constraintsString != null) {\n\t\t\tvar points = constraintsString.split(',');\n\t\t\tvar tlLat = null;\n\t\t\tvar tlLng = null;\n\t\t\tvar brLat = null;\n\t\t\tvar brLng = null;\n\t\t\tif (points.length == 2) {\n\t\t\t\t//must be os grid refs\n\t\t\t\tvar topLeft = conversion.gridRefToLngLat(points[0]);\n\t\t\t\ttlLng = topLeft[0];\n\t\t\t\ttlLat = topLeft[1];\n\t\t\t\tvar bottomRight = conversion.gridRefToLngLat(points[1]);\n\t\t\t\tbrLng = bottomRight[0];\n\t\t\t\tbrLat = bottomRight[1];\n\t\t\t} else { //lat,lng,lat,lng\n\t\t\t\ttlLat = parseFloat(points[0]);\n\t\t\t\ttlLng = parseFloat(points[1]);\n\t\t\t\tbrLat = parseFloat(points[2]);\n\t\t\t\tbrLng = parseFloat(points[3]);\n\t\t\t}\n\t\t\tresolvedConfig.markerConstraints = [[brLat, tlLng], [tlLat, brLng]]; //<LatLng> southWest, <LatLng> northEast\n\t\t}\n\t\tif (resolvedConfig.markerConstraints != null && Array.isArray(resolvedConfig.markerConstraints)) {\n\t\t\tresolvedConfig.markerConstraints = leaflet.latLngBounds(resolvedConfig.markerConstraints); //[[bottom, left], [top, right]]\n\t\t}\n\t\tif (resolvedConfig.markerConstraints != null && typeof resolvedConfig.markerConstraints === \"function\") {\n\t\t\tresolvedConfig.markerConstraintsMatcher = resolvedConfig.markerConstraints;\n\t\t}\n\t\tif (resolvedConfig.markerConstraints != null && resolvedConfig.markerConstraintsMatcher == null) {\n\t\t\tresolvedConfig.markerConstraintsMatcher = function(marker) {\n\t\t\t\treturn resolvedConfig.markerConstraints.contains(marker.latLng);\n\t\t\t};\n\t\t}\n\t},\n\t\n\t_checkForUndefaultedProperties: function(newConfig, source) {\n\t\tfor (var property in newConfig) {\n\t\t\tif (newConfig.hasOwnProperty(property) && !defaults.hasOwnProperty(property)) {\n\t\t\t\tconsole.warn('Property \"' + property + '\" (set from ' + source + ') should have a default');\n\t\t\t}\n\t\t}\n\t},\n\t\n\t_getSavedConfig: function() {\n\t\tif (localStorage !== undefined) {\n\t\t\tvar saved = localStorage.getItem(this._storageId);\n\t\t\tif (saved != null) {\n\t\t\t\treturn JSON.parse(saved);\n\t\t\t} else {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t},\n\t\n\tpersist: function(options) {\n\t\tif (localStorage !== undefined) {\n\t\t\tvar saved = this._getSavedConfig();\n\t\t\tif (saved != null) {\n\t\t\t\toptions = $.extend({}, saved, options);\n\t\t\t}\n\t\t\tlocalStorage.setItem(this._storageId, JSON.stringify(options));\n\t\t}\n\t}\n});\n\nexport default Config;\n","import global from './global';\nimport params from './params';\n\t\n//all taken from http://detectmobilebrowsers.com/ (licence is UNLICENSE - http://unlicense.org/)\n\nvar firstRegex = /(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i;\n\nvar secondRegex = /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i;\n\nvar devHack = params.test('mobile');\n\nexport default {\n\tisMobile: function() {\n\t\tif (devHack) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\tvar testString = global.navigator.userAgent||global.navigator.vendor||global.opera;\n\t\t\treturn firstRegex.test(testString) || secondRegex.test(testString.substr(0,4));\n\t\t}\n\t}\n};\n","import leaflet from 'VendorWrappers/leaflet';\nimport $ from 'jquery';\nimport fullscreen_link from './fullscreen_link';\nimport mobile from './mobile';\n\nvar MapView = leaflet.Class.extend({\n\tinitialize: function (config) {\n\t\tthis._config = config;\n\t\tthis._createView();\n\t\t// set up the map\n\t\tthis._map = new leaflet.Map(this._config.map_element_id, {\n\t\t\t//these controls will be added by the controls module\n\t\t\tzoomControl: false\n\t\t});\n\n\t\t//set start point\n\t\tthis._map.setView(new leaflet.LatLng(this._config.start_position[0], this._config.start_position[1]), this._config.initial_zoom);\n\t\tfullscreen_link(this._config, this._map);\n\t\t\n\t\t//hook up listener to save the location when we move it\n\t\tthis._map.on('zoomend moveend dragend', function() {\n\t\t\tthis._saveLocation();\n\t\t}, this);\n\t},\n\t\n\t//creates the html we need to display errors, loading screen and the map container\n\t_createView: function() {\n\t\tvar content = '';\n\t\t\n\t\tvar mapClass = '';\n\t\tif (this._config.map_style == 'mini' || this._config.map_style == 'mini_embedded') {\n\t\t\tmapClass = ' class=\"mini-map\"';\n\t\t} else if (this._config.map_style == 'full') {\n\t\t\tmapClass = ' class=\"full-screen\"';\n\t\t} else if (this._config.map_style == 'embedded') {\n\t\t\tmapClass = ' class=\"embedded-map\"';\n\t\t}\n\n\t\tif (this._config.map_style == 'mini' || this._config.map_style == 'mini_embedded') {\n\t\t\tcontent+= \t'<div class=\"mini-map\">';\n\t\t}\n\t\tcontent+= \t\t'<div id=\"' + this._config.map_element_id + '\"' + mapClass + '></div>';\n\t\tif (this._config.map_style == 'mini') {\n\t\t\tcontent+= \t'</div>';\n\t\t\tcontent+= \t'<div class=\"full-screen-link\"></div>';\n\t\t}\n\n\t\tif (this._config.map_style == 'full') {\n\t\t\tthis._config.map_outer_container_element.addClass('full-screen');\n\t\t}\n\t\tif (mobile.isMobile()) {\n\t\t\tthis._config.map_outer_container_element.addClass('mobile');\n\t\t}\n\t\tthis._config.map_outer_container_element.prepend($(content));\n\t},\n\t\n\t_saveLocation: function() {\n\t\tvar center = this._map.getCenter();\n\t\tvar start_position = [center.lat, center.lng];\n\t\tvar initial_zoom = this._map.getZoom();\n\t\tif (localStorage !== undefined) {\n\t\t\tvar hash = {\n\t\t\t\tstart_position: start_position,\n\t\t\t\tinitial_zoom: initial_zoom\n\t\t\t};\n\t\t\tthis._config.persist(hash);\n\t\t}\n\t},\n\n\tgetMap: function () {\n\t\treturn this._map;\n\t}\n});\n\nexport default MapView\n","import 'leaflet.markercluster/dist/MarkerCluster.Default.css'\nimport 'leaflet.markercluster/dist/MarkerCluster.css'\n\nimport leaflet_cluster from \"leaflet.markercluster\";\n\nexport default leaflet_cluster\n","import SubGroup from \"leaflet.featuregroup.subgroup/dist/leaflet.featuregroup.subgroup-src\";\nexport default SubGroup\n","import $ from 'jquery';\nimport _ from 'underscore';\nimport leaflet from 'VendorWrappers/leaflet';\nimport popupView from './popup_view';\nimport constants from './constants';\n\t\nexport default {\n\ttranslateMarker: function(markerConfig, bundleConfig, aspectName, manager) {\n\t\tvar latLng = markerConfig.latLng;\n\t\tvar name = markerConfig.name;\n\t\tvar extraTexts = markerConfig.extraTexts;\n\t\tvar exportName = markerConfig.exportName;\n\t\tvar icon = markerConfig.icon;\n\t\tvar url = markerConfig.url;\n\t\tvar visited = markerConfig.visited;\n\t\t\n\t\tif (!popupView.notEmpty(name)) {\n\t\t\tname = url;\n\t\t}\n\t\tif (popupView.notEmpty(exportName)) {\n\t\t\texportName = name;\n\t\t}\n\t\t\n\t\tvar popupText = popupView.buildPopup(manager, name, url, latLng, extraTexts, visited);\n\n\t\tvar markerOptions = {};\n\t\tif (bundleConfig.icons != null && bundleConfig.icons[icon] != null) {\n\t\t\tmarkerOptions.icon = bundleConfig.icons[icon];\n\t\t} else if (bundleConfig.defaultIcon != null) {\n\t\t\tmarkerOptions.icon = bundleConfig.defaultIcon;\n\t\t}\n\t\tmarkerOptions.layerId = markerConfig.layerId;\n\t\tvar marker = leaflet.marker(latLng, markerOptions);\n\t\tvar popupElem = $('<div>' + popupText + '</div>');\n\t\tif (manager.shouldManageVisits()) {\n\t\t\t$('input', popupElem).change(function() {\n\t\t\t\tvar endpoint = '';\n\t\t\t\tif (this.checked) {\n\t\t\t\t\tendpoint = 'recordVisit';\n\t\t\t\t} else {\n\t\t\t\t\tendpoint = 'removeVisit';\n\t\t\t\t}\n\t\t\t\t$.post({\n\t\t\t\t\turl: constants.backendBaseUrl + endpoint,\n\t\t\t\t\tdata: JSON.stringify({\n\t\t\t\t\t\tsource: aspectName,\n\t\t\t\t\t\tname: markerConfig.id\n\t\t\t\t\t}),\n\t\t\t\t\tcontentType: 'application/json',\n\t\t\t\t\txhrFields: {\n\t\t\t\t\t\twithCredentials: true\n\t\t\t\t\t}\n\t\t\t\t}).catch(function(jqXhr, textStatus, errorThrown) {\n\t\t\t\t\tif (jqXhr.status == 401) {\n\t\t\t\t\t\tconsole.log(\"Authentication required\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.log(\"Request failed: \" + jqXhr.status + \", \" + textStatus + \", \" + errorThrown);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t\tmarker.bindPopup(popupElem[0]);\n\t\t\n\t\texportName = _.escape(markerConfig.exportName);\n\t\tvar cmt = null;\n\t\tvar desc = null;\n\t\tif (extraTexts != null) {\n\t\t\tcmt = _.escape(popupView.buildShortDescription(extraTexts));//build the extra texts html but escape it to encode into the exported xml\n\t\t\tdesc = _.escape(popupView.buildDescription(extraTexts));//build the extra texts html but escape it to encode into the exported xml\n\t\t}\n\t\t//selection control looks for .exportData in its default actions\n\t\tmarker.exportData = {\n\t\t\tname: exportName,\n\t\t\tlink: url,\n\t\t\tcmt: cmt,\n\t\t\tdesc: desc\n\t\t};\n\t\treturn marker;\n\t}\n};\n","import _ from \"underscore\";\nimport $ from \"jquery\";\nimport leaflet from \"leaflet\";\nimport leaflet_cluster from \"VendorWrappers/leaflet-marker-cluster\";\nimport LeafletSubgroup from \"VendorWrappers/leaflet-subgroup\";\nimport markerView from \"./marker_view\";\n\nvar PointsView = leaflet.Class.extend({\n\tinitialize: function (map, config, modelsByAspect, matrixLayerControl, controls, bundles, manager) {\n\t\tthis._map = map;\n\t\tthis._config = config;\n\t\tthis._modelsByAspect = modelsByAspect;\n\t\tthis._matrixLayerControl = matrixLayerControl;\n\t\tthis._controls = controls;\n\t\tthis._bundles = bundles;\n\t\tthis._parentGroup = null;\n\t\tthis._manager = manager;\n\t},\n\n\t_translateMarkerGroup: function(group, bundleConfig, aspect) {\n\t\tif (group != null) {\n\t\t\tif (group.constructor === Array) {\n\t\t\t\tgroup.forEach(function(markerConfig, i, group) {\n\t\t\t\t\tgroup[i] = markerView.translateMarker(markerConfig, bundleConfig, aspect, this._manager);\n\t\t\t\t}, this);\n\t\t\t} else { //is hash\n\t\t\t\tfor (var dimension in group) {\n\t\t\t\t\tgroup[dimension] = this._translateMarkerGroup(group[dimension], bundleConfig, aspect);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn group;\n\t},\n\t\n\tfinish: function (finished) {\n\t\tvar deferredObject = $.Deferred();\n\t\t\n\t\tif (this._config.cluster) {\n\t\t\tvar mapElem = $('div#map');\n\t\t\tvar radius = (Math.max(mapElem[0].offsetHeight, mapElem[0].offsetWidth) / 10);\n\t\t\tthis._parentGroup = new leaflet_cluster.MarkerClusterGroup({\n\t\t\t\tdisableClusteringAtZoom: 15,\n\t\t\t\tmaxClusterRadius: radius,\n\t\t\t\tchunkedLoading: true,\n\t\t\t\tchunkProgress: function (processed, total, elapsed, layersArray) {\n\t\t\t\t\tif (processed === total) {\n\t\t\t\t\t\tdeferredObject.resolve();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tthis._parentGroup = leaflet.layerGroup();\n\t\t\tdeferredObject.resolve();\n\t\t}\n\t\t\n\t\tthis._parentGroup.addTo(this._map);\n\t\tif (!this._config.dimensional_layering) {\n\t\t\tvar markerLists = Object.keys(this._modelsByAspect).map(function(aspect) {\n\t\t\t\tvar model = this._modelsByAspect[aspect];\n\t\t\t\treturn this._translateMarkerGroup(model.getMarkerList(), model.getBundleConfig(), aspect);\n\t\t\t}.bind(this)).filter(function(value) {\n\t\t\t\treturn value != null;\n\t\t\t});\n\t\t\tvar allMarkers = [].concat.apply([], markerLists);\n\t\t\tif (this._config.cluster) {\n\t\t\t\tvar nullLayerId = \"null\";\n\t\t\t\tvar markersByLayer = allMarkers.reduce(function (markersByLayer, marker) {\n\t\t\t\t\tvar layerId = marker.options.layerId;\n\t\t\t\t\tlayerId = layerId == null ? nullLayerId : layerId;//because the Object.keys layer will coerce into a string anyway\n\t\t\t\t\tif (markersByLayer[layerId] == null) {\n\t\t\t\t\t\tmarkersByLayer[layerId] = [];\n\t\t\t\t\t}\n\t\t\t\t\tmarkersByLayer[layerId].push(marker);\n\t\t\t\t\treturn markersByLayer;\n\t\t\t\t}, {});\n\t\t\t\t\n\t\t\t\t//add things that don't specify a layer to the default clustered layer\n\t\t\t\tthis._parentGroup.addLayers(markersByLayer[nullLayerId]);\n\t\t\t\t//add everything else to individual, non-clustered, layers\n\t\t\t\tObject.keys(markersByLayer).filter(function(layerId) {\n\t\t\t\t\treturn layerId !== nullLayerId;\n\t\t\t\t}).forEach(function(layerId) {\n\t\t\t\t\tvar markers = markersByLayer[layerId];\n\t\t\t\t\tvar layerGroup = leaflet.layerGroup();\n\t\t\t\t\tfor (var i = 0; i < markers.length; i++) {\n\t\t\t\t\t\tlayerGroup.addLayer(markers[i]);\n\t\t\t\t\t}\n\t\t\t\t\tlayerGroup.addTo(this._map);\n\t\t\t\t}.bind(this));\n\t\t\t} else {\n\t\t\t\tfor (var i = 0; i < allMarkers.length; i++) {\n\t\t\t\t\tthis._parentGroup.addLayer(allMarkers[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tfor (var aspect in this._modelsByAspect) {\n\t\t\t\tvar model = this._modelsByAspect[aspect];\n\t\t\t\tthis.addClusteredModel(aspect, model);\n\t\t\t}\n\t\t}\n\t\t\n\t\treturn deferredObject.promise();\n\t},\n\t\n\taddClusteredModel: function(aspect, model) {\n\t\tif (model.getMarkerList() != null) {\n\t\t\tvar markerList = this._translateMarkerGroup(model.getMarkerList(), model.getBundleConfig(), aspect);\n\t\t\tvar matrixOverlays = {};\n\t\t\tthis.depthFirstIteration(markerList, '', matrixOverlays);\n\t\t\tvar aspectOptions = this._bundles[aspect];//will have other options, but collisions are unlikely\n\t\t\tthis._matrixLayerControl.addAspect(aspect, matrixOverlays, aspectOptions);\n\t\t}\n\t},\n\t\n\tdepthFirstIteration: function(markers, path, overlays) {\n\t\tif (markers.constructor === Array) {\n\t\t\tvar subGroup = new LeafletSubgroup(this._parentGroup, markers);\n\t\t\t//don't add to the map yet - let the layer control do that if it thinks it needs to - otherwise we could add all layers then immediately try to remove them all, which can cause UI weirdness\n\t\t\toverlays[path] = subGroup;\n\t\t} else {\n\t\t\tObject.keys(markers).forEach(function (dimValue) {\n\t\t\t\tvar newPath = path.length === 0 ? dimValue : path + '/' + dimValue;\n\t\t\t\tvar sublist = markers[dimValue];\n\t\t\t\tthis.depthFirstIteration(sublist, newPath, overlays);\n\t\t\t}.bind(this));\n\t\t}\n\t}\n});\n\nexport default PointsView;\n","import $ from 'jquery';\nimport leaflet from 'VendorWrappers/leaflet';\n\t\nvar GeojsonView = leaflet.Class.extend({\n\tinitialize: function (map, config, modelsByAspect, matrixLayerControl, bundles) {\n\t\tthis._map = map;\n\t\tthis._config = config;\n\t\tthis._modelsByAspect = modelsByAspect;\n\t\tthis._matrixLayerControl = matrixLayerControl;\n\t\tthis._bundles = bundles;\n\t},\n\t\n\tfinish: function (finished) {\n\t\tif (!this._config.dimensional_layering && Object.keys(this._modelsByAspect).length > 0) {\n\t\t\tthrow new Error(\"!dimensional_layering is not supported yet.\");\n\t\t} else {\n\t\t\tvar parentGroup = leaflet.layerGroup();\n\t\t\tvar markerLists = Object.keys(this._modelsByAspect).forEach(function(aspect) {\n\t\t\t\tvar model = this._modelsByAspect[aspect];\n\t\t\t\tthis.addClusteredModel(aspect, model);\n\t\t\t}.bind(this));\n\t\t}\n\t\t//no async here, but stick to the convention of the other views\n\t\treturn $.Deferred().resolve().promise();\n\t},\n\t\n\taddClusteredModel: function(aspect, model) {\n\t\tvar aspectOptions = this._bundles[aspect];//will have other options, but collisions are unlikely\n\t\tvar layers = model.buildLayers();\n\t\tObject.values(layers).forEach(function(layer) {\n\t\t\tlayer.addTo(this._map)\n\t\t}.bind(this));\n\t\tthis._matrixLayerControl.addAspect(aspect, layers, aspectOptions);\n\t}\n});\n\nexport default GeojsonView;\n","import MatrixControl from \"leaflet-matrix-layers-control\";\n\nimport \"leaflet-matrix-layers-control/src/matrixControl.css\";\n\nexport default MatrixControl\n","import leaflet from 'VendorWrappers/leaflet';\nimport params from '../params';\n\nvar UrlHandler = leaflet.Class.extend({\n\tinitialize: function () {\n\t\tthis._tester = new params.tester();\n\t},\n\n\tsourceLoaded: function(sourceName) {\n\t\tthis._tester.update();\n\t\tvar params = this._tester.getParams();\n\t\tvar datasource = params['datasources'];\n\t\tdatasource = datasource == null ? '' : datasource;\n\t\tdelete params['datasources'];\n\t\tdatasource = datasource.length > 0 ? datasource + \",\" + sourceName : sourceName\n\t\tvar newParams = Object.keys(params).map(function(paramKey) {\n\t\t\treturn paramKey + \"=\" + params[paramKey];\n\t\t}).join('&');\n\t\tnewParams = (newParams.length > 0 ? newParams + '&' : '') + 'datasources=' + datasource\n\t\tvar newUrl = document.location.origin + document.location.pathname + '?' + newParams;\n\t\t//history.replaceState({}, \"GeoBagging\", newUrl);//do nothing for now until we come up with a nice way to make this bookmarkable\n\t}\n});\n\nexport default UrlHandler;\n","import leaflet from 'VendorWrappers/leaflet';\nimport $ from 'jquery';\nimport PointsView from './points_view';\nimport GeojsonView from './geojson_view';\nimport AbstractPointsBuilder from './bundles/abstract_points_builder';\nimport AbstractGeojsonBuilder from './bundles/abstract_geojson_builder';\nimport Leaflet_MatrixLayers from 'VendorWrappers/leaflet-matrix-layers-control';\nimport UrlHandler from './utils/url_handler';\n\nvar ModelViews = leaflet.Class.extend({\n\tinitialize: function (bundles, manager) {\n\t\tthis._bundles = bundles;\n\t\tthis._manager = manager;\n\t\tthis._controls = manager.getControls();\n\t\tthis._matrixLayerControl = null;\n\t\tthis._urlHandler = new UrlHandler();\n\t},\t\t\t\n\t\n\t_filterModels: function(bundleModels, className) {\n\t\tvar matchingModels = {};\n\t\tObject.keys(bundleModels).filter(function(bundleName) {\n\t\t\tvar model = bundleModels[bundleName];\n\t\t\treturn model instanceof className;\n\t\t}).forEach(function(bundleName) {\n\t\t\tmatchingModels[bundleName] = bundleModels[bundleName];\n\t\t});\n\t\treturn matchingModels;\n\t},\n\t\n\t_addLazyModels: function(lazyModels, addCallback) {\n\t\tObject.keys(lazyModels).forEach(function(bundleName) {\n\t\t\tvar model = lazyModels[bundleName];\n\t\t\tvar callback = function() {\n\t\t\t\tmodel.fetchData().done(function() {\n\t\t\t\t\taddCallback(bundleName, model);\n\t\t\t\t\tthis._addAttribution(bundleName, model);\n\t\t\t\t\tthis._urlHandler.sourceLoaded(bundleName);\n\t\t\t\t}.bind(this));\n\t\t\t}.bind(this);\n\t\t\tvar meta = model.getMeta();\n\t\t\tvar description = meta.recordCount + \" items (last updated \" + meta.lastUpdated + \")\";\n\t\t\tvar bundleDetails = this._bundles[bundleName];\n\t\t\tthis._matrixLayerControl.addLazyAspect(bundleName, bundleDetails, {\n\t\t\t\tdescription: description,\n\t\t\t\tcallback: callback\n\t\t\t});\n\n\t\t}.bind(this));\n\t},\n\t\n\t_addAttribution: function(bundleName, model) {\n\t\tvar attribution = model.getAttribution();\n\t\tif (attribution != null && attribution.length > 0) {\n\t\t\tvar dataSourceLabel = model.getBundleConfig().aspectLabel;\n\t\t\tthis._controls.addAttribution(dataSourceLabel, attribution);\n\t\t}\n\t},\n\t\n\tloadModelViews: function(bundleModels, lazyModels, config, callback) {\n\t\tvar pointsModels = this._filterModels(bundleModels, AbstractPointsBuilder);\n\t\tvar geojsonModels = this._filterModels(bundleModels, AbstractGeojsonBuilder);\n\t\tvar lazyPointsModels = this._filterModels(lazyModels, AbstractPointsBuilder);\n\t\tvar lazyGeojsonModels = this._filterModels(lazyModels, AbstractGeojsonBuilder);\n\t\tif (config.dimensional_layering) {\n\t\t\t\n\t\t\tthis._matrixLayerControl = new Leaflet_MatrixLayers(this._manager.getLayers(), null, {}, {\n\t\t\t\tmultiAspects: true,\n\t\t\t\tembeddable: config.use_sidebar\n\t\t\t});\n\t\t}\n\t\t\n\t\tvar pointsView = new PointsView(this._manager.getMap(), config, pointsModels, this._matrixLayerControl, this._controls, this._bundles, this._manager);\n\t\tvar geojsonView = new GeojsonView(this._manager.getMap(), config, geojsonModels, this._matrixLayerControl, this._bundles);\n\t\tvar promises = [\n\t\t\tpointsView.finish(),\n\t\t\tgeojsonView.finish()\n\t\t];\n\t\t\n\t\tif (config.dimensional_layering) {\n\t\t\tthis._addLazyModels(lazyPointsModels, function (bundleName, model) {\n\t\t\t\tpointsView.addClusteredModel(bundleName, model);\n\t\t\t});\n\t\t\tthis._addLazyModels(lazyGeojsonModels, function (bundleName, model) {\n\t\t\t\tgeojsonView.addClusteredModel(bundleName, model);\n\t\t\t});\n\t\t}\n\t\t\n\t\t$.when.apply($, promises).always(function() {\n\t\t\tif (config.dimensional_layering) {\n\t\t\t\t//override the basic layers control\n\t\t\t\tthis._controls.addControl(this._matrixLayerControl);\n\t\t\t}\n\t\t\t//add attribution texts\n\t\t\tObject.keys(bundleModels).forEach(function(aspect) {\n\t\t\t\tvar model = bundleModels[aspect];\n\t\t\t\tthis._addAttribution(aspect, model);\n\t\t\t}.bind(this));\n\t\t\tcallback();\n\t\t}.bind(this));\n\t}\n});\n\nexport default ModelViews;\n","import $ from 'jquery';\nimport leaflet from 'VendorWrappers/leaflet';\nimport constants from './constants';\nimport ModelViews from './model_views';\nimport params from './params';\n\nconst cache = {};\n\nfunction importAll (r) {\n    r.keys().forEach(key => {\n        cache[key] = r(key).default\n    });\n}\n\nimportAll(require.context('./bundles/', true, /config.*\\.js$/));\n\nvar SourceLoader = leaflet.Class.extend({\n\tinitialize: function (manager, config) {\n\t\tthis._manager = manager;\n\t\tthis._config = config;\n\t},\n\t\n\tloadSources: function(selectedSourceIds) {\n\t\tvar extraDataSourcesString = params.test('extra-datasources');\n\t\tvar extraDataSources = (extraDataSourcesString != null && extraDataSourcesString.length > 0) ? extraDataSourcesString.split(',') : [];\n\t\tvar sourceIds = $.uniqueSort(selectedSourceIds.concat(constants.dataSources, extraDataSources));\n\t\tvar sourceModuleIds = this._sourceIdsToDataSources(sourceIds);\n\t\tvar deferredObject = $.Deferred();\n\t\tvar sources = {}\n\t\tsourceModuleIds.forEach(function(source) {\n\t\t\tvar sourceModule = cache['./' + source + '.js']\n\t\t\tif (typeof sourceModule == 'function') {\n\t\t\t\tsourceModule = sourceModule(this._config)\n\t\t\t}\n\t\t\tsources[source] = sourceModule\n\t\t\t//will require all at compile time and therefore all will be bundled for the client, but we only put in the code into the running vm that is from the source\n\t\t}.bind(this))\n\n\t\t\t//https://cdn.jsdelivr.net/gh/tstibbs/geo-bagging@gh-pages/js/bundles/nt/data.json\n\t\t\tvar sourceDataPrefix = (this._config.remoteData ? 'https://cdn.jsdelivr.net/gh/tstibbs/geo-bagging@gh-pages' : this._config.baseUrl);//some mobile browsers don't support local ajax, so this provides a workaround for dev on mobile devices.\n\t\t\t\n\t\t\tvar sourceModels = {};\n\t\t\tvar lazyModels = {};\n\t\t\tvar promises = Object.keys(sources).map(function(sourceName) {\n\t\t\t\tvar source = sources[sourceName];\n\t\t\t\tvar parser = new source.parser(this._manager, source, sourceName, sourceDataPrefix);\n\t\t\t\t\n\t\t\t\tvar metaPromise = parser.fetchMeta();\n\t\t\t\tif (selectedSourceIds.indexOf(sourceName) != -1) {\n\t\t\t\t\tvar dataPromise = parser.fetchData();\n\t\t\t\t\tsourceModels[sourceName] = parser;\n\t\t\t\t\treturn $.when(metaPromise, dataPromise);\n\t\t\t\t} else {\n\t\t\t\t\tlazyModels[sourceName] = parser;\n\t\t\t\t\treturn metaPromise;\n\t\t\t\t}\n\t\t\t}.bind(this));\n\t\t\t\n\t\t\t$.when.apply($, promises).always(function() {\n\t\t\t\tvar modelViews = new ModelViews(sources, this._manager);\n\t\t\t\tmodelViews.loadModelViews(sourceModels, lazyModels, this._config, this._finish);\n\t\t\t\t//don't need to wait for ModelViews to finish, callback will update UI when the time comes, but can safely return after this call\n\t\t\t\tdeferredObject.resolve();\n\t\t\t}.bind(this));\n\t\t\t\n\t\tsetTimeout(() => {\n\t\t\tthis._finish()\n\t\t\tdeferredObject.resolve();\n\t\t}, 1)\n\t\treturn deferredObject.promise();//TODO if one of the bundles is missing, we error, but the error is hidden...\n\t},\n\t\n\t_sourceIdsToDataSources: function(allSources) {\n\t\tif (allSources != null) {\n\t\t\tallSources = allSources.map(function(source) {\n\t\t\t\tif (source.indexOf('/') == -1) {\n\t\t\t\t\treturn source + '/config';\n\t\t\t\t} else {\n\t\t\t\t\treturn source;\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tallSources = [];\n\t\t}\n\t\treturn allSources;\n\t},\n\t\n\t_finish: function() {\n\t\t$('div#loading-message-pane').hide();\n\t}\n});\n\nexport default SourceLoader;\n","import ControlHider from \"leaflet-control-hider\";\n\nimport \"leaflet-control-hider/src/hider.css\";\n\nexport default ControlHider\n","import {BoxSelectorControl, BoxSelectorGpx} from \"VendorWrappers/leaflet-box-selector\";\n\nvar SelectionControl = BoxSelectorControl.extend({\n\toptions: {\n\t\tactions: {\n\t\t\tgpx: {\n\t\t\t\tdisplay: \"Export to GPX file\",\n\t\t\t\taction: BoxSelectorGpx(function() {\n\t\t\t\t\t//just append the date in case they export multiple - prevents the browser overwriting it\n\t\t\t\t\tvar d = new Date();\n\t\t\t\t\tvar dateString = d.getFullYear() + \"-\" + (d.getMonth()+1) + \"-\" + d.getDate() + \"_\" + d.getHours() + \"-\" + d.getMinutes() + \"-\" + d.getSeconds();\n\t\t\t\t\treturn \"geoPoints_\" + dateString + \".gpx\";\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t}\n});\n\nexport default SelectionControl\n","import leaflet_locate from \"leaflet.locatecontrol\";\nimport 'leaflet.locatecontrol/dist/L.Control.Locate.min.css'\n\nvar Locate = leaflet_locate.extend({\n\toptions: {\n\t\tkeepCurrentZoomLevel: true,\n\t\tsetView: 'once'\n\t}\n});\n\nexport default Locate\n","import MousePosition from 'leaflet-mouse-position';\n\nimport \"leaflet-mouse-position/src/L.Control.MousePosition.css\";\n\nexport default MousePosition\n","import Leaflet_MousePosition from 'VendorWrappers/leaflet-mouse-position'\nimport conversion from \"./conversion\";\n\nvar MousePositionOsgb = Leaflet_MousePosition.extend({\n\toptions: {\n\t\tformatter: function (lng, lat) {\n\t\t\treturn conversion.latLngToGridRef(lat, lng);\n\t\t}\n\t}\n});\n\nexport default MousePositionOsgb\n\t","import MapCenterCoord from \"Leaflet.MapCenterCoord/src/L.Control.MapCenterCoord\";\n\nimport \"Leaflet.MapCenterCoord/src/L.Control.MapCenterCoord.css\";\n\nexport default MapCenterCoord\n","import Leaflet_ScreenPosition from \"VendorWrappers/leaflet-map-center-coord\";\nimport conversion from \"./conversion\";\nimport $ from \"jquery\";\n\nvar ScreenPositionOsgb = Leaflet_ScreenPosition.extend({\n\toptions: {\n\t\tonMove: true,\n\t\ticon: true,\n\t\tlatLngFormatter: function (lat, lng) {\n\t\t\treturn conversion.latLngToGridRef(lat, lng);\n\t\t}\n\t},\n\t\n\taddTo: function(map) {\n\t\tLeaflet_ScreenPosition.prototype.addTo.call(this, map);\n\t\tthis._addShowHideHandling();\n\t},\n\t\n\t_addShowHideHandling: function() {\n\t\tvar $icon = $('div.leaflet-control-mapcentercoord-icon.leaflet-zoom-hide');\n\t\tvar isIconVisible = false;\n\t\tvar $control = $('div.leaflet-control-mapcentercoord.leaflet-control');\n\t\t\n\t\tfunction hideIcon() {\n\t\t\t$icon.css('visibility', 'hidden');\n\t\t\tisIconVisible = false;\n\t\t}\n\t\t\n\t\tfunction showIcon() {\n\t\t\t$icon.css('visibility', 'visible');\n\t\t\tisIconVisible = true;\n\t\t}\n\t\t\n\t\t$control.click(function() {\n\t\t\tif (isIconVisible) {\n\t\t\t\thideIcon();\n\t\t\t} else {\n\t\t\t\tshowIcon();\n\t\t\t}\n\t\t});\n\t\t//start with crosshairs hidden\n\t\thideIcon();\n\t}\n});\n\nexport default ScreenPositionOsgb\n","import Sidebar from 'sidebar-v2/js/leaflet-sidebar';\n\nimport \"sidebar-v2/css/leaflet-sidebar.css\";\n\nexport default Sidebar\n","import $ from 'jquery';\nimport leaflet from 'VendorWrappers/leaflet';\n\nvar AttributionView = leaflet.Class.extend({\n\tinitialize: function(container) {\n\t\tthis._container = container;\n\t},\n\t\n\taddAttribution: function(dataSourceName, text) {\n\t\tvar wrapper = $('<div class=\"attribution-entry\"></div>');\n\t\twrapper.append($('<span class=\"attribution-source\"></span>').text(dataSourceName));\n\t\twrapper.append($('<span></span>').html(text));\n\t\tthis._container.append(wrapper);\n\t},\n});\n\nexport default AttributionView\n","import $ from 'jquery';\nimport leaflet from 'VendorWrappers/leaflet';\nimport constants from '../constants';\n\nvar UserMenu = leaflet.Class.extend({\n\tinitialize: function(manager) {\n\t\tthis._view = $('<div class=\"setting\"></div>');\n\t\tif (manager.isAuthenticated()) {\n\t\t\tthis._view.append($('<span>Logged in as ' + manager.getLoggedInUser() + '</span>'));\n\t\t} else {\n\t\t\tthis._view.append($('<a href=\"' + constants.backendBaseUrl + 'login\">Click here to log in</a>'));\n\t\t}\n\t},\n\n\tgetView: function() {\n\t\treturn this._view;\n\t}\n});\n\nexport default UserMenu\n","import $ from 'jquery';\nimport leaflet from 'VendorWrappers/leaflet';\nimport LeafletSidebar from 'VendorWrappers/sidebar';\nimport AttributionView from './attribution';\nimport UserView from './user';\nimport ConstraintsView from './constraints/view';\nimport params from '../params';\n\nvar MenuView = leaflet.Class.extend({\n\tinitialize: function(manager) {\n\t\tthis._manager = manager;\n\t\tthis._buildView();\n\t\tthis._buildControl();\n\t},\n\n\t_buildView: function() {\n\t\tvar view = '';\n\t\t\n\t\tvar classes = ['sidebar', 'collapsed', 'leaflet-container'];\n\t\t\n\t\tvar showUserSettings = (params.test('testing') == 'true');\n\t\t\n\t\t//top of the navigation bar\n\t\tview += '<div id=\"sidebar\" class=\"' + classes.join(' ') + '\">';\n\t\tview += '    <div class=\"sidebar-tabs\">';\n\t\tview += '        <ul role=\"tablist\">';\n\t\tview += '            <li><a href=\"#sidebar-layers\" role=\"tab\"><i class=\"fa fa-bars\"></i></a></li>';\n\t\tview += '            <li><a href=\"#sidebar-constraints\" role=\"tab\"><i class=\"fa fa-map-o\"></i></a></li>';\n\t\tview += '        </ul>';\n\n\t\t//bottom of the navigation bar\n\t\tview += '        <ul role=\"tablist\">';\n\t\tif (showUserSettings) {\n\t\t\tview += '            <li><a href=\"#sidebar-user\" role=\"tab\"><i class=\"fa fa-user\"></i></a></li>';\n\t\t}\n\t\tview += '            <li><a href=\"#sidebar-attribution\" role=\"tab\"><i class=\"fa fa-copyright\"></i></a></li>';\n\t\tview += '        </ul>';\n\t\tview += '    </div>';\n\n\t\t//tab contents\n\t\tview += '    <div class=\"sidebar-content\">';\n\t\tview += '        <div id=\"sidebar-layers\" class=\"sidebar-pane\">';\n\t\tview += '            <h1 class=\"sidebar-header\">Layers<span class=\"sidebar-close\"><i class=\"fa fa-caret-left\"></i></span></h1>';\n\t\tview += '        </div>';\n\t\tview += '        <div id=\"sidebar-constraints\" class=\"sidebar-pane\">';\n\t\tview += '            <h1 class=\"sidebar-header\">Data Limits<span class=\"sidebar-close\"><i class=\"fa fa-caret-left\"></i></span></h1>';\n\t\tview += '        </div>';\n\t\tview += '        <div id=\"sidebar-attribution\" class=\"sidebar-pane\">';\n\t\tview += '            <h1 class=\"sidebar-header\">Attribution<span class=\"sidebar-close\"><i class=\"fa fa-caret-left\"></i></span></h1>';\n\t\tview += '        </div>';\n\t\tif (showUserSettings) {\n\t\t\tview += '        <div id=\"sidebar-user\" class=\"sidebar-pane\">';\n\t\t\tview += '            <h1 class=\"sidebar-header\">User Settings<span class=\"sidebar-close\"><i class=\"fa fa-caret-left\"></i></span></h1>';\n\t\t\tview += '        </div>';\n\t\t}\n\t\tview += '    </div>';\n\t\tview += '</div>';\n\t\t\n\t\tthis._view = $(view);\n\t\tthis._manager.getConfig().map_outer_container_element.append(this._view);\n\t\t\n\t\tvar attributionContainer = $('<div></div>');\n\t\t$('#sidebar-attribution', this._view).append(attributionContainer);\n\t\tthis._attributionView = new AttributionView(attributionContainer);\n\t\t\n\t\tif (showUserSettings) {\n\t\t\tvar userView = new UserView(this._manager);\n\t\t\t$('#sidebar-user', this._view).append(userView.getView());\n\t\t}\n\t\t\n\t\tvar constraintsView = new ConstraintsView(this._manager);\n\t\t$('#sidebar-constraints', this._view).append(constraintsView.getView())\n\t},\n\t\n\t_buildControl: function() {\n\t\tthis._control = new LeafletSidebar('sidebar');\n\t},\n\t\n\taddTo: function(map) {\n\t\tthis._control.addTo(map);\n\t},\n\n\tgetContainer: function() {\n\t\treturn this._view[0];//get raw dom element from jquery\n\t},\n\t\n\taddLayers: function(matrixLayerControl) {\n\t\t$('#sidebar-layers', this._view).append(matrixLayerControl.getContainer());\n\t},\n\t\n\taddAttribution: function(dataSourceName, text) {\n\t\tthis._attributionView.addAttribution(dataSourceName, text);\n\t}\n});\n\nexport default MenuView;\n","import leaflet from 'VendorWrappers/leaflet';\nimport $ from 'jquery';\nimport Leaflet_ControlHider from 'VendorWrappers/leaflet-control-hider';\nimport Selection from './selection';\nimport Locate from './locate';\nimport mobile from './mobile';\nimport {GeosearchControl, GeosearchBing} from 'VendorWrappers/leaflet-geosearch'\nimport Mouseposition_Osgb from './mouseposition_osgb';\nimport Screenposition_Osgb from './screenposition_osgb';\nimport constants from './constants';\nimport MenuView from './menu/view';\nimport Leaflet_MatrixLayers from 'VendorWrappers/leaflet-matrix-layers-control';\n\n//even if some items aren't used in this particular configuration, we'll stick to a given order (resulting gaps are fine)\nvar order = [\n\tLeaflet_ControlHider,\n\tMenuView,\n\tleaflet.Control.Zoom,\n\tLocate,\n\tGeosearchControl,\n\tleaflet.Control.Layers, //matrix layers extends this, so will appear in the same slot\n\tSelection,\n\tMouseposition_Osgb,\n\tScreenposition_Osgb,\n\tleaflet.Control.Attribution\n];\n\nvar Controls = leaflet.Class.extend({\n\tinitialize: function(config, layers, map, manager) {\n\t\tthis._controlsToHide = [];\n\t\tthis._controlsToAdd = [];\n\t\tthis._config = config;\n\t\tthis._layers = layers;\n\t\tthis._manager = manager;\n\t\tthis._addDefaults();\n\t\tif (map != null) {\n\t\t\tthis._addAllTo(map);\n\t\t}\n\t},\n\t\n\t_addDefaults: function() {\n\t\t//default leaflet controls\n\t\tvar configOverrides = {};\n\t\tif (this._config.use_sidebar) {\n\t\t\tthis._menuView = new MenuView(this._manager);\n\t\t\tthis.addControl(this._menuView);\n\t\t\tconfigOverrides = {position: 'topright'};\n\t\t}\n\t\tif (this._config.show_zoom_control) {\n\t\t\tthis.addControl(new leaflet.Control.Zoom(configOverrides));\n\t\t}\n\t\t//custom controls\n\t\tif (this._config.show_selection_control) {\n\t\t\tthis.addControl(new Selection());\n\t\t}\n\t\tif (this._config.show_search_control) {\n\t\t\tthis.addControl(new GeosearchControl($.extend({\n\t\t\t\tshowPopup: true,\n\t\t\t\tprovider: new GeosearchBing({\n\t\t\t\t\tkey: constants.bingKey\n\t\t\t\t}),\n\t\t\t}, configOverrides)));\n\t\t}\n\t\tif (this._config.show_hider_control === true || (this._config.show_hider_control == 'mobile' && mobile.isMobile())) {\n\t\t\tthis.addControl(new Leaflet_ControlHider(this._controlsToHide, {\n\t\t\t\tvisibleByDefault: this._config.hider_control_start_visible\n\t\t\t}));\n\t\t}\n\t\tif (this._config.show_locate_control) {\n\t\t\tthis.addControl(new Locate(configOverrides));\n\t\t}\n\t\tif (this._config.show_layers_control && this._layers != null && Object.keys(this._layers).length > 1) {\n\t\t\tthis.addControl(new leaflet.Control.Layers(this._layers, null));\n\t\t}\n\t\tif (this._config.show_position_control) {\n\t\t\t//position displays\n\t\t\tif (mobile.isMobile()) {\n\t\t\t\tthis.addControl(new Screenposition_Osgb());\n\t\t\t} else {\n\t\t\t\tthis.addControl(new Mouseposition_Osgb());\n\t\t\t}\n\t\t}\n\t},\n\t\n\taddControl: function(control) {\n\t\tvar oldControl = null;\n\t\tvar found = false;\n\t\tfor (var i = 0; i < order.length; i++) {\n\t\t\tif (control instanceof order[i]) {\n\t\t\t\tif (this._controlsToAdd[i] != null) {\n\t\t\t\t\tif (console) {console.debug('Overwriting existing control \"' + this._controlsToAdd[i] + '\" with \"' + control + '\".');}\n\t\t\t\t\toldControl = this._controlsToAdd[i];\n\t\t\t\t}\n\t\t\t\tthis._controlsToAdd[i] = control;\n\t\t\t\tif (!(control instanceof Leaflet_ControlHider)) {\n\t\t\t\t\tthis._controlsToHide.push(control);\n\t\t\t\t}\n\t\t\t\tfound = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (!found) {\n\t\t\tconsole.error(\"Unrecognised control: \" + control);\n\t\t\tthis._controlsToHide.push(control);\n\t\t\tthis._controlsToAdd[Math.max(order.length, this._controlsToAdd.length)] = control;\n\t\t}\n\t\t//won't run for anything in addDefaults because this._map won't be populated at that point\n\t\tif (this._map != null) {\n\t\t\tcontrol.addTo(this._map); //add it, could be in the wrong place, but we'll move it later if necessary\n\t\t\tif (oldControl != null) {\n\t\t\t\tif (control instanceof Leaflet_MatrixLayers && oldControl instanceof leaflet.Control.Layers && this._config.use_sidebar) {\n\t\t\t\t\t//remove standard layer control and put the new one on the menu\n\t\t\t\t\toldControl.remove();\n\t\t\t\t\tthis._menuView.addLayers(control);\n\t\t\t\t} else {\n\t\t\t\t\tvar newContainer = control._container;\n\t\t\t\t\tvar oldContainer = oldControl._container;\n\t\t\t\t\t$(newContainer).remove(); //remove from incorrect location\n\t\t\t\t\t$(oldContainer).replaceWith(newContainer); //reattach at new location\n\t\t\t\t\toldControl.remove();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\t\n\t_addAllTo: function(map) {\n\t\tthis._controlsToAdd.forEach(function(control) {\n\t\t\tif (control != null) {\n\t\t\t\tcontrol.addTo(map);\n\t\t\t}\n\t\t}.bind(this));\n\t\tthis._map = map;\n\t},\n\t\n\taddAttribution: function(dataSourceName, text) {\n\t\tif (this._config.use_sidebar) {\n\t\t\tthis._menuView.addAttribution(dataSourceName, text);\n\t\t}\n\t}\n});\n\nexport default Controls;\n","import BingLayer from 'leaflet-plugins/layer/tile/Bing';\n\nexport default BingLayer\n","import leaflet from 'VendorWrappers/leaflet';\nimport LeafletBing from 'VendorWrappers/bing-layer';\nimport constants from './constants';\n\nvar defaults = {\n\tkey: constants.bingKey\n};\nvar bingDefaults = leaflet.extend({maxZoom: 18, minZoom: 0, detectRetina: true}, defaults)\n\n//OS\nvar bingOsLayer = new LeafletBing(leaflet.extend({imagerySet: \"OrdnanceSurvey\", minZoom: 12, maxZoom: 18, maxNativeZoom: 17}, defaults));//note OS doesn't support retina\n//fallback layer because the OS maps don't scale well when you zoom out\nvar bingFallbackLayer = new LeafletBing(leaflet.extend({imagerySet: \"RoadOnDemand\", maxZoom: 11, minZoom: 0}, defaults));//note even though this layer supports retetina, having a group with a mix of retina and non-retina screws up the zooming\nvar bingOsGroup = leaflet.layerGroup([bingOsLayer, bingFallbackLayer]);\n//Bing standard maps\nvar bingRoads = new LeafletBing(leaflet.extend({imagerySet: \"RoadOnDemand\"}, bingDefaults));\nvar bingHybrid = new LeafletBing(leaflet.extend({imagerySet: \"AerialWithLabelsOnDemand\"}, bingDefaults));\nvar bingAerial = new LeafletBing(leaflet.extend({imagerySet: \"Aerial\"}, bingDefaults));\n//OSM\nvar osm = new leaflet.TileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n\tminZoom: 0, maxZoom: 19, attribution: 'Map data  <a href=\"http://openstreetmap.org\">OpenStreetMap</a> contributors'\n});\n\nvar layers = {\n\t\"OS\": bingOsGroup,\n\t\"Bing Roads\": bingRoads,\n\t\"Bing Satellite\": bingAerial,\n\t\"Bing Hybrid\": bingHybrid,\n\t\"OSM\": osm\n};\n\nfunction _listenForLayerChange(layerId, layer, config) {\n\tlayer.on('add', function() {\n\t\tconfig.persist({defaultLayer: layerId});\n\t}.bind(this));\n}\n\nvar LayerAdder = function(map, config) {\n\t//if we have a default layer set, select that now\n\tvar layerToSelect = layers[config.defaultLayer];\n\tif (layerToSelect != null) {\n\t\tlayerToSelect.addTo(map);\n\t} else {\n\t\tbingOsGroup.addTo(map);\n\t}\n\n\t//set up listener to persist which layer is selected\n\tfor (var id in layers) {\n\t\t_listenForLayerChange(id, layers[id], config);\n\t}\n\t\n\treturn layers;\n};\n\nexport default LayerAdder\n","import $ from 'jquery';\nimport leaflet from 'VendorWrappers/leaflet';\nimport Controls from './controls';\nimport layersBuilder from './layers';\nimport constants from './constants';\nimport params from './params';\n\t\n//basic manager class that simplifies interoperation between other components\nvar Manager = leaflet.Class.extend({\n\tinitialize: function(map, config) {\n\t\tthis._authenticated = false;//default\n\t\tvar showUserSettings = (params.test('testing') == 'true');\n\t\tif (showUserSettings) {\n\t\t\tthis._initializePromise = $.get({\n\t\t\t\turl: constants.backendBaseUrl + 'isAuthenticated',\n\t\t\t\txhrFields: {\n\t\t\t\t\twithCredentials: true\n\t\t\t\t}\n\t\t\t}).then(function(data) {\n\t\t\t\tif (data == false) {\n\t\t\t\t\tthis._authenticated = false;\n\t\t\t\t} else {\n\t\t\t\t\tthis._authenticated = true;\n\t\t\t\t\tthis._loggedInUser = data.email;\n\t\t\t\t}\n\t\t\t}.bind(this)).fail(function(xhr, textError, error) {\n\t\t\t\tthis._authenticated = false;\n\t\t\t\tconsole.error(\"Failed to check authentication status - this can be ignored unless trying to record visits: \" + textError);\n\t\t\t\tconsole.log(error);\n\t\t\t});\n\t\t} else {\n\t\t\tthis._initializePromise = $.Deferred().resolve();\n\t\t}\n\t\tthis._initializePromise = this._initializePromise.always(function() {\n\t\t\tthis._map = map;\n\t\t\tthis._config = config;\n\t\t\tthis._layers = layersBuilder(map, config);\n\t\t\tthis._controls = new Controls(config, this._layers, map, this);\n\t\t}.bind(this));\n\t},\n\t\n\twaitForInitialization: function() {\n\t\treturn this._initializePromise;\n\t},\n\t\n\tsetViewConstraints: function(limitFunction) {\n\t\tthis._limitFunction = limitFunction;//function(latLng) {return true or false}\n\t},\n\t\n\tgetViewConstraints: function() {\n\t\treturn this._limitFunction;\n\t},\n\t\n\tgetControls: function() {\n\t\treturn this._controls;\n\t},\n\t\n\tgetMap: function() {\n\t\treturn this._map;\n\t},\n\t\n\tgetLayers: function() {\n\t\treturn this._layers;\n\t},\n\t\n\tgetConfig: function() {\n\t\treturn this._config;\n\t},\n\t\n\tsetAuthenticated: function(/*boolean*/ authenticated) {\n\t\tthis._authenticated = authenticated;\n\t},\n\t\n\tisAuthenticated: function() {\n\t\treturn this._authenticated;\n\t},\n\t\n\tshouldManageVisits: function() {\n\t\t//currently just checks that we're authenticated\n\t\treturn this.isAuthenticated();\n\t},\n\t\n\tgetLoggedInUser: function() {\n\t\treturn this._loggedInUser;\n\t}\n});\n\nexport default Manager\n","import Config from './config';\nimport params from './params';\nimport $ from 'jquery';\nimport MapView from './map_view';\nimport SourceLoader from './source_loader';\nimport Manager from './manager';\n\t\t\t\nexport default {\t\t\t\n\tgetBundleIds: function(bundles) {\n\t\tvar allBundles = [];\n\t\tif (bundles != null) {\n\t\t\tallBundles.push.apply(allBundles, bundles);\n\t\t}\n\t\tvar dataSourcesString = params.test('datasources');\n\t\tif (dataSourcesString != null && dataSourcesString.length > 0) {\n\t\t\tallBundles.push.apply(allBundles, dataSourcesString.split(','));\n\t\t}\n\t\t//legacy options\n\t\tif (params.test('hills') == 'true') {\n\t\t\tallBundles.push('hills');\n\t\t}\n\t\tif (params.test('trigs') == 'true') {\n\t\t\tallBundles.push('trigs');\n\t\t}\n\t\t//end legacy options\n\t\treturn allBundles;\n\t},\n\n\tloadMap: function(options, bundleIds) {\n\t\tif (options == null) {\n\t\t\toptions = {};\n\t\t}\n\t\tvar allBundles = this.getBundleIds(bundleIds);\n\t\tif (this.hasUrlData()) {\n\t\t\talert('Loading data from URL is no longer an option.');\n\t\t\tthrow new Error('Loading data from URL is no longer an option.');\n\t\t} else if (options.pointsToLoad != null) {\n\t\t\tvar generalPoints = options.pointsToLoad.generalPoints;\n\t\t\toptions.cluster = (generalPoints.length > 300);\n\t\t\toptions.dimensional_layering = false;\n\t\t\tallBundles = ['trigs/config_embedding'];\n\t\t}\n\t\toptions = $.extend({ //set some defaults that can be overriden by the page or by loadMiniMap\n\t\t\tcluster: true,\n\t\t\tdimensional_layering: true\n\t\t}, options);\n\t\t\n\t\tvar mapView = this._buildMap(options);\n\t\tvar manager = new Manager(mapView.getMap(), this._config);\n\t\treturn manager.waitForInitialization().then(function() {\n\t\t\treturn (new SourceLoader(manager, this._config)).loadSources(allBundles);\n\t\t}.bind(this)).then(function() {\n\t\t\treturn manager;\n\t\t});\n\t},\n\t\n\tloadMiniMap: function() {\n\t\t//set some defaults that can be overriden by the page\n\t\tvar options = {\n\t\t\tcluster: false,\n\t\t\tdimensional_layering: false,\n\t\t\tinitial_zoom: 10,\n\t\t\tstart_position: [54.454463, -3.213515],\n\t\t\tshow_search_control: false,\n\t\t\tshow_locate_control: false,\n\t\t\tshow_hider_control: true,\n\t\t\thider_control_start_visible: false,\n\t\t\tmap_style: 'mini',\n\t\t\tuse_sidebar: false\n\t\t};\n\t\tvar bundles = ['trigs/config_mini'];\n\t\tthis.loadMap(options, bundles);\n\t},\n\n\t_buildMap: function(options) {\n\t\tthis._config = new Config(options);\n\t\treturn new MapView(this._config);\n\t},\n\t\n\thasUrlData: function() {\n\t\treturn params.test('trigs') != null;\n\t}\n};\n","import $ from 'jquery';\nimport conversion from '../../conversion';\nimport CustomDefaultIcon from '../../custom_default_icon';\nimport trigpointingBase from './config_base';\nimport TrigsPointsBuilder from './points_builder';\nimport redIcon from '../../../img/hill.png'\n\nexport default function build(config) {\n\treturn $.extend(true, {}, trigpointingBase(config), {\n\t\ticons: {\n\t\t\tsearchResult: new CustomDefaultIcon(config, redIcon, {iconUrl: redIcon})\n\t\t},\n\t\tparser: TrigsPointsBuilder.extend({\n\t\t\tinitialize: function (manager, bundleConfig, bundleName, urlPrefix) {\n\t\t\t\tTrigsPointsBuilder.prototype.initialize.call(this, manager, bundleConfig, bundleName, urlPrefix);\n\t\t\t\tvar generalPoints = this._config.pointsToLoad.generalPoints;\n\t\t\t\tfor (var i = 0; i < generalPoints.length; i++) {\n\t\t\t\t\tvar point = generalPoints[i];\n\t\t\t\t\tvar lngLat = conversion.osgbToLngLat(point.eastings, point.northings);\n\t\t\t\t\tthis.addWithoutDimensions(lngLat, point.url, point.name);\n\t\t\t\t}\n\t\t\t\tvar significantPoint = this._config.pointsToLoad.significantPoint;\n\t\t\t\tif (significantPoint != null) {\n\t\t\t\t\tvar lngLat = conversion.osgbToLngLat(significantPoint.eastings, significantPoint.northings);\n\t\t\t\t\tvar iconName = 'searchResult';\n\t\t\t\t\tthis.addWithoutDimensions(lngLat, significantPoint.url, significantPoint.name, iconName);\n\t\t\t\t}\n\t\t\t},\n\t\t\t\n\t\t\tfetchData: function() {\n\t\t\t\t//not relevant, ignore\n\t\t\t\treturn $.Deferred().resolve().promise();\n\t\t\t},\n\n\t\t\tfetchMeta: function() {\n\t\t\t\t//not relevant, ignore\n\t\t\t\treturn $.Deferred().resolve().promise();\n\t\t\t}\n\t\t})\n\t});\n}\n","import AbstractPointsBuilder from '../abstract_points_builder';\n\nvar Builder = AbstractPointsBuilder.extend({\n\tparse: function(point) {\n\t\t//[Longitude,Latitude,Id,Name,Classification,Height(m)]\n\t\tvar lng = point[0];\n\t\tvar lat = point[1];\n\t\tvar id = point[2];\n\t\tvar name = point[3];\n\t\tvar classification = point[4];\n\t\tvar height = point[5];\n\t\t\n\t\tvar url = 'http://www.hill-bagging.co.uk/mountaindetails.php?rf=' + id;\n\n\t\tvar extraInfos = [\n\t\t\t['Height', height],\n\t\t\t['Classifications', this.split(classification, this._bundleConfig.hillDisplayNames)]\n\t\t];\n\t\tthis.addMarker(id, lat, lng, url, name, extraInfos, null, [classification]);\n\t},\n});\n\nexport default Builder\n","import leaflet from 'VendorWrappers/leaflet';\nimport PointsBuilder from './points_builder';\nimport CustomDefaultIcon from '../../custom_default_icon';\nimport hillIcon from '../../../img/hill.png'\n\nvar dimensionNames = ['Hills'];\nvar dimensionValueLabels = {};\nvar hillValueLabels = {};\ndimensionValueLabels[dimensionNames[0]] = hillValueLabels;\n\nvar displayNames = {\n\t'5': 'Dewey',\n\t'5D': 'Donald Dewey',\n\t'5H': 'Highland Five',\n\t'C': 'Corbett',\n\t'CouT': 'County Top',\n\t'D': 'Donald',\n\t'G': 'Graham',\n\t'Hew': 'Hewitt',\n\t'Hu': 'Hump',\n\t'M': 'Munro',\n\t'MT': 'Munro Top',\n\t'Ma': 'Marilyn',\n\t'N': 'Nutall',\n\t'SIB': 'Island (SIB)',\n\t'Sim': 'Simm',\n\t'TU': 'Tump',\n\t'W': 'Wainwright'\n};\nvar urlPaths = {\n\t'5': 'Deweys',\n\t'5D': 'HighlandFives',\n\t'5H': 'HighlandFives',\n\t'C': 'Corbetts',\n\t'CouT': 'CountyTops',\n\t'D': 'Donalds',\n\t'G': 'Grahams',\n\t'Hew': 'Hewitts',\n\t'Hu': 'HuMPs',\n\t'M': 'Munros',\n\t'MT': 'Munros',\n\t'Ma': 'Marilyns',\n\t'N': 'Nuttalls',\n\t'SIB': 'SIBs',\n\t'Sim': 'Simms',\n\t'TU': 'Tumps',\n\t'W': 'Wainwrights'\n};\n\nObject.keys(displayNames).forEach(function(key) {\n\thillValueLabels[key] = '<a href=\"http://www.hill-bagging.co.uk/' + urlPaths[key] + '.php\">' + displayNames[key] + '</a>';\n});\n\nvar redIconPath = hillIcon\n\nexport default function build(config) {\n\treturn {\n\t\taspectLabel: \"Hills\",\n\t\tdefaultIcon: new CustomDefaultIcon(config, redIconPath, {iconUrl: redIconPath}),\n\t\tdimensionNames: dimensionNames,\n\t\tdimensionValueLabels: dimensionValueLabels,\n\t\thillDisplayNames: displayNames,\n\t\tdataToLoad: 'data.json',\n\t\tparser: PointsBuilder,\n\t\tattribution: '&copy; <a href=\"http://www.hills-database.co.uk/downloads.html\">The Database of British and Irish Hills</a>'\n\t}\n};\n","import leaflet from 'VendorWrappers/leaflet';\nimport $ from 'jquery';\n\nvar CurrentAreaView = leaflet.Class.extend({\n\tinitialize: function (manager, constraintsView) {\n\t\tthis._manager = manager;\n\t\tthis._constraintsView = constraintsView;\n\n\t\tthis._view = $('<div class=\"setting\"></div>');\n\t\tthis._currentAreaLimit = $('<input type=\"checkbox\">');\n\t\tvar desc = $('<label>Limit new markers to current area</label>');\n\t\tdesc.prepend(this._currentAreaLimit);\n\t\t\n\t\tthis._currentAreaLimit.change(function(event) {\n\t\t\tif (event.target.checked) {\n\t\t\t\tthis._constraintsView.limitTo(this, this._manager.getMap().getBounds());\n\t\t\t} else {\n\t\t\t\tthis._constraintsView.unlimit();\n\t\t\t}\n\t\t}.bind(this));\n\t\t\n\t\tthis._view.append(desc);\n\t},\n\t\n\tgetView: function() {\n\t\treturn this._view;\n\t},\n\t\n\treset: function() {\n\t\tthis._currentAreaLimit.prop('checked', false);\n\t}\n});\n\nexport default CurrentAreaView\n","import AbstractPointsBuilder from '../abstract_points_builder';\n\nvar Builder = AbstractPointsBuilder.extend({\n\tparse: function(point) {\n\t\t//[Longitude,Latitude,Id,Name,Link,type,facilities]\n\t\tvar lng = point[0];\n\t\tvar lat = point[1];\n\t\tvar id = point[2];\n\t\tvar name = point[3];\n\t\tvar link = point[4];\n\t\tvar types = point[5];\n\t\tvar facilities = point[6];\n\t\t\n\t\tvar typeLabels = this._bundleConfig.dimensionValueLabels[this._bundleConfig.dimensionNames[0]];\n\t\tvar facilityLabels = this._bundleConfig.dimensionValueLabels[this._bundleConfig.dimensionNames[1]];\n\n\t\tvar extraInfos = [\n\t\t\t['Type', this.split(types, typeLabels)],\n\t\t\t['Facilities', this.split(facilities, facilityLabels)]\n\t\t];\n\n\t\tthis.addMarker(id, lat, lng, link, name, extraInfos, null, [types, facilities]);\n\t},\n});\n\nexport default Builder\n","import PointsBuilder from './points_builder';\n\nvar dimensionNames = [\"Type\", \"Facilities\"];\n\nvar dimensionValueLabels = {};\ndimensionValueLabels[dimensionNames[0]] = {\n\t'houses-and-buildings': \"Houses\",\n\t'gardens-and-parks': \"Gardens & parks\",\n\t'countryside': \"Countryside\",\n\t'coast-and-beaches': \"Coast & beaches\",\n\t'castles-and-forts': \"Castles & forts\",\n\t'sites-and-monuments': \"Sites & monuments\",\n\t'churches-and-chapels': \"Churches & chapels\",\n\t'mills-and-mines': \"Mills, forges & mines\",\n\t'villages-and-pubs': \"Villages & pubs\"\n};\ndimensionValueLabels[dimensionNames[1]] = {\n\t'family-friendly': \"Family-friendly\",\n\t'dog-friendly': \"Dog-friendly\",\n\t'disabled-access': \"Disabled access\",\n\t'for-hard-of-hearing': \"For deaf/hard of hearing\",\n\t'for-visually-impaired': \"For blind/visually impaired\",\n\t'places-to-eat-and-drink': \"Places to eat & drink\",\n\t'ideal-for-group-visits': \"Ideal for group visits\",\n\t'available-for-weddings': \"Available for weddings\",\n\t'fifty-things': \"50 things to do before you're 11 \"\n};\n\nexport default {\n\taspectLabel: \"National Trust\",\n\tdimensionNames: dimensionNames,\n\tdimensionValueLabels: dimensionValueLabels,\n\tdataToLoad: 'data.json',\n\tparser: PointsBuilder,\n\tattribution: '&copy; National Trust'\n};\n","import AbstractPointsBuilder from '../abstract_points_builder';\n\nvar Builder = AbstractPointsBuilder.extend({\n\tparse: function(point) {\n\t\t//[Longitude,Latitude,Name,Link,LifeboatTypes,LaunchMethods]\n\t\tvar lng = point[0];\n\t\tvar lat = point[1];\n\t\tvar name = point[2];\n\t\tvar link = point[3];\n\t\tvar types = point[4];\n\t\tvar launchMethods = point[5];\n\t\t\n\t\tvar typeLabels = this._bundleConfig.typeData;\n\t\tvar launchMethodLabels = this._bundleConfig.dimensionValueLabels[this._bundleConfig.dimensionNames[1]];\n\n\t\tvar extraInfos = [\n\t\t\t['Types', this.split(types, typeLabels)],\n\t\t\t['Launch Methods', this.split(launchMethods, launchMethodLabels)]\n\t\t];\n\t\tthis.addMarker(name, lat, lng, link, name, extraInfos, null, [types, launchMethods]);\n\t},\n});\n\nexport default Builder\n","import PointsBuilder from './points_builder';\n\nvar dimensionNames = [\"Lifeboat Types\", \"Launch Methods\"];\n\nvar typeData = {\n\t'Atlantic85': ['Atlantic 85', 'b-class-lifeboat'],\n\t'Atlantic75': ['Atlantic 75', 'b-class-lifeboat'],\n\t'D': ['D class', 'd-class-lifeboat'],\n\t'H': ['H class', 'rescue-hovercraft'],\n\t'E': ['E class', 'e-class-lifeboat'],\n\t'Mersey': ['Mersey', 'mersey-class-lifeboat'],\n\t'Tyne': ['Tyne', 'tyne-class-lifeboat'],\n\t'Trent': ['Trent', 'trent-class-lifeboat'],\n\t'Tamar': ['Tamar', 'tamar-class-lifeboat'],\n\t'Severn': ['Severn', 'severn-class-lifeboat'],\n\t'Shannon': ['Shannon', 'shannon-class-lifeboat']\n};\n\nvar baseUrl = \"https://rnli.org/what-we-do/lifeboats-and-stations/our-lifeboat-fleet/\";\nObject.keys(typeData).forEach(function(key) {\n\tvar label = typeData[key]\n\ttypeData[key] = [label[0], baseUrl + label[1]]\n});\n\nvar typeLabels = {};\nObject.keys(typeData).forEach(function(key) {\n\tvar label = typeData[key]\n\ttypeLabels[key] = '<a href=\"' + label[1] + '\">' + label[0] + '</a>';\n});\n\nvar dimensionValueLabels = {};\ndimensionValueLabels[dimensionNames[0]] = typeLabels;\ndimensionValueLabels[dimensionNames[1]] = {\n\t'MooredAfloat': 'Moored Afloat',\n\t'FloatingHouse': 'Floating House',\n\t'FloatingCradle': 'Floating Cradle',\n};\n\nexport default {\n\taspectLabel: \"RNLI\",\n\tdimensionNames: dimensionNames,\n\tdimensionValueLabels: dimensionValueLabels,\n\tdataToLoad: 'data.json',\n\tparser: PointsBuilder,\n\tattribution: 'Contains <a href=\"https://hub.arcgis.com/datasets/7dad2e58254345c08dfde737ec348166_0\">Open Data</a> licensed under the GIS Open Data Licence &copy; RNLI and data from <a href=\"https://en.wikipedia.org/wiki/List_of_RNLI_stations\">Wikipedia</a>',\n\ttypeData: typeData\n};\n","import $ from 'jquery';\nimport leaflet from 'VendorWrappers/leaflet';\nimport FileConstraintsLoadView from './track_load_view';\nimport CurrentLocationView from './current_location_view';\nimport CurrentAreaView from './current_area_view';\n\nvar ConstraintsView = leaflet.Class.extend({\n\tinitialize: function(manager) {\n\t\tthis._manager = manager;\n\t\tthis._limitOriginView = null;//the view that triggered the current limits\n\t\tthis._view = $('<div></div>');\n\t\tvar info = $('<div class=\"info\">This section allows you to limit how much data is displayed on screen. This can be useful for example when on older or mobile devices which may struggle to remain responsive if a large amount of data is loaded.</div>')\n\t\tthis._view.append(info);\n\t\tthis._view.append('<hr class=\"info\">');\n\t\t\n\t\tvar currentAreaView = new CurrentAreaView(manager, this)\n\t\tthis._view.append(currentAreaView.getView());\n\t\t\n\t\tvar currentLocationView = new CurrentLocationView(manager, this)\n\t\tthis._view.append(currentLocationView.getView());\n\t\t\n\t\tthis._fileConstraintsLoadView = new FileConstraintsLoadView(manager, this)\n\t\tthis._view.append(this._fileConstraintsLoadView.getView());\n\t\t\n\t\tvar reset = this._buildReset();\n\t\tthis._view.append(reset);\n\t},\n\t\n\t_buildReset: function() {\n\t\tvar wrapper = $('<div class=\"setting\"></div>');\n\t\tvar currentLocationLimitButton = $('<button type=\"button\">Reset</button>');\n\t\tcurrentLocationLimitButton.click(this.unlimit.bind(this));\n\t\twrapper.append(currentLocationLimitButton);\n\t\treturn wrapper;\n\t},\n\t\n\tlimitTo: function(limitOriginView, /*LatLngBounds*/ bounds) {\n\t\tthis.unlimit();\n\t\tthis._limitOriginView = limitOriginView;\n\t\tthis._manager.setViewConstraints(this._buildLimitFunction(bounds));\n\t\tif (this._constraintPolygon != null) {\n\t\t\tthis._constraintPolygon.remove();\n\t\t}\n\t\tvar polygonPoints = [\n\t\t\t[[-90, -180], [90, -180], [90, 180], [-90, 180]], //outer - should cover the entire map\n\t\t];\n\t\tif (!Array.isArray(bounds)) {\n\t\t\tbounds = [bounds];\n\t\t}\n\t\tbounds.forEach(function(hole) {\n\t\t\tpolygonPoints.push([hole.getSouthWest(), hole.getNorthWest(), hole.getNorthEast(), hole.getSouthEast()]); //hole\n\t\t});\n\t\tthis._constraintPolygon = new L.Polygon(polygonPoints, {\n\t\t\tcolor: 'rgb(0, 0, 0, 0)',\n\t\t\tfillColor: 'rgb(90, 90, 90)',\n\t\t\tfillOpacity: 0.3\n\t\t});\n\t\tthis._constraintPolygon.addTo(this._manager.getMap());\n\t},\n\t\n\t_buildLimitFunction: function(bounds) {\n\t\tif (Array.isArray(bounds)) {\n\t\t\treturn function(latLng) {\n\t\t\t\tfor (var i = 0; i < bounds.length; i++) {\n\t\t\t\t\tif (bounds[i].contains(latLng)) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t};\n\t\t} else {\n\t\t\treturn function(latLng) {\n\t\t\t\treturn bounds.contains(latLng);\n\t\t\t};\n\t\t}\n\t},\n\n\tunlimit: function() {\n\t\tif (this._limitOriginView != null) {\n\t\t\tthis._limitOriginView.reset();\n\t\t\tthis._limitOriginView = null;\n\t\t}\n\t\tthis._manager.setViewConstraints(null);\n\t\tif (this._constraintPolygon != null) {\n\t\t\tthis._constraintPolygon.remove();\n\t\t}\n\t},\n\t\n\tgetView: function() {\n\t\treturn this._view;\n\t}\n});\n\nexport default ConstraintsView\n","import leaflet from 'VendorWrappers/leaflet';\nimport AbstractBundleBuilder from './abstract_bundle_builder';\nimport popupView from '../popup_view';\n\nvar GeojsonLayer = AbstractBundleBuilder.extend({\n\tinitialize: function (manager, bundleConfig, bundleName, urlPrefix) {\n\t\tAbstractBundleBuilder.prototype.initialize.call(this, manager, bundleConfig, bundleName, urlPrefix);\n\t\tthis._data = null;\n\t\tthis._bundleConfig = bundleConfig;\n\t},\n\t\n\tfetchData: function(urlPrefix) {\n\t\treturn this._doFetchData(urlPrefix).done(function(data) {\n\t\t\tthis._data = data;\n\t\t}.bind(this));\n\t},\n\t\n\t_parseDatas: function() {\n\t\treturn this._data.features.map(function(feature) {\n\t\t\treturn this.parse(feature);\n\t\t}.bind(this));\n\t},\n\t\n\t_translateDatas: function(layerDatas) {\n\t\tvar layers = {};\n\t\tlayerDatas.forEach(function(layerData) {\n\t\t\tvar name = layerData.name;\n\t\t\tvar url = layerData.url;\n\t\t\tvar geojson = layerData.geojson;\n\t\t\tvar extraInfos = layerData.extraInfos;\n\t\t\t\n\t\t\tvar geoLayer = leaflet.geoJSON(geojson, {\n\t\t\t\tonEachFeature: function(feature, layer) {\n\t\t\t\t\tvar visited = null;//not supported on geojson sources for now\n\t\t\t\t\tvar popup = popupView.buildPopup(this._manager, name, url, null, extraInfos, visited);\n\t\t\t\t\tlayer.bindPopup(popup);\n\t\t\t\t}.bind(this)\n\t\t\t});\n\t\t\tlayers[name] = geoLayer;\n\t\t}.bind(this));\n\t\treturn layers;\n\t},\n\t\n\tbuildLayers: function() {\n\t\tvar layerDatas = this._parseDatas();\n\t\treturn this._translateDatas(layerDatas);\n\t},\n\t\n\tgetAttribution: function() {\n\t\treturn this._bundleConfig.attribution;\n\t}\n});\n\nexport default GeojsonLayer;\n","import leaflet from 'VendorWrappers/leaflet';\n\nvar TracksView = leaflet.Class.extend({\n\tinitialize: function (manager) {\n\t\tthis._manager = manager;\n\t\tthis._colour = '#FF0000';\n\t\tthis._layers = [];\n\t},\n\n\tshowTracks: function(tracks) {\t\t\t\n\t\tthis._layers.forEach(function(layer) {\n\t\t\tlayer.remove();\n\t\t});\n\t\tthis._layers = tracks.map(function(features) {\n\t\t\tlet geoJsonLayer = leaflet.geoJSON(features, {\n\t\t\t\tcolor: this._colour,\n\t\t\t\tonEachFeature: function(feature, layer) {\n\t\t\t\t\tif (feature.properties && feature.properties.name) {\n\t\t\t\t\t\tlayer.bindPopup(feature.properties.name);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tgeoJsonLayer.addTo(this._manager.getMap());\n\t\t\treturn geoJsonLayer;\n\t\t}.bind(this));\n\t}\n});\n\nexport default TracksView\n","import leaflet from 'VendorWrappers/leaflet';\nimport $ from 'jquery';\nimport {gpx as toGeoJSON} from '@tmcw/togeojson';\nimport TracksView from './tracks_view';\n\nvar TrackLoadView = leaflet.Class.extend({\n\tinitialize: function (manager, constraintsView) {\n\t\tthis._constraintsView = constraintsView;\n\t\tthis._tracksView = new TracksView(manager);\n\t\tthis._view = $('<div class=\"setting\"></div>');\n\t\tthis._view.append($('<span>Upload GPX tracks to see markers around those tracks:</span>'));\n\t\tthis._fileInput = $('<input type=\"file\" multiple>');\n\t\tthis._view.append(this._fileInput);\n\t\tthis._fileInput.on('change', this._readFiles.bind(this));\n\t},\n\t\n\t_readFiles: function() {\n\t\tvar tracks = [];\n\t\tvar files = this._fileInput[0].files;\n\t\tfor (var i = 0; i < files.length; i++) {\n\t\t\t(function(file) {//just scoping\n\t\t\t\tvar reader = new FileReader();\n\t\t\t\t//note this function is called asynchronously\n\t\t\t\treader.onload = function(e) {\n\t\t\t\t\tvar track = this._loadTrack(reader.result);\n\t\t\t\t\ttracks.push(track);\n\t\t\t\t\tif (tracks.length == files.length) {\n\t\t\t\t\t\tthis._finishedReadingFiles(tracks);\n\t\t\t\t\t}\n\t\t\t\t}.bind(this)\n\t\t\t\treader.readAsText(file);\n\t\t\t}.bind(this))(files.item(i));\n\t\t}\n\t},\n\t\n\t_finishedReadingFiles: function(tracks) {\n\t\tvar bounds = tracks.map(function(track) {\n\t\t\treturn track.bounds;\n\t\t});\n\t\tvar features = tracks.map(function(track) {\n\t\t\treturn track.features;\n\t\t});\n\t\tthis._constraintsView.limitTo(this, bounds);\n\t\tthis._tracksView.showTracks(features);\n\t},\n\t\n\t_loadTrack: function(xmlString) {\n\t\tvar dom = (new DOMParser()).parseFromString(xmlString, 'text/xml');\n\t\tvar geoJson = toGeoJSON(dom);\n\t\tvar bounds = this._geoJsonBounds(geoJson);\n\t\treturn {\n\t\t\tfeatures: geoJson,\n\t\t\tbounds: bounds\n\t\t};\n\t},\n\t\n\t_geoJsonBounds: function(geoJson) {\n\t\tvar minLng;\n\t\tvar maxLng;\n\t\tvar minLat;\n\t\tvar maxLat;\n\t\tgeoJson.features.forEach(function(feature) {\n\t\t\tvar geometry = feature.geometry;\n\t\t\tvar lineParser = function(line) {\n\t\t\t\tline.forEach(function(point) {\n\t\t\t\t\tvar lng = point[0]\n\t\t\t\t\tvar lat = point[1];\n\t\t\t\t\tif (minLng == null || lng < minLng) {\n\t\t\t\t\t\tminLng = lng;\n\t\t\t\t\t}\n\t\t\t\t\tif (maxLng == null || lng > maxLng) {\n\t\t\t\t\t\tmaxLng = lng;\n\t\t\t\t\t}\n\t\t\t\t\tif (minLat == null || lat < minLat) {\n\t\t\t\t\t\tminLat = lat;\n\t\t\t\t\t}\n\t\t\t\t\tif (maxLat == null || lat > maxLat) {\n\t\t\t\t\t\tmaxLat = lat;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t};\n\t\t\tif (geometry.type == 'MultiLineString') {\n\t\t\t\tgeometry.coordinates.forEach(lineParser);\n\t\t\t} else {\n\t\t\t\tlineParser(geometry.coordinates);\n\t\t\t}\n\t\t});\n\t\tvar latAdjustment = 0.005;//just to extend the bounding box a bit\n\t\tvar lngAdjustment = 0.01;\n\t\tvar bottomLeft = [minLat - latAdjustment, minLng - lngAdjustment];\n\t\tvar topRight = [maxLat + latAdjustment, maxLng + lngAdjustment];\n\t\treturn leaflet.latLngBounds(bottomLeft, topRight);\n\t},\n\t\n\tgetView: function() {\n\t\treturn this._view;\n\t},\n\t\n\treset: function() {\n\t\tthis._fileInput.val('');\n\t\tthis._tracksView.showTracks([]);\n\t}\n});\n\nexport default TrackLoadView\n","export default {\n\tbingKey: \"AgYJwt3nv3bZyK31EDXorMaO8aIix-5kAa32O5TTwFAhdVYtZdIKhw3ttntsmgqy\",\n\tdataSources: ['follies', 'hills', 'milestones', 'defence', 'trails', 'rnli', 'nationalparks', 'coastallandmarks'],\n\tbackendBaseUrl: 'https://europe-west1-geo-bagging-test.cloudfunctions.net/function-1/'\n};\n","import leaflet from 'VendorWrappers/leaflet';\nimport $ from 'jquery';\nimport constants from '../constants';\n\nvar AbstractBundleBuilder = leaflet.Class.extend({\n\tinitialize: function (manager, bundleConfig, bundleName, urlPrefix) {\n\t\tthis._markerList = null;\n\t\tthis._manager = manager;\n\t\tthis._config = manager.getConfig();\n\t\tthis._bundleConfig = bundleConfig;\n\t\tthis._bundleName = bundleName.indexOf('/') == -1 ? bundleName : bundleName.substring(0, bundleName.lastIndexOf('/'));\n\t\tthis._urlPrefix = urlPrefix != null ? urlPrefix : '';\n\t\tthis._visits = [];\n\t},\n\t\n\t_buildDataUrl: function() {\n\t\treturn this._urlPrefix + 'bundles/' + this._bundleName + '/' + this._bundleConfig.dataToLoad;\n\t},\n\t\n\t_doFetchData: function() {\n\t\tvar dataToLoad = this._buildDataUrl();\n\t\tvar dataLoadPromise = $.ajax({\n\t\t\turl: dataToLoad,\n\t\t\tdataType: 'json'\n\t\t}).fail(function(xhr, textError, error) {\n\t\t\tconsole.error(\"Failed to load map data: \" + textError);\n\t\t\tconsole.log(error);\n\t\t});\n\t\t\n\t\tif (this._manager.shouldManageVisits()) {//not loading visits is ok, because we won't display the info either if not authenticated\n\t\t\tvar visitsLoadPromise = $.get({\n\t\t\t\turl: constants.backendBaseUrl + 'listVisits?source=' + this._bundleName,\n\t\t\t\tdataType: 'json',\n\t\t\t\txhrFields: {\n\t\t\t\t\twithCredentials: true\n\t\t\t\t}\n\t\t\t}).then(function(data) {\n\t\t\t\tthis._visits = data.map(function(visit) {\n\t\t\t\t\t//each visit file is named like \"visits-hills-16495\", so get everything after the second hyphen\n\t\t\t\t\treturn visit.substring(visit.indexOf('-', visit.indexOf('-') + 1) + 1)\n\t\t\t\t}.bind(this));\n\t\t\t}.bind(this)).fail(function(xhr, textError, error) {\n\t\t\t\tconsole.error(\"Failed to load map data: \" + textError);\n\t\t\t\tconsole.log(error);\n\t\t\t});\n\t\t\t\n\t\t\treturn $.when(dataLoadPromise, visitsLoadPromise).then(function(datas) {\n\t\t\t\treturn datas[0];//only need to pass the actual data on, not the visits\n\t\t\t});\n\t\t} else {\n\t\t\treturn dataLoadPromise;\n\t\t}\n\t},\n\t\n\tfetchMeta: function() {\n\t\tvar dataToLoad = this._buildDataUrl() + '.meta';\n\t\treturn $.ajax({\n\t\t\turl: dataToLoad,\n\t\t\tdataType: 'json'\n\t\t}).fail(function(xhr, textError, error) {\n\t\t\tconsole.error(\"Failed to load source metadata: \" + textError);\n\t\t\tconsole.log(error);\n\t\t}).done(function(data) {\n\t\t\tthis._meta = data;\n\t\t}.bind(this));\n\t},\n\t\n\tgetMeta: function() {\n\t\treturn this._meta;\n\t},\n\t\n\tgetVisits: function() {\n\t\treturn this._visits;\n\t},\n\t\n\tgetBundleConfig: function() {\n\t\treturn this._bundleConfig;\n\t}\n});\n\nexport default AbstractBundleBuilder;\n","export default window;//if it isn't window, we'll be stubbing this module anyway\n","import AbstractPointsBuilder from '../abstract_points_builder';\n\nvar Builder = AbstractPointsBuilder.extend({\n\tparse: function(point) {\n\t\t//[Longitude,Latitude,Name,Url,Type,ImageLinks]\n\t\tvar lng = point[0];\n\t\tvar lat = point[1];\n\t\tvar name = point[2];\n\t\tvar url = point[3];\n\t\tvar type = point[4];\n\t\tvar imageLinks = point[5];\n\t\t\n\t\tvar typeDisplay = this._bundleConfig.dimensionValueLabels[this._bundleConfig.dimensionNames[0]][type];\n\t\tif (typeDisplay == null) {\n\t\t\ttypeDisplay = type;\n\t\t}\n\n\t\tvar extraInfos = [\n\t\t\t['Type', typeDisplay],\n\t\t\t['Images', this.buildImageLinks(imageLinks)]\n\t\t];\n\t\t\n\t\tthis.addMarker(name, lat, lng, url, name, extraInfos, null, [type]);\n\t}\n});\n\nexport default Builder\n","import leaflet from 'VendorWrappers/leaflet';\nimport PointsBuilder from './points_builder';\n\nvar dimensionNames = ['Follies'];\n\nvar dimensionValueLabels = {};\ndimensionValueLabels[dimensionNames[0]] = {\n\t'Arch_Gateway': 'Arch/Gateway'\n};\n\nexport default {\n\taspectLabel: \"Follies\",\n\tdimensionNames: dimensionNames,\n\tdimensionValueLabels: dimensionValueLabels,\n\tdataToLoad: 'data.json',\n\tparser: PointsBuilder,\n\tattribution: 'Reproduced with the kind permission of Paul from <a href=\"http://www.follies.org.uk/follymaps.htm\">The Folly Fellowship</a>'\n};\n","import leaflet from 'VendorWrappers/leaflet';\nimport $ from 'jquery';\n\nvar CurrentLocationView = leaflet.Class.extend({\n\tinitialize: function (manager, constraintsView) {\n\t\tthis._manager = manager;\n\t\tthis._constraintsView = constraintsView;\n\n\t\tthis._view = $('<div class=\"setting\"></div>');\n\t\tvar currentLocationLimitButton = $('<button type=\"button\">Limit to 5 miles from current location</button>');\n\t\tcurrentLocationLimitButton.click(this._limitToCurrentLocation.bind(this));\n\t\tthis._view.append(currentLocationLimitButton);\n\t},\n\t\n\t_limitToCurrentLocation: function() {\n\t\tvar map = this._manager.getMap();\n\t\tvar listener = function(e) {\n\t\t\tmap.off('locationfound', listener);//only want to be called once\n\t\t\tvar lat = e.latlng.lat;\n\t\t\tvar lng = e.latlng.lng;\n\t\t\tvar latExtra = 0.08;//roughly 5 miles difference in lattitude in the UK\n\t\t\tvar lngExtra = 0.12;//roughly 5 miles difference in longitude in the UK\n\t\t\tvar latLngBounds = new leaflet.latLngBounds(\n\t\t\t\t[lat + latExtra, lng + lngExtra],\n\t\t\t\t[lat - latExtra, lng - lngExtra]\n\t\t\t);\n\t\t\tthis._constraintsView.limitTo(this, latLngBounds);\n\t\t}.bind(this);\n\t\tmap.on('locationfound', listener);\n\t\tmap.stopLocate();\n\t\tmap.locate();\n\t},\n\t\n\tgetView: function() {\n\t\treturn this._view;\n\t},\n\t\n\treset: function() {\n\t\t//nothing to do\n\t}\n});\n\nexport default CurrentLocationView\n","import leaflet from \"leaflet\";\n\nvar CustomDefaultIcon = leaflet.Icon.Default.extend({\n\tinitialize: function (config, customIconPath, options) {\n\t\tcustomIconPath = config.baseUrl + customIconPath\n\t\tthis._customIconPath = customIconPath;\n\t\tif (options.iconUrl != null) {\n\t\t\toptions.iconUrl = config.baseUrl + options.iconUrl\n\t\t\tif (options.iconRetinaUrl == null) {\n\t\t\t\toptions.iconRetinaUrl = options.iconUrl;\n\t\t\t}\n\t\t}\n\t\tif (options.iconRetinaUrl != null) {\n\t\t\toptions.iconRetinaUrl = config.baseUrl + options.iconRetinaUrl\n\t\t}\n\t\tleaflet.Icon.Default.prototype.initialize.call(this, options);\n\t},\n\n\t_getIconUrl: function(name) {\n\t\tvar url = leaflet.Icon.prototype._getIconUrl.call(this, name);\n\t\tif (url == this._customIconPath) {\n\t\t\treturn url;\n\t\t} else {\n\t\t\treturn leaflet.Icon.Default.prototype._getIconUrl.call(this, name);\n\t\t}\n\t}\n});\n\nexport default CustomDefaultIcon\n","var map = {\n\t\"./coastallandmarks/config.js\": \"Cc/U\",\n\t\"./defence/config.js\": \"F/eF\",\n\t\"./follies/config.js\": \"ZhdR\",\n\t\"./hills/config.js\": \"LEIh\",\n\t\"./hills/config_all.js\": \"ttLr\",\n\t\"./milestones/config.js\": \"/1C1\",\n\t\"./nationalparks/config.js\": \"6UUt\",\n\t\"./nt/config.js\": \"N1D+\",\n\t\"./rnli/config.js\": \"Nizc\",\n\t\"./trails/config.js\": \"tVao\",\n\t\"./trigs/config.js\": \"mifp\",\n\t\"./trigs/config_base.js\": \"jvQH\",\n\t\"./trigs/config_embedding.js\": \"IbCe\",\n\t\"./trigs/config_mini.js\": \"r6U7\"\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = \"jKyv\";","export default __webpack_public_path__ + \"d6a3c2969cb19fe70846152c8cb86b6a.png\";","import leaflet from 'VendorWrappers/leaflet';\nimport pointsBuilder from './points_builder';\nimport CustomDefaultIcon from '../../custom_default_icon';\nimport pillarIcon from '../../../img/pillar.png'\n\nvar dimensionNames = ['Type', 'Condition'];\nvar dimensionValueKeys = ['Pillar', 'Bolt', 'Surface Block', 'Rivet', 'Buried Block', 'Cut', 'Other', 'Berntsen', 'FBM', 'Intersected Station', 'Disc', 'Brass Plate', 'Active station', 'Block', 'Concrete Ring', 'Curry Stool', 'Fenomark', 'Platform Bolt', 'Cannon', 'Spider', 'Pipe'];\nvar dimensionValueLabels = {};\nvar typeValueLabels = {};\ndimensionValueLabels[dimensionNames[0]] = typeValueLabels;\n\ndimensionValueKeys.forEach(function(value) {\n\ttypeValueLabels[value] = '<a href=\"http://trigpointing.uk/wiki/' + value + '\">' + value + '</a>';\n});\n\nexport default function build(config) {\n\treturn {\n\t\taspectLabel: \"Trig Points\",\n\t\ticons: {\n\t\t\tPillar: new CustomDefaultIcon(config, pillarIcon, {\n\t\t\t\ticonUrl: pillarIcon,\n\t\t\t\ticonAnchor: [10, 40], // point of the icon which will correspond to marker's location\n\t\t\t\tpopupAnchor: [1, -38] // point from which the popup should open relative to the iconAnchor\n\t\t\t})\n\t\t},\n\t\tdimensionNames: dimensionNames,\n\t\tdimensionValueLabels: dimensionValueLabels,\n\t\tparser: pointsBuilder,\n\t\tattribution: '&copy; <a href=\"http://trigpointing.uk\">trigpointing.uk</a> and licenced by Ordnance Survey under the <a href=\"http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/\">Open Government Licence</a>.'\n\t}\n};\n","//heavily borrowed from www.movable-type.co.uk/scripts/latlong-gridref.html (MIT licence)\nimport proj4 from \"proj4\";\n\t\t\nvar osgbProj = proj4(\"+proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy +datum=OSGB36 +units=m +no_defs\");\n\nfunction pad(num, w) {\n\tvar n = num.toString();\n\twhile (n.length < w) n = '0' + n;\n\treturn n;\n}\n\nexport default {\n\tlatLngToGridRef: function(lat, lng) {\n\n\t\tvar digits = 10;\n\t\t\n\t\tvar out = osgbProj.forward([lng, lat]);//from WSG84\n\t\tvar eastings = out[0];\n\t\tvar northings = out[1];\n\n\t\tdigits = (digits === undefined) ? 10 : Number(digits);\n\t\tif (isNaN(digits)) throw new Error('Invalid precision');\n\n\t\tvar e = Number(Number(eastings));\n\t\tvar n = Number(Number(northings));\n\n\t\tif (isNaN(e) || isNaN(n)) throw new Error('Invalid grid reference: ' + [lat, lng]);\n\n\t\t// use digits = 0 to return numeric format (in metres)\n\t\tif (digits === 0) return pad(e, 6)+','+pad(n, 6);\n\n\t\t// get the 100km-grid indices\n\t\tvar e100k = Math.floor(e/100000), n100k = Math.floor(n/100000);\n\n\t\tif (e100k<0 || e100k>6 || n100k<0 || n100k>12) return '';\n\n\t\t// translate those into numeric equivalents of the grid letters\n\t\tvar l1 = (19-n100k) - (19-n100k)%5 + Math.floor((e100k+10)/5);\n\t\tvar l2 = (19-n100k)*5%25 + e100k%5;\n\n\t\t// compensate for skipped 'I' and build grid letter-pairs\n\t\tif (l1 > 7) l1++;\n\t\tif (l2 > 7) l2++;\n\t\tvar letPair = String.fromCharCode(l1+'A'.charCodeAt(0), l2+'A'.charCodeAt(0));\n\n\t\t// strip 100km-grid indices from easting & northing, and reduce precision\n\t\te = Math.floor((e%100000)/Math.pow(10, 5-digits/2));\n\t\tn = Math.floor((n%100000)/Math.pow(10, 5-digits/2));\n\n\t\tvar gridRef = letPair + ' ' + pad(e, digits/2) + ' ' + pad(n, digits/2);\n\n\t\treturn gridRef;\n\t},\n\n\tosgbToLngLat: function(eastings, northings) {\n\t\tvar out = osgbProj.inverse([eastings, northings]);//to WSG84\n\t\treturn out;\n\t},\n\t\n\tgridRefToOsgb: function(/*String*/ gridref) {\n\t\tgridref = String(gridref).trim();\n\t\tthis._determineGridRefType(gridref);\n\n\t\t// check for fully numeric comma-separated gridref format\n\t\tvar match = gridref.match(/^(\\d+),\\s*(\\d+)$/);\n\t\tif (match) return new OsGridRef(match[1], match[2]);\n\n\t\t// validate format\n\t\tmatch = gridref.match(/^[A-Z]{2}\\s*[0-9]+\\s*[0-9]+$/i);\n\t\tif (!match) throw new Error('Invalid grid reference: ' + gridref);\n\n\t\t// get numeric values of letter references, mapping A->0, B->1, C->2, etc:\n\t\tvar l1 = gridref.toUpperCase().charCodeAt(0) - 'A'.charCodeAt(0);\n\t\tvar l2 = gridref.toUpperCase().charCodeAt(1) - 'A'.charCodeAt(0);\n\t\t// shuffle down letters after 'I' since 'I' is not used in grid:\n\t\tif (l1 > 7) l1--;\n\t\tif (l2 > 7) l2--;\n\n\t\t// convert grid letters into 100km-square indexes from false origin (grid square SV):\n\t\tvar e100km = ((l1-2)%5)*5 + (l2%5);\n\t\tvar n100km = (19-Math.floor(l1/5)*5) - Math.floor(l2/5);\n\n\t\t// skip grid letters to get numeric (easting/northing) part of ref\n\t\tvar en = gridref.slice(2).trim().split(/\\s+/);\n\t\t// if e/n not whitespace separated, split half way\n\t\tif (en.length == 1) en = [ en[0].slice(0, en[0].length/2), en[0].slice(en[0].length/2) ];\n\n\t\t//fix for grid refs technically part of the grid but outside of the uk\n\t\t//this helped to work this out: https://raw.githubusercontent.com/wu-lee/dinty/master/national-grid.png\n\t\tif (e100km >= 15) {\n\t\t\te100km -= 25\n\t\t}\n\t\tif (n100km > 20) {\n\t\t\tn100km -= 25\n\t\t}\n\n\t\t// validation\n\t\tif (e100km < -10 || n100km < -5)  throw new Error('Invalid grid reference: gridref='+gridref+', e100km='+e100km+', n100km='+n100km);\n\t\tif (en.length != 2) throw new Error('Invalid grid reference: ' + gridref);\n\t\tif (en[0].length != en[1].length) throw new Error('Invalid grid reference: ' + gridref);\n\n\t\t// standardise to 10-digit refs (metres)\n\t\ten[0] = (en[0]+'00000').slice(0, 5);\n\t\ten[1] = (en[1]+'00000').slice(0, 5);\n\n\t\tvar e = parseInt(e100km + '00000') + parseInt(en[0]);\n\t\tvar n = parseInt(n100km + '00000') + parseInt(en[1]);\n\n\t\treturn [e, n];\n\t},\n\n\tgridRefToLngLat: function(/*String*/ gridref) {\n\t\tvar lngLat = this.gridRefToOsgb(gridref);\n\t\tvar out = osgbProj.inverse(lngLat);//to WSG84\n\t\treturn out;\n\t},\n\t\n\t_determineGridRefType: function(gridref) {\n\t\tif (/^\\w\\s*\\d{3,}\\s*\\d{3,}$/.test(gridref)) {\n\t\t\tthrow new Error('Irish grid references currently unsupported: ' + gridref);\n\t\t}\n\t}\n};\n","import $ from 'jquery';\nimport trigpointingBase from './config_base';\n\nexport default function build(config) {\n\treturn $.extend({}, trigpointingBase(config), {dataToLoad: 'data_all.json'});\n}\n","export default __webpack_public_path__ + \"ad2f9c148c8f35cb2996a55ceb6e3bbe.png\";","import AbstractBundleBuilder from './abstract_bundle_builder';\n\nvar PointsBuilder = AbstractBundleBuilder.extend({\n\tinitialize: function (manager, bundleConfig, bundleName, urlPrefix) {\n\t\tAbstractBundleBuilder.prototype.initialize.call(this, manager, bundleConfig, bundleName, urlPrefix);\n\t\tthis._markerList = null;\n\t\tthis._bundleConfig = bundleConfig;\n\t},\n\t\n\tfetchData: function(urlPrefix) {\n\t\treturn this._doFetchData(urlPrefix).done(function(data) {\n\t\t\tthis.addMarkers(data);\n\t\t}.bind(this));\n\t},\n\t\n\taddMarkers: function(data) {\n\t\tvar pointsToLoad = data.data;\n\t\tfor (var i = 0; i < pointsToLoad.length; i++) {\n\t\t\tthis.parse(pointsToLoad[i]);\n\t\t}\n\t\tif (this._bundleConfig.attribution != null) {\n\t\t\tthis._attributionText = this._bundleConfig.attribution;\n\t\t} else {\n\t\t\tthis._attributionText = data.attribution;\n\t\t}\n\t},\n\t\n\taddMarker: function (id, lat, lng, url, name, extraTexts, icon, dimensionValues, layerId) {\n\t\tid = encodeURIComponent(id);\n\t\tvar latLng = [parseFloat(lat), parseFloat(lng)];\n\t\tvar visited = this.getVisits().indexOf(id) != -1;\n\t\tvar marker = {\n\t\t\tid: id, // for filtering purposes\n\t\t\tlatLng: latLng,\n\t\t\tname: name,\n\t\t\textraTexts: extraTexts,\n\t\t\texportName: name,\n\t\t\turl: url,\n\t\t\ticon: icon,\n\t\t\tlayerId: layerId,\n\t\t\tvisited: visited\n\t\t};\n\t\t\n\t\tif (this._config.dimensional_layering || dimensionValues == null || dimensionValues.length === 0) {\n\t\t\tif (this._markerList == null) {\n\t\t\t\tthis._markerList = {};\n\t\t\t}\n\t\t\t\t\n\t\t\tif (this._withinConstraints(marker)) {\n\t\t\t\tvar currentMap = this._markerList;\n\t\t\t\tfor (var i = 0; i < dimensionValues.length - 1; i++) { // all but the last one\n\t\t\t\t\tvar key = dimensionValues[i];\n\t\t\t\t\tif (currentMap[key] == null) {\n\t\t\t\t\t\tcurrentMap[key] = {};\n\t\t\t\t\t}\n\t\t\t\t\tcurrentMap = currentMap[key];\n\t\t\t\t}\n\t\t\t\tvar lastKey = dimensionValues[dimensionValues.length - 1];\n\t\t\t\tif (currentMap[lastKey] == null) {\n\t\t\t\t\tcurrentMap[lastKey] = []; // set the last level to be an array\n\t\t\t\t}\n\t\t\t\tcurrentMap[lastKey].push(marker);\n\t\t\t}\n\t\t} else {\n\t\t\tif (this._markerList == null) {\n\t\t\t\tthis._markerList = [];\n\t\t\t}\n\t\t\tthis._markerList.push(marker);\n\t\t}\n\t},\n\t\n\t_withinConstraints: function(marker) {\n\t\tvar matcher = this._manager.getViewConstraints();\n\t\treturn matcher == null || matcher(marker.latLng);\n\t},\n\t\n\tbuildImageLinks: function(linksArray) {\n\t\treturn linksArray.map(function(elem, index) {\n\t\t\treturn ['Image ' + (index + 1), elem];\n\t\t});\n\t},\n\t\t\n\tsplit: function(values, labels) {\n\t\treturn values.split(';').map(function(value) {\n\t\t\tvar label = labels[value];\n\t\t\treturn label != null ? label : value;\n\t\t});\n\t},\n\t\n\tgetMarkerList: function() {\n\t\treturn this._markerList;\n\t},\n\t\n\tgetAttribution: function() {\n\t\treturn this._attributionText;\n\t}\n});\n\nexport default PointsBuilder;\n","import $ from 'jquery';\nimport trigpointingBase from './config_base';\n\nexport default function build(config) {\n\treturn $.extend({}, trigpointingBase(config), {dataToLoad: 'data_mini.json'});\n}\n","import AbstractGeojsonBuilder from '../abstract_geojson_builder';\n\nvar Builder = AbstractGeojsonBuilder.extend({\n\tparse: function(feature) {\n\t\tvar name = feature.properties.name;\n\t\tvar url = this.getBundleConfig().urls[name];\n\t\tvar geojson = {\n\t\t\t\"type\": \"FeatureCollection\",\n\t\t\t\"features\": [feature]\n\t\t};\n\t\tvar extraInfos = [\n\t\t\t[\"Length (miles)\", feature.properties.length],\n\t\t\t[\"Notes\", feature.properties.notes]\n\t\t];\n\t\tvar openedDate = feature.properties['openedDate'];\n\t\tif (openedDate != null) {\n\t\t\tvar formattedDate = new Date(openedDate).toLocaleDateString();\n\t\t\textraInfos.push(['Opened', formattedDate]);\n\t\t}\n\t\treturn {\n\t\t\tname: name,\n\t\t\turl: url,\n\t\t\tgeojson: geojson,\n\t\t\textraInfos: extraInfos\n\t\t}\n\t}\n});\n\nexport default Builder\n","import Builder from './builder';\n\nvar dimensionNames = [\"National Trails\"];\n\nvar keys = [\n\t\"Pennine Way\",\n\t\"Cleveland Way\",\n\t\"Offa's Dyke Path\",\n\t\"South Downs Way\",\n\t\"The Ridgeway\",\n\t\"South West Coast Path\",\n\t\"Yorkshire Wolds Way\",\n\t\"North Downs Way\",\n\t\"Peddar's Way and Norfolk Coast Path\",\n\t\"Thames Path\",\n\t\"Hadrian's Wall Path\",\n\t\"Cotswold Way\",\n\t\"Pennine Bridleway\",\n\t\"England Coast Path\",\n\t\"Glyndr's Way\"\n];\nvar urls = {};\nkeys.forEach(function(key){\n\tvar munged = key.replace(/^The /g, \"\").replace(/\\s/g, \"-\").replace(/'/g, \"\").replace(//g, 'w').toLowerCase();\n\turls[key] = 'http://www.nationaltrail.co.uk/' + munged;\n});\nurls[\"Wales Coast Path\"] = \"http://www.walescoastpath.gov.uk\";\n\nexport default {\n\taspectLabel: \"National Trails\",\n\tdimensionNames: dimensionNames,\n\tdataToLoad: 'data.geojson',\n\tparser: Builder,\n\tattribution: 'Natural England Open Data (<a href=\"http://www.nationalarchives.gov.uk/doc/open-government-licence/version/\">OGL</a>)',\n\turls: urls\n};\n","//Have to import all css files up front to force the ordering\n//note these should be repeated as dependencies of the thing that actually uses them\n\n//third party\nimport 'leaflet/dist/leaflet.css'\nimport 'Leaflet.MapCenterCoord/src/L.Control.MapCenterCoord.css'\nimport 'leaflet-mouse-position/src/L.Control.MousePosition.css'\nimport 'leaflet.locatecontrol/dist/L.Control.Locate.min.css'\nimport 'leaflet.markercluster/dist/MarkerCluster.Default.css'\nimport 'leaflet.markercluster/dist/MarkerCluster.css'\nimport 'leaflet-geosearch/src/css/l.geosearch.css'\nimport 'sidebar-v2/css/leaflet-sidebar.css'\n\n//my modules that are external to this project\nimport 'leaflet-matrix-layers-control/src/matrixControl.css'\nimport 'leaflet-box-selector/src/selector.css'\nimport 'leaflet-control-hider/src/hider.css'\n\n//this project's styles\nimport '../../style/main.scss'\n","import $ from 'jquery';\nimport configBase from './config';\n\nexport default function build(config) {\n\treturn $.extend({}, configBase(config), {dataToLoad: 'data_all.json'});\n}\n"],"sourceRoot":""}